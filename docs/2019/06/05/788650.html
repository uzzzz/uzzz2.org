<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>效率提高N倍的19条MySQL优化秘籍 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="效率提高N倍的19条MySQL优化秘籍" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一、EXPLAIN 做MySQL优化，我们要善用&nbsp;EXPLAIN&nbsp;查看SQL执行计划。 下面来个简单的示例，标注(1,2,3,4,5)我们要重点关注的数据 type列，连接类型。一个好的sql语句至少要达到range级别。杜绝出现all级别 key列，使用到的索引名。如果没有选择索引，值是NULL。可以采取强制索引方 key_len列，索引长度 rows列，扫描行数。该值是个预估值 extra列，详细说明。注意常见的不太友好的值有：Using filesort, Using temporary 二、SQL语句中IN包含的值不应过多 MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了；再或者使用连接来替换。 三、SELECT语句务必指明字段名称 SELECT *增加很多不必要的消耗（cpu、io、内存、网络带宽）；增加了使用覆盖索引的可能性；当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。 四、当只需要一条数据的时候，使用limit 1 这是为了使EXPLAIN中type列达到const类型 五、如果排序字段没有用到索引，就尽量少排序 六、如果限制条件中其他字段没有索引，尽量少用or or两边的字段中，如果有一个不是索引字段，而其他条件也不是索引字段，会造成该查询不走索引的情况。很多时候使用 union all 或者是union(必要的时候)的方式来代替“or”会得到更好的效果。 七、尽量用union all代替union union和union all的差异主要是前者需要将结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的CPU运算，加大资源消耗及延迟。当然，union all的前提条件是两个结果集没有重复数据。 八、不使用ORDER BY RAND() select id from `dynamic` order by rand() limit 1000; 上面的sql语句，可优化为 select id from `dynamic` t1 join (select rand() * (select max(id) from `dynamic`) as nid) t2 on t1.id &gt; t2.nidlimit 1000; 九、区分in和exists， not in和not exists select * from 表A where id in (select id from 表B) 上面sql语句相当于 select * from 表A where exists(select * from 表B where 表B.id=表A.id) 区分in和exists主要是造成了驱动顺序的改变（这是性能变化的关键），如果是exists，那么以外层表为驱动表，先被访问，如果是IN，那么先执行子查询。所以IN适合于外表大而内表小的情况；EXISTS适合于外表小而内表大的情况。 关于not in和not exists，推荐使用not exists，不仅仅是效率问题，not in可能存在逻辑问题。如何高效的写出一个替代not exists的sql语句？ 原sql语句 select colname … from A表 where a.id not in (select b.id from B表) 高效的sql语句 select colname … from A表 Left join B表 on where a.id = b.id where b.id is null 取出的结果集如下图表示，A表不在B表中的数据 十、使用合理的分页方式以提高分页的效率 select&nbsp;id,name&nbsp;from&nbsp;product&nbsp;limit&nbsp;866613,&nbsp;20 使用上述sql语句做分页的时候，可能有人会发现，随着表数据量的增加，直接使用limit分页查询会越来越慢。 优化的方法如下：可以取前一页的最大行数的id，然后根据这个最大的id来限制下一页的起点。比如此列中，上一页最大的id是866612。sql可以采用如下的写法： select id,name from product where id&gt; 866612 limit 20 十一、分段查询 在一些用户选择页面中，可能一些用户选择的时间范围过大，造成查询缓慢。主要的原因是扫描行数过多。这个时候可以通过程序，分段进行查询，循环遍历，将结果合并处理进行展示。 如下图这个sql语句，扫描的行数成百万级以上的时候就可以使用分段查询 十二、避免在 where 子句中对字段进行 null 值判断 对于null的判断会导致引擎放弃使用索引而进行全表扫描。 十三、不建议使用%前缀模糊查询 例如LIKE “%name”或者LIKE “%name%”，这种查询会导致索引失效而进行全表扫描。但是可以使用LIKE “name%”。那如何查询%name%？如下图所示，虽然给secret字段添加了索引，但在explain结果果并没有使用 那么如何解决这个问题呢，答案：使用全文索引 在我们查询中经常会用到select id,fnum,fdst from dynamic_201606 where user_name like &#39;%zhangsan%&#39;; 。这样的语句，普通索引是无法满足查询需求的。庆幸的是在MySQL中，有全文索引来帮助我们。 创建全文索引的sql语法是： ALTER TABLE `dynamic_201606` ADD FULLTEXT INDEX `idx_user_name` (`user_name`); 使用全文索引的sql语句是： select id,fnum,fdst from dynamic_201606 where match(user_name) against(&#39;zhangsan&#39; in boolean mode); 注意：在需要创建全文索引之前，请联系DBA确定能否创建。同时需要注意的是查询语句的写法与普通索引的区别 十四、避免在where子句中对字段进行表达式操作 比如 select user_id,user_project from user_base where age*2=36; 中对字段就行了算术运算，这会造成引擎放弃使用索引，建议改成 select user_id,user_project from user_base where age=36/2; 十五、避免隐式类型转换 where 子句中出现 column 字段的类型和传入的参数类型不一致的时候发生的类型转换，建议先确定where中的参数类型 十六、对于联合索引来说，要遵守最左前缀法则 举列来说索引含有字段id,name,school，可以直接用id字段，也可以id,name这样的顺序，但是name;school都无法使用这个索引。所以在创建联合索引的时候一定要注意索引字段顺序，常用的查询字段放在最前面 十七、必要时可以使用force index来强制查询走某个索引 有的时候MySQL优化器采取它认为合适的索引来检索sql语句，但是可能它所采用的索引并不是我们想要的。这时就可以采用forceindex来强制优化器使用我们制定的索引。 十八、注意范围查询语句 对于联合索引来说，如果存在范围查询，比如between,&gt;,&lt;等条件时，会造成后面的索引字段失效。 十九、关于JOIN优化 LEFT JOIN A表为驱动表INNER JOIN MySQL会自动找出那个数据少的表作用驱动表RIGHT JOIN B表为驱动表注意：MySQL中没有full join，可以用以下方式来解决select * from A left join B on B.name = A.namewhere B.name is nullunion allselect * from B;尽量使用inner join，避免left join参与联合查询的表至少为2张表，一般都存在大小之分。如果连接方式是inner join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表，但是left join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。合理利用索引被驱动表的索引字段作为on的限制字段。利用小表去驱动大表 从原理图能够直观的看出如果能够减少驱动表的话，减少嵌套循环中的循环次数，以减少 IO总量及CPU运算的次数。 巧用STRAIGHT_JOIN inner join是由mysql选择驱动表，但是有些特殊情况需要选择另个表作为驱动表，比如有group by、order by等「Using filesort」、「Using temporary」时。STRAIGHT_JOIN来强制连接顺序，在STRAIGHT_JOIN左边的表名就是驱动表，右边则是被驱动表。在使用STRAIGHT_JOIN有个前提条件是该查询是内连接，也就是inner join。其他链接不推荐使用STRAIGHT_JOIN，否则可能造成查询结果不准确。 出处：https://zhuanlan.zhihu.com/p/49888088 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;Mydata一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<meta property="og:description" content="一、EXPLAIN 做MySQL优化，我们要善用&nbsp;EXPLAIN&nbsp;查看SQL执行计划。 下面来个简单的示例，标注(1,2,3,4,5)我们要重点关注的数据 type列，连接类型。一个好的sql语句至少要达到range级别。杜绝出现all级别 key列，使用到的索引名。如果没有选择索引，值是NULL。可以采取强制索引方 key_len列，索引长度 rows列，扫描行数。该值是个预估值 extra列，详细说明。注意常见的不太友好的值有：Using filesort, Using temporary 二、SQL语句中IN包含的值不应过多 MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了；再或者使用连接来替换。 三、SELECT语句务必指明字段名称 SELECT *增加很多不必要的消耗（cpu、io、内存、网络带宽）；增加了使用覆盖索引的可能性；当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。 四、当只需要一条数据的时候，使用limit 1 这是为了使EXPLAIN中type列达到const类型 五、如果排序字段没有用到索引，就尽量少排序 六、如果限制条件中其他字段没有索引，尽量少用or or两边的字段中，如果有一个不是索引字段，而其他条件也不是索引字段，会造成该查询不走索引的情况。很多时候使用 union all 或者是union(必要的时候)的方式来代替“or”会得到更好的效果。 七、尽量用union all代替union union和union all的差异主要是前者需要将结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的CPU运算，加大资源消耗及延迟。当然，union all的前提条件是两个结果集没有重复数据。 八、不使用ORDER BY RAND() select id from `dynamic` order by rand() limit 1000; 上面的sql语句，可优化为 select id from `dynamic` t1 join (select rand() * (select max(id) from `dynamic`) as nid) t2 on t1.id &gt; t2.nidlimit 1000; 九、区分in和exists， not in和not exists select * from 表A where id in (select id from 表B) 上面sql语句相当于 select * from 表A where exists(select * from 表B where 表B.id=表A.id) 区分in和exists主要是造成了驱动顺序的改变（这是性能变化的关键），如果是exists，那么以外层表为驱动表，先被访问，如果是IN，那么先执行子查询。所以IN适合于外表大而内表小的情况；EXISTS适合于外表小而内表大的情况。 关于not in和not exists，推荐使用not exists，不仅仅是效率问题，not in可能存在逻辑问题。如何高效的写出一个替代not exists的sql语句？ 原sql语句 select colname … from A表 where a.id not in (select b.id from B表) 高效的sql语句 select colname … from A表 Left join B表 on where a.id = b.id where b.id is null 取出的结果集如下图表示，A表不在B表中的数据 十、使用合理的分页方式以提高分页的效率 select&nbsp;id,name&nbsp;from&nbsp;product&nbsp;limit&nbsp;866613,&nbsp;20 使用上述sql语句做分页的时候，可能有人会发现，随着表数据量的增加，直接使用limit分页查询会越来越慢。 优化的方法如下：可以取前一页的最大行数的id，然后根据这个最大的id来限制下一页的起点。比如此列中，上一页最大的id是866612。sql可以采用如下的写法： select id,name from product where id&gt; 866612 limit 20 十一、分段查询 在一些用户选择页面中，可能一些用户选择的时间范围过大，造成查询缓慢。主要的原因是扫描行数过多。这个时候可以通过程序，分段进行查询，循环遍历，将结果合并处理进行展示。 如下图这个sql语句，扫描的行数成百万级以上的时候就可以使用分段查询 十二、避免在 where 子句中对字段进行 null 值判断 对于null的判断会导致引擎放弃使用索引而进行全表扫描。 十三、不建议使用%前缀模糊查询 例如LIKE “%name”或者LIKE “%name%”，这种查询会导致索引失效而进行全表扫描。但是可以使用LIKE “name%”。那如何查询%name%？如下图所示，虽然给secret字段添加了索引，但在explain结果果并没有使用 那么如何解决这个问题呢，答案：使用全文索引 在我们查询中经常会用到select id,fnum,fdst from dynamic_201606 where user_name like &#39;%zhangsan%&#39;; 。这样的语句，普通索引是无法满足查询需求的。庆幸的是在MySQL中，有全文索引来帮助我们。 创建全文索引的sql语法是： ALTER TABLE `dynamic_201606` ADD FULLTEXT INDEX `idx_user_name` (`user_name`); 使用全文索引的sql语句是： select id,fnum,fdst from dynamic_201606 where match(user_name) against(&#39;zhangsan&#39; in boolean mode); 注意：在需要创建全文索引之前，请联系DBA确定能否创建。同时需要注意的是查询语句的写法与普通索引的区别 十四、避免在where子句中对字段进行表达式操作 比如 select user_id,user_project from user_base where age*2=36; 中对字段就行了算术运算，这会造成引擎放弃使用索引，建议改成 select user_id,user_project from user_base where age=36/2; 十五、避免隐式类型转换 where 子句中出现 column 字段的类型和传入的参数类型不一致的时候发生的类型转换，建议先确定where中的参数类型 十六、对于联合索引来说，要遵守最左前缀法则 举列来说索引含有字段id,name,school，可以直接用id字段，也可以id,name这样的顺序，但是name;school都无法使用这个索引。所以在创建联合索引的时候一定要注意索引字段顺序，常用的查询字段放在最前面 十七、必要时可以使用force index来强制查询走某个索引 有的时候MySQL优化器采取它认为合适的索引来检索sql语句，但是可能它所采用的索引并不是我们想要的。这时就可以采用forceindex来强制优化器使用我们制定的索引。 十八、注意范围查询语句 对于联合索引来说，如果存在范围查询，比如between,&gt;,&lt;等条件时，会造成后面的索引字段失效。 十九、关于JOIN优化 LEFT JOIN A表为驱动表INNER JOIN MySQL会自动找出那个数据少的表作用驱动表RIGHT JOIN B表为驱动表注意：MySQL中没有full join，可以用以下方式来解决select * from A left join B on B.name = A.namewhere B.name is nullunion allselect * from B;尽量使用inner join，避免left join参与联合查询的表至少为2张表，一般都存在大小之分。如果连接方式是inner join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表，但是left join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。合理利用索引被驱动表的索引字段作为on的限制字段。利用小表去驱动大表 从原理图能够直观的看出如果能够减少驱动表的话，减少嵌套循环中的循环次数，以减少 IO总量及CPU运算的次数。 巧用STRAIGHT_JOIN inner join是由mysql选择驱动表，但是有些特殊情况需要选择另个表作为驱动表，比如有group by、order by等「Using filesort」、「Using temporary」时。STRAIGHT_JOIN来强制连接顺序，在STRAIGHT_JOIN左边的表名就是驱动表，右边则是被驱动表。在使用STRAIGHT_JOIN有个前提条件是该查询是内连接，也就是inner join。其他链接不推荐使用STRAIGHT_JOIN，否则可能造成查询结果不准确。 出处：https://zhuanlan.zhihu.com/p/49888088 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;Mydata一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<link rel="canonical" href="https://uzzz.org/2019/06/05/788650.html" />
<meta property="og:url" content="https://uzzz.org/2019/06/05/788650.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一、EXPLAIN 做MySQL优化，我们要善用&nbsp;EXPLAIN&nbsp;查看SQL执行计划。 下面来个简单的示例，标注(1,2,3,4,5)我们要重点关注的数据 type列，连接类型。一个好的sql语句至少要达到range级别。杜绝出现all级别 key列，使用到的索引名。如果没有选择索引，值是NULL。可以采取强制索引方 key_len列，索引长度 rows列，扫描行数。该值是个预估值 extra列，详细说明。注意常见的不太友好的值有：Using filesort, Using temporary 二、SQL语句中IN包含的值不应过多 MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了；再或者使用连接来替换。 三、SELECT语句务必指明字段名称 SELECT *增加很多不必要的消耗（cpu、io、内存、网络带宽）；增加了使用覆盖索引的可能性；当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。 四、当只需要一条数据的时候，使用limit 1 这是为了使EXPLAIN中type列达到const类型 五、如果排序字段没有用到索引，就尽量少排序 六、如果限制条件中其他字段没有索引，尽量少用or or两边的字段中，如果有一个不是索引字段，而其他条件也不是索引字段，会造成该查询不走索引的情况。很多时候使用 union all 或者是union(必要的时候)的方式来代替“or”会得到更好的效果。 七、尽量用union all代替union union和union all的差异主要是前者需要将结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的CPU运算，加大资源消耗及延迟。当然，union all的前提条件是两个结果集没有重复数据。 八、不使用ORDER BY RAND() select id from `dynamic` order by rand() limit 1000; 上面的sql语句，可优化为 select id from `dynamic` t1 join (select rand() * (select max(id) from `dynamic`) as nid) t2 on t1.id &gt; t2.nidlimit 1000; 九、区分in和exists， not in和not exists select * from 表A where id in (select id from 表B) 上面sql语句相当于 select * from 表A where exists(select * from 表B where 表B.id=表A.id) 区分in和exists主要是造成了驱动顺序的改变（这是性能变化的关键），如果是exists，那么以外层表为驱动表，先被访问，如果是IN，那么先执行子查询。所以IN适合于外表大而内表小的情况；EXISTS适合于外表小而内表大的情况。 关于not in和not exists，推荐使用not exists，不仅仅是效率问题，not in可能存在逻辑问题。如何高效的写出一个替代not exists的sql语句？ 原sql语句 select colname … from A表 where a.id not in (select b.id from B表) 高效的sql语句 select colname … from A表 Left join B表 on where a.id = b.id where b.id is null 取出的结果集如下图表示，A表不在B表中的数据 十、使用合理的分页方式以提高分页的效率 select&nbsp;id,name&nbsp;from&nbsp;product&nbsp;limit&nbsp;866613,&nbsp;20 使用上述sql语句做分页的时候，可能有人会发现，随着表数据量的增加，直接使用limit分页查询会越来越慢。 优化的方法如下：可以取前一页的最大行数的id，然后根据这个最大的id来限制下一页的起点。比如此列中，上一页最大的id是866612。sql可以采用如下的写法： select id,name from product where id&gt; 866612 limit 20 十一、分段查询 在一些用户选择页面中，可能一些用户选择的时间范围过大，造成查询缓慢。主要的原因是扫描行数过多。这个时候可以通过程序，分段进行查询，循环遍历，将结果合并处理进行展示。 如下图这个sql语句，扫描的行数成百万级以上的时候就可以使用分段查询 十二、避免在 where 子句中对字段进行 null 值判断 对于null的判断会导致引擎放弃使用索引而进行全表扫描。 十三、不建议使用%前缀模糊查询 例如LIKE “%name”或者LIKE “%name%”，这种查询会导致索引失效而进行全表扫描。但是可以使用LIKE “name%”。那如何查询%name%？如下图所示，虽然给secret字段添加了索引，但在explain结果果并没有使用 那么如何解决这个问题呢，答案：使用全文索引 在我们查询中经常会用到select id,fnum,fdst from dynamic_201606 where user_name like &#39;%zhangsan%&#39;; 。这样的语句，普通索引是无法满足查询需求的。庆幸的是在MySQL中，有全文索引来帮助我们。 创建全文索引的sql语法是： ALTER TABLE `dynamic_201606` ADD FULLTEXT INDEX `idx_user_name` (`user_name`); 使用全文索引的sql语句是： select id,fnum,fdst from dynamic_201606 where match(user_name) against(&#39;zhangsan&#39; in boolean mode); 注意：在需要创建全文索引之前，请联系DBA确定能否创建。同时需要注意的是查询语句的写法与普通索引的区别 十四、避免在where子句中对字段进行表达式操作 比如 select user_id,user_project from user_base where age*2=36; 中对字段就行了算术运算，这会造成引擎放弃使用索引，建议改成 select user_id,user_project from user_base where age=36/2; 十五、避免隐式类型转换 where 子句中出现 column 字段的类型和传入的参数类型不一致的时候发生的类型转换，建议先确定where中的参数类型 十六、对于联合索引来说，要遵守最左前缀法则 举列来说索引含有字段id,name,school，可以直接用id字段，也可以id,name这样的顺序，但是name;school都无法使用这个索引。所以在创建联合索引的时候一定要注意索引字段顺序，常用的查询字段放在最前面 十七、必要时可以使用force index来强制查询走某个索引 有的时候MySQL优化器采取它认为合适的索引来检索sql语句，但是可能它所采用的索引并不是我们想要的。这时就可以采用forceindex来强制优化器使用我们制定的索引。 十八、注意范围查询语句 对于联合索引来说，如果存在范围查询，比如between,&gt;,&lt;等条件时，会造成后面的索引字段失效。 十九、关于JOIN优化 LEFT JOIN A表为驱动表INNER JOIN MySQL会自动找出那个数据少的表作用驱动表RIGHT JOIN B表为驱动表注意：MySQL中没有full join，可以用以下方式来解决select * from A left join B on B.name = A.namewhere B.name is nullunion allselect * from B;尽量使用inner join，避免left join参与联合查询的表至少为2张表，一般都存在大小之分。如果连接方式是inner join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表，但是left join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。合理利用索引被驱动表的索引字段作为on的限制字段。利用小表去驱动大表 从原理图能够直观的看出如果能够减少驱动表的话，减少嵌套循环中的循环次数，以减少 IO总量及CPU运算的次数。 巧用STRAIGHT_JOIN inner join是由mysql选择驱动表，但是有些特殊情况需要选择另个表作为驱动表，比如有group by、order by等「Using filesort」、「Using temporary」时。STRAIGHT_JOIN来强制连接顺序，在STRAIGHT_JOIN左边的表名就是驱动表，右边则是被驱动表。在使用STRAIGHT_JOIN有个前提条件是该查询是内连接，也就是inner join。其他链接不推荐使用STRAIGHT_JOIN，否则可能造成查询结果不准确。 出处：https://zhuanlan.zhihu.com/p/49888088 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;Mydata一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂","@type":"BlogPosting","url":"https://uzzz.org/2019/06/05/788650.html","headline":"效率提高N倍的19条MySQL优化秘籍","dateModified":"2019-06-05T00:00:00+08:00","datePublished":"2019-06-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/06/05/788650.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>效率提高N倍的19条MySQL优化秘籍</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">一、EXPLAIN</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">做MySQL优化，我们要善用&nbsp;EXPLAIN&nbsp;查看SQL执行计划。<br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">下面来个简单的示例，标注(1,2,3,4,5)我们要重点关注的数据</span><br></p>
   <figure>
    <img class="origin_image zh-lightbox-thumb lazy" width="800" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ictltfwUoaKhksoA5d6bzfa9umZUzib2yKMKOtqNApzAicYKxticpIndicXrA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <ul style="list-style-type:square;" class="list-paddingleft-2">
    <li><p style="line-height:1.5em;"><span style="font-size:14px;">type列，连接类型。一个好的sql语句至少要达到range级别。杜绝出现all级别</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:14px;">key列，使用到的索引名。如果没有选择索引，值是NULL。可以采取强制索引方</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:14px;">key_len列，索引长度</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:14px;">rows列，扫描行数。该值是个预估值</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:14px;">extra列，详细说明。注意常见的不太友好的值有：Using filesort, Using temporary<br></span><strong><span style="font-size:16px;color:rgb(0,122,170);"><br></span></strong></p></li>
   </ul>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">二、SQL语句中IN包含的值不应过多</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">MySQL对于IN做了相应的优化，即将IN中的常量全部存储在一个数组里面，而且这个数组是排好序的。但是如果数值较多，产生的消耗也是比较大的。再例如：select id from t where num in(1,2,3) 对于连续的数值，能用 between 就不要用 in 了；再或者使用连接来替换。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">三、SELECT语句务必指明字段名称</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">SELECT *增加很多不必要的消耗（cpu、io、内存、网络带宽）；增加了使用覆盖索引的可能性；当表结构发生改变时，前断也需要更新。所以要求直接在select后面接上字段名。<br></span><strong><span style="font-size:16px;color:rgb(0,122,170);"><br></span></strong></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">四、当只需要一条数据的时候，使用limit 1</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">这是为了使EXPLAIN中type列达到const类型<br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">五、如果排序字段没有用到索引，就尽量少排序</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">六、如果限制条件中其他字段没有索引，尽量少用or</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">or两边的字段中，如果有一个不是索引字段，而其他条件也不是索引字段，会造成该查询不走索引的情况。很多时候使用 union all 或者是union(必要的时候)的方式来代替“or”会得到更好的效果。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">七、尽量用union all代替union</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;">union和union all的差异主要是前者需要将结果集合并后再进行唯一性过滤操作，这就会涉及到排序，增加大量的CPU运算，加大资源消耗及延迟。<strong>当然，union all的前提条件是两个结果集没有重复数据。</strong></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">八、不使用ORDER BY RAND()</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select id from `dynamic` order by rand() limit 1000;</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;">上面的sql语句，可优化为</span><br></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select id from `dynamic` t1 join (select rand() * (select max(id) from `dynamic`) as nid) t2 on t1.id &gt; t2.nidlimit 1000;</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;"></span><br></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:16px;color:rgb(0,122,170);">九、区分in和exists， not in和not exists</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select * from 表A where id in (select id from 表B)</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;">上面sql语句相当于</span><br></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select * from 表A where exists(select * from 表B where 表B.id=表A.id)</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">区分in和exists主要是造成了驱动顺序的改变（这是性能变化的关键），如果是exists，那么以外层表为驱动表，先被访问，如果是IN，那么先执行子查询。<strong>所以IN适合于外表大而内表小的情况；EXISTS适合于外表小而内表大的情况。</strong></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">关于not in和not exists，推荐使用not exists，不仅仅是效率问题，not in可能存在逻辑问题。<strong>如何高效的写出一个替代not exists的sql语句？</strong></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">原sql语句<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select colname … from A表 where a.id not in (select b.id from B表)</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">高效的sql语句<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select colname … from A表 Left join B表 on where a.id = b.id where b.id is null</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;">取出的结果集如下图表示，A表不在B表中的数据<br><br></span><br></p>
   <figure>
    <img class="content_image lazy" width="331" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ict9G1piciaBuYcUutFK9R2OcbIIiafSbAsVZkfhR5OI34823ER5vz4RsUuw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,122,170);"><strong><span style="font-size:16px;">十、使用合理的分页方式以提高分页的效率</span></strong></span></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>	
select&nbsp;id,name&nbsp;from&nbsp;product&nbsp;limit&nbsp;866613,&nbsp;20</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">使用上述sql语句做分页的时候，可能有人会发现，随着表数据量的增加，直接使用limit分页查询会越来越慢。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">优化的方法如下：可以取前一页的最大行数的id，然后根据这个最大的id来限制下一页的起点。比如此列中，上一页最大的id是866612。sql可以采用如下的写法：<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select id,name from product where id&gt; 866612 limit 20</code></pre>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;"><br></span></strong></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十一、分段查询</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">在一些用户选择页面中，可能一些用户选择的时间范围过大，造成查询缓慢。主要的原因是扫描行数过多。这个时候可以通过程序，分段进行查询，循环遍历，将结果合并处理进行展示。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">如下图这个sql语句，扫描的行数成百万级以上的时候就可以使用分段查询</span><br></p>
   <figure>
    <img class="origin_image zh-lightbox-thumb lazy" width="800" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ictKbfOFZ9ibDYibiann8DOvzdd9c6iaH18kwo41Khzq3cFeCpVvTrIkHiaF5Q/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十二、避免在 where 子句中对字段进行 null 值判断</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">对于null的判断会导致引擎放弃使用索引而进行全表扫描。<br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十三、不建议使用%前缀模糊查询</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">例如LIKE “%name”或者LIKE “%name%”，这种查询会导致索引失效而进行全表扫描。但是可以使用LIKE “name%”。<br>那如何查询%name%？<br>如下图所示，虽然给secret字段添加了索引，但在explain结果果并没有使用<br></span><br></p>
   <figure>
    <img class="origin_image zh-lightbox-thumb lazy" width="640" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ictPwaUcWhXibZDDTh902qdv75HdnpVDxqzYlp4DNicwVgspFuJnGIONUcQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;">那么如何解决这个问题呢，答案：使用全文索引</span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;">在我们查询中经常会用到select id,fnum,fdst from dynamic_201606 where user_name like '%zhangsan%'; 。这样的语句，普通索引是无法满足查询需求的。庆幸的是在MySQL中，有全文索引来帮助我们。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">创建全文索引的sql语法是：<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>ALTER TABLE `dynamic_201606` ADD FULLTEXT INDEX `idx_user_name` (`user_name`);</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;">使用全文索引的sql语句是：<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select id,fnum,fdst from dynamic_201606 where match(user_name) against('zhangsan' in boolean mode);</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="font-size:14px;">注意：在需要创建全文索引之前，请联系DBA确定能否创建。同时需要注意的是查询语句的写法与普通索引的区别</span></strong></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十四、避免在where子句中对字段进行表达式操作</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">比如<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select user_id,user_project from user_base where age*2=36;</code></pre>
   <p style="line-height:1.5em;"><span style="font-size:14px;">中对字段就行了算术运算，这会造成引擎放弃使用索引，建议改成<br></span></p>
   <pre class="code-snippet__fix code-snippet__js"></pre>
   <pre><code>select user_id,user_project from user_base where age=36/2;</code></pre>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;"><br></span></strong></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十五、避免隐式类型转换</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">where 子句中出现 column 字段的类型和传入的参数类型不一致的时候发生的类型转换，建议先确定where中的参数类型</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十六、对于联合索引来说，要遵守最左前缀法则</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">举列来说索引含有字段id,name,school，可以直接用id字段，也可以id,name这样的顺序，但是name;school都无法使用这个索引。所以在创建联合索引的时候一定要注意索引字段顺序，常用的查询字段放在最前面</span></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十七、必要时可以使用force index来强制查询走某个索引</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">有的时候MySQL优化器采取它认为合适的索引来检索sql语句，但是可能它所采用的索引并不是我们想要的。这时就可以采用forceindex来强制优化器使用我们制定的索引。<br></span><strong><span style="color:rgb(0,122,170);font-size:16px;"><br></span></strong></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十八、注意范围查询语句</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">对于联合索引来说，如果存在范围查询，比如between,&gt;,&lt;等条件时，会造成后面的索引字段失效。<br></span><strong><span style="color:rgb(0,122,170);font-size:16px;"><br></span></strong></p>
   <p style="line-height:1.5em;"><strong><span style="color:rgb(0,122,170);font-size:16px;">十九、关于JOIN优化</span></strong></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <figure>
    <br>
    <img class="origin_image zh-lightbox-thumb lazy" width="640" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ictFicmQNgXVlmztm0fLibCP6cbhV5o3x23MU5oC59TZpnSkAiaE5vM3IibyA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="font-size:14px;">LEFT JOIN A表为驱动表<br>INNER JOIN MySQL会自动找出那个数据少的表作用驱动表<br>RIGHT JOIN B表为驱动表<br><strong>注意：MySQL中没有full join，可以用以下方式来解决</strong><br>select * from A left join B on B.name = A.namewhere B.name is nullunion allselect * from B;<br><strong>尽量使用inner join，避免left join</strong><br>参与联合查询的表至少为2张表，一般都存在大小之分。如果连接方式是inner join，在没有其他过滤条件的情况下MySQL会自动选择小表作为驱动表，但是left join在驱动表的选择上遵循的是左边驱动右边的原则，即left join左边的表名为驱动表。<br><strong>合理利用索引</strong><br>被驱动表的索引字段作为on的限制字段。<br><strong>利用小表去驱动大表</strong><br><br></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;">从原理图能够直观的看出如果能够减少驱动表的话，减少嵌套循环中的循环次数，以减少 IO总量及CPU运算的次数。<br><strong><br></strong></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;"><strong>巧用STRAIGHT_JOIN</strong></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;"><br></span></p>
   <p style="line-height:1.5em;text-align:left;"><span style="font-size:14px;">inner join是由mysql选择驱动表，但是有些特殊情况需要选择另个表作为驱动表，比如有group by、order by等「Using filesort」、「Using temporary」时。STRAIGHT_JOIN来强制连接顺序，在STRAIGHT_JOIN左边的表名就是驱动表，右边则是被驱动表。<strong>在使用STRAIGHT_JOIN有个前提条件是该查询是内连接，也就是inner join。其他链接不推荐使用STRAIGHT_JOIN，否则可能造成查询结果不准确。</strong><br><br></span></p>
   <figure>
    <img class="origin_image zh-lightbox-thumb lazy" width="623" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQiaQ2k7L81icZMbJUpRy21ict8eqMHQ27bEZxFCibGv7qEM53bj94RtBhbZQuHY1ekqibjew6z7q0VeFQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   </figure>
   <p><br></p>
   <p style="text-align:left;"><span style="font-size:14px;color:rgb(136,136,136);"><br></span></p>
   <p style="text-align:left;"><span style="font-size:14px;color:rgb(136,136,136);">出处：https://zhuanlan.zhihu.com/p/49888088</span></p>
   <p style="text-align:left;"><span style="font-size:14px;color:rgb(136,136,136);">编辑：尹文敏</span></p>
   <p><br></p>
   <p><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606539&amp;idx=1&amp;sn=134dafd5fb9ce3db71e76effd0d84397&amp;chksm=be95a0b589e229a375484ab05507d1c3af138956d41fdd3b12c383b4d0f6da98eae300d9a8da&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">公司简介</a><span style="font-size:12px;">&nbsp;</span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606795&amp;idx=2&amp;sn=bb9544642faa52b4835718eb8479032e&amp;chksm=be95a7b589e22ea3f22adce976e4c0a3da68754c1132e79cb06ea1c97276863af36c5ab6bfde&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">招聘</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605815&amp;idx=1&amp;sn=96f5e15c7d1f7e1ae1e314dbe02b43b2&amp;chksm=be95a38989e22a9fb5ac4329a1cf0beb14878f0b2e6fc8ea3ed7bb0daebbb601acd84bacd2ef&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">DTCC</span></a><span style="font-size:12px;">&nbsp;|<span>&nbsp;</span></span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606300&amp;idx=1&amp;sn=2bed577bbd2785ed15ed6fa30d0bf5b8&amp;chksm=be95a1a289e228b4558498e0c28389e864858d1be334204365c10c2bbdc7ac1d68747cbca542&amp;scene=21#wechat_redirect" rel="nofollow">数据技术嘉年华</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281343&amp;idx=1&amp;sn=668e2c93f551141a416eb16f3eade76f&amp;chksm=be478d698930047f0fb674ef05a7cbaff4e5f3991d0e0b998f37c06ca1eafc44b6c30ecfb6c8&amp;scene=21#wechat_redirect" rel="nofollow">免费课程</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606949&amp;idx=1&amp;sn=f63ecdd4a5b21ef1104b4626ba29350b&amp;chksm=be95a61b89e22f0da76d3b7005cddf376405df2e91ff9fb9ebfc091b2de72d6901813f819332&amp;scene=21#wechat_redirect" rel="nofollow">入驻华为严选商城</a></span></p>&nbsp;&nbsp;
   <img style="width:60px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU3ibRAFVNDK5LeF9aC9xY7qztxG3VyROib1QrADiabUWPVlslTN2fdGDuPQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606558&amp;idx=1&amp;sn=d727f762e155ba9eebf0301a49b3815d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">zCloud</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606400&amp;idx=1&amp;sn=fda7dfd82768bbd8f890a0ab9250b9e6&amp;scene=21#wechat_redirect" rel="nofollow">SQM</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606558&amp;idx=2&amp;sn=06ca69294cebd30f5f710a322fb98b2c&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">Bethune Pro2</a>&nbsp;<span style="font-size:12px;">|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606577&amp;idx=1&amp;sn=30025f8250b8c50663d3a591fe3de257&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">zData一体机</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606261&amp;idx=1&amp;sn=15ab8b32d85c885427c355f95026029d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">Mydata一体机</a>&nbsp;|&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606518&amp;idx=1&amp;sn=00f2f4a54a37cbc7d1e6fb517b529859&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">ZDBM 备份一体机</a></p>
   <img style="width:52px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU3mTOEfnaMaBWJPOOXcozJEKWtutDLicX9YMNhgzycyxNHUdqeuAjUyvA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281215&amp;idx=1&amp;sn=30d52b07763b6d7ba4cb15b79de29564&amp;chksm=be478ce9893005ff93809c1d88eda7066b98f560001b5b324be4a8e9ebc10bcafce2267c619d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">Oracle技术架构</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281343&amp;idx=1&amp;sn=668e2c93f551141a416eb16f3eade76f&amp;chksm=be478d698930047f0fb674ef05a7cbaff4e5f3991d0e0b998f37c06ca1eafc44b6c30ecfb6c8&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">免费课程</a><span style="font-size:12px;">&nbsp;</span><span style="font-size:12px;">|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281350&amp;idx=1&amp;sn=26b13e3f181a5d6e831c021b7426e6c4&amp;chksm=be478d9089300486d05476098e1b3cfee5b2eb94365cf614e24d21d1eb58451e6ed16c601d00&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">数据库排行榜</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281239&amp;idx=2&amp;sn=e72ce90ab0bd2e8375b709644c7f8b54&amp;chksm=be478d01893004170db34db767a38b234606e9dd0eaca08a35c313fa474263bcf23871bebe46&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">DBASK问题集萃</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281286&amp;idx=1&amp;sn=48099b54f34f91687ccbf7afec9e7c65&amp;chksm=be478d50893004463678b48c0eb73f5741f06a6b1bea5502517f9801b0bde84e50c20502811d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">技术通讯</a><span style="font-size:12px;">&nbsp;</span></p>
   <img style="width:60px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU30DVZ9aCJfsArKCAhqbDR3AT9icAzDHeWPvRl8R6NnskotytVDGuiaXuQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p><span style="font-size:12px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605932&amp;idx=1&amp;sn=429bc42915a11a929d8e8d98fa94d627&amp;scene=21#wechat_redirect" rel="nofollow">升级迁移</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606850&amp;idx=1&amp;sn=cc081d93c4a267fcc3b1a99792ec22c9&amp;chksm=be95a67c89e22f6a113affd2d918d82f8139b638ec9a4b5201d0ee030033fd969a49a3b2f4f3&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">性能优化</span></a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605700&amp;idx=1&amp;sn=051812f07add697e78e3f3e7a82564e5&amp;chksm=be95a3fa89e22aecb2c4bdb22b303a77e5c4b19e8ff6de2c62624e1161b8ebd4396b28940ddc&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">智能整合</span></a><span style="font-size:12px;text-decoration:underline;">&nbsp;</span><span style="font-size:12px;">|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650603337&amp;idx=2&amp;sn=1aa0d1664bb04d8f9dd9c22e60887ba2&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">安全保障</span></a><span style="font-size:12px;">&nbsp;|&nbsp;<span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605243&amp;idx=1&amp;sn=83d34ae3e3b33ad55dad215665556dde&amp;scene=21#wechat_redirect" rel="nofollow">架构设计</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=401725923&amp;idx=1&amp;sn=b5c396e5563e0836c9fd40a481ac42db&amp;scene=21#wechat_redirect" rel="nofollow">SQL审核</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650274082&amp;idx=2&amp;sn=729a68af1b7f0266683da44cfd227e32&amp;scene=21#wechat_redirect" rel="nofollow">分布式架构</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606414&amp;idx=1&amp;sn=e952cc631c64da59b204ed513425eea0&amp;scene=21#wechat_redirect" rel="nofollow">高可用容灾</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650603030&amp;idx=1&amp;sn=726b20fde867db768585fe605cbc5fe2&amp;scene=21#wechat_redirect" rel="nofollow">运维代维</a></span></span><br></p>
   <p><strong><span style="font-size:16px;color:rgb(141,203,191);">云和恩墨大讲堂 |&nbsp;</span></strong><span style="font-size:16px;color:rgb(141,203,191);">一个分享交流的地方</span></p>
   <p style="min-height:1em;"><span style="font-size:14px;color:rgb(141,203,191);">长按，识别二维码，加入<strong>万人</strong>交流社群</span></p>
   <p style="min-height:1em;"><br></p>
   <strong><img style="border-width:1px;border-style:dashed;border-color:rgb(168,164,171);" border="0" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMSLia51VIoGv8GNktatN3DiamicGBJkEXibzoGaI0WFTwcD5MT8kzcUlaL1zUEXhewkEHIhRKRTLDq3mw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></strong>
   <p style="color:rgb(35,21,10);font-size:medium;min-height:1em;"><span style="font-size:12px;"><strong><span style="color:rgb(141,203,191);">请备注：云和恩墨大讲堂</span></strong></span></p>
  </div> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
