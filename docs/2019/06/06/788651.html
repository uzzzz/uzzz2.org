<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>从运维角度浅谈MySQL数据库优化，中小企业DBA必会 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="从运维角度浅谈MySQL数据库优化，中小企业DBA必会" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="一个成熟的数据库架构并不是一开始设计就具备高可用、高伸缩等特性的，它是随着用户量的增加，基础架构才逐渐完善。 这篇博文主要谈MySQL数据库发展周期中所面临的问题及优化方案，暂且抛开前端应用不说，大致分为以下五个阶段： 数据库表设计 项目立项后，开发部根据产品部需求开发项目，开发工程师工作其中一部分就是对表结构设计。对于数据库来说，这点很重要，如果设计不当，会直接影响访问速度和用户体验。影响的因素很多，比如慢查询、低效的查询语句、没有适当建立索引、数据库堵塞（死锁）等。当然，有测试工程师的团队，会做压力测试，找bug。对于没有测试工程师的团队来说，大多数开发工程师初期不会太多考虑数据库设计是否合理，而是尽快完成功能实现和交付，等项目有一定访问量后，隐藏的问题就会暴露，这时再去修改就不是这么容易的事了。 数据库部署 该运维工程师出场了，项目初期访问量不会很大，所以单台部署足以应对在1500左右的QPS（每秒查询率）。考虑到高可用性，可采用MySQL主从复制+Keepalived做双击热备，常见集群软件有Keepalived、Heartbeat。 数据库性能优化 如果将MySQL部署到普通的X86服务器上，在不经过任何优化情况下，MySQL理论值正常可以处理2000左右QPS，经过优化后，有可能会提升到2500左右QPS，否则，访问量当达到1500左右并发连接时，数据库处理性能就会变慢，而且硬件资源还很富裕，这时就该考虑软件问题了。那么怎样让数据库最大化发挥性能呢？一方面可以单台运行多个MySQL实例让服务器性能发挥到最大化，另一方面是对数据库进行优化，往往操作系统和数据库默认配置都比较保守，会对数据库发挥有一定限制，可对这些配置进行适当的调整，尽可能的处理更多连接数。 具体优化有以下三个层面： 数据库配置优化 MySQL常用有两种存储引擎，一个是MyISAM，不支持事务处理，读性能处理快，表级别锁。另一个是InnoDB，支持事务处理（ACID），设计目标是为处理大容量数据发挥最大化性能，行级别锁。 表锁：开销小，锁定粒度大，发生死锁概率高，相对并发也低。 行锁：开销大，锁定粒度小，发生死锁概率低，相对并发也高。 为什么会出现表锁和行锁呢？主要是为了保证数据的完整性，举个例子，一个用户在操作一张表，其他用户也想操作这张表，那么就要等第一个用户操作完，其他用户才能操作，表锁和行锁就是这个作用。否则多个用户同时操作一张表，肯定会数据产生冲突或者异常。 根据以上看来，使用InnoDB存储引擎是最好的选择，也是MySQL5.5以后版本中默认存储引擎。每个存储引擎相关联参数比较多，以下列出主要影响数据库性能的参数。 公共参数默认值： MyISAM参数默认值： key_buffer_size = 16M#索引缓存区大小，一般设置物理内存的30-40%read_buffer_size = 128K #读操作缓冲区大小，推荐设置16M或32M InnoDB参数默认值： innodb_buffer_pool_size = 128M#索引和数据缓冲区大小，一般设置物理内存的60%-70%innodb_buffer_pool_instances = 1 #缓冲池实例个数，推荐设置4个或8个innodb_flush_log_at_trx_commit = 1 #关键参数，0代表大约每秒写入到日志并同步到磁盘，数据库故障会丢失1秒左右事务数据。1为每执行一条SQL后写入到日志并同步到磁盘，I/O开销大，执行完SQL要等待日志读写，效率低。2代表只把日志写入到系统缓存区，再每秒同步到磁盘，效率很高，如果服务器故障，才会丢失事务数据。对数据安全性要求不是很高的推荐设置2，性能高，修改后效果明显。innodb_file_per_table = OFF #默认是共享表空间，共享表空间idbdata文件不断增大，影响一定的I/O性能。推荐开启独立表空间模式，每个表的索引和数据都存在自己独立的表空间中，可以实现单表在不同数据库中移动。innodb_log_buffer_size = 8M #日志缓冲区大小，由于日志最长每秒钟刷新一次，所以一般不用超过16M 系统内核优化 大多数MySQL都部署在linux系统上，所以操作系统的一些参数也会影响到MySQL性能，以下对linux内核进行适当优化。 net.ipv4.tcp_fin_timeout = 30#TIME_WAIT超时时间，默认是60snet.ipv4.tcp_tw_reuse = 1 #1表示开启复用，允许TIME_WAIT socket重新用于新的TCP连接，0表示关闭net.ipv4.tcp_tw_recycle = 1 #1表示开启TIME_WAIT socket快速回收，0表示关闭net.ipv4.tcp_max_tw_buckets = 4096 #系统保持TIME_WAIT socket最大数量，如果超出这个数，系统将随机清除一些TIME_WAIT并打印警告信息net.ipv4.tcp_max_syn_backlog = 4096#进入SYN队列最大长度，加大队列长度可容纳更多的等待连接 在linux系统中，如果进程打开的文件句柄数量超过系统默认值1024，就会提示“too many files open”信息，所以要调整打开文件句柄限制。 # vi /etc/security/limits.conf &nbsp;#加入以下配置，*代表所有用户，也可以指定用户，重启系统生效* soft nofile 65535* hard nofile 65535# ulimit -SHn 65535 &nbsp; #立刻生效 硬件配置 加大物理内存，提高文件系统性能。linux内核会从内存中分配出缓存区（系统缓存和数据缓存）来存放热数据，通过文件系统延迟写入机制，等满足条件时（如缓存区大小到达一定百分比或者执行sync命令）才会同步到磁盘。也就是说物理内存越大，分配缓存区越大，缓存数据越多。当然，服务器故障会丢失一定的缓存数据。 SSD硬盘代替SAS硬盘，将RAID级别调整为RAID1+0，相对于RAID1和RAID5有更好的读写性能（IOPS），毕竟数据库的压力主要来自磁盘I/O方面。 数据库架构扩展 随着业务量越来越大，单台数据库服务器性能已无法满足业务需求，该考虑加机器了，该做集群了~~~。主要思想是分解单台数据库负载，突破磁盘I/O性能，热数据存放缓存中，降低磁盘I/O访问频率。 主从复制与读写分离 因为生产环境中，数据库大多都是读操作，所以部署一主多从架构，主数据库负责写操作，并做双击热备，多台从数据库做负载均衡，负责读操作，主流的负载均衡器有LVS、HAProxy、Nginx。怎么来实现读写分离呢？大多数企业是在代码层面实现读写分离，效率比较高。另一个种方式通过代理程序实现读写分离，企业中应用较少，常见代理程序有MySQL Proxy、Amoeba。在这样数据库集群架构中，大大增加数据库高并发能力，解决单台性能瓶颈问题。如果从数据库一台从库能处理2000 QPS，那么5台就能处理1w QPS，数据库横向扩展性也很容易。 有时，面对大量写操作的应用时，单台写性能达不到业务需求。如果做双主，就会遇到数据库数据不一致现象，产生这个原因是在应用程序不同的用户会有可能操作两台数据库，同时的更新操作造成两台数据库数据库数据发生冲突或者不一致。在单库时MySQL利用存储引擎机制表锁和行锁来保证数据完整性，怎样在多台主库时解决这个问题呢？有一套基于perl语言开发的主从复制管理工具，叫&nbsp; -MMM（Master-Master replication managerfor MysQL，MySQL主主复制管理器），这个工具最大的优点是在同一时间只提供一台数据库写操作，有效保证数据一致性。 主从复制博文：http://lizhenliang.blog.51cto.com/7876557/1290431 读写分离博文：http://lizhenliang.blog.51cto.com/7876557/1305083 MySQL-MMM博文：http://lizhenliang.blog.51cto.com/7876557/1354576 增加缓存 给数据库增加缓存系统，把热数据缓存到内存中，如果内存缓存中有要请求的数据就不再去数据库中返回结果，提高读性能。缓存实现有本地缓存和分布式缓存，本地缓存是将数据缓存到本地服务器内存中或者文件中，速度快。分布式可以缓存海量数据，扩展容易，主流的分布式缓存系统有memcached、redis，memcached性能稳定，数据缓存在内存中，速度很快，QPS可达8W左右。如果想数据持久化那就用redis，性能不低于memcached。 工作过程： 分库 分库是根据业务不同把相关的表切分到不同的数据库中，比如web、bbs、blog等库。如果业务量很大，还可将切分后的库做主从架构，进一步避免单个库压力过大。 分表 数据量的日剧增加，数据库中某个表有几百万条数据，导致查询和插入耗时太长，怎么能解决单表压力呢？你就该考虑是否把这个表拆分成多个小表，来减轻单个表的压力，提高处理效率，此方式称为分表。 分表技术比较麻烦，要修改程序代码里的SQL语句，还要手动去创建其他表，也可以用merge存储引擎实现分表，相对简单许多。分表后，程序是对一个总表进行操作，这个总表不存放数据，只有一些分表的关系，以及更新数据的方式，总表会根据不同的查询，将压力分到不同的小表上，因此提高并发能力和磁盘I/O性能。 分表分为垂直拆分和水平拆分： 垂直拆分：把原来的一个很多字段的表拆分多个表，解决表的宽度问题。你可以把不常用的字段单独放到一个表中，也可以把大字段独立放一个表中，或者把关联密切的字段放一个表中。 水平拆分：把原来一个表拆分成多个表，每个表的结构都一样，解决单表数据量大的问题。 分区 分区就是把一张表的数据分成多个区块，这些区块可以在一个磁盘上，也可以在不同的磁盘上，分区后，表面上还是一张表，但数据散列在多个位置，这样一来，多块硬盘同时处理不同的请求，从而提高磁盘I/O读写性能，实现比较简单。 注：增加缓存、分库、分表和分区主要由程序猿来实现。 数据库维护 数据库维护是运维工程师或者DBA主要工作，包括性能监控、性能分析、性能调优、数据库备份和恢复等。 性能状态关键指标 QPS，Queries Per Second：每秒查询数，一台数据库每秒能够处理的查询次数 TPS，Transactions Per Second：每秒处理事务数 通过show status查看运行状态，会有300多条状态信息记录，其中有几个值帮可以我们计算出QPS和TPS，如下： Uptime：服务器已经运行的实际，单位秒 Questions：已经发送给数据库查询数 Com_select：查询次数，实际操作数据库的 Com_insert：插入次数 Com_delete：删除次数 Com_update：更新次数 Com_commit：事务次数 Com_rollback：回滚次数 那么，计算方法来了，基于Questions计算出QPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; QPS = Questions / Uptime，基于Com_commit和Com_rollback计算出TPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; 另一计算方式：基于Com_select、Com_insert、Com_delete、Com_update计算出QPS： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 等待1秒再执行，获取间隔差值，第二次每个变量值减去第一次对应的变量值，就是QPS。 TPS计算方法： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 计算TPS，就不算查询操作了，计算出插入、删除、更新四个值即可。 经网友对这两个计算方式的测试得出，当数据库中myisam表比较多时，使用Questions计算比较准确。当数据库中innodb表比较多时，则以Com_*计算比较准确。 开启慢查询日志 MySQL开启慢查询日志，分析出哪条SQL语句比较慢，使用set设置变量，重启服务失效，可以在my.cnf添加参数永久生效。 mysql&gt; set global slow-query-log=on #开启慢查询功能mysql&gt; set global slow_query_log_file=&#39;/var/log/mysql/mysql-slow.log&#39;; #指定慢查询日志文件位置mysql&gt; set global log_queries_not_using_indexes=on; #记录没有使用索引的查询mysql&gt; set global long_query_time=1; #只记录处理时间1s以上的慢查询 分析慢查询日志，可以使用MySQL自带的mysqldumpslow工具，分析的日志较为简单。 # mysqldumpslow -t 3 /var/log/mysql/mysql-slow.log #查看最慢的前三个查询 也可以使用percona公司的pt-query-digest工具，日志分析功能全面，可分析slow log、binlog、general log。 分析慢查询日志： pt-query-digest /var/log/mysql/mysql-slow.log 分析binlog日志： mysqlbinlog mysql-bin.000001 &gt;mysql-bin.000001.sqlpt-query-digest –type=binlog mysql-bin.000001.sql 分析普通日志： pt-query-digest –type=genlog localhost.log 数据库备份 备份数据库是最基本的工作，也是最重要的，否则后果很严重，你懂得！但由于数据库比较大，上百G，往往备份都很耗费时间，所以就该选择一个效率高的备份策略，对于数据量大的数据库，一般都采用增量备份。常用的备份工具有mysqldump、mysqlhotcopy、xtrabackup等，mysqldump比较适用于小的数据库，因为是逻辑备份，所以备份和恢复耗时都比较长。mysqlhotcopy和xtrabackup是物理备份，备份和恢复速度快，不影响数据库服务情况下进行热拷贝，建议使用xtrabackup，支持增量备份。 Xtrabackup备份工具使用博文：http://lizhenliang.blog.51cto.com/7876557/1612800 数据库修复 有时候MySQL服务器突然断电、异常关闭，会导致表损坏，无法读取表数据。这时就可以用到MySQL自带的两个工具进行修复，myisamchk和mysqlcheck。 myisamchk：只能修复myisam表，需要停止数据库。 常用参数： -f –force 强制修复，覆盖老的临时文件，一般不使用 -r –recover 恢复模式 -q –quik 快速恢复 -a –analyze 分析表 -o –safe-recover 老的恢复模式，如果-r无法修复，可以使用此参数试试 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: # cd /var/lib/mysql/weibo# myisamchk -r -q *.MYI mysqlcheck：myisam和innodb表都可以用，不需要停止数据库，如修复单个表，可在数据库后面添加表名，以空格分割。 常用参数： -a –all-databases 检查所有的库 -r –repair 修复表 -c –check 检查表，默认选项 -a –analyze 分析表 -o –optimize 优化表 -q –quik 最快检查或修复表 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: mysqlcheck -r -q -uroot -p123 weibo 查看CPU和I/O性能方法 查看CPU性能 参数-P是显示CPU数，ALL为所有，也可以只显示第几颗 查看I/O性能 参数-m是以M单位显示，默认K。 %util：当达到100%时，说明I/O很忙。 await：请求在队列中等待时间，直接影响read时间。 I/O极限：IOPS（r/s+w/s）,一般在1200左右。（IOPS，每秒进行读写（I/O）操作次数） I/O带宽：在顺序读写模式下SAS硬盘理论值在300M/s左右，SSD硬盘理论值在600M/s左右。 以上是本人使用MySQL三年来总结的一些主要优化方案，能力有限，有些不太全面，但这些基本能够满足中小型企业数据库需求。由于关系型数据库初衷设计限制，一些BAT公司海量数据放到关系型数据库中，在海量数据查询和分析方面已经达不到更好的性能。因此NoSQL火起来了，非关系型数据库，大数据量，具有高性能，同时也弥补了关系型数据库某方面不足，渐渐大多数公司已经将部分业务数据库存放到NoSQL中，如MongoDB、HBase等。数据存储方面采用分布式文件系统，如HDFS、GFS等。海量数据计算分析采用Hadoop、Spark、Storm等。 出处：JAVA的学习之路 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;MyData一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<meta property="og:description" content="一个成熟的数据库架构并不是一开始设计就具备高可用、高伸缩等特性的，它是随着用户量的增加，基础架构才逐渐完善。 这篇博文主要谈MySQL数据库发展周期中所面临的问题及优化方案，暂且抛开前端应用不说，大致分为以下五个阶段： 数据库表设计 项目立项后，开发部根据产品部需求开发项目，开发工程师工作其中一部分就是对表结构设计。对于数据库来说，这点很重要，如果设计不当，会直接影响访问速度和用户体验。影响的因素很多，比如慢查询、低效的查询语句、没有适当建立索引、数据库堵塞（死锁）等。当然，有测试工程师的团队，会做压力测试，找bug。对于没有测试工程师的团队来说，大多数开发工程师初期不会太多考虑数据库设计是否合理，而是尽快完成功能实现和交付，等项目有一定访问量后，隐藏的问题就会暴露，这时再去修改就不是这么容易的事了。 数据库部署 该运维工程师出场了，项目初期访问量不会很大，所以单台部署足以应对在1500左右的QPS（每秒查询率）。考虑到高可用性，可采用MySQL主从复制+Keepalived做双击热备，常见集群软件有Keepalived、Heartbeat。 数据库性能优化 如果将MySQL部署到普通的X86服务器上，在不经过任何优化情况下，MySQL理论值正常可以处理2000左右QPS，经过优化后，有可能会提升到2500左右QPS，否则，访问量当达到1500左右并发连接时，数据库处理性能就会变慢，而且硬件资源还很富裕，这时就该考虑软件问题了。那么怎样让数据库最大化发挥性能呢？一方面可以单台运行多个MySQL实例让服务器性能发挥到最大化，另一方面是对数据库进行优化，往往操作系统和数据库默认配置都比较保守，会对数据库发挥有一定限制，可对这些配置进行适当的调整，尽可能的处理更多连接数。 具体优化有以下三个层面： 数据库配置优化 MySQL常用有两种存储引擎，一个是MyISAM，不支持事务处理，读性能处理快，表级别锁。另一个是InnoDB，支持事务处理（ACID），设计目标是为处理大容量数据发挥最大化性能，行级别锁。 表锁：开销小，锁定粒度大，发生死锁概率高，相对并发也低。 行锁：开销大，锁定粒度小，发生死锁概率低，相对并发也高。 为什么会出现表锁和行锁呢？主要是为了保证数据的完整性，举个例子，一个用户在操作一张表，其他用户也想操作这张表，那么就要等第一个用户操作完，其他用户才能操作，表锁和行锁就是这个作用。否则多个用户同时操作一张表，肯定会数据产生冲突或者异常。 根据以上看来，使用InnoDB存储引擎是最好的选择，也是MySQL5.5以后版本中默认存储引擎。每个存储引擎相关联参数比较多，以下列出主要影响数据库性能的参数。 公共参数默认值： MyISAM参数默认值： key_buffer_size = 16M#索引缓存区大小，一般设置物理内存的30-40%read_buffer_size = 128K #读操作缓冲区大小，推荐设置16M或32M InnoDB参数默认值： innodb_buffer_pool_size = 128M#索引和数据缓冲区大小，一般设置物理内存的60%-70%innodb_buffer_pool_instances = 1 #缓冲池实例个数，推荐设置4个或8个innodb_flush_log_at_trx_commit = 1 #关键参数，0代表大约每秒写入到日志并同步到磁盘，数据库故障会丢失1秒左右事务数据。1为每执行一条SQL后写入到日志并同步到磁盘，I/O开销大，执行完SQL要等待日志读写，效率低。2代表只把日志写入到系统缓存区，再每秒同步到磁盘，效率很高，如果服务器故障，才会丢失事务数据。对数据安全性要求不是很高的推荐设置2，性能高，修改后效果明显。innodb_file_per_table = OFF #默认是共享表空间，共享表空间idbdata文件不断增大，影响一定的I/O性能。推荐开启独立表空间模式，每个表的索引和数据都存在自己独立的表空间中，可以实现单表在不同数据库中移动。innodb_log_buffer_size = 8M #日志缓冲区大小，由于日志最长每秒钟刷新一次，所以一般不用超过16M 系统内核优化 大多数MySQL都部署在linux系统上，所以操作系统的一些参数也会影响到MySQL性能，以下对linux内核进行适当优化。 net.ipv4.tcp_fin_timeout = 30#TIME_WAIT超时时间，默认是60snet.ipv4.tcp_tw_reuse = 1 #1表示开启复用，允许TIME_WAIT socket重新用于新的TCP连接，0表示关闭net.ipv4.tcp_tw_recycle = 1 #1表示开启TIME_WAIT socket快速回收，0表示关闭net.ipv4.tcp_max_tw_buckets = 4096 #系统保持TIME_WAIT socket最大数量，如果超出这个数，系统将随机清除一些TIME_WAIT并打印警告信息net.ipv4.tcp_max_syn_backlog = 4096#进入SYN队列最大长度，加大队列长度可容纳更多的等待连接 在linux系统中，如果进程打开的文件句柄数量超过系统默认值1024，就会提示“too many files open”信息，所以要调整打开文件句柄限制。 # vi /etc/security/limits.conf &nbsp;#加入以下配置，*代表所有用户，也可以指定用户，重启系统生效* soft nofile 65535* hard nofile 65535# ulimit -SHn 65535 &nbsp; #立刻生效 硬件配置 加大物理内存，提高文件系统性能。linux内核会从内存中分配出缓存区（系统缓存和数据缓存）来存放热数据，通过文件系统延迟写入机制，等满足条件时（如缓存区大小到达一定百分比或者执行sync命令）才会同步到磁盘。也就是说物理内存越大，分配缓存区越大，缓存数据越多。当然，服务器故障会丢失一定的缓存数据。 SSD硬盘代替SAS硬盘，将RAID级别调整为RAID1+0，相对于RAID1和RAID5有更好的读写性能（IOPS），毕竟数据库的压力主要来自磁盘I/O方面。 数据库架构扩展 随着业务量越来越大，单台数据库服务器性能已无法满足业务需求，该考虑加机器了，该做集群了~~~。主要思想是分解单台数据库负载，突破磁盘I/O性能，热数据存放缓存中，降低磁盘I/O访问频率。 主从复制与读写分离 因为生产环境中，数据库大多都是读操作，所以部署一主多从架构，主数据库负责写操作，并做双击热备，多台从数据库做负载均衡，负责读操作，主流的负载均衡器有LVS、HAProxy、Nginx。怎么来实现读写分离呢？大多数企业是在代码层面实现读写分离，效率比较高。另一个种方式通过代理程序实现读写分离，企业中应用较少，常见代理程序有MySQL Proxy、Amoeba。在这样数据库集群架构中，大大增加数据库高并发能力，解决单台性能瓶颈问题。如果从数据库一台从库能处理2000 QPS，那么5台就能处理1w QPS，数据库横向扩展性也很容易。 有时，面对大量写操作的应用时，单台写性能达不到业务需求。如果做双主，就会遇到数据库数据不一致现象，产生这个原因是在应用程序不同的用户会有可能操作两台数据库，同时的更新操作造成两台数据库数据库数据发生冲突或者不一致。在单库时MySQL利用存储引擎机制表锁和行锁来保证数据完整性，怎样在多台主库时解决这个问题呢？有一套基于perl语言开发的主从复制管理工具，叫&nbsp; -MMM（Master-Master replication managerfor MysQL，MySQL主主复制管理器），这个工具最大的优点是在同一时间只提供一台数据库写操作，有效保证数据一致性。 主从复制博文：http://lizhenliang.blog.51cto.com/7876557/1290431 读写分离博文：http://lizhenliang.blog.51cto.com/7876557/1305083 MySQL-MMM博文：http://lizhenliang.blog.51cto.com/7876557/1354576 增加缓存 给数据库增加缓存系统，把热数据缓存到内存中，如果内存缓存中有要请求的数据就不再去数据库中返回结果，提高读性能。缓存实现有本地缓存和分布式缓存，本地缓存是将数据缓存到本地服务器内存中或者文件中，速度快。分布式可以缓存海量数据，扩展容易，主流的分布式缓存系统有memcached、redis，memcached性能稳定，数据缓存在内存中，速度很快，QPS可达8W左右。如果想数据持久化那就用redis，性能不低于memcached。 工作过程： 分库 分库是根据业务不同把相关的表切分到不同的数据库中，比如web、bbs、blog等库。如果业务量很大，还可将切分后的库做主从架构，进一步避免单个库压力过大。 分表 数据量的日剧增加，数据库中某个表有几百万条数据，导致查询和插入耗时太长，怎么能解决单表压力呢？你就该考虑是否把这个表拆分成多个小表，来减轻单个表的压力，提高处理效率，此方式称为分表。 分表技术比较麻烦，要修改程序代码里的SQL语句，还要手动去创建其他表，也可以用merge存储引擎实现分表，相对简单许多。分表后，程序是对一个总表进行操作，这个总表不存放数据，只有一些分表的关系，以及更新数据的方式，总表会根据不同的查询，将压力分到不同的小表上，因此提高并发能力和磁盘I/O性能。 分表分为垂直拆分和水平拆分： 垂直拆分：把原来的一个很多字段的表拆分多个表，解决表的宽度问题。你可以把不常用的字段单独放到一个表中，也可以把大字段独立放一个表中，或者把关联密切的字段放一个表中。 水平拆分：把原来一个表拆分成多个表，每个表的结构都一样，解决单表数据量大的问题。 分区 分区就是把一张表的数据分成多个区块，这些区块可以在一个磁盘上，也可以在不同的磁盘上，分区后，表面上还是一张表，但数据散列在多个位置，这样一来，多块硬盘同时处理不同的请求，从而提高磁盘I/O读写性能，实现比较简单。 注：增加缓存、分库、分表和分区主要由程序猿来实现。 数据库维护 数据库维护是运维工程师或者DBA主要工作，包括性能监控、性能分析、性能调优、数据库备份和恢复等。 性能状态关键指标 QPS，Queries Per Second：每秒查询数，一台数据库每秒能够处理的查询次数 TPS，Transactions Per Second：每秒处理事务数 通过show status查看运行状态，会有300多条状态信息记录，其中有几个值帮可以我们计算出QPS和TPS，如下： Uptime：服务器已经运行的实际，单位秒 Questions：已经发送给数据库查询数 Com_select：查询次数，实际操作数据库的 Com_insert：插入次数 Com_delete：删除次数 Com_update：更新次数 Com_commit：事务次数 Com_rollback：回滚次数 那么，计算方法来了，基于Questions计算出QPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; QPS = Questions / Uptime，基于Com_commit和Com_rollback计算出TPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; 另一计算方式：基于Com_select、Com_insert、Com_delete、Com_update计算出QPS： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 等待1秒再执行，获取间隔差值，第二次每个变量值减去第一次对应的变量值，就是QPS。 TPS计算方法： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 计算TPS，就不算查询操作了，计算出插入、删除、更新四个值即可。 经网友对这两个计算方式的测试得出，当数据库中myisam表比较多时，使用Questions计算比较准确。当数据库中innodb表比较多时，则以Com_*计算比较准确。 开启慢查询日志 MySQL开启慢查询日志，分析出哪条SQL语句比较慢，使用set设置变量，重启服务失效，可以在my.cnf添加参数永久生效。 mysql&gt; set global slow-query-log=on #开启慢查询功能mysql&gt; set global slow_query_log_file=&#39;/var/log/mysql/mysql-slow.log&#39;; #指定慢查询日志文件位置mysql&gt; set global log_queries_not_using_indexes=on; #记录没有使用索引的查询mysql&gt; set global long_query_time=1; #只记录处理时间1s以上的慢查询 分析慢查询日志，可以使用MySQL自带的mysqldumpslow工具，分析的日志较为简单。 # mysqldumpslow -t 3 /var/log/mysql/mysql-slow.log #查看最慢的前三个查询 也可以使用percona公司的pt-query-digest工具，日志分析功能全面，可分析slow log、binlog、general log。 分析慢查询日志： pt-query-digest /var/log/mysql/mysql-slow.log 分析binlog日志： mysqlbinlog mysql-bin.000001 &gt;mysql-bin.000001.sqlpt-query-digest –type=binlog mysql-bin.000001.sql 分析普通日志： pt-query-digest –type=genlog localhost.log 数据库备份 备份数据库是最基本的工作，也是最重要的，否则后果很严重，你懂得！但由于数据库比较大，上百G，往往备份都很耗费时间，所以就该选择一个效率高的备份策略，对于数据量大的数据库，一般都采用增量备份。常用的备份工具有mysqldump、mysqlhotcopy、xtrabackup等，mysqldump比较适用于小的数据库，因为是逻辑备份，所以备份和恢复耗时都比较长。mysqlhotcopy和xtrabackup是物理备份，备份和恢复速度快，不影响数据库服务情况下进行热拷贝，建议使用xtrabackup，支持增量备份。 Xtrabackup备份工具使用博文：http://lizhenliang.blog.51cto.com/7876557/1612800 数据库修复 有时候MySQL服务器突然断电、异常关闭，会导致表损坏，无法读取表数据。这时就可以用到MySQL自带的两个工具进行修复，myisamchk和mysqlcheck。 myisamchk：只能修复myisam表，需要停止数据库。 常用参数： -f –force 强制修复，覆盖老的临时文件，一般不使用 -r –recover 恢复模式 -q –quik 快速恢复 -a –analyze 分析表 -o –safe-recover 老的恢复模式，如果-r无法修复，可以使用此参数试试 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: # cd /var/lib/mysql/weibo# myisamchk -r -q *.MYI mysqlcheck：myisam和innodb表都可以用，不需要停止数据库，如修复单个表，可在数据库后面添加表名，以空格分割。 常用参数： -a –all-databases 检查所有的库 -r –repair 修复表 -c –check 检查表，默认选项 -a –analyze 分析表 -o –optimize 优化表 -q –quik 最快检查或修复表 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: mysqlcheck -r -q -uroot -p123 weibo 查看CPU和I/O性能方法 查看CPU性能 参数-P是显示CPU数，ALL为所有，也可以只显示第几颗 查看I/O性能 参数-m是以M单位显示，默认K。 %util：当达到100%时，说明I/O很忙。 await：请求在队列中等待时间，直接影响read时间。 I/O极限：IOPS（r/s+w/s）,一般在1200左右。（IOPS，每秒进行读写（I/O）操作次数） I/O带宽：在顺序读写模式下SAS硬盘理论值在300M/s左右，SSD硬盘理论值在600M/s左右。 以上是本人使用MySQL三年来总结的一些主要优化方案，能力有限，有些不太全面，但这些基本能够满足中小型企业数据库需求。由于关系型数据库初衷设计限制，一些BAT公司海量数据放到关系型数据库中，在海量数据查询和分析方面已经达不到更好的性能。因此NoSQL火起来了，非关系型数据库，大数据量，具有高性能，同时也弥补了关系型数据库某方面不足，渐渐大多数公司已经将部分业务数据库存放到NoSQL中，如MongoDB、HBase等。数据存储方面采用分布式文件系统，如HDFS、GFS等。海量数据计算分析采用Hadoop、Spark、Storm等。 出处：JAVA的学习之路 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;MyData一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<link rel="canonical" href="https://uzzz.org/2019/06/06/788651.html" />
<meta property="og:url" content="https://uzzz.org/2019/06/06/788651.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-06T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"一个成熟的数据库架构并不是一开始设计就具备高可用、高伸缩等特性的，它是随着用户量的增加，基础架构才逐渐完善。 这篇博文主要谈MySQL数据库发展周期中所面临的问题及优化方案，暂且抛开前端应用不说，大致分为以下五个阶段： 数据库表设计 项目立项后，开发部根据产品部需求开发项目，开发工程师工作其中一部分就是对表结构设计。对于数据库来说，这点很重要，如果设计不当，会直接影响访问速度和用户体验。影响的因素很多，比如慢查询、低效的查询语句、没有适当建立索引、数据库堵塞（死锁）等。当然，有测试工程师的团队，会做压力测试，找bug。对于没有测试工程师的团队来说，大多数开发工程师初期不会太多考虑数据库设计是否合理，而是尽快完成功能实现和交付，等项目有一定访问量后，隐藏的问题就会暴露，这时再去修改就不是这么容易的事了。 数据库部署 该运维工程师出场了，项目初期访问量不会很大，所以单台部署足以应对在1500左右的QPS（每秒查询率）。考虑到高可用性，可采用MySQL主从复制+Keepalived做双击热备，常见集群软件有Keepalived、Heartbeat。 数据库性能优化 如果将MySQL部署到普通的X86服务器上，在不经过任何优化情况下，MySQL理论值正常可以处理2000左右QPS，经过优化后，有可能会提升到2500左右QPS，否则，访问量当达到1500左右并发连接时，数据库处理性能就会变慢，而且硬件资源还很富裕，这时就该考虑软件问题了。那么怎样让数据库最大化发挥性能呢？一方面可以单台运行多个MySQL实例让服务器性能发挥到最大化，另一方面是对数据库进行优化，往往操作系统和数据库默认配置都比较保守，会对数据库发挥有一定限制，可对这些配置进行适当的调整，尽可能的处理更多连接数。 具体优化有以下三个层面： 数据库配置优化 MySQL常用有两种存储引擎，一个是MyISAM，不支持事务处理，读性能处理快，表级别锁。另一个是InnoDB，支持事务处理（ACID），设计目标是为处理大容量数据发挥最大化性能，行级别锁。 表锁：开销小，锁定粒度大，发生死锁概率高，相对并发也低。 行锁：开销大，锁定粒度小，发生死锁概率低，相对并发也高。 为什么会出现表锁和行锁呢？主要是为了保证数据的完整性，举个例子，一个用户在操作一张表，其他用户也想操作这张表，那么就要等第一个用户操作完，其他用户才能操作，表锁和行锁就是这个作用。否则多个用户同时操作一张表，肯定会数据产生冲突或者异常。 根据以上看来，使用InnoDB存储引擎是最好的选择，也是MySQL5.5以后版本中默认存储引擎。每个存储引擎相关联参数比较多，以下列出主要影响数据库性能的参数。 公共参数默认值： MyISAM参数默认值： key_buffer_size = 16M#索引缓存区大小，一般设置物理内存的30-40%read_buffer_size = 128K #读操作缓冲区大小，推荐设置16M或32M InnoDB参数默认值： innodb_buffer_pool_size = 128M#索引和数据缓冲区大小，一般设置物理内存的60%-70%innodb_buffer_pool_instances = 1 #缓冲池实例个数，推荐设置4个或8个innodb_flush_log_at_trx_commit = 1 #关键参数，0代表大约每秒写入到日志并同步到磁盘，数据库故障会丢失1秒左右事务数据。1为每执行一条SQL后写入到日志并同步到磁盘，I/O开销大，执行完SQL要等待日志读写，效率低。2代表只把日志写入到系统缓存区，再每秒同步到磁盘，效率很高，如果服务器故障，才会丢失事务数据。对数据安全性要求不是很高的推荐设置2，性能高，修改后效果明显。innodb_file_per_table = OFF #默认是共享表空间，共享表空间idbdata文件不断增大，影响一定的I/O性能。推荐开启独立表空间模式，每个表的索引和数据都存在自己独立的表空间中，可以实现单表在不同数据库中移动。innodb_log_buffer_size = 8M #日志缓冲区大小，由于日志最长每秒钟刷新一次，所以一般不用超过16M 系统内核优化 大多数MySQL都部署在linux系统上，所以操作系统的一些参数也会影响到MySQL性能，以下对linux内核进行适当优化。 net.ipv4.tcp_fin_timeout = 30#TIME_WAIT超时时间，默认是60snet.ipv4.tcp_tw_reuse = 1 #1表示开启复用，允许TIME_WAIT socket重新用于新的TCP连接，0表示关闭net.ipv4.tcp_tw_recycle = 1 #1表示开启TIME_WAIT socket快速回收，0表示关闭net.ipv4.tcp_max_tw_buckets = 4096 #系统保持TIME_WAIT socket最大数量，如果超出这个数，系统将随机清除一些TIME_WAIT并打印警告信息net.ipv4.tcp_max_syn_backlog = 4096#进入SYN队列最大长度，加大队列长度可容纳更多的等待连接 在linux系统中，如果进程打开的文件句柄数量超过系统默认值1024，就会提示“too many files open”信息，所以要调整打开文件句柄限制。 # vi /etc/security/limits.conf &nbsp;#加入以下配置，*代表所有用户，也可以指定用户，重启系统生效* soft nofile 65535* hard nofile 65535# ulimit -SHn 65535 &nbsp; #立刻生效 硬件配置 加大物理内存，提高文件系统性能。linux内核会从内存中分配出缓存区（系统缓存和数据缓存）来存放热数据，通过文件系统延迟写入机制，等满足条件时（如缓存区大小到达一定百分比或者执行sync命令）才会同步到磁盘。也就是说物理内存越大，分配缓存区越大，缓存数据越多。当然，服务器故障会丢失一定的缓存数据。 SSD硬盘代替SAS硬盘，将RAID级别调整为RAID1+0，相对于RAID1和RAID5有更好的读写性能（IOPS），毕竟数据库的压力主要来自磁盘I/O方面。 数据库架构扩展 随着业务量越来越大，单台数据库服务器性能已无法满足业务需求，该考虑加机器了，该做集群了~~~。主要思想是分解单台数据库负载，突破磁盘I/O性能，热数据存放缓存中，降低磁盘I/O访问频率。 主从复制与读写分离 因为生产环境中，数据库大多都是读操作，所以部署一主多从架构，主数据库负责写操作，并做双击热备，多台从数据库做负载均衡，负责读操作，主流的负载均衡器有LVS、HAProxy、Nginx。怎么来实现读写分离呢？大多数企业是在代码层面实现读写分离，效率比较高。另一个种方式通过代理程序实现读写分离，企业中应用较少，常见代理程序有MySQL Proxy、Amoeba。在这样数据库集群架构中，大大增加数据库高并发能力，解决单台性能瓶颈问题。如果从数据库一台从库能处理2000 QPS，那么5台就能处理1w QPS，数据库横向扩展性也很容易。 有时，面对大量写操作的应用时，单台写性能达不到业务需求。如果做双主，就会遇到数据库数据不一致现象，产生这个原因是在应用程序不同的用户会有可能操作两台数据库，同时的更新操作造成两台数据库数据库数据发生冲突或者不一致。在单库时MySQL利用存储引擎机制表锁和行锁来保证数据完整性，怎样在多台主库时解决这个问题呢？有一套基于perl语言开发的主从复制管理工具，叫&nbsp; -MMM（Master-Master replication managerfor MysQL，MySQL主主复制管理器），这个工具最大的优点是在同一时间只提供一台数据库写操作，有效保证数据一致性。 主从复制博文：http://lizhenliang.blog.51cto.com/7876557/1290431 读写分离博文：http://lizhenliang.blog.51cto.com/7876557/1305083 MySQL-MMM博文：http://lizhenliang.blog.51cto.com/7876557/1354576 增加缓存 给数据库增加缓存系统，把热数据缓存到内存中，如果内存缓存中有要请求的数据就不再去数据库中返回结果，提高读性能。缓存实现有本地缓存和分布式缓存，本地缓存是将数据缓存到本地服务器内存中或者文件中，速度快。分布式可以缓存海量数据，扩展容易，主流的分布式缓存系统有memcached、redis，memcached性能稳定，数据缓存在内存中，速度很快，QPS可达8W左右。如果想数据持久化那就用redis，性能不低于memcached。 工作过程： 分库 分库是根据业务不同把相关的表切分到不同的数据库中，比如web、bbs、blog等库。如果业务量很大，还可将切分后的库做主从架构，进一步避免单个库压力过大。 分表 数据量的日剧增加，数据库中某个表有几百万条数据，导致查询和插入耗时太长，怎么能解决单表压力呢？你就该考虑是否把这个表拆分成多个小表，来减轻单个表的压力，提高处理效率，此方式称为分表。 分表技术比较麻烦，要修改程序代码里的SQL语句，还要手动去创建其他表，也可以用merge存储引擎实现分表，相对简单许多。分表后，程序是对一个总表进行操作，这个总表不存放数据，只有一些分表的关系，以及更新数据的方式，总表会根据不同的查询，将压力分到不同的小表上，因此提高并发能力和磁盘I/O性能。 分表分为垂直拆分和水平拆分： 垂直拆分：把原来的一个很多字段的表拆分多个表，解决表的宽度问题。你可以把不常用的字段单独放到一个表中，也可以把大字段独立放一个表中，或者把关联密切的字段放一个表中。 水平拆分：把原来一个表拆分成多个表，每个表的结构都一样，解决单表数据量大的问题。 分区 分区就是把一张表的数据分成多个区块，这些区块可以在一个磁盘上，也可以在不同的磁盘上，分区后，表面上还是一张表，但数据散列在多个位置，这样一来，多块硬盘同时处理不同的请求，从而提高磁盘I/O读写性能，实现比较简单。 注：增加缓存、分库、分表和分区主要由程序猿来实现。 数据库维护 数据库维护是运维工程师或者DBA主要工作，包括性能监控、性能分析、性能调优、数据库备份和恢复等。 性能状态关键指标 QPS，Queries Per Second：每秒查询数，一台数据库每秒能够处理的查询次数 TPS，Transactions Per Second：每秒处理事务数 通过show status查看运行状态，会有300多条状态信息记录，其中有几个值帮可以我们计算出QPS和TPS，如下： Uptime：服务器已经运行的实际，单位秒 Questions：已经发送给数据库查询数 Com_select：查询次数，实际操作数据库的 Com_insert：插入次数 Com_delete：删除次数 Com_update：更新次数 Com_commit：事务次数 Com_rollback：回滚次数 那么，计算方法来了，基于Questions计算出QPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; QPS = Questions / Uptime，基于Com_commit和Com_rollback计算出TPS： mysql&gt; show global status like &#39;Com_commit&#39;;mysql&gt; show global status like &#39;Com_rollback&#39;;mysql&gt; show global status like &#39;Uptime&#39;; 另一计算方式：基于Com_select、Com_insert、Com_delete、Com_update计算出QPS： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 等待1秒再执行，获取间隔差值，第二次每个变量值减去第一次对应的变量值，就是QPS。 TPS计算方法： mysql&gt; show global status where Variable_name in(&#39;com_select&#39;,&#39;com_insert&#39;,&#39;com_delete&#39;,&#39;com_update&#39;); 计算TPS，就不算查询操作了，计算出插入、删除、更新四个值即可。 经网友对这两个计算方式的测试得出，当数据库中myisam表比较多时，使用Questions计算比较准确。当数据库中innodb表比较多时，则以Com_*计算比较准确。 开启慢查询日志 MySQL开启慢查询日志，分析出哪条SQL语句比较慢，使用set设置变量，重启服务失效，可以在my.cnf添加参数永久生效。 mysql&gt; set global slow-query-log=on #开启慢查询功能mysql&gt; set global slow_query_log_file=&#39;/var/log/mysql/mysql-slow.log&#39;; #指定慢查询日志文件位置mysql&gt; set global log_queries_not_using_indexes=on; #记录没有使用索引的查询mysql&gt; set global long_query_time=1; #只记录处理时间1s以上的慢查询 分析慢查询日志，可以使用MySQL自带的mysqldumpslow工具，分析的日志较为简单。 # mysqldumpslow -t 3 /var/log/mysql/mysql-slow.log #查看最慢的前三个查询 也可以使用percona公司的pt-query-digest工具，日志分析功能全面，可分析slow log、binlog、general log。 分析慢查询日志： pt-query-digest /var/log/mysql/mysql-slow.log 分析binlog日志： mysqlbinlog mysql-bin.000001 &gt;mysql-bin.000001.sqlpt-query-digest –type=binlog mysql-bin.000001.sql 分析普通日志： pt-query-digest –type=genlog localhost.log 数据库备份 备份数据库是最基本的工作，也是最重要的，否则后果很严重，你懂得！但由于数据库比较大，上百G，往往备份都很耗费时间，所以就该选择一个效率高的备份策略，对于数据量大的数据库，一般都采用增量备份。常用的备份工具有mysqldump、mysqlhotcopy、xtrabackup等，mysqldump比较适用于小的数据库，因为是逻辑备份，所以备份和恢复耗时都比较长。mysqlhotcopy和xtrabackup是物理备份，备份和恢复速度快，不影响数据库服务情况下进行热拷贝，建议使用xtrabackup，支持增量备份。 Xtrabackup备份工具使用博文：http://lizhenliang.blog.51cto.com/7876557/1612800 数据库修复 有时候MySQL服务器突然断电、异常关闭，会导致表损坏，无法读取表数据。这时就可以用到MySQL自带的两个工具进行修复，myisamchk和mysqlcheck。 myisamchk：只能修复myisam表，需要停止数据库。 常用参数： -f –force 强制修复，覆盖老的临时文件，一般不使用 -r –recover 恢复模式 -q –quik 快速恢复 -a –analyze 分析表 -o –safe-recover 老的恢复模式，如果-r无法修复，可以使用此参数试试 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: # cd /var/lib/mysql/weibo# myisamchk -r -q *.MYI mysqlcheck：myisam和innodb表都可以用，不需要停止数据库，如修复单个表，可在数据库后面添加表名，以空格分割。 常用参数： -a –all-databases 检查所有的库 -r –repair 修复表 -c –check 检查表，默认选项 -a –analyze 分析表 -o –optimize 优化表 -q –quik 最快检查或修复表 -F –fast 只检查没有正常关闭的表 快速修复weibo数据库: mysqlcheck -r -q -uroot -p123 weibo 查看CPU和I/O性能方法 查看CPU性能 参数-P是显示CPU数，ALL为所有，也可以只显示第几颗 查看I/O性能 参数-m是以M单位显示，默认K。 %util：当达到100%时，说明I/O很忙。 await：请求在队列中等待时间，直接影响read时间。 I/O极限：IOPS（r/s+w/s）,一般在1200左右。（IOPS，每秒进行读写（I/O）操作次数） I/O带宽：在顺序读写模式下SAS硬盘理论值在300M/s左右，SSD硬盘理论值在600M/s左右。 以上是本人使用MySQL三年来总结的一些主要优化方案，能力有限，有些不太全面，但这些基本能够满足中小型企业数据库需求。由于关系型数据库初衷设计限制，一些BAT公司海量数据放到关系型数据库中，在海量数据查询和分析方面已经达不到更好的性能。因此NoSQL火起来了，非关系型数据库，大数据量，具有高性能，同时也弥补了关系型数据库某方面不足，渐渐大多数公司已经将部分业务数据库存放到NoSQL中，如MongoDB、HBase等。数据存储方面采用分布式文件系统，如HDFS、GFS等。海量数据计算分析采用Hadoop、Spark、Storm等。 出处：JAVA的学习之路 编辑：尹文敏 公司简介&nbsp;&nbsp;|&nbsp;招聘&nbsp;|&nbsp;DTCC&nbsp;|&nbsp;数据技术嘉年华&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;入驻华为严选商城&nbsp;&nbsp; zCloud&nbsp;|&nbsp;SQM&nbsp;|&nbsp;Bethune Pro2&nbsp;|&nbsp;zData一体机&nbsp;|&nbsp;MyData一体机&nbsp;|&nbsp;ZDBM 备份一体机 Oracle技术架构&nbsp;|&nbsp;免费课程&nbsp;|&nbsp;数据库排行榜&nbsp;|&nbsp;DBASK问题集萃&nbsp;|&nbsp;技术通讯&nbsp; 升级迁移&nbsp;|&nbsp;性能优化&nbsp;|&nbsp;智能整合&nbsp;|&nbsp;安全保障&nbsp;|&nbsp;&nbsp;架构设计&nbsp;|&nbsp;SQL审核&nbsp;|&nbsp;分布式架构&nbsp;|&nbsp;高可用容灾&nbsp;|&nbsp;运维代维 云和恩墨大讲堂 |&nbsp;一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂","@type":"BlogPosting","url":"https://uzzz.org/2019/06/06/788651.html","headline":"从运维角度浅谈MySQL数据库优化，中小企业DBA必会","dateModified":"2019-06-06T00:00:00+08:00","datePublished":"2019-06-06T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/06/06/788651.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>从运维角度浅谈MySQL数据库优化，中小企业DBA必会</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix csdn-tracking-statistics" data-pid="blog" data-mod="popu_307" data-dsm="post"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-f57960eb32.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">一个成熟的数据库架构并不是一开始设计就具备高可用、高伸缩等特性的，它是随着用户量的增加，基础架构才逐渐完善。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">这篇博文主要谈MySQL数据库发展周期中所面临的问题及优化方案，暂且抛开前端应用不说，大致分为以下五个阶段：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;color:rgb(0,122,170);"><br></span></p>
   <h2 style="margin-left:8px;line-height:1.5em;"><span style="font-size:16px;color:rgb(0,122,170);"><strong>数据库表设计</strong></span></h2>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">项目立项后，开发部根据产品部需求开发项目，开发工程师工作其中一部分就是对表结构设计。对于数据库来说，这点很重要，如果设计不当，会直接影响访问速度和用户体验。影响的因素很多，比如慢查询、低效的查询语句、没有适当建立索引、数据库堵塞（死锁）等。当然，有测试工程师的团队，会做压力测试，找bug。对于没有测试工程师的团队来说，大多数开发工程师初期不会太多考虑数据库设计是否合理，而是尽快完成功能实现和交付，等项目有一定访问量后，隐藏的问题就会暴露，这时再去修改就不是这么容易的事了。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h2 style="margin-left:8px;line-height:1.5em;"><span style="color:rgb(0,122,170);"><strong><span style="font-size:16px;">数据库部署</span></strong></span></h2>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">该运维工程师出场了，项目初期访问量不会很大，所以单台部署足以应对在1500左右的QPS（每秒查询率）。考虑到高可用性，可采用MySQL主从复制+Keepalived做双击热备，常见集群软件有Keepalived、Heartbeat。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p><img style="border-width:1px;border-style:solid;border-color:rgb(230,230,230);width:217px;" width="400" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/FDmPiaXNnWFQicYop0qBI9icB5AoicBywB2Cib2MsBgLx56CD4RaMEW1uHzcQbhVwl5nwicAKYIM5kEGcRv2n1siap1pA/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <h2 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h2>
   <h2 style="margin-left:8px;line-height:1.5em;"><span style="font-size:16px;"><strong><span style="color:rgb(0,122,170);">数据库性能优化</span></strong></span></h2>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">如果将MySQL部署到普通的X86服务器上，在不经过任何优化情况下，MySQL理论值正常可以处理2000左右QPS，经过优化后，有可能会提升到2500左右QPS，否则，访问量当达到1500左右并发连接时，数据库处理性能就会变慢，而且硬件资源还很富裕，这时就该考虑软件问题了。那么怎样让数据库最大化发挥性能呢？一方面可以单台运行多个MySQL实例让服务器性能发挥到最大化，另一方面是对数据库进行优化，往往操作系统和数据库默认配置都比较保守，会对数据库发挥有一定限制，可对这些配置进行适当的调整，尽可能的处理更多连接数。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">具体优化有以下三个层面：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">数据库配置优化</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">MySQL常用有两种存储引擎，一个是MyISAM，不支持事务处理，读性能处理快，表级别锁。另一个是InnoDB，支持事务处理（ACID），设计目标是为处理大容量数据发挥最大化性能，行级别锁。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">表锁：开销小，锁定粒度大，发生死锁概率高，相对并发也低。</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">行锁：开销大，锁定粒度小，发生死锁概率低，相对并发也高。</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">为什么会出现表锁和行锁呢？主要是为了保证数据的完整性，举个例子，一个用户在操作一张表，其他用户也想操作这张表，那么就要等第一个用户操作完，其他用户才能操作，表锁和行锁就是这个作用。否则多个用户同时操作一张表，肯定会数据产生冲突或者异常。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">根据以上看来，使用InnoDB存储引擎是最好的选择，也是MySQL5.5以后版本中默认存储引擎。每个存储引擎相关联参数比较多，以下列出主要影响数据库性能的参数。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">公共参数默认值：</span></p>
   <pre><code></code></pre>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"></span><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">MyISAM参数默认值：</span></p>
   <pre></pre>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span>key_buffer_size</span> = <span style="color:rgb(0,128,128);">16</span>M<span style="color:rgb(153,153,136);">#索引缓存区大小，一般设置物理内存的30-40%<br></span><span>read_buffer_size</span> = <span style="color:rgb(0,128,128);">128</span>K  <br><span style="color:rgb(153,153,136);">#读操作缓冲区大小，推荐设置16M或32M</span></pre>
   <p style="margin-left:8px;line-height:1.5em;"><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">InnoDB参数默认值：</span></p>
   <pre></pre>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"></span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span>innodb_buffer_pool_size</span> = <span style="color:rgb(0,128,128);">128</span>M<span style="color:rgb(153,153,136);">#索引和数据缓冲区大小，一般设置物理内存的60%-70%</span><span>innodb_buffer_pool_instances</span> = <span style="color:rgb(0,128,128);">1</span>    <span style="color:rgb(153,153,136);">#缓冲池实例个数，推荐设置4个或8个<br></span><span>innodb_flush_log_at_trx_commit</span> = <span style="color:rgb(0,128,128);">1</span>  <span style="color:rgb(153,153,136);">#关键参数，0代表大约每秒写入到日志并同步到磁盘，数据库故障会丢失1秒左右事务数据。1为每执行一条SQL后写入到日志并同步到磁盘，I/O开销大，执行完SQL要等待日志读写，效率低。2代表只把日志写入到系统缓存区，再每秒同步到磁盘，效率很高，如果服务器故障，才会丢失事务数据。对数据安全性要求不是很高的推荐设置2，性能高，修改后效果明显。<br></span><span>innodb_file_per_table</span> = <span style="color:rgb(0,128,128);">OFF</span>  <span style="color:rgb(153,153,136);">#默认是共享表空间，共享表空间idbdata文件不断增大，影响一定的I/O性能。推荐开启独立表空间模式，每个表的索引和数据都存在自己独立的表空间中，可以实现单表在不同数据库中移动。<br></span><span>innodb_log_buffer_size</span> = <span style="color:rgb(0,128,128);">8</span>M  <br><span style="color:rgb(153,153,136);">#日志缓冲区大小，由于日志最长每秒钟刷新一次，所以一般不用超过16M</span></pre>
   <p style="margin-left:8px;line-height:1.5em;"><br></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">系统内核优化</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">大多数MySQL都部署在linux系统上，所以操作系统的一些参数也会影响到MySQL性能，以下对linux内核进行适当优化。</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">net.ipv4.tcp_fin_timeout = <span style="color:rgb(0,128,128);">30</span><span style="color:rgb(153,153,136);">#TIME_WAIT超时时间，默认是60s</span>net.ipv4.tcp_tw_reuse = <span style="color:rgb(0,128,128);">1</span>    <span style="color:rgb(153,153,136);">#1表示开启复用，允许TIME_WAIT socket重新用于新的TCP连接，0表示关闭</span>net.ipv4.tcp_tw_recycle = <span style="color:rgb(0,128,128);">1</span>  <span style="color:rgb(153,153,136);">#1表示开启TIME_WAIT socket快速回收，0表示关闭</span>net.ipv4.tcp_max_tw_buckets = <span style="color:rgb(0,128,128);">4096</span>   <span style="color:rgb(153,153,136);">#系统保持TIME_WAIT socket最大数量，如果超出这个数，系统将随机清除一些TIME_WAIT并打印警告信息</span>net.ipv4.tcp_max_syn_backlog = <span style="color:rgb(0,128,128);">4096</span><span style="color:rgb(153,153,136);">#进入SYN队列最大长度，加大队列长度可容纳更多的等待连接</span></pre>
   <p style="margin-left:8px;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;"><span style="font-size:15px;">在linux系统中，如果进程打开的文件句柄数量超过系统默认值1024，就会提示“too many files open”信息，所以要调整打开文件句柄限制。</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span style="color:rgb(153,0,0);font-weight:bold;"># vi /etc/security/limits.conf &nbsp;#加入以下配置，*代表所有用户，也可以指定用户，重启系统生效</span><span style="color:rgb(153,0,115);">* </span>soft nofile 65535<span style="color:rgb(153,0,115);">* </span>hard nofile 65535<span style="color:rgb(153,0,0);font-weight:bold;"># ulimit -SHn 65535 &nbsp; #立刻生效</span></pre>
   <p style="margin-left:8px;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;"><span style="font-size:15px;"></span><strong><span style="font-size:15px;">硬件配置</span></strong></p>
   <p style="margin-left:8px;"><strong><span style="font-size:15px;"><br></span></strong></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">加大物理内存，提高文件系统性能。linux内核会从内存中分配出缓存区（系统缓存和数据缓存）来存放热数据，通过文件系统延迟写入机制，等满足条件时（如缓存区大小到达一定百分比或者执行sync命令）才会同步到磁盘。也就是说物理内存越大，分配缓存区越大，缓存数据越多。当然，服务器故障会丢失一定的缓存数据。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">SSD硬盘代替SAS硬盘，将RAID级别调整为RAID1+0，相对于RAID1和RAID5有更好的读写性能（IOPS），毕竟数据库的压力主要来自磁盘I/O方面。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h2 style="margin-left:8px;line-height:1.5em;"><span style="font-size:16px;color:rgb(0,122,170);"><strong>数据库架构扩展</strong></span></h2>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">随着业务量越来越大，单台数据库服务器性能已无法满足业务需求，该考虑加机器了，该做集群了~~~。主要思想是分解单台数据库负载，突破磁盘I/O性能，热数据存放缓存中，降低磁盘I/O访问频率。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;"><br></span></strong></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">主从复制与读写分离</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">因为生产环境中，数据库大多都是读操作，所以部署一主多从架构，主数据库负责写操作，并做双击热备，多台从数据库做负载均衡，负责读操作，主流的负载均衡器有LVS、HAProxy、Nginx。怎么来实现读写分离呢？大多数企业是在代码层面实现读写分离，效率比较高。另一个种方式通过代理程序实现读写分离，企业中应用较少，常见代理程序有MySQL Proxy、Amoeba。在这样数据库集群架构中，大大增加数据库高并发能力，解决单台性能瓶颈问题。如果从数据库一台从库能处理2000 QPS，那么5台就能处理1w QPS，数据库横向扩展性也很容易。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">有时，面对大量写操作的应用时，单台写性能达不到业务需求。如果做双主，就会遇到数据库数据不一致现象，产生这个原因是在应用程序不同的用户会有可能操作两台数据库，同时的更新操作造成两台数据库数据库数据发生冲突或者不一致。在单库时MySQL利用存储引擎机制表锁和行锁来保证数据完整性，怎样在多台主库时解决这个问题呢？有一套基于perl语言开发的主从复制管理工具，叫&nbsp; -MMM（Master-Master replication managerfor MysQL，<span style="font-size:15px;">MySQL</span>主主复制管理器），这个工具最大的优点是在同一时间只提供一台数据库写操作，有效保证数据一致性。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul style="list-style-type:disc;" class="list-paddingleft-2">
    <li><p style="line-height:1.5em;text-align:left;"><span style="font-size:15px;">主从复制博文：http://lizhenliang.blog.51cto.com/7876557/1290431</span></p></li>
    <li><p style="line-height:1.5em;text-align:left;"><span style="font-size:15px;">读写分离博文：http://lizhenliang.blog.51cto.com/7876557/1305083</span></p></li>
    <li><p style="line-height:1.5em;text-align:left;"><span style="font-size:15px;">MySQL-MMM博文：http://lizhenliang.blog.51cto.com/7876557/1354576</span></p></li>
   </ul>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">增加缓存</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">给数据库增加缓存系统，把热数据缓存到内存中，如果内存缓存中有要请求的数据就不再去数据库中返回结果，提高读性能。缓存实现有本地缓存和分布式缓存，本地缓存是将数据缓存到本地服务器内存中或者文件中，速度快。分布式可以缓存海量数据，扩展容易，主流的分布式缓存系统有memcached、redis，memcached性能稳定，数据缓存在内存中，速度很快，QPS可达8W左右。如果想数据持久化那就用redis，性能不低于memcached。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">工作过程：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p><img style="border-width:1px;border-style:solid;border-color:rgb(230,230,230);" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/FDmPiaXNnWFQicYop0qBI9icB5AoicBywB2Cw9T1vdABeibkicCLeeQL1VrtDoDgF7wBvGERBYWqiconrXUQJj4zvONfA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">分库</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分库是根据业务不同把相关的表切分到不同的数据库中，比如web、bbs、blog等库。如果业务量很大，还可将切分后的库做主从架构，进一步避免单个库压力过大。</span></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">分表</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">数据量的日剧增加，数据库中某个表有几百万条数据，导致查询和插入耗时太长，怎么能解决单表压力呢？你就该考虑是否把这个表拆分成多个小表，来减轻单个表的压力，提高处理效率，此方式称为分表。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分表技术比较麻烦，要修改程序代码里的SQL语句，还要手动去创建其他表，也可以用merge存储引擎实现分表，相对简单许多。分表后，程序是对一个总表进行操作，这个总表不存放数据，只有一些分表的关系，以及更新数据的方式，总表会根据不同的查询，将压力分到不同的小表上，因此提高并发能力和磁盘I/O性能。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分表分为垂直拆分和水平拆分：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">垂直拆分：把原来的一个很多字段的表拆分多个表，解决表的宽度问题。你可以把不常用的字段单独放到一个表中，也可以把大字段独立放一个表中，或者把关联密切的字段放一个表中。</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">水平拆分：把原来一个表拆分成多个表，每个表的结构都一样，解决单表数据量大的问题。</span></p></li>
   </ul>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">分区</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分区就是把一张表的数据分成多个区块，这些区块可以在一个磁盘上，也可以在不同的磁盘上，分区后，表面上还是一张表，但数据散列在多个位置，这样一来，多块硬盘同时处理不同的请求，从而提高磁盘I/O读写性能，实现比较简单。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;color:rgb(136,136,136);">注：增加缓存、分库、分表和分区主要由程序猿来实现。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h2 style="margin-left:8px;line-height:1.5em;"><span style="font-size:16px;color:rgb(0,122,170);"><strong>数据库维护</strong></span></h2>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">数据库维护是运维工程师或者DBA主要工作，包括性能监控、性能分析、性能调优、数据库备份和恢复等。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">性能状态关键指标</span></strong></h3>
   <p><br></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">QPS，Queries Per Second：每秒查询数，一台数据库每秒能够处理的查询次数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">TPS，Transactions Per Second：每秒处理事务数</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">通过show status查看运行状态，会有300多条状态信息记录，其中有几个值帮可以我们计算出QPS和TPS，如下：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Uptime：服务器已经运行的实际，单位秒</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Questions：已经发送给数据库查询数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_select：查询次数，实际操作数据库的</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_insert：插入次数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_delete：删除次数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_update：更新次数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_commit：事务次数</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">Com_rollback：回滚次数</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">那么，计算方法来了，基于Questions计算出QPS：</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Com_commit'</span>;<br>mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Com_rollback'</span>;<br>mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Uptime'</span>;</pre>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">QPS = Questions / Uptime，基于Com_commit和Com_rollback计算出TPS：</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Com_commit'</span>;<br>mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Com_rollback'</span>;<br>mysql&gt; show <span style="font-weight:bold;">global</span> status like <span style="color:rgb(221,17,68);">'Uptime'</span>;</pre>
   <pre></pre>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">另一计算方式：基于Com_select、Com_insert、Com_delete、Com_update计算出QPS：</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">mysql&gt; show <span style="color:rgb(0,134,179);">global</span> status where Variable_name <span style="font-weight:bold;">in</span>(<span style="color:rgb(221,17,68);">'com_select'</span>,<span style="color:rgb(221,17,68);">'com_insert'</span>,<span style="color:rgb(221,17,68);">'com_delete'</span>,<span style="color:rgb(221,17,68);">'com_update'</span>);</pre>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">等待1秒再执行，获取间隔差值，第二次每个变量值减去第一次对应的变量值，就是QPS。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">TPS计算方法：</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">mysql&gt; show <span style="color:rgb(0,134,179);">global</span> status where Variable_name <span style="font-weight:bold;">in</span>(<span style="color:rgb(221,17,68);">'com_select'</span>,<span style="color:rgb(221,17,68);">'com_insert'</span>,<span style="color:rgb(221,17,68);">'com_delete'</span>,<span style="color:rgb(221,17,68);">'com_update'</span>);</pre>
   <p><br></p>
   <p style="margin-left:8px;"><span style="font-size:15px;">计算TPS，就不算查询操作了，计算出插入、删除、更新四个值即可。</span></p>
   <p style="margin-left:8px;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">经网友对这两个计算方式的测试得出，当数据库中myisam表比较多时，使用Questions计算比较准确。当数据库中innodb表比较多时，则以Com_*计算比较准确。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">开启慢查询日志</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">MySQL开启慢查询日志，分析出哪条SQL语句比较慢，使用set设置变量，重启服务失效，可以在my.cnf添加参数永久生效。</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">mysql&gt; set <span style="color:rgb(0,134,179);">global</span> slow-query-log=<span style="color:rgb(0,128,128);">on</span>  <span style="color:rgb(153,153,136);">#开启慢查询功能<br></span>mysql&gt; set <span style="color:rgb(0,134,179);">global</span> slow_query_log_file=<span style="color:rgb(221,17,68);">'/var/log/mysql/mysql-slow.log'</span>;  <span style="color:rgb(153,153,136);">#指定慢查询日志文件位置<br></span>mysql&gt; set <span style="color:rgb(0,134,179);">global</span> log_queries_not_using_indexes=<span style="color:rgb(0,128,128);">on</span>;   <span style="color:rgb(153,153,136);">#记录没有使用索引的查询</span>mysql&gt; set <span style="color:rgb(0,134,179);">global</span> long_query_time=<span style="color:rgb(0,128,128);">1</span>;   <span style="color:rgb(153,153,136);">#只记录处理时间1s以上的慢查询</span></pre>
   <p><br></p>
   <p style="margin-left:8px;"><span style="font-size:15px;">分析慢查询日志，可以使用MySQL自带的mysqldumpslow工具，分析的日志较为简单。</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"># mysqldumpslow -t <span style="color:rgb(0,128,128);">3</span> /var/<span style="color:rgb(0,134,179);">log</span>/mysql/mysql-slow.<span style="color:rgb(0,134,179);">log</span> #查看最慢的前三个查询</pre>
   <p><br></p>
   <p style="margin-left:8px;"><span style="font-size:15px;">也可以使用percona公司的pt-query-digest工具，日志分析功能全面，可分析slow log、binlog、general log。</span></p>
   <p style="margin-left:8px;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分析慢查询日志：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"></span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">pt-query-digest /var/<span style="color:rgb(0,134,179);">log</span>/mysql/mysql-slow.<span style="color:rgb(0,134,179);">log</span></pre>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分析binlog日志：</span></p>
   <pre></pre>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span style="color:rgb(0,0,128);">mysqlbinlog</span> mysql-bin.<span style="color:rgb(0,128,128);">000001</span> &gt;mysql-bin.<span style="color:rgb(0,128,128);">000001</span>.sql<br>pt-query-digest –type=binlog mysql-bin.<span style="color:rgb(0,128,128);">000001</span>.sql</pre>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">分析普通日志：</span></p>
   <pre></pre>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;">pt-query-digest –type=genlog localhost.<span style="color:rgb(0,134,179);">log</span></pre>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">数据库备份</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">备份数据库是最基本的工作，也是最重要的，否则后果很严重，你懂得！但由于数据库比较大，上百G，往往备份都很耗费时间，所以就该选择一个效率高的备份策略，对于数据量大的数据库，一般都采用增量备份。常用的备份工具有mysqldump、mysqlhotcopy、xtrabackup等，mysqldump比较适用于小的数据库，因为是逻辑备份，所以备份和恢复耗时都比较长。mysqlhotcopy和xtrabackup是物理备份，备份和恢复速度快，不影响数据库服务情况下进行热拷贝，建议使用xtrabackup，支持增量备份。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul style="list-style-type:disc;" class="list-paddingleft-2">
    <li><p style="line-height:1.5em;text-align:left;"><span style="font-size:15px;color:rgb(136,136,136);">Xtrabackup备份工具使用博文：http://lizhenliang.blog.51cto.com/7876557/1612800</span></p></li>
   </ul>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">数据库修复</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">有时候MySQL服务器突然断电、异常关闭，会导致表损坏，无法读取表数据。这时就可以用到MySQL自带的两个工具进行修复，myisamchk和mysqlcheck。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">myisamchk：只能修复myisam表，需要停止数据库。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">常用参数：</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-f –force 强制修复，覆盖老的临时文件，一般不使用</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-r –recover 恢复模式</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-q –quik 快速恢复</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-a –analyze 分析表</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-o –safe-recover 老的恢复模式，如果-r无法修复，可以使用此参数试试</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-F –fast 只检查没有正常关闭的表</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">快速修复weibo数据库:</span></p>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span style="color:rgb(153,153,136);"># cd /var/lib/mysql/weibo</span><span style="color:rgb(153,153,136);"># myisamchk -r -q *.MYI</span></pre>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">mysqlcheck：myisam和innodb表都可以用，不需要停止数据库，如修复单个表，可在数据库后面添加表名，以空格分割。</span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">常用参数：</span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-a –all-databases 检查所有的库</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-r –repair 修复表</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-c –check 检查表，默认选项</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-a –analyze 分析表</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-o –optimize 优化表</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-q –quik 最快检查或修复表</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">-F –fast 只检查没有正常关闭的表</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">快速修复weibo数据库:</span></p>
   <pre></pre>
   <pre style="color:rgb(51,51,51);font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;font-size:12px;line-height:20px;border-style:solid;border-color:rgb(221,221,221);text-align:left;"><span style="color:rgb(0,0,128);">mysqlcheck</span> -r -q -uroot -p123 weibo</pre>
   <h3 style="margin-left:8px;line-height:1.5em;"><br><span style="font-size:15px;"></span></h3>
   <h3 style="margin-left:8px;line-height:1.5em;"><strong><span style="font-size:15px;">查看CPU和I/O性能方法</span></strong></h3>
   <p><br></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">查看CPU性能</span></p>
   <p><img style="border-width:1px;border-style:solid;border-color:rgb(230,230,230);" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/FDmPiaXNnWFQicYop0qBI9icB5AoicBywB2CbcWK1SCGBGiattvXOf1Hc7Vhia92zCkGABsKeRkAd0TDK6aUNI7RV2eA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">参数-P是显示CPU数，ALL为所有，也可以只显示第几颗</span></p>
   <p><img style="border-width:1px;border-style:solid;border-color:rgb(230,230,230);" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/FDmPiaXNnWFQicYop0qBI9icB5AoicBywB2CeYWGRSYCsQpXicMAmMozTeKicop1jwp4BM6mLTd1ua58ABUWaQicTqxWA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">查看I/O性能</span></p>
   <p><img style="border-width:1px;border-style:solid;border-color:rgb(230,230,230);" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/FDmPiaXNnWFQicYop0qBI9icB5AoicBywB2CD0BLQtfn3mL4ibOJLLqibwI9TjYKiaTZbfm3Gf18wib7FSNrLYWCmOI1aw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">参数-m是以M单位显示，默认K。</span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;margin-left:8px;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">%util：当达到100%时，说明I/O很忙。</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">await：请求在队列中等待时间，直接影响read时间。</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">I/O极限：IOPS（r/s+w/s）,一般在1200左右。（IOPS，每秒进行读写（I/O）操作次数）</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">I/O带宽：在顺序读写模式下SAS硬盘理论值在300M/s左右，SSD硬盘理论值在600M/s左右。</span></p></li>
   </ul>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;"><br></span></p>
   <p style="margin-left:8px;line-height:1.5em;"><span style="font-size:15px;">以上是本人使用MySQL三年来总结的一些主要优化方案，能力有限，有些不太全面，但这些基本能够满足中小型企业数据库需求。由于关系型数据库初衷设计限制，一些BAT公司海量数据放到关系型数据库中，在海量数据查询和分析方面已经达不到更好的性能。因此NoSQL火起来了，非关系型数据库，大数据量，具有高性能，同时也弥补了关系型数据库某方面不足，渐渐大多数公司已经将部分业务数据库存放到NoSQL中，如MongoDB、HBase等。数据存储方面采用分布式文件系统，如HDFS、GFS等。海量数据计算分析采用Hadoop、Spark、Storm等。</span></p>
   <p><br></p>
   <p style="text-align:left;margin-left:8px;"><span style="font-size:14px;color:rgb(136,136,136);">出处：JAVA的学习之路</span></p>
   <p style="text-align:left;margin-left:8px;"><span style="font-size:14px;color:rgb(136,136,136);">编辑：尹文敏</span></p>
   <p><br></p>
   <p><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606539&amp;idx=1&amp;sn=134dafd5fb9ce3db71e76effd0d84397&amp;chksm=be95a0b589e229a375484ab05507d1c3af138956d41fdd3b12c383b4d0f6da98eae300d9a8da&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">公司简介</a><span style="font-size:12px;">&nbsp;</span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606795&amp;idx=2&amp;sn=bb9544642faa52b4835718eb8479032e&amp;chksm=be95a7b589e22ea3f22adce976e4c0a3da68754c1132e79cb06ea1c97276863af36c5ab6bfde&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">招聘</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605815&amp;idx=1&amp;sn=96f5e15c7d1f7e1ae1e314dbe02b43b2&amp;chksm=be95a38989e22a9fb5ac4329a1cf0beb14878f0b2e6fc8ea3ed7bb0daebbb601acd84bacd2ef&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">DTCC</span></a><span style="font-size:12px;">&nbsp;|<span>&nbsp;</span></span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606300&amp;idx=1&amp;sn=2bed577bbd2785ed15ed6fa30d0bf5b8&amp;chksm=be95a1a289e228b4558498e0c28389e864858d1be334204365c10c2bbdc7ac1d68747cbca542&amp;scene=21#wechat_redirect" rel="nofollow">数据技术嘉年华</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281343&amp;idx=1&amp;sn=668e2c93f551141a416eb16f3eade76f&amp;chksm=be478d698930047f0fb674ef05a7cbaff4e5f3991d0e0b998f37c06ca1eafc44b6c30ecfb6c8&amp;scene=21#wechat_redirect" rel="nofollow">免费课程</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606949&amp;idx=1&amp;sn=f63ecdd4a5b21ef1104b4626ba29350b&amp;chksm=be95a61b89e22f0da76d3b7005cddf376405df2e91ff9fb9ebfc091b2de72d6901813f819332&amp;scene=21#wechat_redirect" rel="nofollow">入驻华为严选商城</a></span></p>&nbsp;&nbsp;
   <img style="width:60px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU3ibRAFVNDK5LeF9aC9xY7qztxG3VyROib1QrADiabUWPVlslTN2fdGDuPQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p style="text-align:left;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606558&amp;idx=1&amp;sn=d727f762e155ba9eebf0301a49b3815d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">zCloud</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><span style="font-size:12px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606400&amp;idx=1&amp;sn=fda7dfd82768bbd8f890a0ab9250b9e6&amp;scene=21#wechat_redirect" rel="nofollow">SQM</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606558&amp;idx=2&amp;sn=06ca69294cebd30f5f710a322fb98b2c&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">Bethune Pro2</a>&nbsp;<span style="font-size:12px;">|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606577&amp;idx=1&amp;sn=30025f8250b8c50663d3a591fe3de257&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">zData一体机</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606261&amp;idx=1&amp;sn=15ab8b32d85c885427c355f95026029d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">MyData一体机</a>&nbsp;|&nbsp;<a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606518&amp;idx=1&amp;sn=00f2f4a54a37cbc7d1e6fb517b529859&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">ZDBM 备份一体机</a></p>
   <img style="width:52px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU3mTOEfnaMaBWJPOOXcozJEKWtutDLicX9YMNhgzycyxNHUdqeuAjUyvA/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281215&amp;idx=1&amp;sn=30d52b07763b6d7ba4cb15b79de29564&amp;chksm=be478ce9893005ff93809c1d88eda7066b98f560001b5b324be4a8e9ebc10bcafce2267c619d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">Oracle技术架构</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281343&amp;idx=1&amp;sn=668e2c93f551141a416eb16f3eade76f&amp;chksm=be478d698930047f0fb674ef05a7cbaff4e5f3991d0e0b998f37c06ca1eafc44b6c30ecfb6c8&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">免费课程</a><span style="font-size:12px;">&nbsp;</span><span style="font-size:12px;">|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281350&amp;idx=1&amp;sn=26b13e3f181a5d6e831c021b7426e6c4&amp;chksm=be478d9089300486d05476098e1b3cfee5b2eb94365cf614e24d21d1eb58451e6ed16c601d00&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">数据库排行榜</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281239&amp;idx=2&amp;sn=e72ce90ab0bd2e8375b709644c7f8b54&amp;chksm=be478d01893004170db34db767a38b234606e9dd0eaca08a35c313fa474263bcf23871bebe46&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">DBASK问题集萃</a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281286&amp;idx=1&amp;sn=48099b54f34f91687ccbf7afec9e7c65&amp;chksm=be478d50893004463678b48c0eb73f5741f06a6b1bea5502517f9801b0bde84e50c20502811d&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;font-size:12px;">技术通讯</a><span style="font-size:12px;">&nbsp;</span></p>
   <img style="width:60px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/hUPnvEAd0LUUBAJOlz8CcqEOPa1ldXU30DVZ9aCJfsArKCAhqbDR3AT9icAzDHeWPvRl8R6NnskotytVDGuiaXuQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg">
   <p><span style="font-size:12px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605932&amp;idx=1&amp;sn=429bc42915a11a929d8e8d98fa94d627&amp;scene=21#wechat_redirect" rel="nofollow">升级迁移</a></span><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606850&amp;idx=1&amp;sn=cc081d93c4a267fcc3b1a99792ec22c9&amp;chksm=be95a67c89e22f6a113affd2d918d82f8139b638ec9a4b5201d0ee030033fd969a49a3b2f4f3&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">性能优化</span></a><span style="font-size:12px;">&nbsp;|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605700&amp;idx=1&amp;sn=051812f07add697e78e3f3e7a82564e5&amp;chksm=be95a3fa89e22aecb2c4bdb22b303a77e5c4b19e8ff6de2c62624e1161b8ebd4396b28940ddc&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">智能整合</span></a><span style="font-size:12px;text-decoration:underline;">&nbsp;</span><span style="font-size:12px;">|&nbsp;</span><a href="http://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650603337&amp;idx=2&amp;sn=1aa0d1664bb04d8f9dd9c22e60887ba2&amp;scene=21#wechat_redirect" rel="nofollow" style="text-decoration:underline;"><span style="font-size:12px;">安全保障</span></a><span style="font-size:12px;">&nbsp;|&nbsp;<span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650605243&amp;idx=1&amp;sn=83d34ae3e3b33ad55dad215665556dde&amp;scene=21#wechat_redirect" rel="nofollow">架构设计</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=401725923&amp;idx=1&amp;sn=b5c396e5563e0836c9fd40a481ac42db&amp;scene=21#wechat_redirect" rel="nofollow">SQL审核</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650274082&amp;idx=2&amp;sn=729a68af1b7f0266683da44cfd227e32&amp;scene=21#wechat_redirect" rel="nofollow">分布式架构</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650606414&amp;idx=1&amp;sn=e952cc631c64da59b204ed513425eea0&amp;scene=21#wechat_redirect" rel="nofollow">高可用容灾</a></span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;">&nbsp;|&nbsp;</span><span style="font-family:'微软雅黑';font-size:12px;letter-spacing:1px;line-height:26.25px;text-decoration:underline;"><a href="https://mp.weixin.qq.com/s?__biz=MjM5MzExMTU2OQ==&amp;mid=2650603030&amp;idx=1&amp;sn=726b20fde867db768585fe605cbc5fe2&amp;scene=21#wechat_redirect" rel="nofollow">运维代维</a></span></span><br></p>
   <p><strong><span style="font-size:16px;color:rgb(141,203,191);">云和恩墨大讲堂 |&nbsp;</span></strong><span style="font-size:16px;color:rgb(141,203,191);">一个分享交流的地方</span></p>
   <p style="min-height:1em;"><span style="font-size:14px;color:rgb(141,203,191);">长按，识别二维码，加入<strong>万人</strong>交流社群</span></p>
   <p style="min-height:1em;"><br></p>
   <strong><img style="border-width:1px;border-style:dashed;border-color:rgb(168,164,171);" border="0" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMSLia51VIoGv8GNktatN3DiamicGBJkEXibzoGaI0WFTwcD5MT8kzcUlaL1zUEXhewkEHIhRKRTLDq3mw/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></strong>
   <p style="color:rgb(35,21,10);font-size:medium;min-height:1em;"><span style="font-size:12px;"><strong><span style="color:rgb(141,203,191);">请备注：云和恩墨大讲堂</span></strong></span></p>
  </div> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
