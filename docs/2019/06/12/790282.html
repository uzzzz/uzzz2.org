<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>兴业银行银企直联冲账查询及网银审核退回经办 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="兴业银行银企直联冲账查询及网银审核退回经办" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="之前写过兴业银行银企直联应当如何查询手续费及退票，但事实上兴业银行还会产生冲账问题。所谓冲账，就是指支付信息错误，导致根本无法到达实际收款银行，这时候因为根本无法到达收款银行，所以也就不会有收款银行回馈的支付失败信息（也就是退票），这时候银行就会自己产生一笔负向交易流水，以便将这笔付款进行冲正。 虽然看起来与退票类似，但两者其实完全不同： 退票记录金额是正值，而冲账金额是负值； 退票并不会退还手续费，冲账将退还手续费； 退票有专门的查询参数，冲账查询方式则与手续费是一致的。 下面先展示一段项目中真实的支付报文，该报文将导致冲账问题，当然关键信息已脱敏 &lt;SECURITIES_MSGSRQV1&gt; &lt;XFERTRNRQ&gt; &lt;TRNUID&gt;000145_DCXJXL1904260004_1&lt;/TRNUID&gt; &lt;XFERRQ&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;BANKDESC&gt;兴业银行股份有限公司上海淮海支行&lt;/BANKDESC&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;/XFERRQ&gt; &lt;/XFERTRNRQ&gt; &lt;/SECURITIES_MSGSRQV1&gt; 这段报文哪里错了呢？细看一下，收款银行ACCTTO.BANKDESC，这里居然错误的填写了乌鲁木齐市，事实上，这会导致人行无法找到对应的收款银行，从而也就导致了冲账。 下面我们再看下3.4.2 查询转账交易状态所查询到的支付结果 &lt;SECURITIES_MSGSRSV1&gt; &lt;XFERINQTRNRS&gt; &lt;TRNUID&gt;190429103101328_3.4.2_1652&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;XFERINQRS&gt; &lt;XFERLIST MORE=&quot;N&quot;&gt; &lt;FROM&gt;900861323722&lt;/FROM&gt; &lt;TO&gt;900861323722&lt;/TO&gt; &lt;XFER&gt; &lt;SRVRTID&gt;900861323722&lt;/SRVRTID&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;CHEQUENUM&gt;8758456&lt;/CHEQUENUM&gt; &lt;CURSYM&gt;RMB&lt;/CURSYM&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;XFERPRCSTS&gt; &lt;XFERPRCCODE&gt;PAYOUT&lt;/XFERPRCCODE&gt; &lt;DTXFERPRC&gt;2019-04-26 16:42:10&lt;/DTXFERPRC&gt; &lt;MESSAGE&gt;交易成功&lt;/MESSAGE&gt; &lt;/XFERPRCSTS&gt; &lt;/XFER&gt; &lt;/XFERLIST&gt; &lt;/XFERINQRS&gt; &lt;/XFERINQTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 这个接口不管怎么查询，返回的最终结果都是PAYOUT，下面我们再看下3.6账户余额和交易流水分页查询中查询到的交易信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190426224007047_3.6_1_9469&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-26&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-26&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;227&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;银行扣款&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614580000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;收费&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;收费&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;企业网银转账手续费;&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;231&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614588000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;汇款&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;网上汇款&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 下面就是同样通过3.6账户余额和交易流水分页查询中查询到的冲账信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190428154005926_3.6_1_9957&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;216170100100279407&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-28&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-28&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000002&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 可以看到交易发生日期是2019-04-26，实际冲账日期是2019-04-28，虽然银行方面没能指出冲账和交易报文可以通过哪些字段进行对应，但对比两份报文，可以发现虽然交易的HXJYLSBH与冲账的HXJYLSBH不同，但两者的CHEQUENUM、CORRELATE_ACCTID、CORRELATE_NAME这三者却是完全一致的，TRNAMT则是完全相反，另外冲账退回的手续费，其HXJYLSBH与冲账记录的HXJYLSBH也是完全一致的，所以到此我们也就知道了冲账应该如何关联到原始交易记录 通过CHEQUENUM进行关联，如果觉得不够保险，可以增加CORRELATE_ACCTID、CORRELATE_NAME、TRNAMT三者共同判断 冲账退回的手续费与正常交易的手续费一样，还是通过HXJYLSBH进行关联 接下来我们就是需要在CIBTransactionHelper中增加冲账相关的查询代码，代码涉及的SDK在此处下载，完整的代码如下，如果需要了解各个接口说明，则可以查看此篇内容 /// &lt;summary&gt; /// 兴业银行交易辅助类 /// &lt;/summary&gt; public class CIBTransactionHelper { private long _cid; private string _userId; private string _pwd; private ICIBTransactionPurposeBuilder _buider; /// &lt;summary&gt; /// 转账对应的SUMMNAME /// &lt;/summary&gt; public static string TransactionSummaryName = &quot;汇款&quot;; /// &lt;summary&gt; /// 退票对应的SUMMNAME /// &lt;/summary&gt; public static string RefundSummaryName = &quot;汇出退回&quot;; /// &lt;summary&gt; /// 手续费对应的SUMMNAME /// &lt;/summary&gt; public static string ChargesSummaryName = &quot;收费&quot;; /// &lt;summary&gt; /// 冲账对应的SUMMNAME /// &lt;/summary&gt; public static string RubricSummaryName = &quot;冲账&quot;; /// &lt;summary&gt; /// 构造函数 /// &lt;/summary&gt; /// &lt;param name=&quot;cid&quot;&gt;兴业银行银企直联客户号&lt;/param&gt; /// &lt;param name=&quot;userId&quot;&gt;兴业银行银企直联登录用户名&lt;/param&gt; /// &lt;param name=&quot;pwd&quot;&gt;兴业银行银企直联登录密码&lt;/param&gt; /// &lt;param name=&quot;host&quot;&gt;前置机域名，默认为127.0.0.1&lt;/param&gt; /// &lt;param name=&quot;port&quot;&gt;前置机端口，默认为8007&lt;/param&gt; /// &lt;param name=&quot;builder&quot;&gt;转账交易用途构建实现，如果不传则使用默认实现&lt;see cref=&quot;CIBTransactionPurposeBuilder&quot;/&gt;&lt;/param&gt; public CIBTransactionHelper(long cid, string userId, string pwd, string host = &quot;127.0.0.1&quot;, int port = 8007, ICIBTransactionPurposeBuilder builder = null) { if (cid &lt;= 0 || string.IsNullOrWhiteSpace(userId) || string.IsNullOrWhiteSpace(pwd) || string.IsNullOrWhiteSpace(host)) { throw new ArgumentException(); } this._cid = cid; this._userId = userId; this._pwd = pwd; this._buider = builder; if (builder == null) { this._buider = new CIBTransactionPurposeBuilder(); } this.Client = new CIBClient(host, port); } /// &lt;summary&gt; /// 兴业银行银企直联客户端 /// &lt;/summary&gt; public ICIBClient Client { get; set; } /// &lt;summary&gt; /// 生成一个用于查询的TRNUID，注意转账之类的业务切记不要采用此方法获取TRNUID /// &lt;/summary&gt; /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static string GetQueryTRNUID(string key) { var tmp = (Math.Abs(Guid.NewGuid().GetHashCode()) % 10000).ToString(&quot;0000&quot;); return string.Format(&quot;{0:yyMMddHHmmssfff}_{1}_{2}&quot;, DateTime.Now, key, tmp); } /// &lt;summary&gt; /// 获取兴业银行3.6查询接口请求主体 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;page&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;selType&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt; GetCIBRequest_3_6(string acctid, DateTime dtStart, DateTime dtEnd, int page, int selType) { return new FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt;() { SIGNONMSGSRQV1 = new SIGNONMSGSRQV1 { SONRQ = new SONRQ { CID = this._cid, USERID = this._userId, USERPASS = this._pwd, } }, SECURITIES_MSGSRQV1 = new V1_SCUSTSTMTTRNRQ { SCUSTSTMTTRNRQ = new SCUSTSTMTTRNRQ { TRNUID = GetQueryTRNUID(&quot;3.6&quot; + &quot;_&quot; + selType), SCUSTSTMTRQ = new SCUSTSTMTTRN_SCUSTSTMTRQ { VERSION = &quot;2.0&quot;, ACCTFROM = new ACCTFROM { ACCTID = acctid }, INCTRAN = new INCTRAN { DTEND = dtEnd, DTSTART = dtStart, TRNTYPE = 2, PAGE = page, }, SELTYPE = selType } } } }; } /// &lt;summary&gt; /// 获取退票记录 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetRefundRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 3); } private List&lt;STMTTRN&gt; GetRecords(string acctid, DateTime dtStart, DateTime dtEnd, int selType) { var list = new List&lt;STMTTRN&gt;(); dtStart = dtStart.Date; dtEnd = dtEnd.Date; if (dtStart &lt;= dtEnd) { //历史与当日不能同查，所以此处要加以判断，因为每日流水可能较大，所以此处简单拆分成按每天查询 var dt = dtStart; for (; dt &lt;= dtEnd;) { for (var i = 1; ; i++) { var rq = GetCIBRequest_3_6(acctid, dt, dt, i, selType); var rs = this.Client.Execute(rq); if (rs != null &amp;&amp; rs.ResponseSuccess &amp;&amp; rs.SIGNONMSGSRSV1?.SONRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1?.SCUSTSTMTTRNRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS?.TRANLIST?.List != null) { list.AddRange(rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.List); if (rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.MORE == &quot;Y&quot;) { continue; } } break; } dt = dt.AddDays(1); } } return list; } /// &lt;summary&gt; /// 获取交易记录（含手续费、冲账等） /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 1); } /// &lt;summary&gt; /// 根据退票记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;refundList&quot;&gt;退票流水&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前退票属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;refundDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认按兴业银行文档设置为2天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为退票流水&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt; GetRefundMapping(IList&lt;STMTTRN&gt; refundList, string acctid, int refundDayDiff = 2, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt;(); if (refundList != null &amp;&amp; refundList.Count &gt; 0) { refundList = refundList.Where(x =&gt; x.SUMMNAME == RefundSummaryName).OrderBy(x =&gt; x.DTACCT).ToList(); if (refundList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按退票日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, refundList, refundDayDiff); } var query = from refund in refundList join trans in transList on refund.MEMO equals trans.HXJYLSBH where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, refund); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } } return dic; } private IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, IList&lt;STMTTRN&gt; list, int dayDiff) { var transList = new List&lt;STMTTRN&gt;(); var timeList = list.Select(x =&gt; x.DTACCT.Date).Distinct().OrderBy(d =&gt; d).ToList(); //虽然底层查询时是拆分成按每日查询，但因为退票或冲账需要倒查N天的交易流水，所以将日期按连续性拆分成日期范围还是有必要的 var timeRange = this.GetTimeRange(timeList, dayDiff); foreach (var t in timeRange) { var tmp = this.GetTransactionRecords(acctid, t.Item1.AddDays(-1), t.Item2); transList.AddRange(tmp); } return transList; } private IList&lt;Tuple&lt;DateTime, DateTime&gt;&gt; GetTimeRange(IList&lt;DateTime&gt; timeList, int dayDiff) { var timeRange = new List&lt;Tuple&lt;DateTime, DateTime&gt;&gt;(); var dtStart = timeList[0]; var dtEnd = timeList[0]; for (var i = 1; i &lt;= timeList.Count; i++) { DateTime dt = DateTime.MaxValue; if (i &lt; timeList.Count) { dt = timeList[i]; } if (dt &gt;= dtEnd &amp;&amp; dt &lt;= dtEnd.AddDays(dayDiff)) { //退票需要查询交易流水日期范围为交易当天或交易前一天 //所以如果出现跳日，比如03-19和03-21,也应该算是连续日期 dtEnd = dt; } else { timeRange.Add(Tuple.Create(dtStart, dtEnd)); dtStart = dt; dtEnd = dt; } } return timeRange; } /// &lt;summary&gt; /// 根据交易流水获取对应的交易记录及手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt; GetServiceChargesMapping(IList&lt;STMTTRN&gt; list) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { //此处判断PURPOSE是否是当前业务组织的PURPOSE list = list.Where(x =&gt; (x.SUMMNAME == TransactionSummaryName &amp;&amp; this._buider.IsCorrectPurpose(x.PURPOSE)) || x.SUMMNAME == ChargesSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH); // new { x.SRVRTID, x.DTACCT } #if DEBUG var tmp = groups.ToList(); #endif foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; x.SUMMNAME == TransactionSummaryName); if (trans == null) { continue; } var id = this._buider.GetIdFromPurpose(trans.PURPOSE); if (string.IsNullOrWhiteSpace(id)) { continue; } //可能会无需手续费 var charge = g.FirstOrDefault(x =&gt; x.SUMMNAME == ChargesSummaryName)?.TRNAMT ?? 0; dic.Add(id, Tuple.Create(trans, charge)); } } } return dic; } /// &lt;summary&gt; /// 根据交易流水获取其内包含的冲账记录及冲账退回的手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Tuple.Item1为冲账交易流水，需按其值&lt;see cref=&quot;STMTTRN.CHEQUENUM&quot;/&gt;凭证代号与历史交易记录CHEQUENUM的进行比较，Tuple.Item2为冲账时退回的手续费&lt;/returns&gt; public IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; GetRubricRecords(IList&lt;STMTTRN&gt; list) { var retList = new List&lt;Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { list = list.Where(x =&gt; x.SUMMNAME == RubricSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH);//冲账逻辑与退票本质无差别 foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; !string.IsNullOrWhiteSpace(x.CHEQUENUM));//凭证代号不为空代表冲账交易记录，为空代表冲账手续费 if (trans == null) { continue; } var charge = g.FirstOrDefault(x =&gt; string.IsNullOrWhiteSpace(x.CHEQUENUM))?.TRNAMT ?? 0;//冲账退回的手续费 retList.Add(Tuple.Create(trans, charge)); } } } return retList; } /// &lt;summary&gt; /// 根据冲账记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;rubricList&quot;&gt;冲账流水及冲账手续费&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前冲账属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;rubricDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认设置为3天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为冲账流水，Tuple.Item3为冲账手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt; GetRubricMapping(IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; rubricList, string acctid, int rubricDayDiff = 3, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt;(); if (rubricList != null &amp;&amp; rubricList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按冲账日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, rubricList.Select(x =&gt; x.Item1).ToList(), rubricDayDiff); } var query = from rubric in rubricList join trans in transList on rubric.Item1.CHEQUENUM equals trans.CHEQUENUM where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, rubric.Item1, rubric.Item2); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } return dic; } } /// &lt;summary&gt; /// 兴业银行交易流水用途构建约束接口 /// &lt;/summary&gt; public interface ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetPurpose(string id); /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetIdFromPurpose(string purpose); /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; bool IsCorrectPurpose(string purpose); } /// &lt;summary&gt; /// 兴业银行交易流水用途构建默认实现 /// &lt;/summary&gt; public class CIBTransactionPurposeBuilder : ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetIdFromPurpose(string purpose) { return purpose; } /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetPurpose(string id) { return id; } /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual bool IsCorrectPurpose(string purpose) { return true; } } 调用示例如下 var helper = new CIBTransactionHelper(cid, uid, pwd, ip, port, new CustCIBTransactionPurposeBuilder()); var transList = helper.GetTransactionRecords(mainAccountId, new DateTime(2019, 3, 19), new DateTime(2019, 3, 19)); var changeDic = helper.GetServiceChargesMapping(transList); var rubricList = helper.GetRubricRecords(transList); #if DEBUG if (rubricList.Count == 0) { var tmpTransList = new List&lt;STMTTRN&gt;(); //为方便测试，手工增加一条冲账记录及冲账流水 tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;110340545&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT=-15.54m, }); tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT = -0.60m, }); rubricList = helper.GetRubricRecords(tmpTransList); } #endif //如果你已经通过GetTransactionRecords获取并持久化了手续费、HXJYLSBH及CHEQUENUM //那么下面Mappding这步就可以忽略，转为直接查本地数据库 var rubricDic = helper.GetRubricMapping(rubricList, mainAccountId, rubricDayDiff: 3, transList: transList); 说完了冲账，我们再来说下网银审核退回经办，因为该部分内容不多，就不单独开篇描述。 正常来讲，我们既然通过银企直联将支付信息发送给了银行，那么我们肯定是要进行支付的，所以一般来说，网银审批时，基本都是会审批通过，但有时候存在一些特殊情况，虽然支付信息已经同步到了银行，但财务必需要在网银中终止该笔交易，也就是财务不进行支付，这时候就会产生退回经办操作，具体就是出纳和财务复审进行退回经办，当这两者操作完后，通过3.4.2 查询转账交易状态，我们能查到的状态为SEND_BACK，这时候还需要由操作员进行最终的驳回操作，这样才能使查询状态最终返回值为CANCEL，然后问题就出在这个操作员身上，因为银企直联时，需要将U盾插在银企直联前置机所在服务器上，也就是说，往往财务并不能直接访问前置机服务器，那么这个通过操作员账号进行驳回的操作也就无法进行，虽然兴业银行有EXPIRED的处理逻辑，但如果你未设置期望支付时间，那么你需要花费一个月的时间才能等到EXPIRED这个状态，所以这在实际操作中基本是无法被用户接受的，那这时候，你可以考虑将SEND_BACK做为一个终结状态来进行业务处理。当然因为实际SEND_BACK并不是真正的最终状态，出纳等网银操作用户还是可以通过一些操作，在网银中将该笔单据回归到正常可支付状态并进行支付，这样的话，就可能存在系统中支付状态与网银中支付状态不一致，这个风险性还是需要注意的。" />
<meta property="og:description" content="之前写过兴业银行银企直联应当如何查询手续费及退票，但事实上兴业银行还会产生冲账问题。所谓冲账，就是指支付信息错误，导致根本无法到达实际收款银行，这时候因为根本无法到达收款银行，所以也就不会有收款银行回馈的支付失败信息（也就是退票），这时候银行就会自己产生一笔负向交易流水，以便将这笔付款进行冲正。 虽然看起来与退票类似，但两者其实完全不同： 退票记录金额是正值，而冲账金额是负值； 退票并不会退还手续费，冲账将退还手续费； 退票有专门的查询参数，冲账查询方式则与手续费是一致的。 下面先展示一段项目中真实的支付报文，该报文将导致冲账问题，当然关键信息已脱敏 &lt;SECURITIES_MSGSRQV1&gt; &lt;XFERTRNRQ&gt; &lt;TRNUID&gt;000145_DCXJXL1904260004_1&lt;/TRNUID&gt; &lt;XFERRQ&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;BANKDESC&gt;兴业银行股份有限公司上海淮海支行&lt;/BANKDESC&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;/XFERRQ&gt; &lt;/XFERTRNRQ&gt; &lt;/SECURITIES_MSGSRQV1&gt; 这段报文哪里错了呢？细看一下，收款银行ACCTTO.BANKDESC，这里居然错误的填写了乌鲁木齐市，事实上，这会导致人行无法找到对应的收款银行，从而也就导致了冲账。 下面我们再看下3.4.2 查询转账交易状态所查询到的支付结果 &lt;SECURITIES_MSGSRSV1&gt; &lt;XFERINQTRNRS&gt; &lt;TRNUID&gt;190429103101328_3.4.2_1652&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;XFERINQRS&gt; &lt;XFERLIST MORE=&quot;N&quot;&gt; &lt;FROM&gt;900861323722&lt;/FROM&gt; &lt;TO&gt;900861323722&lt;/TO&gt; &lt;XFER&gt; &lt;SRVRTID&gt;900861323722&lt;/SRVRTID&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;CHEQUENUM&gt;8758456&lt;/CHEQUENUM&gt; &lt;CURSYM&gt;RMB&lt;/CURSYM&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;XFERPRCSTS&gt; &lt;XFERPRCCODE&gt;PAYOUT&lt;/XFERPRCCODE&gt; &lt;DTXFERPRC&gt;2019-04-26 16:42:10&lt;/DTXFERPRC&gt; &lt;MESSAGE&gt;交易成功&lt;/MESSAGE&gt; &lt;/XFERPRCSTS&gt; &lt;/XFER&gt; &lt;/XFERLIST&gt; &lt;/XFERINQRS&gt; &lt;/XFERINQTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 这个接口不管怎么查询，返回的最终结果都是PAYOUT，下面我们再看下3.6账户余额和交易流水分页查询中查询到的交易信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190426224007047_3.6_1_9469&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-26&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-26&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;227&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;银行扣款&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614580000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;收费&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;收费&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;企业网银转账手续费;&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;231&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614588000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;汇款&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;网上汇款&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 下面就是同样通过3.6账户余额和交易流水分页查询中查询到的冲账信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190428154005926_3.6_1_9957&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;216170100100279407&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-28&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-28&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000002&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 可以看到交易发生日期是2019-04-26，实际冲账日期是2019-04-28，虽然银行方面没能指出冲账和交易报文可以通过哪些字段进行对应，但对比两份报文，可以发现虽然交易的HXJYLSBH与冲账的HXJYLSBH不同，但两者的CHEQUENUM、CORRELATE_ACCTID、CORRELATE_NAME这三者却是完全一致的，TRNAMT则是完全相反，另外冲账退回的手续费，其HXJYLSBH与冲账记录的HXJYLSBH也是完全一致的，所以到此我们也就知道了冲账应该如何关联到原始交易记录 通过CHEQUENUM进行关联，如果觉得不够保险，可以增加CORRELATE_ACCTID、CORRELATE_NAME、TRNAMT三者共同判断 冲账退回的手续费与正常交易的手续费一样，还是通过HXJYLSBH进行关联 接下来我们就是需要在CIBTransactionHelper中增加冲账相关的查询代码，代码涉及的SDK在此处下载，完整的代码如下，如果需要了解各个接口说明，则可以查看此篇内容 /// &lt;summary&gt; /// 兴业银行交易辅助类 /// &lt;/summary&gt; public class CIBTransactionHelper { private long _cid; private string _userId; private string _pwd; private ICIBTransactionPurposeBuilder _buider; /// &lt;summary&gt; /// 转账对应的SUMMNAME /// &lt;/summary&gt; public static string TransactionSummaryName = &quot;汇款&quot;; /// &lt;summary&gt; /// 退票对应的SUMMNAME /// &lt;/summary&gt; public static string RefundSummaryName = &quot;汇出退回&quot;; /// &lt;summary&gt; /// 手续费对应的SUMMNAME /// &lt;/summary&gt; public static string ChargesSummaryName = &quot;收费&quot;; /// &lt;summary&gt; /// 冲账对应的SUMMNAME /// &lt;/summary&gt; public static string RubricSummaryName = &quot;冲账&quot;; /// &lt;summary&gt; /// 构造函数 /// &lt;/summary&gt; /// &lt;param name=&quot;cid&quot;&gt;兴业银行银企直联客户号&lt;/param&gt; /// &lt;param name=&quot;userId&quot;&gt;兴业银行银企直联登录用户名&lt;/param&gt; /// &lt;param name=&quot;pwd&quot;&gt;兴业银行银企直联登录密码&lt;/param&gt; /// &lt;param name=&quot;host&quot;&gt;前置机域名，默认为127.0.0.1&lt;/param&gt; /// &lt;param name=&quot;port&quot;&gt;前置机端口，默认为8007&lt;/param&gt; /// &lt;param name=&quot;builder&quot;&gt;转账交易用途构建实现，如果不传则使用默认实现&lt;see cref=&quot;CIBTransactionPurposeBuilder&quot;/&gt;&lt;/param&gt; public CIBTransactionHelper(long cid, string userId, string pwd, string host = &quot;127.0.0.1&quot;, int port = 8007, ICIBTransactionPurposeBuilder builder = null) { if (cid &lt;= 0 || string.IsNullOrWhiteSpace(userId) || string.IsNullOrWhiteSpace(pwd) || string.IsNullOrWhiteSpace(host)) { throw new ArgumentException(); } this._cid = cid; this._userId = userId; this._pwd = pwd; this._buider = builder; if (builder == null) { this._buider = new CIBTransactionPurposeBuilder(); } this.Client = new CIBClient(host, port); } /// &lt;summary&gt; /// 兴业银行银企直联客户端 /// &lt;/summary&gt; public ICIBClient Client { get; set; } /// &lt;summary&gt; /// 生成一个用于查询的TRNUID，注意转账之类的业务切记不要采用此方法获取TRNUID /// &lt;/summary&gt; /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static string GetQueryTRNUID(string key) { var tmp = (Math.Abs(Guid.NewGuid().GetHashCode()) % 10000).ToString(&quot;0000&quot;); return string.Format(&quot;{0:yyMMddHHmmssfff}_{1}_{2}&quot;, DateTime.Now, key, tmp); } /// &lt;summary&gt; /// 获取兴业银行3.6查询接口请求主体 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;page&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;selType&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt; GetCIBRequest_3_6(string acctid, DateTime dtStart, DateTime dtEnd, int page, int selType) { return new FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt;() { SIGNONMSGSRQV1 = new SIGNONMSGSRQV1 { SONRQ = new SONRQ { CID = this._cid, USERID = this._userId, USERPASS = this._pwd, } }, SECURITIES_MSGSRQV1 = new V1_SCUSTSTMTTRNRQ { SCUSTSTMTTRNRQ = new SCUSTSTMTTRNRQ { TRNUID = GetQueryTRNUID(&quot;3.6&quot; + &quot;_&quot; + selType), SCUSTSTMTRQ = new SCUSTSTMTTRN_SCUSTSTMTRQ { VERSION = &quot;2.0&quot;, ACCTFROM = new ACCTFROM { ACCTID = acctid }, INCTRAN = new INCTRAN { DTEND = dtEnd, DTSTART = dtStart, TRNTYPE = 2, PAGE = page, }, SELTYPE = selType } } } }; } /// &lt;summary&gt; /// 获取退票记录 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetRefundRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 3); } private List&lt;STMTTRN&gt; GetRecords(string acctid, DateTime dtStart, DateTime dtEnd, int selType) { var list = new List&lt;STMTTRN&gt;(); dtStart = dtStart.Date; dtEnd = dtEnd.Date; if (dtStart &lt;= dtEnd) { //历史与当日不能同查，所以此处要加以判断，因为每日流水可能较大，所以此处简单拆分成按每天查询 var dt = dtStart; for (; dt &lt;= dtEnd;) { for (var i = 1; ; i++) { var rq = GetCIBRequest_3_6(acctid, dt, dt, i, selType); var rs = this.Client.Execute(rq); if (rs != null &amp;&amp; rs.ResponseSuccess &amp;&amp; rs.SIGNONMSGSRSV1?.SONRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1?.SCUSTSTMTTRNRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS?.TRANLIST?.List != null) { list.AddRange(rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.List); if (rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.MORE == &quot;Y&quot;) { continue; } } break; } dt = dt.AddDays(1); } } return list; } /// &lt;summary&gt; /// 获取交易记录（含手续费、冲账等） /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 1); } /// &lt;summary&gt; /// 根据退票记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;refundList&quot;&gt;退票流水&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前退票属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;refundDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认按兴业银行文档设置为2天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为退票流水&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt; GetRefundMapping(IList&lt;STMTTRN&gt; refundList, string acctid, int refundDayDiff = 2, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt;(); if (refundList != null &amp;&amp; refundList.Count &gt; 0) { refundList = refundList.Where(x =&gt; x.SUMMNAME == RefundSummaryName).OrderBy(x =&gt; x.DTACCT).ToList(); if (refundList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按退票日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, refundList, refundDayDiff); } var query = from refund in refundList join trans in transList on refund.MEMO equals trans.HXJYLSBH where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, refund); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } } return dic; } private IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, IList&lt;STMTTRN&gt; list, int dayDiff) { var transList = new List&lt;STMTTRN&gt;(); var timeList = list.Select(x =&gt; x.DTACCT.Date).Distinct().OrderBy(d =&gt; d).ToList(); //虽然底层查询时是拆分成按每日查询，但因为退票或冲账需要倒查N天的交易流水，所以将日期按连续性拆分成日期范围还是有必要的 var timeRange = this.GetTimeRange(timeList, dayDiff); foreach (var t in timeRange) { var tmp = this.GetTransactionRecords(acctid, t.Item1.AddDays(-1), t.Item2); transList.AddRange(tmp); } return transList; } private IList&lt;Tuple&lt;DateTime, DateTime&gt;&gt; GetTimeRange(IList&lt;DateTime&gt; timeList, int dayDiff) { var timeRange = new List&lt;Tuple&lt;DateTime, DateTime&gt;&gt;(); var dtStart = timeList[0]; var dtEnd = timeList[0]; for (var i = 1; i &lt;= timeList.Count; i++) { DateTime dt = DateTime.MaxValue; if (i &lt; timeList.Count) { dt = timeList[i]; } if (dt &gt;= dtEnd &amp;&amp; dt &lt;= dtEnd.AddDays(dayDiff)) { //退票需要查询交易流水日期范围为交易当天或交易前一天 //所以如果出现跳日，比如03-19和03-21,也应该算是连续日期 dtEnd = dt; } else { timeRange.Add(Tuple.Create(dtStart, dtEnd)); dtStart = dt; dtEnd = dt; } } return timeRange; } /// &lt;summary&gt; /// 根据交易流水获取对应的交易记录及手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt; GetServiceChargesMapping(IList&lt;STMTTRN&gt; list) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { //此处判断PURPOSE是否是当前业务组织的PURPOSE list = list.Where(x =&gt; (x.SUMMNAME == TransactionSummaryName &amp;&amp; this._buider.IsCorrectPurpose(x.PURPOSE)) || x.SUMMNAME == ChargesSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH); // new { x.SRVRTID, x.DTACCT } #if DEBUG var tmp = groups.ToList(); #endif foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; x.SUMMNAME == TransactionSummaryName); if (trans == null) { continue; } var id = this._buider.GetIdFromPurpose(trans.PURPOSE); if (string.IsNullOrWhiteSpace(id)) { continue; } //可能会无需手续费 var charge = g.FirstOrDefault(x =&gt; x.SUMMNAME == ChargesSummaryName)?.TRNAMT ?? 0; dic.Add(id, Tuple.Create(trans, charge)); } } } return dic; } /// &lt;summary&gt; /// 根据交易流水获取其内包含的冲账记录及冲账退回的手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Tuple.Item1为冲账交易流水，需按其值&lt;see cref=&quot;STMTTRN.CHEQUENUM&quot;/&gt;凭证代号与历史交易记录CHEQUENUM的进行比较，Tuple.Item2为冲账时退回的手续费&lt;/returns&gt; public IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; GetRubricRecords(IList&lt;STMTTRN&gt; list) { var retList = new List&lt;Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { list = list.Where(x =&gt; x.SUMMNAME == RubricSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH);//冲账逻辑与退票本质无差别 foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; !string.IsNullOrWhiteSpace(x.CHEQUENUM));//凭证代号不为空代表冲账交易记录，为空代表冲账手续费 if (trans == null) { continue; } var charge = g.FirstOrDefault(x =&gt; string.IsNullOrWhiteSpace(x.CHEQUENUM))?.TRNAMT ?? 0;//冲账退回的手续费 retList.Add(Tuple.Create(trans, charge)); } } } return retList; } /// &lt;summary&gt; /// 根据冲账记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;rubricList&quot;&gt;冲账流水及冲账手续费&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前冲账属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;rubricDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认设置为3天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为冲账流水，Tuple.Item3为冲账手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt; GetRubricMapping(IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; rubricList, string acctid, int rubricDayDiff = 3, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt;(); if (rubricList != null &amp;&amp; rubricList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按冲账日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, rubricList.Select(x =&gt; x.Item1).ToList(), rubricDayDiff); } var query = from rubric in rubricList join trans in transList on rubric.Item1.CHEQUENUM equals trans.CHEQUENUM where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, rubric.Item1, rubric.Item2); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } return dic; } } /// &lt;summary&gt; /// 兴业银行交易流水用途构建约束接口 /// &lt;/summary&gt; public interface ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetPurpose(string id); /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetIdFromPurpose(string purpose); /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; bool IsCorrectPurpose(string purpose); } /// &lt;summary&gt; /// 兴业银行交易流水用途构建默认实现 /// &lt;/summary&gt; public class CIBTransactionPurposeBuilder : ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetIdFromPurpose(string purpose) { return purpose; } /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetPurpose(string id) { return id; } /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual bool IsCorrectPurpose(string purpose) { return true; } } 调用示例如下 var helper = new CIBTransactionHelper(cid, uid, pwd, ip, port, new CustCIBTransactionPurposeBuilder()); var transList = helper.GetTransactionRecords(mainAccountId, new DateTime(2019, 3, 19), new DateTime(2019, 3, 19)); var changeDic = helper.GetServiceChargesMapping(transList); var rubricList = helper.GetRubricRecords(transList); #if DEBUG if (rubricList.Count == 0) { var tmpTransList = new List&lt;STMTTRN&gt;(); //为方便测试，手工增加一条冲账记录及冲账流水 tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;110340545&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT=-15.54m, }); tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT = -0.60m, }); rubricList = helper.GetRubricRecords(tmpTransList); } #endif //如果你已经通过GetTransactionRecords获取并持久化了手续费、HXJYLSBH及CHEQUENUM //那么下面Mappding这步就可以忽略，转为直接查本地数据库 var rubricDic = helper.GetRubricMapping(rubricList, mainAccountId, rubricDayDiff: 3, transList: transList); 说完了冲账，我们再来说下网银审核退回经办，因为该部分内容不多，就不单独开篇描述。 正常来讲，我们既然通过银企直联将支付信息发送给了银行，那么我们肯定是要进行支付的，所以一般来说，网银审批时，基本都是会审批通过，但有时候存在一些特殊情况，虽然支付信息已经同步到了银行，但财务必需要在网银中终止该笔交易，也就是财务不进行支付，这时候就会产生退回经办操作，具体就是出纳和财务复审进行退回经办，当这两者操作完后，通过3.4.2 查询转账交易状态，我们能查到的状态为SEND_BACK，这时候还需要由操作员进行最终的驳回操作，这样才能使查询状态最终返回值为CANCEL，然后问题就出在这个操作员身上，因为银企直联时，需要将U盾插在银企直联前置机所在服务器上，也就是说，往往财务并不能直接访问前置机服务器，那么这个通过操作员账号进行驳回的操作也就无法进行，虽然兴业银行有EXPIRED的处理逻辑，但如果你未设置期望支付时间，那么你需要花费一个月的时间才能等到EXPIRED这个状态，所以这在实际操作中基本是无法被用户接受的，那这时候，你可以考虑将SEND_BACK做为一个终结状态来进行业务处理。当然因为实际SEND_BACK并不是真正的最终状态，出纳等网银操作用户还是可以通过一些操作，在网银中将该笔单据回归到正常可支付状态并进行支付，这样的话，就可能存在系统中支付状态与网银中支付状态不一致，这个风险性还是需要注意的。" />
<link rel="canonical" href="https://uzzz.org/2019/06/12/790282.html" />
<meta property="og:url" content="https://uzzz.org/2019/06/12/790282.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-12T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"之前写过兴业银行银企直联应当如何查询手续费及退票，但事实上兴业银行还会产生冲账问题。所谓冲账，就是指支付信息错误，导致根本无法到达实际收款银行，这时候因为根本无法到达收款银行，所以也就不会有收款银行回馈的支付失败信息（也就是退票），这时候银行就会自己产生一笔负向交易流水，以便将这笔付款进行冲正。 虽然看起来与退票类似，但两者其实完全不同： 退票记录金额是正值，而冲账金额是负值； 退票并不会退还手续费，冲账将退还手续费； 退票有专门的查询参数，冲账查询方式则与手续费是一致的。 下面先展示一段项目中真实的支付报文，该报文将导致冲账问题，当然关键信息已脱敏 &lt;SECURITIES_MSGSRQV1&gt; &lt;XFERTRNRQ&gt; &lt;TRNUID&gt;000145_DCXJXL1904260004_1&lt;/TRNUID&gt; &lt;XFERRQ&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;BANKDESC&gt;兴业银行股份有限公司上海淮海支行&lt;/BANKDESC&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;/XFERRQ&gt; &lt;/XFERTRNRQ&gt; &lt;/SECURITIES_MSGSRQV1&gt; 这段报文哪里错了呢？细看一下，收款银行ACCTTO.BANKDESC，这里居然错误的填写了乌鲁木齐市，事实上，这会导致人行无法找到对应的收款银行，从而也就导致了冲账。 下面我们再看下3.4.2 查询转账交易状态所查询到的支付结果 &lt;SECURITIES_MSGSRSV1&gt; &lt;XFERINQTRNRS&gt; &lt;TRNUID&gt;190429103101328_3.4.2_1652&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;XFERINQRS&gt; &lt;XFERLIST MORE=&quot;N&quot;&gt; &lt;FROM&gt;900861323722&lt;/FROM&gt; &lt;TO&gt;900861323722&lt;/TO&gt; &lt;XFER&gt; &lt;SRVRTID&gt;900861323722&lt;/SRVRTID&gt; &lt;XFERINFO&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXXX信息技术股份有限公司&lt;/NAME&gt; &lt;CITY&gt;上海&lt;/CITY&gt; &lt;/ACCTFROM&gt; &lt;ACCTTO INTERBANK=&quot;N&quot; LOCAL=&quot;Y&quot;&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;NAME&gt;XXX&lt;/NAME&gt; &lt;BANKDESC&gt;乌鲁木齐市&lt;/BANKDESC&gt; &lt;CITY&gt;上海黄浦区&lt;/CITY&gt; &lt;/ACCTTO&gt; &lt;CHEQUENUM&gt;8758456&lt;/CHEQUENUM&gt; &lt;CURSYM&gt;RMB&lt;/CURSYM&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;/XFERINFO&gt; &lt;XFERPRCSTS&gt; &lt;XFERPRCCODE&gt;PAYOUT&lt;/XFERPRCCODE&gt; &lt;DTXFERPRC&gt;2019-04-26 16:42:10&lt;/DTXFERPRC&gt; &lt;MESSAGE&gt;交易成功&lt;/MESSAGE&gt; &lt;/XFERPRCSTS&gt; &lt;/XFER&gt; &lt;/XFERLIST&gt; &lt;/XFERINQRS&gt; &lt;/XFERINQTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 这个接口不管怎么查询，返回的最终结果都是PAYOUT，下面我们再看下3.6账户余额和交易流水分页查询中查询到的交易信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190426224007047_3.6_1_9469&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;XXXXX&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-26&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-26&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;227&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;银行扣款&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614580000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;收费&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;收费&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;企业网银转账手续费;&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;9999A5OA&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;231&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-26T16:42:10&lt;/DTACCT&gt; &lt;TRNAMT&gt;16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042600305614588000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904260010541383430000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;汇款&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;网上汇款&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;FKB_DCXJXL1904260004_000145&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;204&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;0&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49958.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-26&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 下面就是同样通过3.6账户余额和交易流水分页查询中查询到的冲账信息 &lt;SECURITIES_MSGSRSV1&gt; &lt;SCUSTSTMTTRNRS&gt; &lt;TRNUID&gt;190428154005926_3.6_1_9957&lt;/TRNUID&gt; &lt;STATUS&gt; &lt;CODE&gt;0&lt;/CODE&gt; &lt;SEVERITY&gt;INFO&lt;/SEVERITY&gt; &lt;/STATUS&gt; &lt;SCUSTSTMTRS&gt; &lt;CURDEF&gt;RMB&lt;/CURDEF&gt; &lt;ACCTFROM&gt; &lt;ACCTID&gt;216170100100279407&lt;/ACCTID&gt; &lt;/ACCTFROM&gt; &lt;TRANLIST MORE=&quot;N&quot;&gt; &lt;DTSTART&gt;2019-04-28&lt;/DTSTART&gt; &lt;DTEND&gt;2019-04-28&lt;/DTEND&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-16.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49974.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;XXXXX&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;XXX&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;118758456&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;乌鲁木齐市&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000001&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;4&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;STMTTRN&gt; &lt;SRVRTID&gt;07020004&lt;/SRVRTID&gt; &lt;TRNTYPE&gt;DEBIT&lt;/TRNTYPE&gt; &lt;TRNCODE&gt;144&lt;/TRNCODE&gt; &lt;DTACCT&gt;2019-04-28T10:39:56&lt;/DTACCT&gt; &lt;TRNAMT&gt;-1.00&lt;/TRNAMT&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;CURRENCY&gt;RMB&lt;/CURRENCY&gt; &lt;MEMO&gt;&lt;/MEMO&gt; &lt;CORRELATE_ACCTID&gt;&lt;/CORRELATE_ACCTID&gt; &lt;CORRELATE_NAME&gt;&lt;/CORRELATE_NAME&gt; &lt;CHEQUENUM&gt;&lt;/CHEQUENUM&gt; &lt;BILLTYPE&gt;&lt;/BILLTYPE&gt; &lt;BILLNUMBER&gt;&lt;/BILLNUMBER&gt; &lt;CORRELATE_BANKNAME&gt;&lt;/CORRELATE_BANKNAME&gt; &lt;CORRELATE_BANKCODE&gt;&lt;/CORRELATE_BANKCODE&gt; &lt;BUSINESSTYPE&gt;&lt;/BUSINESSTYPE&gt; &lt;ATTACHINFO&gt;2019042800323201412000002&lt;/ATTACHINFO&gt; &lt;HXJYLSBH&gt;H00100201904280011321490470000&lt;/HXJYLSBH&gt; &lt;SUMMNAME&gt;冲账&lt;/SUMMNAME&gt; &lt;SUMMDESC&gt;隔日冲账&lt;/SUMMDESC&gt; &lt;PURPOSE&gt;无收款行&lt;/PURPOSE&gt; &lt;BRANCHNO&gt;21168&lt;/BRANCHNO&gt; &lt;CHANNELCODE&gt;101&lt;/CHANNELCODE&gt; &lt;CASHFLAG&gt;1&lt;/CASHFLAG&gt; &lt;CBBZ&gt;3&lt;/CBBZ&gt; &lt;BCZBZ&gt;0&lt;/BCZBZ&gt; &lt;ROUTECHOICE&gt;&lt;/ROUTECHOICE&gt; &lt;BIZREF&gt;&lt;/BIZREF&gt; &lt;TEXT1&gt;&lt;/TEXT1&gt; &lt;TEXT2&gt;&lt;/TEXT2&gt; &lt;TEXT3&gt;&lt;/TEXT3&gt; &lt;/STMTTRN&gt; &lt;/TRANLIST&gt; &lt;LEDGERBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/LEDGERBAL&gt; &lt;AVAILBAL&gt; &lt;BALAMT&gt;49975.00&lt;/BALAMT&gt; &lt;DTASOF&gt;2019-04-28&lt;/DTASOF&gt; &lt;/AVAILBAL&gt; &lt;/SCUSTSTMTRS&gt; &lt;/SCUSTSTMTTRNRS&gt; &lt;/SECURITIES_MSGSRSV1&gt; 可以看到交易发生日期是2019-04-26，实际冲账日期是2019-04-28，虽然银行方面没能指出冲账和交易报文可以通过哪些字段进行对应，但对比两份报文，可以发现虽然交易的HXJYLSBH与冲账的HXJYLSBH不同，但两者的CHEQUENUM、CORRELATE_ACCTID、CORRELATE_NAME这三者却是完全一致的，TRNAMT则是完全相反，另外冲账退回的手续费，其HXJYLSBH与冲账记录的HXJYLSBH也是完全一致的，所以到此我们也就知道了冲账应该如何关联到原始交易记录 通过CHEQUENUM进行关联，如果觉得不够保险，可以增加CORRELATE_ACCTID、CORRELATE_NAME、TRNAMT三者共同判断 冲账退回的手续费与正常交易的手续费一样，还是通过HXJYLSBH进行关联 接下来我们就是需要在CIBTransactionHelper中增加冲账相关的查询代码，代码涉及的SDK在此处下载，完整的代码如下，如果需要了解各个接口说明，则可以查看此篇内容 /// &lt;summary&gt; /// 兴业银行交易辅助类 /// &lt;/summary&gt; public class CIBTransactionHelper { private long _cid; private string _userId; private string _pwd; private ICIBTransactionPurposeBuilder _buider; /// &lt;summary&gt; /// 转账对应的SUMMNAME /// &lt;/summary&gt; public static string TransactionSummaryName = &quot;汇款&quot;; /// &lt;summary&gt; /// 退票对应的SUMMNAME /// &lt;/summary&gt; public static string RefundSummaryName = &quot;汇出退回&quot;; /// &lt;summary&gt; /// 手续费对应的SUMMNAME /// &lt;/summary&gt; public static string ChargesSummaryName = &quot;收费&quot;; /// &lt;summary&gt; /// 冲账对应的SUMMNAME /// &lt;/summary&gt; public static string RubricSummaryName = &quot;冲账&quot;; /// &lt;summary&gt; /// 构造函数 /// &lt;/summary&gt; /// &lt;param name=&quot;cid&quot;&gt;兴业银行银企直联客户号&lt;/param&gt; /// &lt;param name=&quot;userId&quot;&gt;兴业银行银企直联登录用户名&lt;/param&gt; /// &lt;param name=&quot;pwd&quot;&gt;兴业银行银企直联登录密码&lt;/param&gt; /// &lt;param name=&quot;host&quot;&gt;前置机域名，默认为127.0.0.1&lt;/param&gt; /// &lt;param name=&quot;port&quot;&gt;前置机端口，默认为8007&lt;/param&gt; /// &lt;param name=&quot;builder&quot;&gt;转账交易用途构建实现，如果不传则使用默认实现&lt;see cref=&quot;CIBTransactionPurposeBuilder&quot;/&gt;&lt;/param&gt; public CIBTransactionHelper(long cid, string userId, string pwd, string host = &quot;127.0.0.1&quot;, int port = 8007, ICIBTransactionPurposeBuilder builder = null) { if (cid &lt;= 0 || string.IsNullOrWhiteSpace(userId) || string.IsNullOrWhiteSpace(pwd) || string.IsNullOrWhiteSpace(host)) { throw new ArgumentException(); } this._cid = cid; this._userId = userId; this._pwd = pwd; this._buider = builder; if (builder == null) { this._buider = new CIBTransactionPurposeBuilder(); } this.Client = new CIBClient(host, port); } /// &lt;summary&gt; /// 兴业银行银企直联客户端 /// &lt;/summary&gt; public ICIBClient Client { get; set; } /// &lt;summary&gt; /// 生成一个用于查询的TRNUID，注意转账之类的业务切记不要采用此方法获取TRNUID /// &lt;/summary&gt; /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static string GetQueryTRNUID(string key) { var tmp = (Math.Abs(Guid.NewGuid().GetHashCode()) % 10000).ToString(&quot;0000&quot;); return string.Format(&quot;{0:yyMMddHHmmssfff}_{1}_{2}&quot;, DateTime.Now, key, tmp); } /// &lt;summary&gt; /// 获取兴业银行3.6查询接口请求主体 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;page&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;selType&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt; GetCIBRequest_3_6(string acctid, DateTime dtStart, DateTime dtEnd, int page, int selType) { return new FOXRQ&lt;V1_SCUSTSTMTTRNRQ, V1_SCUSTSTMTTRNRS&gt;() { SIGNONMSGSRQV1 = new SIGNONMSGSRQV1 { SONRQ = new SONRQ { CID = this._cid, USERID = this._userId, USERPASS = this._pwd, } }, SECURITIES_MSGSRQV1 = new V1_SCUSTSTMTTRNRQ { SCUSTSTMTTRNRQ = new SCUSTSTMTTRNRQ { TRNUID = GetQueryTRNUID(&quot;3.6&quot; + &quot;_&quot; + selType), SCUSTSTMTRQ = new SCUSTSTMTTRN_SCUSTSTMTRQ { VERSION = &quot;2.0&quot;, ACCTFROM = new ACCTFROM { ACCTID = acctid }, INCTRAN = new INCTRAN { DTEND = dtEnd, DTSTART = dtStart, TRNTYPE = 2, PAGE = page, }, SELTYPE = selType } } } }; } /// &lt;summary&gt; /// 获取退票记录 /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetRefundRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 3); } private List&lt;STMTTRN&gt; GetRecords(string acctid, DateTime dtStart, DateTime dtEnd, int selType) { var list = new List&lt;STMTTRN&gt;(); dtStart = dtStart.Date; dtEnd = dtEnd.Date; if (dtStart &lt;= dtEnd) { //历史与当日不能同查，所以此处要加以判断，因为每日流水可能较大，所以此处简单拆分成按每天查询 var dt = dtStart; for (; dt &lt;= dtEnd;) { for (var i = 1; ; i++) { var rq = GetCIBRequest_3_6(acctid, dt, dt, i, selType); var rs = this.Client.Execute(rq); if (rs != null &amp;&amp; rs.ResponseSuccess &amp;&amp; rs.SIGNONMSGSRSV1?.SONRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1?.SCUSTSTMTTRNRS?.STATUS?.IsCorrect == true &amp;&amp; rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS?.TRANLIST?.List != null) { list.AddRange(rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.List); if (rs.SECURITIES_MSGSRSV1.SCUSTSTMTTRNRS.SCUSTSTMTRS.TRANLIST.MORE == &quot;Y&quot;) { continue; } } break; } dt = dt.AddDays(1); } } return list; } /// &lt;summary&gt; /// 获取交易记录（含手续费、冲账等） /// &lt;/summary&gt; /// &lt;param name=&quot;acctid&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtStart&quot;&gt;&lt;/param&gt; /// &lt;param name=&quot;dtEnd&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, DateTime dtStart, DateTime dtEnd) { return this.GetRecords(acctid, dtStart, dtEnd, 1); } /// &lt;summary&gt; /// 根据退票记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;refundList&quot;&gt;退票流水&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前退票属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;refundDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认按兴业银行文档设置为2天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为退票流水&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt; GetRefundMapping(IList&lt;STMTTRN&gt; refundList, string acctid, int refundDayDiff = 2, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN&gt;&gt;(); if (refundList != null &amp;&amp; refundList.Count &gt; 0) { refundList = refundList.Where(x =&gt; x.SUMMNAME == RefundSummaryName).OrderBy(x =&gt; x.DTACCT).ToList(); if (refundList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按退票日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, refundList, refundDayDiff); } var query = from refund in refundList join trans in transList on refund.MEMO equals trans.HXJYLSBH where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, refund); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } } return dic; } private IList&lt;STMTTRN&gt; GetTransactionRecords(string acctid, IList&lt;STMTTRN&gt; list, int dayDiff) { var transList = new List&lt;STMTTRN&gt;(); var timeList = list.Select(x =&gt; x.DTACCT.Date).Distinct().OrderBy(d =&gt; d).ToList(); //虽然底层查询时是拆分成按每日查询，但因为退票或冲账需要倒查N天的交易流水，所以将日期按连续性拆分成日期范围还是有必要的 var timeRange = this.GetTimeRange(timeList, dayDiff); foreach (var t in timeRange) { var tmp = this.GetTransactionRecords(acctid, t.Item1.AddDays(-1), t.Item2); transList.AddRange(tmp); } return transList; } private IList&lt;Tuple&lt;DateTime, DateTime&gt;&gt; GetTimeRange(IList&lt;DateTime&gt; timeList, int dayDiff) { var timeRange = new List&lt;Tuple&lt;DateTime, DateTime&gt;&gt;(); var dtStart = timeList[0]; var dtEnd = timeList[0]; for (var i = 1; i &lt;= timeList.Count; i++) { DateTime dt = DateTime.MaxValue; if (i &lt; timeList.Count) { dt = timeList[i]; } if (dt &gt;= dtEnd &amp;&amp; dt &lt;= dtEnd.AddDays(dayDiff)) { //退票需要查询交易流水日期范围为交易当天或交易前一天 //所以如果出现跳日，比如03-19和03-21,也应该算是连续日期 dtEnd = dt; } else { timeRange.Add(Tuple.Create(dtStart, dtEnd)); dtStart = dt; dtEnd = dt; } } return timeRange; } /// &lt;summary&gt; /// 根据交易流水获取对应的交易记录及手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt; GetServiceChargesMapping(IList&lt;STMTTRN&gt; list) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { //此处判断PURPOSE是否是当前业务组织的PURPOSE list = list.Where(x =&gt; (x.SUMMNAME == TransactionSummaryName &amp;&amp; this._buider.IsCorrectPurpose(x.PURPOSE)) || x.SUMMNAME == ChargesSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH); // new { x.SRVRTID, x.DTACCT } #if DEBUG var tmp = groups.ToList(); #endif foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; x.SUMMNAME == TransactionSummaryName); if (trans == null) { continue; } var id = this._buider.GetIdFromPurpose(trans.PURPOSE); if (string.IsNullOrWhiteSpace(id)) { continue; } //可能会无需手续费 var charge = g.FirstOrDefault(x =&gt; x.SUMMNAME == ChargesSummaryName)?.TRNAMT ?? 0; dic.Add(id, Tuple.Create(trans, charge)); } } } return dic; } /// &lt;summary&gt; /// 根据交易流水获取其内包含的冲账记录及冲账退回的手续费 /// &lt;/summary&gt; /// &lt;param name=&quot;list&quot;&gt;交易流水&lt;/param&gt; /// &lt;returns&gt;Tuple.Item1为冲账交易流水，需按其值&lt;see cref=&quot;STMTTRN.CHEQUENUM&quot;/&gt;凭证代号与历史交易记录CHEQUENUM的进行比较，Tuple.Item2为冲账时退回的手续费&lt;/returns&gt; public IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; GetRubricRecords(IList&lt;STMTTRN&gt; list) { var retList = new List&lt;Tuple&lt;STMTTRN, decimal&gt;&gt;(); if (list != null &amp;&amp; list.Count &gt; 0) { list = list.Where(x =&gt; x.SUMMNAME == RubricSummaryName).ToList(); if (list.Count &gt; 0) { var groups = list.GroupBy(x =&gt; x.HXJYLSBH);//冲账逻辑与退票本质无差别 foreach (var g in groups) { var trans = g.FirstOrDefault(x =&gt; !string.IsNullOrWhiteSpace(x.CHEQUENUM));//凭证代号不为空代表冲账交易记录，为空代表冲账手续费 if (trans == null) { continue; } var charge = g.FirstOrDefault(x =&gt; string.IsNullOrWhiteSpace(x.CHEQUENUM))?.TRNAMT ?? 0;//冲账退回的手续费 retList.Add(Tuple.Create(trans, charge)); } } } return retList; } /// &lt;summary&gt; /// 根据冲账记录获取其对应的交易记录 /// &lt;/summary&gt; /// &lt;param name=&quot;rubricList&quot;&gt;冲账流水及冲账手续费&lt;/param&gt; /// &lt;param name=&quot;acctid&quot;&gt;当前冲账属于哪个账号&lt;/param&gt; /// &lt;param name=&quot;rubricDayDiff&quot;&gt;若需自动查询交易流水时，查询几天内的交易流水，默认设置为3天&lt;/param&gt; /// &lt;param name=&quot;transList&quot;&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt; /// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为冲账流水，Tuple.Item3为冲账手续费&lt;/returns&gt; public IDictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt; GetRubricMapping(IList&lt;Tuple&lt;STMTTRN, decimal&gt;&gt; rubricList, string acctid, int rubricDayDiff = 3, IList&lt;STMTTRN&gt; transList = null) { var dic = new Dictionary&lt;string, Tuple&lt;STMTTRN, STMTTRN, decimal&gt;&gt;(); if (rubricList != null &amp;&amp; rubricList.Count &gt; 0) { if (transList == null || transList.Count == 0) {//如果未传递交易流水，则自动按冲账日期获取对应日期的所有交易流水 transList = this.GetTransactionRecords(acctid, rubricList.Select(x =&gt; x.Item1).ToList(), rubricDayDiff); } var query = from rubric in rubricList join trans in transList on rubric.Item1.CHEQUENUM equals trans.CHEQUENUM where trans.SUMMNAME == TransactionSummaryName select Tuple.Create(trans, rubric.Item1, rubric.Item2); dic = query.ToDictionary(k =&gt; this._buider.GetIdFromPurpose(k.Item1.PURPOSE), v =&gt; v); } return dic; } } /// &lt;summary&gt; /// 兴业银行交易流水用途构建约束接口 /// &lt;/summary&gt; public interface ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetPurpose(string id); /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; string GetIdFromPurpose(string purpose); /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; bool IsCorrectPurpose(string purpose); } /// &lt;summary&gt; /// 兴业银行交易流水用途构建默认实现 /// &lt;/summary&gt; public class CIBTransactionPurposeBuilder : ICIBTransactionPurposeBuilder { /// &lt;summary&gt; /// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetIdFromPurpose(string purpose) { return purpose; } /// &lt;summary&gt; /// 根据内部系统业务Id构建Purpose /// &lt;/summary&gt; /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual string GetPurpose(string id) { return id; } /// &lt;summary&gt; /// 当前PURPOSE是否符合标准 /// &lt;/summary&gt; /// &lt;param name=&quot;purpose&quot;&gt;&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public virtual bool IsCorrectPurpose(string purpose) { return true; } } 调用示例如下 var helper = new CIBTransactionHelper(cid, uid, pwd, ip, port, new CustCIBTransactionPurposeBuilder()); var transList = helper.GetTransactionRecords(mainAccountId, new DateTime(2019, 3, 19), new DateTime(2019, 3, 19)); var changeDic = helper.GetServiceChargesMapping(transList); var rubricList = helper.GetRubricRecords(transList); #if DEBUG if (rubricList.Count == 0) { var tmpTransList = new List&lt;STMTTRN&gt;(); //为方便测试，手工增加一条冲账记录及冲账流水 tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;110340545&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT=-15.54m, }); tmpTransList.Add(new STMTTRN { DTACCT = new DateTime(2019, 3, 19), HXJYLSBH = &quot;H00100201904280011321490470000&quot;,//假编号 CHEQUENUM = &quot;&quot;, SUMMNAME = CIBTransactionHelper.RubricSummaryName, SUMMDESC = &quot;隔日冲账&quot;, PURPOSE = &quot;无收款行&quot;, TRNAMT = -0.60m, }); rubricList = helper.GetRubricRecords(tmpTransList); } #endif //如果你已经通过GetTransactionRecords获取并持久化了手续费、HXJYLSBH及CHEQUENUM //那么下面Mappding这步就可以忽略，转为直接查本地数据库 var rubricDic = helper.GetRubricMapping(rubricList, mainAccountId, rubricDayDiff: 3, transList: transList); 说完了冲账，我们再来说下网银审核退回经办，因为该部分内容不多，就不单独开篇描述。 正常来讲，我们既然通过银企直联将支付信息发送给了银行，那么我们肯定是要进行支付的，所以一般来说，网银审批时，基本都是会审批通过，但有时候存在一些特殊情况，虽然支付信息已经同步到了银行，但财务必需要在网银中终止该笔交易，也就是财务不进行支付，这时候就会产生退回经办操作，具体就是出纳和财务复审进行退回经办，当这两者操作完后，通过3.4.2 查询转账交易状态，我们能查到的状态为SEND_BACK，这时候还需要由操作员进行最终的驳回操作，这样才能使查询状态最终返回值为CANCEL，然后问题就出在这个操作员身上，因为银企直联时，需要将U盾插在银企直联前置机所在服务器上，也就是说，往往财务并不能直接访问前置机服务器，那么这个通过操作员账号进行驳回的操作也就无法进行，虽然兴业银行有EXPIRED的处理逻辑，但如果你未设置期望支付时间，那么你需要花费一个月的时间才能等到EXPIRED这个状态，所以这在实际操作中基本是无法被用户接受的，那这时候，你可以考虑将SEND_BACK做为一个终结状态来进行业务处理。当然因为实际SEND_BACK并不是真正的最终状态，出纳等网银操作用户还是可以通过一些操作，在网银中将该笔单据回归到正常可支付状态并进行支付，这样的话，就可能存在系统中支付状态与网银中支付状态不一致，这个风险性还是需要注意的。","@type":"BlogPosting","url":"https://uzzz.org/2019/06/12/790282.html","headline":"兴业银行银企直联冲账查询及网银审核退回经办","dateModified":"2019-06-12T00:00:00+08:00","datePublished":"2019-06-12T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/06/12/790282.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>兴业银行银企直联冲账查询及网银审核退回经办</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix" data-track-view="{&quot;mod&quot;:&quot;popu_307&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/starfd/article/details/91612552,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_307&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/starfd/article/details/91612552&quot;}">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-cd6c485e8b.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p>之前写过兴业银行银企直联应当如何查询手续费及退票，但事实上兴业银行还会产生冲账问题。所谓冲账，就是指支付信息错误，导致根本无法到达实际收款银行，这时候因为根本无法到达收款银行，所以也就不会有收款银行回馈的支付失败信息（也就是退票），这时候银行就会自己产生一笔负向交易流水，以便将这笔付款进行冲正。</p> 
  <p>虽然看起来与退票类似，但两者其实完全不同：</p> 
  <ul> 
   <li>退票记录金额是正值，而冲账金额是负值；</li> 
   <li>退票并不会退还手续费，冲账将退还手续费；</li> 
   <li>退票有专门的查询参数，冲账查询方式则与手续费是一致的。</li> 
  </ul> 
  <p>下面先展示一段项目中真实的支付报文，该报文将导致冲账问题，当然关键信息已脱敏</p> 
  <pre><code class="prism language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SECURITIES_MSGSRQV1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERTRNRQ</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNUID</span><span class="token punctuation">&gt;</span></span>000145_DCXJXL1904260004_1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNUID</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERRQ</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERINFO</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">&gt;</span></span>XXXX信息技术股份有限公司<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>兴业银行股份有限公司上海淮海支行<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CITY</span><span class="token punctuation">&gt;</span></span>上海<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CITY</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTTO</span> <span class="token attr-name">INTERBANK</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>N<span class="token punctuation">"</span></span> <span class="token attr-name">LOCAL</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Y<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">&gt;</span></span>XXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>乌鲁木齐市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CITY</span><span class="token punctuation">&gt;</span></span>上海黄浦区<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CITY</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTTO</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>16.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>FKB_DCXJXL1904260004_000145<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERINFO</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERRQ</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERTRNRQ</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SECURITIES_MSGSRQV1</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
  <p>这段报文哪里错了呢？细看一下，收款银行<code>ACCTTO.BANKDESC</code>，这里居然错误的填写了<code>乌鲁木齐市</code>，事实上，这会导致人行无法找到对应的收款银行，从而也就导致了冲账。</p> 
  <p>下面我们再看下<code>3.4.2 查询转账交易状态</code>所查询到的支付结果</p> 
  <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERINQTRNRS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNUID</span><span class="token punctuation">&gt;</span></span>190429103101328_3.4.2_1652<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNUID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STATUS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CODE</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CODE</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STATUS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERINQRS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERLIST</span> <span class="token attr-name">MORE</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>N<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FROM</span><span class="token punctuation">&gt;</span></span>900861323722<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FROM</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TO</span><span class="token punctuation">&gt;</span></span>900861323722<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TO</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFER</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>900861323722<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERINFO</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">&gt;</span></span>XXXX信息技术股份有限公司<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CITY</span><span class="token punctuation">&gt;</span></span>上海<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CITY</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTTO</span> <span class="token attr-name">INTERBANK</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>N<span class="token punctuation">"</span></span> <span class="token attr-name">LOCAL</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Y<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>NAME</span><span class="token punctuation">&gt;</span></span>XXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>NAME</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>乌鲁木齐市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BANKDESC</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CITY</span><span class="token punctuation">&gt;</span></span>上海黄浦区<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CITY</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTTO</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>8758456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURSYM</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURSYM</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>16.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>FKB_DCXJXL1904260004_000145<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERINFO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERPRCSTS</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>XFERPRCCODE</span><span class="token punctuation">&gt;</span></span>PAYOUT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERPRCCODE</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTXFERPRC</span><span class="token punctuation">&gt;</span></span>2019-04-26 16:42:10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTXFERPRC</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MESSAGE</span><span class="token punctuation">&gt;</span></span>交易成功<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MESSAGE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERPRCSTS</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFER</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERLIST</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERINQRS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>XFERINQTRNRS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
  <p>这个接口不管怎么查询，返回的最终结果都是<code>PAYOUT</code>，下面我们再看下<code>3.6账户余额和交易流水分页查询</code>中查询到的交易信息</p> 
  <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCUSTSTMTTRNRS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNUID</span><span class="token punctuation">&gt;</span></span>190426224007047_3.6_1_9469<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNUID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STATUS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CODE</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CODE</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STATUS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCUSTSTMTRS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURDEF</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURDEF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRANLIST</span> <span class="token attr-name">MORE</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>N<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTSTART</span><span class="token punctuation">&gt;</span></span>2019-04-26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTSTART</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTEND</span><span class="token punctuation">&gt;</span></span>2019-04-26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTEND</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>9999A5OA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>DEBIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>227<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTACCT</span><span class="token punctuation">&gt;</span></span>2019-04-26T16:42:10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTACCT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>1.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49974.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MEMO</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MEMO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span>银行扣款<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>2019042600305614580000001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>H00100201904260010541383430000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>收费<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>收费<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>企业网银转账手续费;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>21168<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>204<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CBBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CBBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BIZREF</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BIZREF</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT1</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT2</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT3</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>9999A5OA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>DEBIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>231<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTACCT</span><span class="token punctuation">&gt;</span></span>2019-04-26T16:42:10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTACCT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>16.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49958.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MEMO</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MEMO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>XXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>118758456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>乌鲁木齐市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>2019042600305614588000001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>H00100201904260010541383430000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>汇款<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>网上汇款<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>FKB_DCXJXL1904260004_000145<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>21168<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>204<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CBBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CBBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BIZREF</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BIZREF</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT1</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT2</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT3</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRANLIST</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LEDGERBAL</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49958.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTASOF</span><span class="token punctuation">&gt;</span></span>2019-04-26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTASOF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LEDGERBAL</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AVAILBAL</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49958.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTASOF</span><span class="token punctuation">&gt;</span></span>2019-04-26<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTASOF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AVAILBAL</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCUSTSTMTRS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCUSTSTMTTRNRS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
  <p>下面就是同样通过<code>3.6账户余额和交易流水分页查询</code>中查询到的冲账信息</p> 
  <pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCUSTSTMTTRNRS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNUID</span><span class="token punctuation">&gt;</span></span>190428154005926_3.6_1_9957<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNUID</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STATUS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CODE</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CODE</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>INFO<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SEVERITY</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STATUS</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SCUSTSTMTRS</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURDEF</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURDEF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ACCTID</span><span class="token punctuation">&gt;</span></span>216170100100279407<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTID</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ACCTFROM</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRANLIST</span> <span class="token attr-name">MORE</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>N<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTSTART</span><span class="token punctuation">&gt;</span></span>2019-04-28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTSTART</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTEND</span><span class="token punctuation">&gt;</span></span>2019-04-28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTEND</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>07020004<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>DEBIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>144<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTACCT</span><span class="token punctuation">&gt;</span></span>2019-04-28T10:39:56<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTACCT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>-16.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49974.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MEMO</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MEMO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>XXXXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>XXX<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>118758456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>乌鲁木齐市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>2019042800323201412000001<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>H00100201904280011321490470000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>冲账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>隔日冲账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>无收款行<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>21168<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CBBZ</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CBBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BIZREF</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BIZREF</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT1</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT2</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT3</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>07020004<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SRVRTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>DEBIT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>144<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTACCT</span><span class="token punctuation">&gt;</span></span>2019-04-28T10:39:56<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTACCT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>-1.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRNAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49975.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>RMB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CURRENCY</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MEMO</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MEMO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_ACCTID</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_NAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHEQUENUM</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BILLNUMBER</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CORRELATE_BANKCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BUSINESSTYPE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>2019042800323201412000002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ATTACHINFO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>H00100201904280011321490470000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>HXJYLSBH</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>冲账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMNAME</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>隔日冲账<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SUMMDESC</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>无收款行<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>PURPOSE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>21168<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BRANCHNO</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>101<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CHANNELCODE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CASHFLAG</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>CBBZ</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>CBBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BCZBZ</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ROUTECHOICE</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BIZREF</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BIZREF</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT1</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT1</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT2</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TEXT3</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TEXT3</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>STMTTRN</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TRANLIST</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LEDGERBAL</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49975.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTASOF</span><span class="token punctuation">&gt;</span></span>2019-04-28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTASOF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LEDGERBAL</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AVAILBAL</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>BALAMT</span><span class="token punctuation">&gt;</span></span>49975.00<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>BALAMT</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>DTASOF</span><span class="token punctuation">&gt;</span></span>2019-04-28<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>DTASOF</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>AVAILBAL</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCUSTSTMTRS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SCUSTSTMTTRNRS</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SECURITIES_MSGSRSV1</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
  <p>可以看到交易发生日期是<code>2019-04-26</code>，实际冲账日期是<code>2019-04-28</code>，虽然银行方面没能指出冲账和交易报文可以通过哪些字段进行对应，但对比两份报文，可以发现虽然交易的<code>HXJYLSBH</code>与冲账的<code>HXJYLSBH</code>不同，但两者的<code>CHEQUENUM</code>、<code>CORRELATE_ACCTID</code>、<code>CORRELATE_NAME</code>这三者却是完全一致的，<code>TRNAMT</code>则是完全相反，另外冲账退回的手续费，其<code>HXJYLSBH</code>与冲账记录的<code>HXJYLSBH</code>也是完全一致的，所以到此我们也就知道了冲账应该如何关联到原始交易记录</p> 
  <ul> 
   <li>通过<code>CHEQUENUM</code>进行关联，如果觉得不够保险，可以增加<code>CORRELATE_ACCTID</code>、<code>CORRELATE_NAME</code>、<code>TRNAMT</code>三者共同判断</li> 
   <li>冲账退回的手续费与正常交易的手续费一样，还是通过<code>HXJYLSBH</code>进行关联</li> 
  </ul> 
  <p>接下来我们就是需要在<code>CIBTransactionHelper</code>中增加冲账相关的查询代码，代码涉及的SDK在<a href="https://github.com/fdstar/BankEnterpriseDirectAttach" rel="nofollow">此处</a>下载，完整的代码如下，如果需要了解各个接口说明，则可以查看<a href="https://blog.csdn.net/starfd/article/details/88733101" rel="nofollow">此篇内容</a></p> 
  <pre><code class="prism language-csharp">    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 兴业银行交易辅助类</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CIBTransactionHelper</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">long</span> _cid<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">string</span> _userId<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">string</span> _pwd<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">ICIBTransactionPurposeBuilder</span> _buider<span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 转账对应的SUMMNAME</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> TransactionSummaryName <span class="token operator">=</span> <span class="token string">"汇款"</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 退票对应的SUMMNAME</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> RefundSummaryName <span class="token operator">=</span> <span class="token string">"汇出退回"</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 手续费对应的SUMMNAME</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> ChargesSummaryName <span class="token operator">=</span> <span class="token string">"收费"</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 冲账对应的SUMMNAME</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> RubricSummaryName <span class="token operator">=</span> <span class="token string">"冲账"</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 构造函数</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="cid"&gt;兴业银行银企直联客户号&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="userId"&gt;兴业银行银企直联登录用户名&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="pwd"&gt;兴业银行银企直联登录密码&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="host"&gt;前置机域名，默认为127.0.0.1&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="port"&gt;前置机端口，默认为8007&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="builder"&gt;转账交易用途构建实现，如果不传则使用默认实现&lt;see cref="CIBTransactionPurposeBuilder"/&gt;&lt;/param&gt;</span>
        <span class="token keyword">public</span> <span class="token function">CIBTransactionHelper</span><span class="token punctuation">(</span><span class="token keyword">long</span> cid<span class="token punctuation">,</span> <span class="token keyword">string</span> userId<span class="token punctuation">,</span> <span class="token keyword">string</span> pwd<span class="token punctuation">,</span>
            <span class="token keyword">string</span> host <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">8007</span><span class="token punctuation">,</span> <span class="token class-name">ICIBTransactionPurposeBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cid <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>pwd<span class="token punctuation">)</span>
                <span class="token operator">||</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_cid <span class="token operator">=</span> cid<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_userId <span class="token operator">=</span> userId<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_pwd <span class="token operator">=</span> pwd<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>_buider <span class="token operator">=</span> builder<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>builder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>_buider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CIBTransactionPurposeBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>Client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CIBClient</span><span class="token punctuation">(</span>host<span class="token punctuation">,</span> port<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 兴业银行银企直联客户端</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token keyword">public</span> <span class="token class-name">ICIBClient</span> Client <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 生成一个用于查询的TRNUID，注意转账之类的业务切记不要采用此方法获取TRNUID</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="key"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">string</span> <span class="token function">GetQueryTRNUID</span><span class="token punctuation">(</span><span class="token keyword">string</span> key<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span>Guid<span class="token punctuation">.</span><span class="token function">NewGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetHashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">"0000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0:yyMMddHHmmssfff}_{1}_{2}"</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span> key<span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取兴业银行3.6查询接口请求主体</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="acctid"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtStart"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtEnd"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="page"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="selType"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> FOXRQ<span class="token operator">&lt;</span>V1_SCUSTSTMTTRNRQ<span class="token punctuation">,</span> V1_SCUSTSTMTTRNRS<span class="token operator">&gt;</span> <span class="token function">GetCIBRequest_3_6</span><span class="token punctuation">(</span><span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtStart<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtEnd<span class="token punctuation">,</span> <span class="token keyword">int</span> page<span class="token punctuation">,</span> <span class="token keyword">int</span> selType<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">FOXRQ</span><span class="token punctuation">&lt;</span><span class="token class-name">V1_SCUSTSTMTTRNRQ</span><span class="token punctuation">,</span> <span class="token class-name">V1_SCUSTSTMTTRNRS</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                SIGNONMSGSRQV1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SIGNONMSGSRQV1</span>
                <span class="token punctuation">{</span>
                    SONRQ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SONRQ</span>
                    <span class="token punctuation">{</span>
                        CID <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_cid<span class="token punctuation">,</span>
                        USERID <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_userId<span class="token punctuation">,</span>
                        USERPASS <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pwd<span class="token punctuation">,</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                SECURITIES_MSGSRQV1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">V1_SCUSTSTMTTRNRQ</span>
                <span class="token punctuation">{</span>
                    SCUSTSTMTTRNRQ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SCUSTSTMTTRNRQ</span>
                    <span class="token punctuation">{</span>
                        TRNUID <span class="token operator">=</span> <span class="token function">GetQueryTRNUID</span><span class="token punctuation">(</span><span class="token string">"3.6"</span> <span class="token operator">+</span> <span class="token string">"_"</span> <span class="token operator">+</span> selType<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        SCUSTSTMTRQ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SCUSTSTMTTRN_SCUSTSTMTRQ</span>
                        <span class="token punctuation">{</span>
                            VERSION <span class="token operator">=</span> <span class="token string">"2.0"</span><span class="token punctuation">,</span>
                            ACCTFROM <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ACCTFROM</span>
                            <span class="token punctuation">{</span>
                                ACCTID <span class="token operator">=</span> acctid
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            INCTRAN <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">INCTRAN</span>
                            <span class="token punctuation">{</span>
                                DTEND <span class="token operator">=</span> dtEnd<span class="token punctuation">,</span>
                                DTSTART <span class="token operator">=</span> dtStart<span class="token punctuation">,</span>
                                TRNTYPE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
                                PAGE <span class="token operator">=</span> page<span class="token punctuation">,</span>
                            <span class="token punctuation">}</span><span class="token punctuation">,</span>
                            SELTYPE <span class="token operator">=</span> selType
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取退票记录</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="acctid"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtStart"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtEnd"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> <span class="token function">GetRefundRecords</span><span class="token punctuation">(</span><span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtStart<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtEnd<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetRecords</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> dtStart<span class="token punctuation">,</span> dtEnd<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> List<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> <span class="token function">GetRecords</span><span class="token punctuation">(</span><span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtStart<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtEnd<span class="token punctuation">,</span> <span class="token keyword">int</span> selType<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token class-name">STMTTRN</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dtStart <span class="token operator">=</span> dtStart<span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
            dtEnd <span class="token operator">=</span> dtEnd<span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dtStart <span class="token operator">&lt;=</span> dtEnd<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//历史与当日不能同查，所以此处要加以判断，因为每日流水可能较大，所以此处简单拆分成按每天查询</span>
                <span class="token keyword">var</span> dt <span class="token operator">=</span> dtStart<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> dt <span class="token operator">&lt;=</span> dtEnd<span class="token punctuation">;</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">var</span> rq <span class="token operator">=</span> <span class="token function">GetCIBRequest_3_6</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> dt<span class="token punctuation">,</span> dt<span class="token punctuation">,</span> i<span class="token punctuation">,</span> selType<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> rs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>Client<span class="token punctuation">.</span><span class="token function">Execute</span><span class="token punctuation">(</span>rq<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>rs <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>ResponseSuccess <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>SIGNONMSGSRSV1<span class="token operator">?</span><span class="token punctuation">.</span>SONRS<span class="token operator">?</span><span class="token punctuation">.</span>STATUS<span class="token operator">?</span><span class="token punctuation">.</span>IsCorrect <span class="token operator">==</span> <span class="token keyword">true</span>
                            <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>SECURITIES_MSGSRSV1<span class="token operator">?</span><span class="token punctuation">.</span>SCUSTSTMTTRNRS<span class="token operator">?</span><span class="token punctuation">.</span>STATUS<span class="token operator">?</span><span class="token punctuation">.</span>IsCorrect <span class="token operator">==</span> <span class="token keyword">true</span>
                            <span class="token operator">&amp;&amp;</span> rs<span class="token punctuation">.</span>SECURITIES_MSGSRSV1<span class="token punctuation">.</span>SCUSTSTMTTRNRS<span class="token punctuation">.</span>SCUSTSTMTRS<span class="token operator">?</span><span class="token punctuation">.</span>TRANLIST<span class="token operator">?</span><span class="token punctuation">.</span>List <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            list<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>SECURITIES_MSGSRSV1<span class="token punctuation">.</span>SCUSTSTMTTRNRS<span class="token punctuation">.</span>SCUSTSTMTRS<span class="token punctuation">.</span>TRANLIST<span class="token punctuation">.</span>List<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span>SECURITIES_MSGSRSV1<span class="token punctuation">.</span>SCUSTSTMTTRNRS<span class="token punctuation">.</span>SCUSTSTMTRS<span class="token punctuation">.</span>TRANLIST<span class="token punctuation">.</span>MORE <span class="token operator">==</span> <span class="token string">"Y"</span><span class="token punctuation">)</span>
                            <span class="token punctuation">{</span>
                                <span class="token keyword">continue</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    dt <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> list<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 获取交易记录（含手续费、冲账等）</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="acctid"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtStart"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="dtEnd"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> <span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span><span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtStart<span class="token punctuation">,</span> <span class="token class-name">DateTime</span> dtEnd<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetRecords</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> dtStart<span class="token punctuation">,</span> dtEnd<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据退票记录获取其对应的交易记录</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="refundList"&gt;退票流水&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="acctid"&gt;当前退票属于哪个账号&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="refundDayDiff"&gt;若需自动查询交易流水时，查询几天内的交易流水，默认按兴业银行文档设置为2天&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="transList"&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为退票流水&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IDictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> STMTTRN<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">GetRefundMapping</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> refundList<span class="token punctuation">,</span> <span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token keyword">int</span> refundDayDiff <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> transList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> STMTTRN<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>refundList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> refundList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                refundList <span class="token operator">=</span> refundList<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> RefundSummaryName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>DTACCT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>refundList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>transList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> transList<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span><span class="token comment">//如果未传递交易流水，则自动按退票日期获取对应日期的所有交易流水</span>
                        transList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> refundList<span class="token punctuation">,</span> refundDayDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token keyword">from</span> refund <span class="token keyword">in</span> refundList
                                <span class="token keyword">join</span> trans <span class="token keyword">in</span> transList
                                on refund<span class="token punctuation">.</span><span class="token class-name">MEMO</span> equals trans<span class="token punctuation">.</span><span class="token class-name">HXJYLSBH</span>
                                <span class="token keyword">where</span> trans<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> <span class="token class-name">TransactionSummaryName</span>
                                <span class="token keyword">select</span> Tuple<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> refund<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dic <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>k <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_buider<span class="token punctuation">.</span><span class="token function">GetIdFromPurpose</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span>Item1<span class="token punctuation">.</span>PURPOSE<span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> dic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> <span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span><span class="token keyword">string</span> acctid<span class="token punctuation">,</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> list<span class="token punctuation">,</span> <span class="token keyword">int</span> dayDiff<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> transList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token class-name">STMTTRN</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> timeList <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>DTACCT<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>d <span class="token operator">=</span><span class="token operator">&gt;</span> d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//虽然底层查询时是拆分成按每日查询，但因为退票或冲账需要倒查N天的交易流水，所以将日期按连续性拆分成日期范围还是有必要的</span>
            <span class="token keyword">var</span> timeRange <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetTimeRange</span><span class="token punctuation">(</span>timeList<span class="token punctuation">,</span> dayDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token keyword">in</span> timeRange<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> t<span class="token punctuation">.</span>Item1<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">.</span>Item2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                transList<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> transList<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> IList<span class="token operator">&lt;</span>Tuple<span class="token operator">&lt;</span>DateTime<span class="token punctuation">,</span> DateTime<span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">GetTimeRange</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>DateTime<span class="token operator">&gt;</span> timeList<span class="token punctuation">,</span> <span class="token keyword">int</span> dayDiff<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> timeRange <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token operator">&lt;</span>Tuple<span class="token operator">&lt;</span>DateTime<span class="token punctuation">,</span> DateTime<span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> dtStart <span class="token operator">=</span> timeList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> dtEnd <span class="token operator">=</span> timeList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> timeList<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">DateTime</span> dt <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>MaxValue<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> timeList<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    dt <span class="token operator">=</span> timeList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>dt <span class="token operator">&gt;=</span> dtEnd <span class="token operator">&amp;&amp;</span> dt <span class="token operator">&lt;=</span> dtEnd<span class="token punctuation">.</span><span class="token function">AddDays</span><span class="token punctuation">(</span>dayDiff<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token comment">//退票需要查询交易流水日期范围为交易当天或交易前一天</span>
                    <span class="token comment">//所以如果出现跳日，比如03-19和03-21,也应该算是连续日期</span>
                    dtEnd <span class="token operator">=</span> dt<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{</span>
                    timeRange<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>dtStart<span class="token punctuation">,</span> dtEnd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dtStart <span class="token operator">=</span> dt<span class="token punctuation">;</span>
                    dtEnd <span class="token operator">=</span> dt<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> timeRange<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据交易流水获取对应的交易记录及手续费</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="list"&gt;交易流水&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为手续费&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IDictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">GetServiceChargesMapping</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> list<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//此处判断PURPOSE是否是当前业务组织的PURPOSE</span>
                list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> TransactionSummaryName <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_buider<span class="token punctuation">.</span><span class="token function">IsCorrectPurpose</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>PURPOSE<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token operator">||</span> x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> ChargesSummaryName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> groups <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>HXJYLSBH<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// new { x.SRVRTID, x.DTACCT }</span>
<span class="token preprocessor property">#<span class="token directive keyword">if</span> DEBUG</span>
                    <span class="token keyword">var</span> tmp <span class="token operator">=</span> groups<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> g <span class="token keyword">in</span> groups<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">var</span> trans <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> TransactionSummaryName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>trans <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_buider<span class="token punctuation">.</span><span class="token function">GetIdFromPurpose</span><span class="token punctuation">(</span>trans<span class="token punctuation">.</span>PURPOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">//可能会无需手续费</span>
                        <span class="token keyword">var</span> charge <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> ChargesSummaryName<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>TRNAMT <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0</span><span class="token punctuation">;</span>
                        dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> Tuple<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> charge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> dic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据交易流水获取其内包含的冲账记录及冲账退回的手续费</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="list"&gt;交易流水&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;Tuple.Item1为冲账交易流水，需按其值&lt;see cref="STMTTRN.CHEQUENUM"/&gt;凭证代号与历史交易记录CHEQUENUM的进行比较，Tuple.Item2为冲账时退回的手续费&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IList<span class="token operator">&lt;</span>Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">GetRubricRecords</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> list<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> retList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">List</span><span class="token operator">&lt;</span>Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>list <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> list<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                list <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">Where</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> RubricSummaryName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>list<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> groups <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">GroupBy</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>HXJYLSBH<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//冲账逻辑与退票本质无差别</span>
                    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> g <span class="token keyword">in</span> groups<span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                        <span class="token keyword">var</span> trans <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token operator">!</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>CHEQUENUM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//凭证代号不为空代表冲账交易记录，为空代表冲账手续费</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>trans <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">var</span> charge <span class="token operator">=</span> g<span class="token punctuation">.</span><span class="token function">FirstOrDefault</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrWhiteSpace</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>CHEQUENUM<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span>TRNAMT <span class="token operator">?</span><span class="token operator">?</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//冲账退回的手续费</span>
                        retList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Tuple<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> charge<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> retList<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据冲账记录获取其对应的交易记录</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="rubricList"&gt;冲账流水及冲账手续费&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="acctid"&gt;当前冲账属于哪个账号&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="rubricDayDiff"&gt;若需自动查询交易流水时，查询几天内的交易流水，默认设置为3天&lt;/param&gt;</span>
        <span class="token comment">/// &lt;param name="transList"&gt;交易流水，默认为null，代表按退票流水自动查询，如果不为null则与退票流水进行对比&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;Key为交易流水id，Tuple.Item1为交易流水，Tuple.Item2为冲账流水，Tuple.Item3为冲账手续费&lt;/returns&gt;</span>
        <span class="token keyword">public</span> IDictionary<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span> <span class="token function">GetRubricMapping</span><span class="token punctuation">(</span>IList<span class="token operator">&lt;</span>Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span> rubricList<span class="token punctuation">,</span> <span class="token keyword">string</span> acctid<span class="token punctuation">,</span> <span class="token keyword">int</span> rubricDayDiff <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">,</span> IList<span class="token operator">&lt;</span>STMTTRN<span class="token operator">&gt;</span> transList <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> Tuple<span class="token operator">&lt;</span>STMTTRN<span class="token punctuation">,</span> STMTTRN<span class="token punctuation">,</span> <span class="token keyword">decimal</span><span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rubricList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> rubricList<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>transList <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> transList<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{</span><span class="token comment">//如果未传递交易流水，则自动按冲账日期获取对应日期的所有交易流水</span>
                    transList <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span>acctid<span class="token punctuation">,</span> rubricList<span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>Item1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> rubricDayDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token keyword">from</span> rubric <span class="token keyword">in</span> rubricList
                            <span class="token keyword">join</span> trans <span class="token keyword">in</span> transList
                            on rubric<span class="token punctuation">.</span><span class="token class-name">Item1<span class="token punctuation">.</span>CHEQUENUM</span> equals trans<span class="token punctuation">.</span><span class="token class-name">CHEQUENUM</span>
                            <span class="token keyword">where</span> trans<span class="token punctuation">.</span>SUMMNAME <span class="token operator">==</span> <span class="token class-name">TransactionSummaryName</span>
                            <span class="token keyword">select</span> Tuple<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>trans<span class="token punctuation">,</span> rubric<span class="token punctuation">.</span>Item1<span class="token punctuation">,</span> rubric<span class="token punctuation">.</span>Item2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                dic <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">ToDictionary</span><span class="token punctuation">(</span>k <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_buider<span class="token punctuation">.</span><span class="token function">GetIdFromPurpose</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span>Item1<span class="token punctuation">.</span>PURPOSE<span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">=</span><span class="token operator">&gt;</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> dic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 兴业银行交易流水用途构建约束接口</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ICIBTransactionPurposeBuilder</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据内部系统业务Id构建Purpose</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="id"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">string</span> <span class="token function">GetPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="purpose"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">string</span> <span class="token function">GetIdFromPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> purpose<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 当前PURPOSE是否符合标准</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="purpose"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">bool</span> <span class="token function">IsCorrectPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> purpose<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// 兴业银行交易流水用途构建默认实现</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CIBTransactionPurposeBuilder</span> <span class="token punctuation">:</span> <span class="token class-name">ICIBTransactionPurposeBuilder</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 从交易流水Purpose中获取内部系统业务Id，注意此处Purpose应当为网上汇款交易流水中的PURPOSE</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="purpose"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">string</span> <span class="token function">GetIdFromPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> purpose<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> purpose<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 根据内部系统业务Id构建Purpose</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="id"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">string</span> <span class="token function">GetPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> id<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> id<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/// &lt;summary&gt;</span>
        <span class="token comment">/// 当前PURPOSE是否符合标准</span>
        <span class="token comment">/// &lt;/summary&gt;</span>
        <span class="token comment">/// &lt;param name="purpose"&gt;&lt;/param&gt;</span>
        <span class="token comment">/// &lt;returns&gt;&lt;/returns&gt;</span>
        <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token keyword">bool</span> <span class="token function">IsCorrectPurpose</span><span class="token punctuation">(</span><span class="token keyword">string</span> purpose<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
  <p>调用示例如下</p> 
  <pre><code class="prism language-csharp">            <span class="token keyword">var</span> helper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CIBTransactionHelper</span><span class="token punctuation">(</span>cid<span class="token punctuation">,</span> uid<span class="token punctuation">,</span> pwd<span class="token punctuation">,</span> ip<span class="token punctuation">,</span> port<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CustCIBTransactionPurposeBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> transList <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetTransactionRecords</span><span class="token punctuation">(</span>mainAccountId<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> changeDic <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetServiceChargesMapping</span><span class="token punctuation">(</span>transList<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">var</span> rubricList <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetRubricRecords</span><span class="token punctuation">(</span>transList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token preprocessor property">#<span class="token directive keyword">if</span> DEBUG</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rubricList<span class="token punctuation">.</span>Count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">var</span> tmpTransList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token class-name">STMTTRN</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//为方便测试，手工增加一条冲账记录及冲账流水</span>
                tmpTransList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">STMTTRN</span>
                <span class="token punctuation">{</span>
                    DTACCT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    HXJYLSBH <span class="token operator">=</span> <span class="token string">"H00100201904280011321490470000"</span><span class="token punctuation">,</span><span class="token comment">//假编号</span>
                    CHEQUENUM <span class="token operator">=</span> <span class="token string">"110340545"</span><span class="token punctuation">,</span>
                    SUMMNAME <span class="token operator">=</span> CIBTransactionHelper<span class="token punctuation">.</span>RubricSummaryName<span class="token punctuation">,</span>
                    SUMMDESC <span class="token operator">=</span> <span class="token string">"隔日冲账"</span><span class="token punctuation">,</span>
                    PURPOSE <span class="token operator">=</span> <span class="token string">"无收款行"</span><span class="token punctuation">,</span>
                    TRNAMT<span class="token operator">=</span><span class="token operator">-</span><span class="token number">15.54</span>m<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                tmpTransList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">STMTTRN</span>
                <span class="token punctuation">{</span>
                    DTACCT <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DateTime</span><span class="token punctuation">(</span><span class="token number">2019</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    HXJYLSBH <span class="token operator">=</span> <span class="token string">"H00100201904280011321490470000"</span><span class="token punctuation">,</span><span class="token comment">//假编号</span>
                    CHEQUENUM <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>
                    SUMMNAME <span class="token operator">=</span> CIBTransactionHelper<span class="token punctuation">.</span>RubricSummaryName<span class="token punctuation">,</span>
                    SUMMDESC <span class="token operator">=</span> <span class="token string">"隔日冲账"</span><span class="token punctuation">,</span>
                    PURPOSE <span class="token operator">=</span> <span class="token string">"无收款行"</span><span class="token punctuation">,</span>
                    TRNAMT <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.60</span>m<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                rubricList <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetRubricRecords</span><span class="token punctuation">(</span>tmpTransList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
<span class="token preprocessor property">#<span class="token directive keyword">endif</span></span>
            <span class="token comment">//如果你已经通过GetTransactionRecords获取并持久化了手续费、HXJYLSBH及CHEQUENUM</span>
            <span class="token comment">//那么下面Mappding这步就可以忽略，转为直接查本地数据库</span>
            <span class="token keyword">var</span> rubricDic <span class="token operator">=</span> helper<span class="token punctuation">.</span><span class="token function">GetRubricMapping</span><span class="token punctuation">(</span>rubricList<span class="token punctuation">,</span> mainAccountId<span class="token punctuation">,</span> rubricDayDiff<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> transList<span class="token punctuation">:</span> transList<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
  <p>说完了冲账，我们再来说下网银审核退回经办，因为该部分内容不多，就不单独开篇描述。<br> 正常来讲，我们既然通过银企直联将支付信息发送给了银行，那么我们肯定是要进行支付的，所以一般来说，网银审批时，基本都是会审批通过，但有时候存在一些特殊情况，虽然支付信息已经同步到了银行，但财务必需要在网银中终止该笔交易，也就是财务不进行支付，这时候就会产生<code>退回经办</code>操作，具体就是出纳和财务复审进行退回经办，当这两者操作完后，通过<code>3.4.2 查询转账交易状态</code>，我们能查到的状态为<code>SEND_BACK</code>，这时候还需要由操作员进行最终的驳回操作，这样才能使查询状态最终返回值为<code>CANCEL</code>，然后问题就出在这个操作员身上，因为银企直联时，需要将U盾插在银企直联前置机所在服务器上，也就是说，往往财务并不能直接访问前置机服务器，那么这个通过操作员账号进行驳回的操作也就无法进行，虽然兴业银行有<code>EXPIRED</code>的处理逻辑，但如果你未设置期望支付时间，那么你需要花费一个月的时间才能等到<code>EXPIRED</code>这个状态，所以这在实际操作中基本是无法被用户接受的，那这时候，你可以考虑将<code>SEND_BACK</code>做为一个终结状态来进行业务处理。当然因为实际<code>SEND_BACK</code>并不是真正的最终状态，出纳等网银操作用户还是可以通过一些操作，在网银中将该笔单据回归到正常可支付状态并进行支付，这样的话，就可能存在系统中支付状态与网银中支付状态不一致，这个风险性还是需要注意的。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
