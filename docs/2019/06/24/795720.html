<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>云计算基础设施平台iaas（openstack）超级详细搭建（十三） 安装Trove服务 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="云计算基础设施平台iaas（openstack）超级详细搭建（十三） 安装Trove服务" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="注意：接与上一篇博客内容 进行更新 由于整个开源openstack安装过程过于繁琐，命令太长，太繁琐，于是把整个安装命令写成shell脚本。 脚本数量内容过多，已经推送自我的github源码托管中心了。 这是本篇脚本内容所在的github仓库位置 controller节点 脚本内容介绍 #!/bin/bash source /etc/xiandian/openrc.sh source /etc/keystone/admin-openrc.sh default_network_id= #------------------------------------------------------------------------------------------------ printf &quot;\033[35mPlease wait...\n\033[0m&quot; if [[ `openstack endpoint list | grep -w &#39;volume&#39; ` == &#39;&#39; ]];then printf &quot;\033[35mPlease install the cinder service first! \n\033[0m&quot; exit 1 fi if [[ `openstack endpoint list | grep -w &#39;object-store&#39; ` == &#39;&#39; ]];then printf &quot;\033[35mPlease install the swift service first! \n\033[0m&quot; exit 1 fi if [[ `neutron net-list` == &#39;&#39; ]];then printf &quot;\033[35mPlease create network first!\n\033[0m&quot; exit 1 fi if [[ $default_network_id == &#39;&#39; ]]; then network_mode=`cat /etc/neutron/plugin.ini |grep ^tenant_network_types |awk -F= &#39;{print $2}&#39;` if [[ $network_mode == &#39;flat&#39; ]];then default_network_id=`neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;` elif [[ $network_mode == &#39;gre&#39; ]];then # neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39; for net_name in `neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;`; do mode=`neutron net-show $net_name |grep &quot;router:external&quot;` if [[ `echo $mode |grep -w &quot;False&quot;` != &quot;&quot; ]];then default_network_id=$net_name break fi done # elif [[ $network_mode == &#39;vlan&#39; ]] ;then 9 安装Trove服务 9.1 执行脚本进行安装 9.2-9.11编配服务的操作命令已经编写成shell脚本，通过脚本进行一键安装。如下： #Controller节点 执行脚本iaas-install-trove.sh进行安装 需注意安装Trove服务之前需要配置好网络（flat或gre）,创建好子网，并确认系统已经安装swift和cinder两个服务，否则安装会失败。 9.2 安装Trove数据库服务的软件包 # yum install openstack-trove-guestagent openstack-trove python-troveclient openstack-trove-ui –y 9.3 创建数据库 # mysql -u root -p mysql&gt; CREATE DATABASE trove; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;localhost&#39; IDENTIFIED BY &#39;000000&#39;; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;%&#39; IDENTIFIED BY &#39;000000&#39;; 9.4 创建用户 # openstack user create --domain $DOMAIN_NAME --password 000000 trove # openstack role add --project service --user trove admin # openstack service create --name trove --description &quot;Database&quot; database 9.5 创建Endpoint和API端点 # openstack endpoint create --region RegionOne database public http:// controller:8779/v1.0/%\(tenant_id\)s # openstack endpoint create --region RegionOne database internal http:// controller:8779/v1.0/%\(tenant_id\)s # openstack endpoint create --region RegionOne database admin http:// controller:8779/v1.0/%\(tenant_id\)s 9.6 配置trove.conf文件 openstack-config --set /etc/trove/trove.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove.conf DEFAULT log_file trove-api.log openstack-config --set /etc/trove/trove.conf DEFAULT trove_auth_url http://controller:35357/v2.0 openstack-config --set /etc/trove/trove.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_compute_service_type compute openstack-config --set /etc/trove/trove.conf DEFAULT cinder_service_type volumev2 openstack-config --set /etc/trove/trove.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove.conf DEFAULT default_neutron_networks (网络的ID) openstack-config --set /etc/trove/trove.conf DEFAULT auth_strategy keystone openstack-config --set /etc/trove/trove.conf DEFAULT add_addresses True openstack-config --set /etc/trove/trove.conf DEFAULT network_label_regex \.\* openstack-config --set /etc/trove/trove.conf DEFAULT api_paste_config api-paste.ini openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove.conf database connection mysql://trove:000000@controller/trove openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_uri http://controller:5000 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_url http://controller:35357 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_type password openstack-config --set /etc/trove/trove.conf keystone_authtoken project_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken user_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken project_name service openstack-config --set /etc/trove/trove.conf keystone_authtoken username trove openstack-config --set /etc/trove/trove.conf keystone_authtoken password 000000 9.7 配置trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_file trove-taskmanager.log openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_compute_url http://controller:8774/v2.1 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config crudini --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT taskmanager_manager trove.taskmanager.manager.Manager openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notification_driver messagingv2 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT default_neutron_networks （网络ID） openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_label_regex \.\* openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_config /etc/trove/trove-guestagent.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_info guest_info.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT injected_config_location /etc/trove/conf.d openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT cloudinit_location /etc/trove/cloudinit sed -i &#39;/^exists_notification/s/^/#/&#39; /etc/trove/trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-taskmanager.conf database connection mysql://trove:000000@controller/trove 9.8 配置trove-conductor.conf文件 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_file trove-conductor.log openstack-config --set /etc/trove/trove-conductor.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-conductor.conf database connection mysql://trove:000000@controller/trove 9.9 配置trove-guestagent.conf文件 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT trove_auth_url http://192.168.100.10:35357/v2.0 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_url http://192.168.100.10:8080/v1/AUTH_ openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT os_region_name RegionOne openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_service_type object-store openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT log_file trove-guestagent.log openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_password 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_port 5672 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_password 000000 9.10 同步数据库 # su -s /bin/sh -c &quot;trove-manage db_sync&quot; trove 9.11 启动服务 # service httpd restart # systemctl enable openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service # systemctl restart openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service 以上便是脚本内容 下面的操作不在脚本之中，可以熟悉下该操作 9.12 上传镜像 将提供的MySQL_5.6_xiandian.qcow2 上传到系统内 # glance image-create --name &quot;mysql-5.6&quot; --disk-format qcow2 --container-format bare --progress &lt; MySQL_5.6_XD.qcow2 9.13 创建数据库存储 # trove-manage datastore_update mysql &#39;&#39; 9.14 使用上传的镜像更新数据库 # glance_id=$(glance image-list | awk &#39;/ mysql-5.6 / { print $2 }&#39;) # trove-manage datastore_version_update mysql mysql-5.6 mysql ${glance_id} &#39;&#39; 1 9.15 启动数据库实例 使用m1.small类型启动名称为mysql-1、大小为5G、创建数据库名称为myDB，用户为user，密码为r00tme，创建过程一般需要3-4分钟。 # FLAVOR_ID=$(openstack flavor list | awk &#39;/ m1.small / { print $2 }&#39;) # trove create mysql-1 ${FLAVOR_ID} --size 5 --databases myDB --users user:r00tme --datastore_version mysql-5.6 --datastore mysql 创建完成后查询trove列表 [root@controller ~]# trove list +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | ID | Name | Datastore | Datastore Version | Status | Flavor ID | Size | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | b9c9208d-5bca-434a-b258-127ff8496c5e | mysql-1 | mysql | mysql-5.6 | ACTIVE | 2 | 5 | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ trove数据库网页访问数据库备份模块可能会出现异常，可以通过命令行完成相关操作。 下一篇博客内容将更新heat服务组件。" />
<meta property="og:description" content="注意：接与上一篇博客内容 进行更新 由于整个开源openstack安装过程过于繁琐，命令太长，太繁琐，于是把整个安装命令写成shell脚本。 脚本数量内容过多，已经推送自我的github源码托管中心了。 这是本篇脚本内容所在的github仓库位置 controller节点 脚本内容介绍 #!/bin/bash source /etc/xiandian/openrc.sh source /etc/keystone/admin-openrc.sh default_network_id= #------------------------------------------------------------------------------------------------ printf &quot;\033[35mPlease wait...\n\033[0m&quot; if [[ `openstack endpoint list | grep -w &#39;volume&#39; ` == &#39;&#39; ]];then printf &quot;\033[35mPlease install the cinder service first! \n\033[0m&quot; exit 1 fi if [[ `openstack endpoint list | grep -w &#39;object-store&#39; ` == &#39;&#39; ]];then printf &quot;\033[35mPlease install the swift service first! \n\033[0m&quot; exit 1 fi if [[ `neutron net-list` == &#39;&#39; ]];then printf &quot;\033[35mPlease create network first!\n\033[0m&quot; exit 1 fi if [[ $default_network_id == &#39;&#39; ]]; then network_mode=`cat /etc/neutron/plugin.ini |grep ^tenant_network_types |awk -F= &#39;{print $2}&#39;` if [[ $network_mode == &#39;flat&#39; ]];then default_network_id=`neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;` elif [[ $network_mode == &#39;gre&#39; ]];then # neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39; for net_name in `neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;`; do mode=`neutron net-show $net_name |grep &quot;router:external&quot;` if [[ `echo $mode |grep -w &quot;False&quot;` != &quot;&quot; ]];then default_network_id=$net_name break fi done # elif [[ $network_mode == &#39;vlan&#39; ]] ;then 9 安装Trove服务 9.1 执行脚本进行安装 9.2-9.11编配服务的操作命令已经编写成shell脚本，通过脚本进行一键安装。如下： #Controller节点 执行脚本iaas-install-trove.sh进行安装 需注意安装Trove服务之前需要配置好网络（flat或gre）,创建好子网，并确认系统已经安装swift和cinder两个服务，否则安装会失败。 9.2 安装Trove数据库服务的软件包 # yum install openstack-trove-guestagent openstack-trove python-troveclient openstack-trove-ui –y 9.3 创建数据库 # mysql -u root -p mysql&gt; CREATE DATABASE trove; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;localhost&#39; IDENTIFIED BY &#39;000000&#39;; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;%&#39; IDENTIFIED BY &#39;000000&#39;; 9.4 创建用户 # openstack user create --domain $DOMAIN_NAME --password 000000 trove # openstack role add --project service --user trove admin # openstack service create --name trove --description &quot;Database&quot; database 9.5 创建Endpoint和API端点 # openstack endpoint create --region RegionOne database public http:// controller:8779/v1.0/%\(tenant_id\)s # openstack endpoint create --region RegionOne database internal http:// controller:8779/v1.0/%\(tenant_id\)s # openstack endpoint create --region RegionOne database admin http:// controller:8779/v1.0/%\(tenant_id\)s 9.6 配置trove.conf文件 openstack-config --set /etc/trove/trove.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove.conf DEFAULT log_file trove-api.log openstack-config --set /etc/trove/trove.conf DEFAULT trove_auth_url http://controller:35357/v2.0 openstack-config --set /etc/trove/trove.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_compute_service_type compute openstack-config --set /etc/trove/trove.conf DEFAULT cinder_service_type volumev2 openstack-config --set /etc/trove/trove.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove.conf DEFAULT default_neutron_networks (网络的ID) openstack-config --set /etc/trove/trove.conf DEFAULT auth_strategy keystone openstack-config --set /etc/trove/trove.conf DEFAULT add_addresses True openstack-config --set /etc/trove/trove.conf DEFAULT network_label_regex \.\* openstack-config --set /etc/trove/trove.conf DEFAULT api_paste_config api-paste.ini openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove.conf database connection mysql://trove:000000@controller/trove openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_uri http://controller:5000 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_url http://controller:35357 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_type password openstack-config --set /etc/trove/trove.conf keystone_authtoken project_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken user_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken project_name service openstack-config --set /etc/trove/trove.conf keystone_authtoken username trove openstack-config --set /etc/trove/trove.conf keystone_authtoken password 000000 9.7 配置trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_file trove-taskmanager.log openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_compute_url http://controller:8774/v2.1 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config crudini --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT taskmanager_manager trove.taskmanager.manager.Manager openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notification_driver messagingv2 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT default_neutron_networks （网络ID） openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_label_regex \.\* openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_config /etc/trove/trove-guestagent.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_info guest_info.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT injected_config_location /etc/trove/conf.d openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT cloudinit_location /etc/trove/cloudinit sed -i &#39;/^exists_notification/s/^/#/&#39; /etc/trove/trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-taskmanager.conf database connection mysql://trove:000000@controller/trove 9.8 配置trove-conductor.conf文件 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_file trove-conductor.log openstack-config --set /etc/trove/trove-conductor.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-conductor.conf database connection mysql://trove:000000@controller/trove 9.9 配置trove-guestagent.conf文件 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT trove_auth_url http://192.168.100.10:35357/v2.0 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_url http://192.168.100.10:8080/v1/AUTH_ openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT os_region_name RegionOne openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_service_type object-store openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT log_file trove-guestagent.log openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_password 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_port 5672 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_password 000000 9.10 同步数据库 # su -s /bin/sh -c &quot;trove-manage db_sync&quot; trove 9.11 启动服务 # service httpd restart # systemctl enable openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service # systemctl restart openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service 以上便是脚本内容 下面的操作不在脚本之中，可以熟悉下该操作 9.12 上传镜像 将提供的MySQL_5.6_xiandian.qcow2 上传到系统内 # glance image-create --name &quot;mysql-5.6&quot; --disk-format qcow2 --container-format bare --progress &lt; MySQL_5.6_XD.qcow2 9.13 创建数据库存储 # trove-manage datastore_update mysql &#39;&#39; 9.14 使用上传的镜像更新数据库 # glance_id=$(glance image-list | awk &#39;/ mysql-5.6 / { print $2 }&#39;) # trove-manage datastore_version_update mysql mysql-5.6 mysql ${glance_id} &#39;&#39; 1 9.15 启动数据库实例 使用m1.small类型启动名称为mysql-1、大小为5G、创建数据库名称为myDB，用户为user，密码为r00tme，创建过程一般需要3-4分钟。 # FLAVOR_ID=$(openstack flavor list | awk &#39;/ m1.small / { print $2 }&#39;) # trove create mysql-1 ${FLAVOR_ID} --size 5 --databases myDB --users user:r00tme --datastore_version mysql-5.6 --datastore mysql 创建完成后查询trove列表 [root@controller ~]# trove list +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | ID | Name | Datastore | Datastore Version | Status | Flavor ID | Size | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | b9c9208d-5bca-434a-b258-127ff8496c5e | mysql-1 | mysql | mysql-5.6 | ACTIVE | 2 | 5 | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ trove数据库网页访问数据库备份模块可能会出现异常，可以通过命令行完成相关操作。 下一篇博客内容将更新heat服务组件。" />
<link rel="canonical" href="https://uzzz.org/2019/06/24/795720.html" />
<meta property="og:url" content="https://uzzz.org/2019/06/24/795720.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-24T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"注意：接与上一篇博客内容 进行更新 由于整个开源openstack安装过程过于繁琐，命令太长，太繁琐，于是把整个安装命令写成shell脚本。 脚本数量内容过多，已经推送自我的github源码托管中心了。 这是本篇脚本内容所在的github仓库位置 controller节点 脚本内容介绍 #!/bin/bash source /etc/xiandian/openrc.sh source /etc/keystone/admin-openrc.sh default_network_id= #------------------------------------------------------------------------------------------------ printf &quot;\\033[35mPlease wait...\\n\\033[0m&quot; if [[ `openstack endpoint list | grep -w &#39;volume&#39; ` == &#39;&#39; ]];then printf &quot;\\033[35mPlease install the cinder service first! \\n\\033[0m&quot; exit 1 fi if [[ `openstack endpoint list | grep -w &#39;object-store&#39; ` == &#39;&#39; ]];then printf &quot;\\033[35mPlease install the swift service first! \\n\\033[0m&quot; exit 1 fi if [[ `neutron net-list` == &#39;&#39; ]];then printf &quot;\\033[35mPlease create network first!\\n\\033[0m&quot; exit 1 fi if [[ $default_network_id == &#39;&#39; ]]; then network_mode=`cat /etc/neutron/plugin.ini |grep ^tenant_network_types |awk -F= &#39;{print $2}&#39;` if [[ $network_mode == &#39;flat&#39; ]];then default_network_id=`neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;` elif [[ $network_mode == &#39;gre&#39; ]];then # neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39; for net_name in `neutron net-list | sed -e &#39;1,3d&#39; -e &#39;$d&#39; |awk &#39;{print $2}&#39;`; do mode=`neutron net-show $net_name |grep &quot;router:external&quot;` if [[ `echo $mode |grep -w &quot;False&quot;` != &quot;&quot; ]];then default_network_id=$net_name break fi done # elif [[ $network_mode == &#39;vlan&#39; ]] ;then 9 安装Trove服务 9.1 执行脚本进行安装 9.2-9.11编配服务的操作命令已经编写成shell脚本，通过脚本进行一键安装。如下： #Controller节点 执行脚本iaas-install-trove.sh进行安装 需注意安装Trove服务之前需要配置好网络（flat或gre）,创建好子网，并确认系统已经安装swift和cinder两个服务，否则安装会失败。 9.2 安装Trove数据库服务的软件包 # yum install openstack-trove-guestagent openstack-trove python-troveclient openstack-trove-ui –y 9.3 创建数据库 # mysql -u root -p mysql&gt; CREATE DATABASE trove; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;localhost&#39; IDENTIFIED BY &#39;000000&#39;; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@&#39;%&#39; IDENTIFIED BY &#39;000000&#39;; 9.4 创建用户 # openstack user create --domain $DOMAIN_NAME --password 000000 trove # openstack role add --project service --user trove admin # openstack service create --name trove --description &quot;Database&quot; database 9.5 创建Endpoint和API端点 # openstack endpoint create --region RegionOne database public http:// controller:8779/v1.0/%\\(tenant_id\\)s # openstack endpoint create --region RegionOne database internal http:// controller:8779/v1.0/%\\(tenant_id\\)s # openstack endpoint create --region RegionOne database admin http:// controller:8779/v1.0/%\\(tenant_id\\)s 9.6 配置trove.conf文件 openstack-config --set /etc/trove/trove.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove.conf DEFAULT log_file trove-api.log openstack-config --set /etc/trove/trove.conf DEFAULT trove_auth_url http://controller:35357/v2.0 openstack-config --set /etc/trove/trove.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove.conf DEFAULT nova_compute_service_type compute openstack-config --set /etc/trove/trove.conf DEFAULT cinder_service_type volumev2 openstack-config --set /etc/trove/trove.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove.conf DEFAULT default_neutron_networks (网络的ID) openstack-config --set /etc/trove/trove.conf DEFAULT auth_strategy keystone openstack-config --set /etc/trove/trove.conf DEFAULT add_addresses True openstack-config --set /etc/trove/trove.conf DEFAULT network_label_regex \\.\\* openstack-config --set /etc/trove/trove.conf DEFAULT api_paste_config api-paste.ini openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove.conf database connection mysql://trove:000000@controller/trove openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_uri http://controller:5000 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_url http://controller:35357 openstack-config --set /etc/trove/trove.conf keystone_authtoken auth_type password openstack-config --set /etc/trove/trove.conf keystone_authtoken project_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken user_domain_name default openstack-config --set /etc/trove/trove.conf keystone_authtoken project_name service openstack-config --set /etc/trove/trove.conf keystone_authtoken username trove openstack-config --set /etc/trove/trove.conf keystone_authtoken password 000000 9.7 配置trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_file trove-taskmanager.log openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_compute_url http://controller:8774/v2.1 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config crudini --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT taskmanager_manager trove.taskmanager.manager.Manager openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notification_driver messagingv2 openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_driver trove.network.neutron.NeutronDriver openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT default_neutron_networks （网络ID） openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_label_regex \\.\\* openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_config /etc/trove/trove-guestagent.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_info guest_info.conf openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT injected_config_location /etc/trove/conf.d openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT cloudinit_location /etc/trove/cloudinit sed -i &#39;/^exists_notification/s/^/#/&#39; /etc/trove/trove-taskmanager.conf openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-taskmanager.conf database connection mysql://trove:000000@controller/trove 9.8 配置trove-conductor.conf文件 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_dir /var/log/trove openstack-config --set /etc/trove/trove-conductor.conf DEFAULT log_file trove-conductor.log openstack-config --set /etc/trove/trove-conductor.conf DEFAULT trove_auth_url http://controller:5000/v2.0 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT notifier_queue_hostname controller openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-conductor.conf DEFAULT nova_proxy_admin_tenant_name admin openstack-config --set /etc/trove/trove-conductor.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_host controller openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-conductor.conf oslo_messaging_rabbit rabbit_password 000000 openstack-config --set /etc/trove/trove-conductor.conf database connection mysql://trove:000000@controller/trove 9.9 配置trove-guestagent.conf文件 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rpc_backend rabbit openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_pass 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_user admin openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT nova_proxy_admin_tenant_id $(openstack project list |grep -w &#39;admin&#39; |awk &#39;{print $2}&#39;) openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT trove_auth_url http://192.168.100.10:35357/v2.0 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_url http://192.168.100.10:8080/v1/AUTH_ openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT os_region_name RegionOne openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT swift_service_type object-store openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT log_file trove-guestagent.log openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_password 000000 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf DEFAULT rabbit_port 5672 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_host 192.168.100.10 openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_userid openstack openstack-config --set /etc/trove/trove-guestagent.conf oslo_messaging_rabbit rabbit_password 000000 9.10 同步数据库 # su -s /bin/sh -c &quot;trove-manage db_sync&quot; trove 9.11 启动服务 # service httpd restart # systemctl enable openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service # systemctl restart openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service 以上便是脚本内容 下面的操作不在脚本之中，可以熟悉下该操作 9.12 上传镜像 将提供的MySQL_5.6_xiandian.qcow2 上传到系统内 # glance image-create --name &quot;mysql-5.6&quot; --disk-format qcow2 --container-format bare --progress &lt; MySQL_5.6_XD.qcow2 9.13 创建数据库存储 # trove-manage datastore_update mysql &#39;&#39; 9.14 使用上传的镜像更新数据库 # glance_id=$(glance image-list | awk &#39;/ mysql-5.6 / { print $2 }&#39;) # trove-manage datastore_version_update mysql mysql-5.6 mysql ${glance_id} &#39;&#39; 1 9.15 启动数据库实例 使用m1.small类型启动名称为mysql-1、大小为5G、创建数据库名称为myDB，用户为user，密码为r00tme，创建过程一般需要3-4分钟。 # FLAVOR_ID=$(openstack flavor list | awk &#39;/ m1.small / { print $2 }&#39;) # trove create mysql-1 ${FLAVOR_ID} --size 5 --databases myDB --users user:r00tme --datastore_version mysql-5.6 --datastore mysql 创建完成后查询trove列表 [root@controller ~]# trove list +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | ID | Name | Datastore | Datastore Version | Status | Flavor ID | Size | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ | b9c9208d-5bca-434a-b258-127ff8496c5e | mysql-1 | mysql | mysql-5.6 | ACTIVE | 2 | 5 | +--------------------------------------+---------+-----------+-------------------+--------+-----------+------+ trove数据库网页访问数据库备份模块可能会出现异常，可以通过命令行完成相关操作。 下一篇博客内容将更新heat服务组件。","@type":"BlogPosting","url":"https://uzzz.org/2019/06/24/795720.html","headline":"云计算基础设施平台iaas（openstack）超级详细搭建（十三） 安装Trove服务","dateModified":"2019-06-24T00:00:00+08:00","datePublished":"2019-06-24T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/06/24/795720.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>云计算基础设施平台iaas（openstack）超级详细搭建（十三） 安装Trove服务</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p>注意：接与上一篇博客内容 进行更新<br> 由于整个开源openstack安装过程过于繁琐，命令太长，太繁琐，于是把整个安装命令写成shell脚本。</p> 
  <p>脚本数量内容过多，已经推送自我的<a href="https://github.com/pwxwmm/openstackShellScript" rel="nofollow" data-token="13b229d9fe52baa765138ddd4db2a30c">github</a>源码托管中心了。<br> 这是本篇脚本内容所在的github仓库位置<br> <a href="https://github.com/pwxwmm/openstackShellScript/blob/master/iaas-install-trove.sh" rel="nofollow" data-token="bb05bf3e63a808f94506f50cc2934db6">controller节点</a><br> 脚本内容介绍</p> 
  <pre><code class="prism language-shell"><span class="token shebang important">#!/bin/bash</span>
<span class="token function">source</span> /etc/xiandian/openrc.sh
<span class="token function">source</span> /etc/keystone/admin-openrc.sh
default_network_id<span class="token operator">=</span>

<span class="token comment">#------------------------------------------------------------------------------------------------</span>
<span class="token function">printf</span> <span class="token string">"\033[35mPlease wait...\n\033[0m"</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span>openstack endpoint list <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">'volume'</span> <span class="token variable">`</span></span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">printf</span> <span class="token string">"\033[35mPlease install the cinder service first! \n\033[0m"</span>
        <span class="token keyword">exit</span> 1
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span>openstack endpoint list <span class="token operator">|</span> <span class="token function">grep</span> -w <span class="token string">'object-store'</span> <span class="token variable">`</span></span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">printf</span> <span class="token string">"\033[35mPlease install the swift service first! \n\033[0m"</span>
        <span class="token keyword">exit</span> 1
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span>neutron net-list<span class="token variable">`</span></span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
        <span class="token function">printf</span> <span class="token string">"\033[35mPlease create network first!\n\033[0m"</span>
        <span class="token keyword">exit</span> 1
<span class="token keyword">fi</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$default_network_id</span> <span class="token operator">==</span> <span class="token string">''</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        network_mode<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /etc/neutron/plugin.ini <span class="token operator">|</span><span class="token function">grep</span> ^tenant_network_types <span class="token operator">|</span><span class="token function">awk</span> -F<span class="token operator">=</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span><span class="token variable">`</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$network_mode</span> <span class="token operator">==</span> <span class="token string">'flat'</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                default_network_id<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>neutron net-list <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'1,3d'</span> -e <span class="token string">'<span class="token variable">$d</span>'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span><span class="token variable">`</span></span>
        <span class="token keyword">elif</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable">$network_mode</span> <span class="token operator">==</span> <span class="token string">'gre'</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                <span class="token comment"># neutron net-list | sed -e '1,3d' -e '$d' |awk '{print $2}'</span>
                <span class="token keyword">for</span> net_name <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span>neutron net-list <span class="token operator">|</span> <span class="token function">sed</span> -e <span class="token string">'1,3d'</span> -e <span class="token string">'<span class="token variable">$d</span>'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span><span class="token variable">`</span></span><span class="token punctuation">;</span>
                <span class="token keyword">do</span>
                        mode<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>neutron net-show $net_name <span class="token operator">|</span><span class="token function">grep</span> <span class="token string">"router:external"</span><span class="token variable">`</span></span>
                        <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token keyword">echo</span> $mode <span class="token operator">|</span><span class="token function">grep</span> -w <span class="token string">"False"</span><span class="token variable">`</span></span> <span class="token operator">!=</span>  <span class="token string">""</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
                                default_network_id<span class="token operator">=</span><span class="token variable">$net_name</span>
                                <span class="token keyword">break</span>
                        <span class="token keyword">fi</span>
                <span class="token keyword">done</span>
        <span class="token comment"># elif [[ $network_mode == 'vlan' ]] ;then</span>
</code></pre> 
  <p>9 安装Trove服务</p> 
  <pre><code class="prism language-shell">9.1 执行脚本进行安装
9.2-9.11编配服务的操作命令已经编写成shell脚本，通过脚本进行一键安装。如下：
<span class="token comment">#Controller节点</span>
执行脚本iaas-install-trove.sh进行安装
需注意安装Trove服务之前需要配置好网络（flat或gre）,创建好子网，并确认系统已经安装swift和cinder两个服务，否则安装会失败。

</code></pre> 
  <p>9.2 安装Trove数据库服务的软件包</p> 
  <pre><code class="prism language-shell"><span class="token comment"># yum install openstack-trove-guestagent openstack-trove python-troveclient openstack-trove-ui –y</span>
</code></pre> 
  <p>9.3 创建数据库</p> 
  <pre><code class="prism language-sql"><span class="token comment"># mysql -u root -p</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> trove<span class="token punctuation">;</span>
mysql<span class="token operator">&gt;</span> <span class="token keyword">GRANT</span> <span class="token keyword">ALL</span> <span class="token keyword">PRIVILEGES</span> <span class="token keyword">ON</span> trove<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> trove@'localhost<span class="token string">' IDENTIFIED BY '</span><span class="token number">000000</span><span class="token string">'; mysql&gt; GRANT ALL PRIVILEGES ON trove.* TO trove@'</span><span class="token operator">%</span><span class="token string">' IDENTIFIED BY '</span><span class="token number">000000</span>'<span class="token punctuation">;</span>

</code></pre> 
  <p>9.4 创建用户</p> 
  <pre><code class="prism language-python"><span class="token comment"># openstack user create --domain $DOMAIN_NAME --password 000000 trove</span>
<span class="token comment"># openstack role add --project service --user trove admin</span>
<span class="token comment"># openstack service create --name trove --description "Database" database</span>

</code></pre> 
  <p>9.5 创建Endpoint和API端点</p> 
  <pre><code class="prism language-shell"><span class="token comment"># openstack endpoint create --region RegionOne database public http:// controller:8779/v1.0/%\(tenant_id\)s</span>
<span class="token comment"># openstack endpoint create --region RegionOne database internal http:// controller:8779/v1.0/%\(tenant_id\)s</span>
<span class="token comment"># openstack endpoint create --region RegionOne database admin http:// controller:8779/v1.0/%\(tenant_id\)s</span>

</code></pre> 
  <p>9.6 配置trove.conf文件</p> 
  <pre><code class="prism language-python">openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT log_dir <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>trove
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT log_file trove<span class="token operator">-</span>api<span class="token punctuation">.</span>log
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT trove_auth_url http<span class="token punctuation">:</span><span class="token operator">//</span>controller<span class="token punctuation">:</span><span class="token number">35357</span><span class="token operator">/</span>v2<span class="token punctuation">.</span><span class="token number">0</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT notifier_queue_hostname controller
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT rpc_backend rabbit
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_user admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_pass <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_tenant_name admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT nova_compute_service_type compute
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT cinder_service_type volumev2
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT network_driver trove<span class="token punctuation">.</span>network<span class="token punctuation">.</span>neutron<span class="token punctuation">.</span>NeutronDriver
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT default_neutron_networks <span class="token punctuation">(</span>网络的ID<span class="token punctuation">)</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT auth_strategy keystone
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT add_addresses <span class="token boolean">True</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT network_label_regex \<span class="token punctuation">.</span>\<span class="token operator">*</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf DEFAULT api_paste_config api<span class="token operator">-</span>paste<span class="token punctuation">.</span>ini
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_host controller
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_userid openstack
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_password <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf database connection mysql<span class="token punctuation">:</span><span class="token operator">//</span>trove<span class="token punctuation">:</span><span class="token number">000000</span>@controller<span class="token operator">/</span>trove
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken auth_uri http<span class="token punctuation">:</span><span class="token operator">//</span>controller<span class="token punctuation">:</span><span class="token number">5000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken auth_url http<span class="token punctuation">:</span><span class="token operator">//</span>controller<span class="token punctuation">:</span><span class="token number">35357</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken auth_type password
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken project_domain_name default
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken user_domain_name default
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken project_name service
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken username trove
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token punctuation">.</span>conf keystone_authtoken password  <span class="token number">000000</span>

</code></pre> 
  <p>9.7 配置trove-taskmanager.conf</p> 
  <pre><code class="prism language-shell">openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_dir /var/log/trove
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT log_file trove-taskmanager.log
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT trove_auth_url http://controller:5000/v2.0
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_compute_url  http://controller:8774/v2.1
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notifier_queue_hostname  controller
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT rpc_backend rabbit
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_user admin
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_pass 000000
openstack-config crudini --set /etc/trove/trove-taskmanager.conf DEFAULT nova_proxy_admin_tenant_id <span class="token variable"><span class="token variable">$(</span>openstack project list <span class="token operator">|</span><span class="token function">grep</span> -w <span class="token string">'admin'</span> <span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span><span class="token variable">)</span></span>
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT taskmanager_manager trove.taskmanager.manager.Manager
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT notification_driver messagingv2
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_driver trove.network.neutron.NeutronDriver
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT default_neutron_networks （网络ID）
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT network_label_regex \.\*
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_config /etc/trove/trove-guestagent.conf
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT guest_info guest_info.conf
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT injected_config_location /etc/trove/conf.d
openstack-config --set /etc/trove/trove-taskmanager.conf DEFAULT cloudinit_location /etc/trove/cloudinit
<span class="token function">sed</span> -i <span class="token string">'/^exists_notification/s/^/#/'</span> /etc/trove/trove-taskmanager.conf 
openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_host controller
openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_userid openstack
openstack-config --set /etc/trove/trove-taskmanager.conf oslo_messaging_rabbit rabbit_password 000000
openstack-config --set /etc/trove/trove-taskmanager.conf database connection mysql://trove:000000@controller/trove

</code></pre> 
  <p>9.8 配置trove-conductor.conf文件</p> 
  <pre><code class="prism language-python">openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT log_dir <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>trove
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT log_file trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>log
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT trove_auth_url http<span class="token punctuation">:</span><span class="token operator">//</span>controller<span class="token punctuation">:</span><span class="token number">5000</span><span class="token operator">/</span>v2<span class="token punctuation">.</span><span class="token number">0</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT notifier_queue_hostname  controller
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_user admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_pass <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_tenant_name admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf DEFAULT rpc_backend rabbit
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_host controller
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_userid openstack
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_password <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>conductor<span class="token punctuation">.</span>conf database connection mysql<span class="token punctuation">:</span><span class="token operator">//</span>trove<span class="token punctuation">:</span><span class="token number">000000</span>@controller<span class="token operator">/</span>trove

</code></pre> 
  <p>9.9 配置trove-guestagent.conf文件</p> 
  <pre><code class="prism language-python">openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT rpc_backend rabbit
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_user admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_pass <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_user admin
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT nova_proxy_admin_tenant_id $<span class="token punctuation">(</span>openstack project <span class="token builtin">list</span> <span class="token operator">|</span>grep <span class="token operator">-</span>w <span class="token string">'admin'</span> <span class="token operator">|</span>awk <span class="token string">'{print $2}'</span><span class="token punctuation">)</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT trove_auth_url http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.10</span><span class="token punctuation">:</span><span class="token number">35357</span><span class="token operator">/</span>v2<span class="token punctuation">.</span><span class="token number">0</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT swift_url http<span class="token punctuation">:</span><span class="token operator">//</span><span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.10</span><span class="token punctuation">:</span><span class="token number">8080</span><span class="token operator">/</span>v1<span class="token operator">/</span>AUTH_
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT os_region_name RegionOne 
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT swift_service_type <span class="token builtin">object</span><span class="token operator">-</span>store
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT log_file trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>log
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT rabbit_password <span class="token number">000000</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT rabbit_host <span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.10</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT rabbit_userid openstack
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf DEFAULT rabbit_port <span class="token number">5672</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_host <span class="token number">192.168</span><span class="token number">.100</span><span class="token number">.10</span>
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_userid openstack
openstack<span class="token operator">-</span>config <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">set</span> <span class="token operator">/</span>etc<span class="token operator">/</span>trove<span class="token operator">/</span>trove<span class="token operator">-</span>guestagent<span class="token punctuation">.</span>conf oslo_messaging_rabbit rabbit_password <span class="token number">000000</span>

</code></pre> 
  <p>9.10 同步数据库</p> 
  <pre><code># su -s /bin/sh -c "trove-manage db_sync" trove
</code></pre> 
  <p>9.11 启动服务</p> 
  <pre><code># service httpd restart
# systemctl enable openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service
# systemctl restart openstack-trove-api.service openstack-trove-taskmanager.service openstack-trove-conductor.service

</code></pre> 
  <p>以上便是脚本内容<br> 下面的操作不在脚本之中，可以熟悉下该操作</p> 
  <p>9.12 上传镜像</p> 
  <pre><code>将提供的MySQL_5.6_xiandian.qcow2 上传到系统内
# glance image-create --name "mysql-5.6" --disk-format qcow2  --container-format bare --progress &lt;  MySQL_5.6_XD.qcow2 

</code></pre> 
  <p>9.13 创建数据库存储</p> 
  <pre><code># trove-manage datastore_update mysql ''
</code></pre> 
  <p>9.14 使用上传的镜像更新数据库</p> 
  <pre><code># glance_id=$(glance image-list | awk '/ mysql-5.6 / { print $2 }')
# trove-manage datastore_version_update mysql mysql-5.6 mysql ${glance_id} '' 1

</code></pre> 
  <p>9.15 启动数据库实例</p> 
  <pre><code class="prism language-shell">使用m1.small类型启动名称为mysql-1、大小为5G、创建数据库名称为myDB，用户为user，密码为r00tme，创建过程一般需要3-4分钟。
<span class="token comment"># FLAVOR_ID=$(openstack flavor list | awk '/ m1.small / { print $2 }')</span>
<span class="token comment"># trove create mysql-1 ${FLAVOR_ID} --size 5 --databases myDB --users user:r00tme --datastore_version mysql-5.6 --datastore mysql</span>
创建完成后查询trove列表
<span class="token punctuation">[</span>root@controller ~<span class="token punctuation">]</span><span class="token comment"># trove list</span>
+--------------------------------------+---------+-----------+-------------------+--------+-----------+------+
<span class="token operator">|</span> ID                                   <span class="token operator">|</span> Name    <span class="token operator">|</span> Datastore <span class="token operator">|</span> Datastore Version <span class="token operator">|</span> Status <span class="token operator">|</span> Flavor ID <span class="token operator">|</span> Size <span class="token operator">|</span>
+--------------------------------------+---------+-----------+-------------------+--------+-----------+------+
<span class="token operator">|</span> b9c9208d-5bca-434a-b258-127ff8496c5e <span class="token operator">|</span> mysql-1 <span class="token operator">|</span> mysql     <span class="token operator">|</span> mysql-5.6         <span class="token operator">|</span> ACTIVE <span class="token operator">|</span> 2         <span class="token operator">|</span>    5 <span class="token operator">|</span>
+--------------------------------------+---------+-----------+-------------------+--------+-----------+------+
trove数据库网页访问数据库备份模块可能会出现异常，可以通过命令行完成相关操作。

</code></pre> 
  <p>下一篇博客内容将更新heat服务组件。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
