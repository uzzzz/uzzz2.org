<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>使用OpenMP实现并分析PageRank算法 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="使用OpenMP实现并分析PageRank算法" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Introduction Background PageRank是Google创始人Larry Page和Sergey Brin在1996年创造的算法，起源于他们在斯坦福的一个关于开发有效搜索引擎的项目。 他们把万维网(World Wide Web)看作是一个巨大的文件集，在这个集中，文件与文件间有着复杂的超链接结构。因此万维网也可以抽象成一个巨大的有向图，节点代表各网页，而有向边则代表网页之间的超链接。如何通过节点在图中的位置来计算逼近它对应的重要性，是PageRank算法的主要目的。 在详细讨论pageRank算法以前，需要先阐述一些有关的基础概念与定义。首先，如何把万维网抽象成一个有向图对PageRank算法至关重要。因为，万维网的link structure可以确定每个节点在整个网络中的相对位置，而这个相对位置则为后续计算它的重要性提供了信息。 我们用节点(vertex)来代表网页，有向边(edge)来代表网页间的链接关系。由于网页之间的链接边(或 link)有两个方向，因此分别命名为forward link(outedge) 和 backlink(inedge)。下图示意了一个，由5个网页组成的网络的link structure： Principle 基于万维网link structure的这个结构特性，PageRank算法的核心思想应运而生。 既然网页之间相互链接，那么对于一个网页而言，每一个指向它的链接(inedge)都可以类似成一个学术引用，代表了它的重要性。但是与学术引用不同，网页并没有质量控制和发表成本等门槛。因此，如果只单用inedge的数量来表示重要性的话，所得出的重要性指标会很容易被操控篡改。仅仅是靠低成本地制造大量垃圾网页，使它们指向某一特定网页，便可以增加此网页的引用数量。 基于这个考虑，除了使用引用数目(inedge的数目)这个局部指标以外，还应该使用万维网的全局信息。因为涉及万维网巨大的整体结构，这部分信息难以被简单篡改，使得计算出的重要性更为robust。 由观察得知，一个网页的重要与否，取决于以下两个因素： 与学术引用类似，此网页是否有许多入链接，即是否很多网页都指向它 指向它的网页中，是否存在非常重要的网页。例如：某网页也许只有一个入链接，但此入链接是源自Wiki这样的权威网页 PageRank正是综合地考虑了网页的入链接数目这个局部指标，以及入链接网页重要性这个全局指标，来逼近一个网页的真实重要性。为了达到这一综合，此算法使用了重要性传递(rank propagation through links)这一思想，让rank依照万维网的结构动态流动直到稳定，所得的最终结果便是网页最后的重要性(或 Rank)。 ##PageRank Algorithm ###basics PageRank的定义 R ( u ) = c ∑ v ∈ B u R ( v ) N v R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v} R(u)=cv∈Bu​∑​Nv​R(v)​ u : u: u:某一个网页 R : R: R:此网页对应的PageRank值(此公式算出的PageRank为naive版本) c : c: c:归一化系数 B u : B_u: Bu​:指向网页u的网页集合 N u = ∣ F u ∣ N_u=|F_u| Nu​=∣Fu​∣ F u : F_u: Fu​:网页u指向的网页集合 如上图中: B 2 = { 1 , 3 } B_2=\{1, 3\} B2​={1,3} F 1 = { 2 , 4 } F_1=\{2, 4\} F1​={2,4} N 1 = ∣ F 1 ∣ = 2 N_1=|F_1|=2 N1​=∣F1​∣=2 Matrix Representation 为了能够高效地计算网络里各个网页的PageRank，需要把上一节中公式表达成矩阵运算形式。 首先，假设网络中一共包含了N 个网页。设 R 为一个向量，一共包含 N 个entries，它的每个entry均存储了对应网页的PageRank值。 R N × 1 : R_{N\times{1}}: RN×1​:一个数组，负责存储每个网页的PageRank。 设一矩阵 A N × N A_{N\times{N}} AN×N​，它存储了网络任意两个网页间的链接关系。 KaTeX parse error: No such environment: eqnarray at position 7: \begin{̲e̲q̲n̲a̲r̲r̲a̲y̲}̲A_{u,{v}}=\begi… 例如下图三中的网络所对应的矩阵 A 为： A 4 × 4 = [ 0 0 1 3 0 1 2 0 1 3 0 0 1 0 0 1 2 0 1 3 1 ] A_{4\times{4}}=\left[ \begin{matrix}0 &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 1 \end{matrix} \right] A4×4​=⎣⎢⎢⎡​021​021​​0010​31​31​031​​0001​⎦⎥⎥⎤​ Computation Process 在有了矩阵表达后，原先计算PageRank的公式可以进行如下转换： R ( u ) = c ∑ v ∈ B u R ( v ) N v &nbsp;&nbsp; ⟹ &nbsp;&nbsp; R = c A R R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v}\ \ \Longrightarrow\ \ R=cAR R(u)=cv∈Bu​∑​Nv​R(v)​&nbsp;&nbsp;⟹&nbsp;&nbsp;R=cAR 因此，在实际计算时，可以反复循环计算 R，直到收敛。即： R i + 1 = c A R i R_{i+1}=cAR_i Ri+1​=cARi​ 由 Power method convergence theorem可知，由于矩阵 A 可以看作是一个跳转概率矩阵，其每列都是一个网页对应的跳转概率分布，因此如下数列收敛： R , A R , A 2 R , . . . . A k R R,AR,A^2R,....A^kR R,AR,A2R,....AkR 即，按此方法计算PageRank，最终会到达一个稳定状态。此状态即使最后的网页重要性排序的结果。 interpretation PageRank算法的核心是跳转矩阵 A。因为跳转矩阵 A 包含了网络中所有网页的链接关系，根据此链接关系（网页在网络中的位置），可直接推导出网页的重要性。它的每一列包含了一个网页所有的出边(outedges)，及每个出边所对应的概率。也可理解成，若用户当前位于此网页，那么下一时刻用户跳转到其他网页的概率分布。 而这个过程可以更形象地运用 Random Surfer Model来解释。Random Surfer Model模拟了用户在网络上随机浏览的概率分布。此处，随机浏览是说用户从任意的一个网页开始，按照跳转矩阵 A 中，对应网页的跳转概率分布来随机点击跳转到下一网页。用户持续重复这一行为知道被一个死循环困住。而在全过程中，每个网页被浏览的次数可以归一化为一个稳定的概率分布，这个分布即是最后的网页重要性。 Rank Sink 但是按照这个方法计算PageRank会出现一个问题，叫做 Rank Sink。网络中可能会存在由一些网页组成的子网络，这个网络只有入链接(inedges)而没有出链接，形成了一个闭环，如下图所示： 当随机浏览的用户进入这个子网络时，他将被困住，一直在这个网络的网页里循环。因此，这些网页的PageRank会趋近于无限大，而这个子网络之外的网页的PageRank会下降，造成失真。 Optimalization 一个有效的解决办法是额外加入一个Escape Term E(u)。它和R(u)一样，也是一个跳转概率分布，通过融合R(u) 和 Escape Term E(u)，死循环可以被打破。相当于，当用户陷入一个死循环时，Escape Term E(u) 提供了随机跳出此循环的可能性。融合方法如下： R ′ ( u ) = d ∑ v ∈ B v R ′ ( v ) N v + ( 1 − d ) E ( u ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ∣ ∣ R ′ ∣ ∣ 1 = 1 R^{&amp;#x27;}(u)=d\sum_{v\in{B_v}}\frac{R^{&amp;#x27;}(v)}{N_v}+(1-d)E(u)\ \ \ \ \ ||R^{&amp;#x27;}||_1=1 R′(u)=dv∈Bv​∑​Nv​R′(v)​+(1−d)E(u)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∣∣R′∣∣1​=1 Implementation in OpenMP Motivation 此处，我使用OpenMP实现了PageRank的并行计算。 OpenMP是一个共享内存的并行计算模型，适用于多核的单节点并行。它支持多平台，计算中数据的分布与合成可以由 directives 自动处理，因此使用十分便捷，非常适合用来初步并行串行代码。 General Process 根据公式，计算PageRank的伪代码如下： 其中： S : S: S: initialization of PageRank E : E: E: Escape Term d : d: d: a scalar, accelerates convergence &amp; miantains ∣ ∣ R ∣ ∣ 1 ||R||_1 ∣∣R∣∣1​ Experiment Result 在一个有916,428个网页的网络上运行PageRank算法，在此网络中，共有5,105,039个链接。下图为并行与串行的时间对比，横轴为运行的次数，纵轴为每次运行对应的时间。为了保证客观，排除特殊情况，两个算法各独立运行15次。可以看出，并行提升了性能。 $Speedup:$1.4803 $Efficiency:$0.37 下图是 scaling factor，由于我的电脑只有四核，因此曲线的走势是合理的。 Analysis 由上面的分析可知，算法的 Speedup 非常不理想的。而这个性能的限制主要有两个因素 ： Load imbalance overheads(负载不均衡) Synchronization overheads(线程同步开销) Load imbalance overheads 上图展示了OpenMP的三种 scheduling methods： Static Dynamic Guided 具体实现时，需要根据数据的具体分布来选择合适的scheduling methods，否则可能会降低算法的性能。 首先，在原始的数据上检验不同的scheduling methods对性能的影响。结果如下： 可以看出，由于负载较为均衡，此时用chunk较小的Dynamic方法反而会增大调度开销，降低性能。 然后，随机在原始网络上选出三个网页(节点)，每个网页手动添加一百万个随机入链接，增加网络的不均衡分布。当计算这个新的strewed数据时，每个iteration的计算量会严重不均衡。各个scheduling methods的运行时间如下： 可以看出，在计算量不均衡时，使用Dynamic更有优势，避免线程空闲。 Synchronization overheads 另一个影响性能的因素是代码的并行度。由于在实现这个算法时，为了避免data races ，在每个iteration中均用了atomic operation，造成了代码同步度的底下，降低了性能。 为了解决这个问题，可以先使每个iteration仅更新改变本地值，避免data races problem，在循环结束后做一个总的final synchronized reduction，以更新最终的全局共享变量。这个操作可以避免使用 atomic operation ，提高了代码的并行度。缺点是需要大量的内存来存放本地数据 ( N × K × 8 N\times{K}\times{8} N×K×8)。 改进的算法与旧算法的性能对比如下： [外链图片转存失败(img-k1lzh4Xu-1562310808132)(https://upload-images.jianshu.io/upload_images/14768852-a74a2dc11776bc70.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)] Summary PageRank: numbers &amp; importance of backlinks importance propagation: based on location in the graph structure Implementation in OpenMP: Data race Load imbalance" />
<meta property="og:description" content="Introduction Background PageRank是Google创始人Larry Page和Sergey Brin在1996年创造的算法，起源于他们在斯坦福的一个关于开发有效搜索引擎的项目。 他们把万维网(World Wide Web)看作是一个巨大的文件集，在这个集中，文件与文件间有着复杂的超链接结构。因此万维网也可以抽象成一个巨大的有向图，节点代表各网页，而有向边则代表网页之间的超链接。如何通过节点在图中的位置来计算逼近它对应的重要性，是PageRank算法的主要目的。 在详细讨论pageRank算法以前，需要先阐述一些有关的基础概念与定义。首先，如何把万维网抽象成一个有向图对PageRank算法至关重要。因为，万维网的link structure可以确定每个节点在整个网络中的相对位置，而这个相对位置则为后续计算它的重要性提供了信息。 我们用节点(vertex)来代表网页，有向边(edge)来代表网页间的链接关系。由于网页之间的链接边(或 link)有两个方向，因此分别命名为forward link(outedge) 和 backlink(inedge)。下图示意了一个，由5个网页组成的网络的link structure： Principle 基于万维网link structure的这个结构特性，PageRank算法的核心思想应运而生。 既然网页之间相互链接，那么对于一个网页而言，每一个指向它的链接(inedge)都可以类似成一个学术引用，代表了它的重要性。但是与学术引用不同，网页并没有质量控制和发表成本等门槛。因此，如果只单用inedge的数量来表示重要性的话，所得出的重要性指标会很容易被操控篡改。仅仅是靠低成本地制造大量垃圾网页，使它们指向某一特定网页，便可以增加此网页的引用数量。 基于这个考虑，除了使用引用数目(inedge的数目)这个局部指标以外，还应该使用万维网的全局信息。因为涉及万维网巨大的整体结构，这部分信息难以被简单篡改，使得计算出的重要性更为robust。 由观察得知，一个网页的重要与否，取决于以下两个因素： 与学术引用类似，此网页是否有许多入链接，即是否很多网页都指向它 指向它的网页中，是否存在非常重要的网页。例如：某网页也许只有一个入链接，但此入链接是源自Wiki这样的权威网页 PageRank正是综合地考虑了网页的入链接数目这个局部指标，以及入链接网页重要性这个全局指标，来逼近一个网页的真实重要性。为了达到这一综合，此算法使用了重要性传递(rank propagation through links)这一思想，让rank依照万维网的结构动态流动直到稳定，所得的最终结果便是网页最后的重要性(或 Rank)。 ##PageRank Algorithm ###basics PageRank的定义 R ( u ) = c ∑ v ∈ B u R ( v ) N v R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v} R(u)=cv∈Bu​∑​Nv​R(v)​ u : u: u:某一个网页 R : R: R:此网页对应的PageRank值(此公式算出的PageRank为naive版本) c : c: c:归一化系数 B u : B_u: Bu​:指向网页u的网页集合 N u = ∣ F u ∣ N_u=|F_u| Nu​=∣Fu​∣ F u : F_u: Fu​:网页u指向的网页集合 如上图中: B 2 = { 1 , 3 } B_2=\{1, 3\} B2​={1,3} F 1 = { 2 , 4 } F_1=\{2, 4\} F1​={2,4} N 1 = ∣ F 1 ∣ = 2 N_1=|F_1|=2 N1​=∣F1​∣=2 Matrix Representation 为了能够高效地计算网络里各个网页的PageRank，需要把上一节中公式表达成矩阵运算形式。 首先，假设网络中一共包含了N 个网页。设 R 为一个向量，一共包含 N 个entries，它的每个entry均存储了对应网页的PageRank值。 R N × 1 : R_{N\times{1}}: RN×1​:一个数组，负责存储每个网页的PageRank。 设一矩阵 A N × N A_{N\times{N}} AN×N​，它存储了网络任意两个网页间的链接关系。 KaTeX parse error: No such environment: eqnarray at position 7: \begin{̲e̲q̲n̲a̲r̲r̲a̲y̲}̲A_{u,{v}}=\begi… 例如下图三中的网络所对应的矩阵 A 为： A 4 × 4 = [ 0 0 1 3 0 1 2 0 1 3 0 0 1 0 0 1 2 0 1 3 1 ] A_{4\times{4}}=\left[ \begin{matrix}0 &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 1 \end{matrix} \right] A4×4​=⎣⎢⎢⎡​021​021​​0010​31​31​031​​0001​⎦⎥⎥⎤​ Computation Process 在有了矩阵表达后，原先计算PageRank的公式可以进行如下转换： R ( u ) = c ∑ v ∈ B u R ( v ) N v &nbsp;&nbsp; ⟹ &nbsp;&nbsp; R = c A R R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v}\ \ \Longrightarrow\ \ R=cAR R(u)=cv∈Bu​∑​Nv​R(v)​&nbsp;&nbsp;⟹&nbsp;&nbsp;R=cAR 因此，在实际计算时，可以反复循环计算 R，直到收敛。即： R i + 1 = c A R i R_{i+1}=cAR_i Ri+1​=cARi​ 由 Power method convergence theorem可知，由于矩阵 A 可以看作是一个跳转概率矩阵，其每列都是一个网页对应的跳转概率分布，因此如下数列收敛： R , A R , A 2 R , . . . . A k R R,AR,A^2R,....A^kR R,AR,A2R,....AkR 即，按此方法计算PageRank，最终会到达一个稳定状态。此状态即使最后的网页重要性排序的结果。 interpretation PageRank算法的核心是跳转矩阵 A。因为跳转矩阵 A 包含了网络中所有网页的链接关系，根据此链接关系（网页在网络中的位置），可直接推导出网页的重要性。它的每一列包含了一个网页所有的出边(outedges)，及每个出边所对应的概率。也可理解成，若用户当前位于此网页，那么下一时刻用户跳转到其他网页的概率分布。 而这个过程可以更形象地运用 Random Surfer Model来解释。Random Surfer Model模拟了用户在网络上随机浏览的概率分布。此处，随机浏览是说用户从任意的一个网页开始，按照跳转矩阵 A 中，对应网页的跳转概率分布来随机点击跳转到下一网页。用户持续重复这一行为知道被一个死循环困住。而在全过程中，每个网页被浏览的次数可以归一化为一个稳定的概率分布，这个分布即是最后的网页重要性。 Rank Sink 但是按照这个方法计算PageRank会出现一个问题，叫做 Rank Sink。网络中可能会存在由一些网页组成的子网络，这个网络只有入链接(inedges)而没有出链接，形成了一个闭环，如下图所示： 当随机浏览的用户进入这个子网络时，他将被困住，一直在这个网络的网页里循环。因此，这些网页的PageRank会趋近于无限大，而这个子网络之外的网页的PageRank会下降，造成失真。 Optimalization 一个有效的解决办法是额外加入一个Escape Term E(u)。它和R(u)一样，也是一个跳转概率分布，通过融合R(u) 和 Escape Term E(u)，死循环可以被打破。相当于，当用户陷入一个死循环时，Escape Term E(u) 提供了随机跳出此循环的可能性。融合方法如下： R ′ ( u ) = d ∑ v ∈ B v R ′ ( v ) N v + ( 1 − d ) E ( u ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ∣ ∣ R ′ ∣ ∣ 1 = 1 R^{&amp;#x27;}(u)=d\sum_{v\in{B_v}}\frac{R^{&amp;#x27;}(v)}{N_v}+(1-d)E(u)\ \ \ \ \ ||R^{&amp;#x27;}||_1=1 R′(u)=dv∈Bv​∑​Nv​R′(v)​+(1−d)E(u)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∣∣R′∣∣1​=1 Implementation in OpenMP Motivation 此处，我使用OpenMP实现了PageRank的并行计算。 OpenMP是一个共享内存的并行计算模型，适用于多核的单节点并行。它支持多平台，计算中数据的分布与合成可以由 directives 自动处理，因此使用十分便捷，非常适合用来初步并行串行代码。 General Process 根据公式，计算PageRank的伪代码如下： 其中： S : S: S: initialization of PageRank E : E: E: Escape Term d : d: d: a scalar, accelerates convergence &amp; miantains ∣ ∣ R ∣ ∣ 1 ||R||_1 ∣∣R∣∣1​ Experiment Result 在一个有916,428个网页的网络上运行PageRank算法，在此网络中，共有5,105,039个链接。下图为并行与串行的时间对比，横轴为运行的次数，纵轴为每次运行对应的时间。为了保证客观，排除特殊情况，两个算法各独立运行15次。可以看出，并行提升了性能。 $Speedup:$1.4803 $Efficiency:$0.37 下图是 scaling factor，由于我的电脑只有四核，因此曲线的走势是合理的。 Analysis 由上面的分析可知，算法的 Speedup 非常不理想的。而这个性能的限制主要有两个因素 ： Load imbalance overheads(负载不均衡) Synchronization overheads(线程同步开销) Load imbalance overheads 上图展示了OpenMP的三种 scheduling methods： Static Dynamic Guided 具体实现时，需要根据数据的具体分布来选择合适的scheduling methods，否则可能会降低算法的性能。 首先，在原始的数据上检验不同的scheduling methods对性能的影响。结果如下： 可以看出，由于负载较为均衡，此时用chunk较小的Dynamic方法反而会增大调度开销，降低性能。 然后，随机在原始网络上选出三个网页(节点)，每个网页手动添加一百万个随机入链接，增加网络的不均衡分布。当计算这个新的strewed数据时，每个iteration的计算量会严重不均衡。各个scheduling methods的运行时间如下： 可以看出，在计算量不均衡时，使用Dynamic更有优势，避免线程空闲。 Synchronization overheads 另一个影响性能的因素是代码的并行度。由于在实现这个算法时，为了避免data races ，在每个iteration中均用了atomic operation，造成了代码同步度的底下，降低了性能。 为了解决这个问题，可以先使每个iteration仅更新改变本地值，避免data races problem，在循环结束后做一个总的final synchronized reduction，以更新最终的全局共享变量。这个操作可以避免使用 atomic operation ，提高了代码的并行度。缺点是需要大量的内存来存放本地数据 ( N × K × 8 N\times{K}\times{8} N×K×8)。 改进的算法与旧算法的性能对比如下： [外链图片转存失败(img-k1lzh4Xu-1562310808132)(https://upload-images.jianshu.io/upload_images/14768852-a74a2dc11776bc70.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)] Summary PageRank: numbers &amp; importance of backlinks importance propagation: based on location in the graph structure Implementation in OpenMP: Data race Load imbalance" />
<link rel="canonical" href="https://uzzz.org/2019/07/05/790217.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/05/790217.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-05T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"Introduction Background PageRank是Google创始人Larry Page和Sergey Brin在1996年创造的算法，起源于他们在斯坦福的一个关于开发有效搜索引擎的项目。 他们把万维网(World Wide Web)看作是一个巨大的文件集，在这个集中，文件与文件间有着复杂的超链接结构。因此万维网也可以抽象成一个巨大的有向图，节点代表各网页，而有向边则代表网页之间的超链接。如何通过节点在图中的位置来计算逼近它对应的重要性，是PageRank算法的主要目的。 在详细讨论pageRank算法以前，需要先阐述一些有关的基础概念与定义。首先，如何把万维网抽象成一个有向图对PageRank算法至关重要。因为，万维网的link structure可以确定每个节点在整个网络中的相对位置，而这个相对位置则为后续计算它的重要性提供了信息。 我们用节点(vertex)来代表网页，有向边(edge)来代表网页间的链接关系。由于网页之间的链接边(或 link)有两个方向，因此分别命名为forward link(outedge) 和 backlink(inedge)。下图示意了一个，由5个网页组成的网络的link structure： Principle 基于万维网link structure的这个结构特性，PageRank算法的核心思想应运而生。 既然网页之间相互链接，那么对于一个网页而言，每一个指向它的链接(inedge)都可以类似成一个学术引用，代表了它的重要性。但是与学术引用不同，网页并没有质量控制和发表成本等门槛。因此，如果只单用inedge的数量来表示重要性的话，所得出的重要性指标会很容易被操控篡改。仅仅是靠低成本地制造大量垃圾网页，使它们指向某一特定网页，便可以增加此网页的引用数量。 基于这个考虑，除了使用引用数目(inedge的数目)这个局部指标以外，还应该使用万维网的全局信息。因为涉及万维网巨大的整体结构，这部分信息难以被简单篡改，使得计算出的重要性更为robust。 由观察得知，一个网页的重要与否，取决于以下两个因素： 与学术引用类似，此网页是否有许多入链接，即是否很多网页都指向它 指向它的网页中，是否存在非常重要的网页。例如：某网页也许只有一个入链接，但此入链接是源自Wiki这样的权威网页 PageRank正是综合地考虑了网页的入链接数目这个局部指标，以及入链接网页重要性这个全局指标，来逼近一个网页的真实重要性。为了达到这一综合，此算法使用了重要性传递(rank propagation through links)这一思想，让rank依照万维网的结构动态流动直到稳定，所得的最终结果便是网页最后的重要性(或 Rank)。 ##PageRank Algorithm ###basics PageRank的定义 R ( u ) = c ∑ v ∈ B u R ( v ) N v R(u)=c\\sum_{v\\in{B_u}}\\frac{R(v)}{N_v} R(u)=cv∈Bu​∑​Nv​R(v)​ u : u: u:某一个网页 R : R: R:此网页对应的PageRank值(此公式算出的PageRank为naive版本) c : c: c:归一化系数 B u : B_u: Bu​:指向网页u的网页集合 N u = ∣ F u ∣ N_u=|F_u| Nu​=∣Fu​∣ F u : F_u: Fu​:网页u指向的网页集合 如上图中: B 2 = { 1 , 3 } B_2=\\{1, 3\\} B2​={1,3} F 1 = { 2 , 4 } F_1=\\{2, 4\\} F1​={2,4} N 1 = ∣ F 1 ∣ = 2 N_1=|F_1|=2 N1​=∣F1​∣=2 Matrix Representation 为了能够高效地计算网络里各个网页的PageRank，需要把上一节中公式表达成矩阵运算形式。 首先，假设网络中一共包含了N 个网页。设 R 为一个向量，一共包含 N 个entries，它的每个entry均存储了对应网页的PageRank值。 R N × 1 : R_{N\\times{1}}: RN×1​:一个数组，负责存储每个网页的PageRank。 设一矩阵 A N × N A_{N\\times{N}} AN×N​，它存储了网络任意两个网页间的链接关系。 KaTeX parse error: No such environment: eqnarray at position 7: \\begin{̲e̲q̲n̲a̲r̲r̲a̲y̲}̲A_{u,{v}}=\\begi… 例如下图三中的网络所对应的矩阵 A 为： A 4 × 4 = [ 0 0 1 3 0 1 2 0 1 3 0 0 1 0 0 1 2 0 1 3 1 ] A_{4\\times{4}}=\\left[ \\begin{matrix}0 &amp;amp; 0 &amp;amp; \\frac{1}{3} &amp;amp; 0 \\\\ \\frac{1}{2} &amp;amp; 0 &amp;amp; \\frac{1}{3} &amp;amp; 0 \\\\ 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \\\\ \\frac{1}{2} &amp;amp; 0 &amp;amp; \\frac{1}{3} &amp;amp; 1 \\end{matrix} \\right] A4×4​=⎣⎢⎢⎡​021​021​​0010​31​31​031​​0001​⎦⎥⎥⎤​ Computation Process 在有了矩阵表达后，原先计算PageRank的公式可以进行如下转换： R ( u ) = c ∑ v ∈ B u R ( v ) N v &nbsp;&nbsp; ⟹ &nbsp;&nbsp; R = c A R R(u)=c\\sum_{v\\in{B_u}}\\frac{R(v)}{N_v}\\ \\ \\Longrightarrow\\ \\ R=cAR R(u)=cv∈Bu​∑​Nv​R(v)​&nbsp;&nbsp;⟹&nbsp;&nbsp;R=cAR 因此，在实际计算时，可以反复循环计算 R，直到收敛。即： R i + 1 = c A R i R_{i+1}=cAR_i Ri+1​=cARi​ 由 Power method convergence theorem可知，由于矩阵 A 可以看作是一个跳转概率矩阵，其每列都是一个网页对应的跳转概率分布，因此如下数列收敛： R , A R , A 2 R , . . . . A k R R,AR,A^2R,....A^kR R,AR,A2R,....AkR 即，按此方法计算PageRank，最终会到达一个稳定状态。此状态即使最后的网页重要性排序的结果。 interpretation PageRank算法的核心是跳转矩阵 A。因为跳转矩阵 A 包含了网络中所有网页的链接关系，根据此链接关系（网页在网络中的位置），可直接推导出网页的重要性。它的每一列包含了一个网页所有的出边(outedges)，及每个出边所对应的概率。也可理解成，若用户当前位于此网页，那么下一时刻用户跳转到其他网页的概率分布。 而这个过程可以更形象地运用 Random Surfer Model来解释。Random Surfer Model模拟了用户在网络上随机浏览的概率分布。此处，随机浏览是说用户从任意的一个网页开始，按照跳转矩阵 A 中，对应网页的跳转概率分布来随机点击跳转到下一网页。用户持续重复这一行为知道被一个死循环困住。而在全过程中，每个网页被浏览的次数可以归一化为一个稳定的概率分布，这个分布即是最后的网页重要性。 Rank Sink 但是按照这个方法计算PageRank会出现一个问题，叫做 Rank Sink。网络中可能会存在由一些网页组成的子网络，这个网络只有入链接(inedges)而没有出链接，形成了一个闭环，如下图所示： 当随机浏览的用户进入这个子网络时，他将被困住，一直在这个网络的网页里循环。因此，这些网页的PageRank会趋近于无限大，而这个子网络之外的网页的PageRank会下降，造成失真。 Optimalization 一个有效的解决办法是额外加入一个Escape Term E(u)。它和R(u)一样，也是一个跳转概率分布，通过融合R(u) 和 Escape Term E(u)，死循环可以被打破。相当于，当用户陷入一个死循环时，Escape Term E(u) 提供了随机跳出此循环的可能性。融合方法如下： R ′ ( u ) = d ∑ v ∈ B v R ′ ( v ) N v + ( 1 − d ) E ( u ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ∣ ∣ R ′ ∣ ∣ 1 = 1 R^{&amp;#x27;}(u)=d\\sum_{v\\in{B_v}}\\frac{R^{&amp;#x27;}(v)}{N_v}+(1-d)E(u)\\ \\ \\ \\ \\ ||R^{&amp;#x27;}||_1=1 R′(u)=dv∈Bv​∑​Nv​R′(v)​+(1−d)E(u)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;∣∣R′∣∣1​=1 Implementation in OpenMP Motivation 此处，我使用OpenMP实现了PageRank的并行计算。 OpenMP是一个共享内存的并行计算模型，适用于多核的单节点并行。它支持多平台，计算中数据的分布与合成可以由 directives 自动处理，因此使用十分便捷，非常适合用来初步并行串行代码。 General Process 根据公式，计算PageRank的伪代码如下： 其中： S : S: S: initialization of PageRank E : E: E: Escape Term d : d: d: a scalar, accelerates convergence &amp; miantains ∣ ∣ R ∣ ∣ 1 ||R||_1 ∣∣R∣∣1​ Experiment Result 在一个有916,428个网页的网络上运行PageRank算法，在此网络中，共有5,105,039个链接。下图为并行与串行的时间对比，横轴为运行的次数，纵轴为每次运行对应的时间。为了保证客观，排除特殊情况，两个算法各独立运行15次。可以看出，并行提升了性能。 $Speedup:$1.4803 $Efficiency:$0.37 下图是 scaling factor，由于我的电脑只有四核，因此曲线的走势是合理的。 Analysis 由上面的分析可知，算法的 Speedup 非常不理想的。而这个性能的限制主要有两个因素 ： Load imbalance overheads(负载不均衡) Synchronization overheads(线程同步开销) Load imbalance overheads 上图展示了OpenMP的三种 scheduling methods： Static Dynamic Guided 具体实现时，需要根据数据的具体分布来选择合适的scheduling methods，否则可能会降低算法的性能。 首先，在原始的数据上检验不同的scheduling methods对性能的影响。结果如下： 可以看出，由于负载较为均衡，此时用chunk较小的Dynamic方法反而会增大调度开销，降低性能。 然后，随机在原始网络上选出三个网页(节点)，每个网页手动添加一百万个随机入链接，增加网络的不均衡分布。当计算这个新的strewed数据时，每个iteration的计算量会严重不均衡。各个scheduling methods的运行时间如下： 可以看出，在计算量不均衡时，使用Dynamic更有优势，避免线程空闲。 Synchronization overheads 另一个影响性能的因素是代码的并行度。由于在实现这个算法时，为了避免data races ，在每个iteration中均用了atomic operation，造成了代码同步度的底下，降低了性能。 为了解决这个问题，可以先使每个iteration仅更新改变本地值，避免data races problem，在循环结束后做一个总的final synchronized reduction，以更新最终的全局共享变量。这个操作可以避免使用 atomic operation ，提高了代码的并行度。缺点是需要大量的内存来存放本地数据 ( N × K × 8 N\\times{K}\\times{8} N×K×8)。 改进的算法与旧算法的性能对比如下： [外链图片转存失败(img-k1lzh4Xu-1562310808132)(https://upload-images.jianshu.io/upload_images/14768852-a74a2dc11776bc70.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240)] Summary PageRank: numbers &amp; importance of backlinks importance propagation: based on location in the graph structure Implementation in OpenMP: Data race Load imbalance","@type":"BlogPosting","url":"https://uzzz.org/2019/07/05/790217.html","headline":"使用OpenMP实现并分析PageRank算法","dateModified":"2019-07-05T00:00:00+08:00","datePublished":"2019-07-05T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/05/790217.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>使用OpenMP实现并分析PageRank算法</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix" data-track-view="{&quot;mod&quot;:&quot;popu_307&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/huxiyan450/article/details/94736524,&quot;}" data-track-click="{&quot;mod&quot;:&quot;popu_307&quot;,&quot;con&quot;:&quot;,https://blog.csdn.net/huxiyan450/article/details/94736524&quot;}"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-cd6c485e8b.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <h2><a id="Introduction_0"></a>Introduction</h2> 
  <h3><a id="Background_1"></a><em>Background</em></h3> 
  <p>PageRank是Google创始人Larry Page和Sergey Brin在1996年创造的算法，起源于他们在斯坦福的一个关于开发有效搜索引擎的项目。<br> 他们把万维网(World Wide Web)看作是一个巨大的文件集，在这个集中，文件与文件间有着复杂的超链接结构。因此万维网也可以抽象成一个巨大的有向图，节点代表各网页，而有向边则代表网页之间的超链接。如何通过节点在图中的位置来计算逼近它对应的重要性，是PageRank算法的主要目的。<br> 在详细讨论pageRank算法以前，需要先阐述一些有关的基础概念与定义。首先，如何把万维网抽象成一个有向图对PageRank算法至关重要。因为，万维网的link structure可以确定每个节点在整个网络中的相对位置，而这个相对位置则为后续计算它的重要性提供了信息。<br> 我们用节点(vertex)来代表网页，有向边(edge)来代表网页间的链接关系。由于网页之间的链接边(或 link)有两个方向，因此分别命名为forward link(outedge) 和 backlink(inedge)。下图示意了一个，由5个网页组成的网络的link structure：<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi0wZDhlZDdiOWIyZThiZjZkLnBuZw" alt="图1：W.W.W as a directed graph"></p> 
  <h3><a id="Principle_7"></a><em>Principle</em></h3> 
  <p>基于万维网link structure的这个结构特性，PageRank算法的核心思想应运而生。<br> 既然网页之间相互链接，那么对于一个网页而言，每一个指向它的链接(inedge)都可以类似成一个学术引用，代表了它的重要性。但是与学术引用不同，网页并没有质量控制和发表成本等门槛。因此，如果只单用inedge的数量来表示重要性的话，所得出的重要性指标会很容易被操控篡改。仅仅是靠低成本地制造大量垃圾网页，使它们指向某一特定网页，便可以增加此网页的引用数量。<br> 基于这个考虑，除了使用引用数目(inedge的数目)这个局部指标以外，还应该使用万维网的全局信息。因为涉及万维网巨大的整体结构，这部分信息难以被简单篡改，使得计算出的重要性更为robust。<br> 由观察得知，一个网页的重要与否，取决于以下两个因素：</p> 
  <ul> 
   <li>与学术引用类似，此网页是否有许多入链接，即是否很多网页都指向它</li> 
   <li>指向它的网页中，是否存在非常重要的网页。例如：某网页也许只有一个入链接，但此入链接是源自Wiki这样的权威网页<br> PageRank正是综合地考虑了网页的入链接数目这个局部指标，以及入链接网页重要性这个全局指标，来逼近一个网页的真实重要性。为了达到这一综合，此算法使用了重要性传递(rank propagation through links)这一思想，让rank依照万维网的结构动态流动直到稳定，所得的最终结果便是网页最后的重要性(或 Rank)。<br> ##PageRank Algorithm<br> ###<em>basics</em><br> <strong>PageRank的定义</strong><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
        <math>
         <semantics>
          <mrow>
           <mi>
            R
           </mi>
           <mo>
            (
           </mo>
           <mi>
            u
           </mi>
           <mo>
            )
           </mo>
           <mo>
            =
           </mo>
           <mi>
            c
           </mi>
           <munder>
            <mo>
             ∑
            </mo>
            <mrow>
             <mi>
              v
             </mi>
             <mo>
              ∈
             </mo>
             <msub>
              <mi>
               B
              </mi>
              <mi>
               u
              </mi>
             </msub>
            </mrow>
           </munder>
           <mfrac>
            <mrow>
             <mi>
              R
             </mi>
             <mo>
              (
             </mo>
             <mi>
              v
             </mi>
             <mo>
              )
             </mo>
            </mrow>
            <msub>
             <mi>
              N
             </mi>
             <mi>
              v
             </mi>
            </msub>
           </mfrac>
          </mrow>
          <annotation encoding="application/x-tex">
           R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v}
          </annotation>
         </semantics>
        </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.82144em; vertical-align: -1.39444em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.05017em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.39444em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           u
          </mi>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          u:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit">u</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>某一个网页<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           R
          </mi>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          R:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>此网页对应的PageRank值(此公式算出的PageRank为naive版本)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           c
          </mi>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          c:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>归一化系数<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            B
           </mi>
           <mi>
            u
           </mi>
          </msub>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          B_u:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.05017em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>指向网页u的网页集合<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            N
           </mi>
           <mi>
            u
           </mi>
          </msub>
          <mo>
           =
          </mo>
          <mi mathvariant="normal">
           ∣
          </mi>
          <msub>
           <mi>
            F
           </mi>
           <mi>
            u
           </mi>
          </msub>
          <mi mathvariant="normal">
           ∣
          </mi>
         </mrow>
         <annotation encoding="application/x-tex">
          N_u=|F_u|
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            F
           </mi>
           <mi>
            u
           </mi>
          </msub>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          F_u:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span>网页u指向的网页集合<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi04ZDQ3NWM4ZjczZDZiMTRjLnBuZw" alt="图2"></li> 
  </ul> 
  <p>如上图中:<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           B
          </mi>
          <mn>
           2
          </mn>
         </msub>
         <mo>
          =
         </mo>
         <mo>
          {
         </mo>
         <mn>
          1
         </mn>
         <mo separator="true">
          ,
         </mo>
         <mn>
          3
         </mn>
         <mo>
          }
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         B_2=\{1, 3\}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.05017em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">3</span><span class="mclose">}</span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           F
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo>
          =
         </mo>
         <mo>
          {
         </mo>
         <mn>
          2
         </mn>
         <mo separator="true">
          ,
         </mo>
         <mn>
          4
         </mn>
         <mo>
          }
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         F_1=\{2, 4\}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">4</span><span class="mclose">}</span></span></span></span></span><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           N
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mo>
          =
         </mo>
         <mi mathvariant="normal">
          ∣
         </mi>
         <msub>
          <mi>
           F
          </mi>
          <mn>
           1
          </mn>
         </msub>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mo>
          =
         </mo>
         <mn>
          2
         </mn>
        </mrow>
        <annotation encoding="application/x-tex">
         N_1=|F_1|=2
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span></p> 
  <h3><a id="Matrix_Representation_31"></a><em>Matrix Representation</em></h3> 
  <p>为了能够高效地计算网络里各个网页的PageRank，需要把上一节中公式表达成矩阵运算形式。<br> 首先，假设网络中一共包含了<strong>N</strong> 个网页。设 <strong>R</strong> 为一个向量，一共包含 <strong>N</strong> 个entries，它的每个entry均存储了对应网页的PageRank值。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            R
           </mi>
           <mrow>
            <mi>
             N
            </mi>
            <mo>
             ×
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo>
           :
          </mo>
         </mrow>
         <annotation encoding="application/x-tex">
          R_{N\times{1}}:
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.00773em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.10903em;">N</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span></span>一个数组，负责存储每个网页的PageRank。<br> 设一矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           A
          </mi>
          <mrow>
           <mi>
            N
           </mi>
           <mo>
            ×
           </mo>
           <mi>
            N
           </mi>
          </mrow>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         A_{N\times{N}}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.10903em;">N</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.10903em;">N</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，它存储了网络任意两个网页间的链接关系。<br> <span class="katex--display">KaTeX parse error: No such environment: eqnarray at position 7: \begin{̲e̲q̲n̲a̲r̲r̲a̲y̲}̲A_{u,{v}}=\begi…</span><br> 例如下图三中的网络所对应的矩阵 <strong>A</strong> 为：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190705151933475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1eGl5YW40NTA=,size_16,color_FFFFFF,t_70" alt="图三"><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            A
           </mi>
           <mrow>
            <mn>
             4
            </mn>
            <mo>
             ×
            </mo>
            <mn>
             4
            </mn>
           </mrow>
          </msub>
          <mo>
           =
          </mo>
          <mrow>
           <mo fence="true">
            [
           </mo>
           <mtable>
            <mtr>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mfrac>
                <mn>
                 1
                </mn>
                <mn>
                 3
                </mn>
               </mfrac>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
            </mtr>
            <mtr>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mfrac>
                <mn>
                 1
                </mn>
                <mn>
                 2
                </mn>
               </mfrac>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mfrac>
                <mn>
                 1
                </mn>
                <mn>
                 3
                </mn>
               </mfrac>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
            </mtr>
            <mtr>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                1
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
            </mtr>
            <mtr>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mfrac>
                <mn>
                 1
                </mn>
                <mn>
                 2
                </mn>
               </mfrac>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                0
               </mn>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mfrac>
                <mn>
                 1
                </mn>
                <mn>
                 3
                </mn>
               </mfrac>
              </mstyle>
             </mtd>
             <mtd>
              <mstyle scriptlevel="0" displaystyle="false">
               <mn>
                1
               </mn>
              </mstyle>
             </mtd>
            </mtr>
           </mtable>
           <mo fence="true">
            ]
           </mo>
          </mrow>
         </mrow>
         <annotation encoding="application/x-tex">
          A_{4\times{4}}=\left[ \begin{matrix}0 &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 0 \\ 0 &amp;amp; 1 &amp;amp; 0 &amp;amp; 0 \\ \frac{1}{2} &amp;amp; 0 &amp;amp; \frac{1}{3} &amp;amp; 1 \end{matrix} \right]
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mtight">4</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 4.81532em; vertical-align: -2.15766em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎣</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎢</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎡</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65766em;"><span class="" style="top: -4.81255em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -3.60745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -2.40745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.20234em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15766em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65766em;"><span class="" style="top: -4.81255em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -3.60745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.40745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span><span class="" style="top: -1.20234em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15766em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65766em;"><span class="" style="top: -4.81255em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -3.60745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -2.40745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.20234em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.845108em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15766em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65766em;"><span class="" style="top: -4.81255em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -3.60745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -2.40745em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">0</span></span></span><span class="" style="top: -1.20234em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15766em;"><span class=""></span></span></span></span></span></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.65201em;"><span class="" style="top: -1.64999em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎦</span></span></span><span class="" style="top: -2.80499em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -3.40599em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎥</span></span></span><span class="" style="top: -4.65201em;"><span class="pstrut" style="height: 3.155em;"></span><span class="delimsizinginner delim-size4"><span class="">⎤</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.15003em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span></p> 
  <h3><a id="Computation_Process_48"></a><em>Computation Process</em></h3> 
  <p>在有了矩阵表达后，原先计算PageRank的公式可以进行如下转换：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           R
          </mi>
          <mo>
           (
          </mo>
          <mi>
           u
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           c
          </mi>
          <munder>
           <mo>
            ∑
           </mo>
           <mrow>
            <mi>
             v
            </mi>
            <mo>
             ∈
            </mo>
            <msub>
             <mi>
              B
             </mi>
             <mi>
              u
             </mi>
            </msub>
           </mrow>
          </munder>
          <mfrac>
           <mrow>
            <mi>
             R
            </mi>
            <mo>
             (
            </mo>
            <mi>
             v
            </mi>
            <mo>
             )
            </mo>
           </mrow>
           <msub>
            <mi>
             N
            </mi>
            <mi>
             v
            </mi>
           </msub>
          </mfrac>
          <mtext>
           &nbsp;&nbsp;
          </mtext>
          <mo>
           ⟹
          </mo>
          <mtext>
           &nbsp;&nbsp;
          </mtext>
          <mi>
           R
          </mi>
          <mo>
           =
          </mo>
          <mi>
           c
          </mi>
          <mi>
           A
          </mi>
          <mi>
           R
          </mi>
         </mrow>
         <annotation encoding="application/x-tex">
          R(u)=c\sum_{v\in{B_u}}\frac{R(v)}{N_v}\ \ \Longrightarrow\ \ R=cAR
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.82144em; vertical-align: -1.39444em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.05017em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">u</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.39444em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span><span class="mrel">⟹</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit">c</span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span></span><br> 因此，在实际计算时，可以反复循环计算 <strong>R</strong>，直到收敛。即：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            R
           </mi>
           <mrow>
            <mi>
             i
            </mi>
            <mo>
             +
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msub>
          <mo>
           =
          </mo>
          <mi>
           c
          </mi>
          <mi>
           A
          </mi>
          <msub>
           <mi>
            R
           </mi>
           <mi>
            i
           </mi>
          </msub>
         </mrow>
         <annotation encoding="application/x-tex">
          R_{i+1}=cAR_i
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.891661em; vertical-align: -0.208331em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.00773em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord mathit">c</span><span class="mord mathit">A</span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: -0.00773em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 由 <strong>Power method convergence theorem</strong>可知，由于矩阵 <strong>A</strong><br> 可以看作是一个跳转概率矩阵，其每列都是一个网页对应的跳转概率分布，因此如下数列收敛：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           R
          </mi>
          <mo separator="true">
           ,
          </mo>
          <mi>
           A
          </mi>
          <mi>
           R
          </mi>
          <mo separator="true">
           ,
          </mo>
          <msup>
           <mi>
            A
           </mi>
           <mn>
            2
           </mn>
          </msup>
          <mi>
           R
          </mi>
          <mo separator="true">
           ,
          </mo>
          <mi mathvariant="normal">
           .
          </mi>
          <mi mathvariant="normal">
           .
          </mi>
          <mi mathvariant="normal">
           .
          </mi>
          <mi mathvariant="normal">
           .
          </mi>
          <msup>
           <mi>
            A
           </mi>
           <mi>
            k
           </mi>
          </msup>
          <mi>
           R
          </mi>
         </mrow>
         <annotation encoding="application/x-tex">
          R,AR,A^2R,....A^kR
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.09355em; vertical-align: -0.19444em;"></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathit">A</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mord"><span class="mord mathit">A</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.899108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03148em;">k</span></span></span></span></span></span></span></span><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span></span><br> 即，按此方法计算PageRank，最终会到达一个稳定状态。此状态即使最后的网页重要性排序的结果。</p> 
  <h3><a id="interpretation_57"></a><em>interpretation</em></h3> 
  <p>PageRank算法的核心是跳转矩阵 <strong>A</strong>。因为跳转矩阵 <strong>A</strong> 包含了网络中所有网页的链接关系，根据此链接关系（网页在网络中的位置），可直接推导出网页的重要性。它的每一列包含了一个网页所有的出边(outedges)，及每个出边所对应的概率。也可理解成，若用户当前位于此网页，那么下一时刻用户跳转到其他网页的概率分布。<br> 而这个过程可以更形象地运用 <strong>Random Surfer Model</strong>来解释。<strong>Random Surfer Model</strong>模拟了用户在网络上随机浏览的概率分布。此处，随机浏览是说用户从任意的一个网页开始，按照跳转矩阵 <strong>A</strong> 中，对应网页的跳转概率分布来随机点击跳转到下一网页。用户持续重复这一行为知道被一个死循环困住。而在全过程中，每个网页被浏览的次数可以归一化为一个稳定的概率分布，这个分布即是最后的网页重要性。</p> 
  <h3><a id="Rank_Sink_60"></a><em>Rank Sink</em></h3> 
  <p>但是按照这个方法计算PageRank会出现一个问题，叫做 <strong>Rank Sink</strong>。网络中可能会存在由一些网页组成的子网络，这个网络只有入链接(inedges)而没有出链接，形成了一个闭环，如下图所示：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190705152027971.png" alt="https://goo.gl/images/4hnXVL"><br> 当随机浏览的用户进入这个子网络时，他将被困住，一直在这个网络的网页里循环。因此，这些网页的PageRank会趋近于无限大，而这个子网络之外的网页的PageRank会下降，造成失真。</p> 
  <h3><a id="Optimalization_64"></a><em>Optimalization</em></h3> 
  <p>一个有效的解决办法是额外加入一个<strong>Escape Term E(u)</strong>。它和<strong>R(u)<strong>一样，也是一个跳转概率分布，通过融合</strong>R(u)</strong> 和 <strong>Escape Term E(u)</strong>，死循环可以被打破。相当于，当用户陷入一个死循环时，<strong>Escape Term E(u)</strong> 提供了随机跳出此循环的可能性。融合方法如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msup>
           <mi>
            R
           </mi>
           <msup>
            <mrow></mrow>
            <mo mathvariant="normal">
             ′
            </mo>
           </msup>
          </msup>
          <mo>
           (
          </mo>
          <mi>
           u
          </mi>
          <mo>
           )
          </mo>
          <mo>
           =
          </mo>
          <mi>
           d
          </mi>
          <munder>
           <mo>
            ∑
           </mo>
           <mrow>
            <mi>
             v
            </mi>
            <mo>
             ∈
            </mo>
            <msub>
             <mi>
              B
             </mi>
             <mi>
              v
             </mi>
            </msub>
           </mrow>
          </munder>
          <mfrac>
           <mrow>
            <msup>
             <mi>
              R
             </mi>
             <msup>
              <mrow></mrow>
              <mo mathvariant="normal">
               ′
              </mo>
             </msup>
            </msup>
            <mo>
             (
            </mo>
            <mi>
             v
            </mi>
            <mo>
             )
            </mo>
           </mrow>
           <msub>
            <mi>
             N
            </mi>
            <mi>
             v
            </mi>
           </msub>
          </mfrac>
          <mo>
           +
          </mo>
          <mo>
           (
          </mo>
          <mn>
           1
          </mn>
          <mo>
           −
          </mo>
          <mi>
           d
          </mi>
          <mo>
           )
          </mo>
          <mi>
           E
          </mi>
          <mo>
           (
          </mo>
          <mi>
           u
          </mi>
          <mo>
           )
          </mo>
          <mtext>
           &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </mtext>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mi mathvariant="normal">
           ∣
          </mi>
          <msup>
           <mi>
            R
           </mi>
           <msup>
            <mrow></mrow>
            <mo mathvariant="normal">
             ′
            </mo>
           </msup>
          </msup>
          <mi mathvariant="normal">
           ∣
          </mi>
          <msub>
           <mi mathvariant="normal">
            ∣
           </mi>
           <mn>
            1
           </mn>
          </msub>
          <mo>
           =
          </mo>
          <mn>
           1
          </mn>
         </mrow>
         <annotation encoding="application/x-tex">
          R^{&amp;#x27;}(u)=d\sum_{v\in{B_v}}\frac{R^{&amp;#x27;}(v)}{N_v}+(1-d)E(u)\ \ \ \ \ ||R^{&amp;#x27;}||_1=1
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1.24248em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.99248em;"><span class="" style="top: -2.99248em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.57948em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.01392em; vertical-align: -1.39444em;"></span><span class="mord mathit">d</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.85566em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span><span class="mrel mtight">∈</span><span class="mord mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.05017em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.39444em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.61948em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right: 0.03588em;">v</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.94248em;"><span class="" style="top: -2.94248em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.57948em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit" style="margin-right: 0.03588em;">v</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.24248em; vertical-align: -0.25em;"></span><span class="mord mathit">d</span><span class="mclose">)</span><span class="mord mathit" style="margin-right: 0.05764em;">E</span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mclose">)</span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span><span class="mspace">&nbsp;</span><span class="mord">∣</span><span class="mord">∣</span><span class="mord"><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.99248em;"><span class="" style="top: -2.99248em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.57948em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.827829em;"><span class="" style="top: -2.931em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span></span></p> 
  <h2><a id="Implementation_in_OpenMP_67"></a>Implementation in OpenMP</h2> 
  <h3><a id="Motivation_68"></a><em>Motivation</em></h3> 
  <p>此处，我使用OpenMP实现了PageRank的并行计算。<br> OpenMP是一个共享内存的并行计算模型，适用于多核的单节点并行。它支持多平台，计算中数据的分布与合成可以由 <strong>directives</strong> 自动处理，因此使用十分便捷，非常适合用来初步并行串行代码。</p> 
  <h3><a id="General_Process_71"></a><em>General Process</em></h3> 
  <p>根据公式，计算PageRank的伪代码如下：<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi1mYmZkNmU3ZTNiZWIwOWZkLnBuZw" alt="pseudo code"><br> 其中：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          S
         </mi>
         <mo>
          :
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         S:
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span> initialization of PageRank<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          E
         </mi>
         <mo>
          :
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         E:
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathit" style="margin-right: 0.05764em;">E</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span> Escape Term<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          d
         </mi>
         <mo>
          :
         </mo>
        </mrow>
        <annotation encoding="application/x-tex">
         d:
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">:</span></span></span></span></span> a scalar, accelerates convergence &amp; miantains <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <mi>
          R
         </mi>
         <mi mathvariant="normal">
          ∣
         </mi>
         <msub>
          <mi mathvariant="normal">
           ∣
          </mi>
          <mn>
           1
          </mn>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         ||R||_1
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">∣</span><span class="mord">∣</span><span class="mord mathit" style="margin-right: 0.00773em;">R</span><span class="mord">∣</span><span class="mord"><span class="mord">∣</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></p> 
  <h3><a id="Experiment_Result_78"></a><em>Experiment Result</em></h3> 
  <p>在一个有916,428个网页的网络上运行PageRank算法，在此网络中，共有5,105,039个链接。下图为并行与串行的时间对比，横轴为运行的次数，纵轴为每次运行对应的时间。为了保证客观，排除特殊情况，两个算法各独立运行15次。可以看出，并行提升了性能。<br> $Speedup:$1.4803<br> $Efficiency:$0.37<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi0yNWFhMzFkYzYzZjU2NzUyLnBuZw" alt="串行 vs. 并行"><br> 下图是 <strong>scaling factor</strong>，由于我的电脑只有四核，因此曲线的走势是合理的。<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi00MTQwM2FhZWFlOTdhYTc1LnBuZw" alt="scaling factor"></p> 
  <h3><a id="Analysis_85"></a><em>Analysis</em></h3> 
  <p>由上面的分析可知，算法的 <strong>Speedup</strong> 非常不理想的。而这个性能的限制主要有两个因素 ：</p> 
  <ul> 
   <li> <p>Load imbalance overheads(负载不均衡)</p> </li> 
   <li> <p>Synchronization overheads(线程同步开销)</p> </li> 
  </ul> 
  <h4><a id="Load_imbalance_overheads_90"></a><em>Load imbalance overheads</em></h4> 
  <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi04MDI3ZmZhMzA3Y2VjOTZiLnBuZw" alt="scheduling methods"><br> 上图展示了OpenMP的三种 <strong>scheduling methods</strong>：</p> 
  <ul> 
   <li>Static</li> 
   <li>Dynamic</li> 
   <li>Guided<br> 具体实现时，需要根据数据的具体分布来选择合适的scheduling methods，否则可能会降低算法的性能。<br> 首先，在原始的数据上检验不同的scheduling methods对性能的影响。结果如下：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019070515213757.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2h1eGl5YW40NTA=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 可以看出，由于负载较为均衡，此时用chunk较小的Dynamic方法反而会增大调度开销，降低性能。<br> 然后，随机在原始网络上选出三个网页(节点)，每个网页手动添加一百万个随机入链接，增加网络的不均衡分布。当计算这个新的strewed数据时，每个iteration的计算量会严重不均衡。各个scheduling methods的运行时间如下：<br> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8xNDc2ODg1Mi1jMDBkYmIyNjQ3ZWJmODE2LnBuZw" alt="imbalance data"><br> 可以看出，在计算量不均衡时，使用Dynamic更有优势，避免线程空闲。</li> 
  </ul> 
  <h4><a id="Synchronization_overheads_103"></a><em>Synchronization overheads</em></h4> 
  <p>另一个影响性能的因素是代码的并行度。由于在实现这个算法时，为了避免<strong>data races</strong> ，在每个iteration中均用了<strong>atomic operation</strong>，造成了代码同步度的底下，降低了性能。<br> 为了解决这个问题，可以先使每个iteration仅更新改变本地值，避免<strong>data races problem</strong>，在循环结束后做一个总的final synchronized reduction，以更新最终的全局共享变量。这个操作可以避免使用 <strong>atomic operation</strong> ，提高了代码的并行度。缺点是需要大量的内存来存放本地数据 (<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          N
         </mi>
         <mo>
          ×
         </mo>
         <mi>
          K
         </mi>
         <mo>
          ×
         </mo>
         <mn>
          8
         </mn>
        </mrow>
        <annotation encoding="application/x-tex">
         N\times{K}\times{8}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathit" style="margin-right: 0.10903em;">N</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord"><span class="mord mathit" style="margin-right: 0.07153em;">K</span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord"><span class="mord">8</span></span></span></span></span></span>)。<br> 改进的算法与旧算法的性能对比如下：<br> [外链图片转存失败(img-k1lzh4Xu-1562310808132)(<a href="https://upload-images.jianshu.io/upload_images/14768852-a74a2dc11776bc70.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" rel="nofollow">https://upload-images.jianshu.io/upload_images/14768852-a74a2dc11776bc70.png?imageMogr2/auto-orient/strip|imageView2/2/w/1240</a>)]</p> 
  <h2><a id="Summary_108"></a>Summary</h2> 
  <h4><a id="PageRank_109"></a>PageRank:</h4> 
  <ul> 
   <li>numbers &amp; importance of backlinks</li> 
   <li>importance propagation:<br> based on location in the graph structure</li> 
  </ul> 
  <h4><a id="Implementation_in_OpenMP_113"></a>Implementation in OpenMP:</h4> 
  <ul> 
   <li>Data race</li> 
   <li>Load imbalance</li> 
  </ul> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
