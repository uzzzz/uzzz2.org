<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>jmeter接口自动化测试环境部署（ant+jmeter+jenkins+svn+钉钉） | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="jmeter接口自动化测试环境部署（ant+jmeter+jenkins+svn+钉钉）" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="jmeter接口自动化测试环境部署 注意：以下内容适应用于公司测试团队小，同时技术不足以开发或者不愿意投入时间精力开发接口自动化测试平台的测试团队。同时本文章内容是使用docker技术实现搭建，当然如果公司没有使用docker技术的也适用。将docker镜像看作是一台服务器即可。但是docker并不是虚拟机。他只是服务器中的一个进程。请读者不要混淆。 另外需要该文章pdf版本的读者可在百度网盘下载 链接:https://pan.baidu.com/s/1N7lkkh29YZgPB4RJF8Ywvg 密码:rked 一、概述 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmeter是做API和性能测试的一把利器。也是接口自动化测试的一种非常棒的一款开源的测试软件。本次接口自动化的环境搭建主要围绕着jmeter展开。主要用到的工具／应用程序有：jmeter+ant+apache／tomcat+jenkins+DingDing+SVN。搭建自动化测试环境的时候注意，无论是任何的框架或者说是架构都是围绕着简单、易用、功能强大三个特点来开展的。所以我们要做的就是尽可能能的减少重复性的操作。让使用者能够节省时间的同时尽可能的保证该架构的稳定性。 结构图如下： 注意：该内容讲解的所有内容均在docker镜像中操作、如果有自己服务器的同学可以直接使用服务器进行操作 二、环境准备环境搭建 （一）Linux docker环境搭建 1、centos安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;如果linux环境中安装了yum工具包那么直接使用yum install docker便可以直接安装了，在安装过程中如果询问直接‘y’就好 使用docker --version可以查看当前的docker版本 2、ubuntu安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;前提条件：Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的 Ubuntu 版本是否支持 Docker。 通过 uname -r 命令查看你当前的内核版本 检查完版本后在命令行中输入wget -qO- https://get.docker.com/ | sh 输入当前用户的密码后，就会下载脚本并且安装Docker及依赖包。 安装完成后有个提示： If you would like to use Docker as a non-root user, you should now consider adding your user to the &quot;docker&quot; group with something like: sudo usermod -aG docker runoob Remember that you will have to log out and back in for this to take effect! 使用docker --version可以查看当前的docker版本 3、启动docker service docker start 4、下载linux镜像文件 5、搜索镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;搜索ssh镜像文件docker search ssh 6、下载镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载镜像文件到本地 docker pull jdeathe/centos-ssh 7、检查与查看 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看镜像文件是否下载成功 docker images 8、运行docker镜像并开启所需端口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1)运行镜像 “docker run -it --name jmeterTest -d -p 7890:8080 -p 7891:22 -p 7892:80 jdeathe/centos-ssh”此命令会运行docker仓库中的jdeathe/centos-ssh镜像并重新命名为jmeterTest 并且会将镜像中的8080、22、80端口映射到docker宿主机的7890、7891、7892上。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2)查看正在运行的docker镜像 “docker ps” &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3)进入docker镜像内执行sh命令 “docker exec -it jmeterTest bash”，如果此时发现主机名称变成了12位的字符便成功了，不过你会发现字符是你启动docker镜像的时候返回给你的前12位字符 （二）、安装JDK 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html， 2、上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter压缩包上传到服务器，由于docker下载的镜像是比较干净的镜像所以有很多我们常见的命令不能执行，需要我们手动的去下载。所以先使用rz或者scp命令将压缩包上传到宿主机，退到宿主机只要执行exit命令就可以了 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JAVA_HOME”环境变量，并修改完后让配置立即生效 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看java版本 java -version （三）、安装jmeter 1、下载jmeter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：http://jmeter.apache.org/download_jmeter.cgi。在jmeter官网中有两处下载：Binaries为jmeter应用程序下载。Source为源码下载。下载的时候可以在Binaries处自己选择想要下载的格式，.tgz和.zip。这里我选择第一个.tgz。（两个是一样的，下载后只是解压格式不一样） 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JMTER_HOME”环境变量，并修改完后让配置立即生效 （四）、安装ANT 1、下载ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：https://ant.apache.org/bindownload.cgi 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“ANT_HOME”环境变量，并修改完后让配置立即生效 3、配置ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter目录下的ant-jmeter-1.1.1.jar文件复制到ANT文件夹的lib目录下 （五）、安装svn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install subversion安装完成后svn --version查看当前svn版本 （六）、安装apache 1、安装 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install -y httpd 暗转完成后输入httpd -v查看当前版本 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看完当前版本后访问该镜像，【http://ip地址:端口】 （七）、安装jenkins 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址 ：https://jenkins.io/download/ 选择一个与自己docker镜像相匹配的jenkins包，或者下载java的版本。这里为了教学方便所以选择下载java版本 2、将jenkins包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jenkins包文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行jenkins 3、jenkins基础配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;启动后访问地址：http://ip地址:7890/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;根据jenkins提示在docker镜像中找到对应路径文件，并打开复制内容，黏贴。黏贴后安装推介的插件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;创建初始化帐号（最高权限） 三、文件环境准备 （一）、文件目录准备 1、svn新建jmeterCase &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建jmeterCase文件夹用于存放jmeter自动化测试脚本 （二）、jmeter脚本数据准备 （三）、ANT数据文件准备 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个.xml的ANT编译文件内容格式如下 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!--Project为整个量的根目录；name随便写,可自行更改；default默认执行什么任务,下面有个target name = &quot;all&quot;；basedir为.代表当前目录--&gt; &lt;project name=&quot;jmeter_test&quot; default=&quot;all&quot; basedir=&quot;/var/www/jmeterCase/case/&quot;&gt; &lt;tstamp&gt; &lt;!-- 这里是加入了年月日时分秒,用来加在报告的后缀上--&gt; &lt;format property=&quot;time&quot; pattern=&quot;yyyyMMddhhmmss&quot; /&gt; &lt;/tstamp&gt; &lt;!-- 需要改成自己本地的 Jmeter 目录,写到bin目录的上一步就可以--&gt; &lt;property name=&quot;jmeter.home&quot; value=&quot;/home/ubuntu/softWare/qjclouds/apache-jmeter-5.0&quot; /&gt; &lt;!-- jmeter生成jtl格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.jtl.dir&quot; value=&quot;/var/www/jmeterCase/report/jtl&quot; /&gt; &lt;!-- jmeter生成html格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.html.dir&quot; value=&quot;/var/www/html/report&quot; /&gt; &lt;!-- 生成的报告的前缀ReportName的value可以自定义值,下面的jtl和html的名字是用变量来的也不需要改 --&gt; &lt;property name=&quot;ReportName&quot; value=&quot;${caseName}&quot; /&gt; &lt;property name=&quot;jmeter.result.jtlName&quot; value=&quot;${jmeter.result.jtl.dir}/${ReportName}${time}.jtl&quot; /&gt; &lt;property name=&quot;jmeter.result.htmlName&quot; value=&quot;${jmeter.result.html.dir}/${ReportName}${time}.html&quot; /&gt; &lt;!-- 接收测试报告的邮箱,不用这个发邮件，可以删除 --&gt; &lt;property name=&quot;mail_to&quot; value=&quot;xxxx@xxxxx.com&quot; /&gt; &lt;!-- 电脑地址,也不用，可以删除 --&gt; &lt;property name=&quot;ComputerName&quot; value=&quot;Admin&quot; /&gt; &lt;!-- 对应到上面的，default为all，下面调用了两个：test和report--&gt; &lt;target name=&quot;all&quot;&gt; &lt;antcall target=&quot;test&quot; /&gt; &lt;antcall target=&quot;report&quot; /&gt; &lt;/target&gt; &lt;!-- 对应到上面的target为test --&gt; &lt;target name=&quot;test&quot;&gt; &lt;taskdef name=&quot;jmeter&quot; classname=&quot;org.programmerplanet.ant.taskdefs.jmeter.JMeterTask&quot; /&gt; &lt;jmeter jmeterhome=&quot;${jmeter.home}&quot; resultlog=&quot;${jmeter.result.jtlName}&quot;&gt; &lt;!-- 声明要运行的脚本。&quot;*.jmx&quot;指包含此目录下的所有jmeter脚本,脚本要执行某一个就写死哪个 --&gt; &lt;testplans dir=&quot;/var/www/jmeterCase/case&quot; includes=&quot;${caseName}.jmx&quot; /&gt; &lt;property name=&quot;jmeter.save.saveservice.output_format&quot; value=&quot;xml&quot;/&gt; &lt;/jmeter&gt; &lt;/target&gt; &lt;path id=&quot;xslt.classpath&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;xalan*.jar&quot;/&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;serializer*.jar&quot;/&gt; &lt;/path&gt; &lt;!-- 对应到上面的target为report --&gt; &lt;target name=&quot;report&quot;&gt; &lt;tstamp&gt;&lt;format property=&quot;report.datestamp&quot; pattern=&quot;yyyy/MM/dd HH:mm&quot;/&gt;&lt;/tstamp&gt; &lt;xslt classpathref=&quot;xslt.classpath&quot; force=&quot;true&quot; in=&quot;${jmeter.result.jtlName}&quot; out=&quot;${jmeter.result.htmlName}&quot; style=&quot;${jmeter.home}/extras/jmeter.results.shanhe.me.xsl&quot; &gt; &lt;param name=&quot;dateReport&quot; expression=&quot;${report.datestamp}&quot;/&gt; &lt;/xslt&gt; &lt;!-- 因为上面生成报告的时候，不会将相关的图片也一起拷贝至目标目录，所以，需要手动拷贝 --&gt; &lt;copy todir=&quot;${jmeter.result.html.dir}&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/extras&quot;&gt; &lt;include name=&quot;collapse.png&quot; /&gt; &lt;include name=&quot;expand.png&quot; /&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;/target&gt; &lt;!-- 发送邮件 --&gt; &lt;/project&gt; 注意：这里个modle的脚本文件名称用${caseName}代替了 （四）DINGDING文件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;因为整个自动化结构都是由钉钉通知的所以首先要对钉钉消息进行模版化。在新建模版化json文件之前，我们需要先在DingDing上创建一个群，并在群内开启一个钉钉机器人，新建一个json文件内容如下： { &quot;msgtype&quot;: &quot;link&quot;, &quot;link&quot;: { &quot;text&quot;: &quot;jmeter编译成功&quot;, &quot;title&quot;: &quot;接口自动化环境通知！！！&quot;, &quot;picUrl&quot;: &quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1547116083262&amp;di=a123ecc9c1ae1b57809a51e83a81369a&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180623%2Fa55f0483026a41bf861e3c82afb7b9b4.jpeg&quot;, &quot;messageUrl&quot;: &quot;http://xxx.xxx.xxx.xxx/report/${html}&quot; } } 注意：这里个modle的脚本文件名称用${caseName}代替了 （五）、文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter脚本名称与ANT编译文件名称改为一致的文件名称例如：demo.xml、demo.jmx。改完名称后将jmeter脚本上传到jmeterCase文件夹下case文件夹。 （六）、服务器文件目录准备 1、新建文件夹bin、DingDing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;命令：mkdir 目录名称 2、模版文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将demo.xml、demo.json文件上传到bin目录 3、检出jmeterCase目录 四、sh命令准备 （一）、创建新的ANT启动.xml文件sh 内容如下： home=/var/www cp ${home}/bin/demo.xml ${home}/bin/$1.xml sed -i -e &#39;s/${caseName}/&#39;$1&#39;/g&#39; ${home}/bin/$1.xml mv ${home}/bin/$1.xml ${home}/jmeterCase/case/$1.xml svn add ${home}/jmeterCase/case/$1.xml svn commit -m 新增$1.xml文件 ${home}/jmeterCase/case/$1.xml （二）、发送钉钉消息sh 内容如下： #定义jmeter自动化home文件夹 home=/var/www if [ ! -f ${home}/jmeterCase/case/&quot;$1&quot;.xml ]; then sh -x ${home}/bin/createAntXML.sh $1 fi #更新html报告文件夹 svn up ${home}/html/ #更新用例文件夹 svn up ${home}/jmeterCase/ #调用ant执行jmeter脚本并生成报告 ant -f ${home}/jmeterCase/case/$1.xml #创建随机变量文件名 random=${RANDOM} #遍历report目录下以参数$1开头的文件并排序，将内容吧写入到随机文件 ls -t ${home}/html/report | grep $1 &gt;&gt;${home}/html/report/${random}.txt #读取随机文件的第一行文本 file=$(head -1 $home/html/report/${random}.txt) #删除随机文件 rm -rf ${home}/html/report/${random}.txt #删除钉钉消息文件 rm -rf ${home}/DingDing/$1.json #复制消息文件 cp ${home}/DingDing/msg.json ${home}/DingDing/$1.json #替换url sed -i -e &#39;s/${html}/&#39;${file}&#39;/g&#39; ${home}/DingDing/$1.json #替换消息标题 sed -i -e &#39;s/jmeter编译成功/【&#39;$1&#39;】jmeter脚本编译成功，点击查阅：http:\/\/111.230.223.145\/report\/&#39;$file&#39;/g&#39; ${home}/DingDing/$1.json #读取json文件 json=$(head -n 100 ${home}/DingDing/$1.json) #发送钉钉消息 if [ $(grep -c &quot;class=\&quot;failure\&quot;&quot; ${home}/html/report/${file}) -eq 1 ]; then curl https://oapi.dingtalk.com/robot/send?access_token=992debb70f5fe66037383d5e7635e99cdc1608957affc6c4256127b500526c5a -H &#39;Content-Type: application/json&#39; -H &quot;Data_Type:msg&quot; -X POST -d &quot;${json}&quot; fi 注意：最后发送钉钉消息时将之前创建的DingDing机器人的token换成自己的“access_token” 五、jenkins配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个job &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;配置参数化构建 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;添加需要执行的命令" />
<meta property="og:description" content="jmeter接口自动化测试环境部署 注意：以下内容适应用于公司测试团队小，同时技术不足以开发或者不愿意投入时间精力开发接口自动化测试平台的测试团队。同时本文章内容是使用docker技术实现搭建，当然如果公司没有使用docker技术的也适用。将docker镜像看作是一台服务器即可。但是docker并不是虚拟机。他只是服务器中的一个进程。请读者不要混淆。 另外需要该文章pdf版本的读者可在百度网盘下载 链接:https://pan.baidu.com/s/1N7lkkh29YZgPB4RJF8Ywvg 密码:rked 一、概述 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmeter是做API和性能测试的一把利器。也是接口自动化测试的一种非常棒的一款开源的测试软件。本次接口自动化的环境搭建主要围绕着jmeter展开。主要用到的工具／应用程序有：jmeter+ant+apache／tomcat+jenkins+DingDing+SVN。搭建自动化测试环境的时候注意，无论是任何的框架或者说是架构都是围绕着简单、易用、功能强大三个特点来开展的。所以我们要做的就是尽可能能的减少重复性的操作。让使用者能够节省时间的同时尽可能的保证该架构的稳定性。 结构图如下： 注意：该内容讲解的所有内容均在docker镜像中操作、如果有自己服务器的同学可以直接使用服务器进行操作 二、环境准备环境搭建 （一）Linux docker环境搭建 1、centos安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;如果linux环境中安装了yum工具包那么直接使用yum install docker便可以直接安装了，在安装过程中如果询问直接‘y’就好 使用docker --version可以查看当前的docker版本 2、ubuntu安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;前提条件：Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的 Ubuntu 版本是否支持 Docker。 通过 uname -r 命令查看你当前的内核版本 检查完版本后在命令行中输入wget -qO- https://get.docker.com/ | sh 输入当前用户的密码后，就会下载脚本并且安装Docker及依赖包。 安装完成后有个提示： If you would like to use Docker as a non-root user, you should now consider adding your user to the &quot;docker&quot; group with something like: sudo usermod -aG docker runoob Remember that you will have to log out and back in for this to take effect! 使用docker --version可以查看当前的docker版本 3、启动docker service docker start 4、下载linux镜像文件 5、搜索镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;搜索ssh镜像文件docker search ssh 6、下载镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载镜像文件到本地 docker pull jdeathe/centos-ssh 7、检查与查看 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看镜像文件是否下载成功 docker images 8、运行docker镜像并开启所需端口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1)运行镜像 “docker run -it --name jmeterTest -d -p 7890:8080 -p 7891:22 -p 7892:80 jdeathe/centos-ssh”此命令会运行docker仓库中的jdeathe/centos-ssh镜像并重新命名为jmeterTest 并且会将镜像中的8080、22、80端口映射到docker宿主机的7890、7891、7892上。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2)查看正在运行的docker镜像 “docker ps” &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3)进入docker镜像内执行sh命令 “docker exec -it jmeterTest bash”，如果此时发现主机名称变成了12位的字符便成功了，不过你会发现字符是你启动docker镜像的时候返回给你的前12位字符 （二）、安装JDK 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html， 2、上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter压缩包上传到服务器，由于docker下载的镜像是比较干净的镜像所以有很多我们常见的命令不能执行，需要我们手动的去下载。所以先使用rz或者scp命令将压缩包上传到宿主机，退到宿主机只要执行exit命令就可以了 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JAVA_HOME”环境变量，并修改完后让配置立即生效 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看java版本 java -version （三）、安装jmeter 1、下载jmeter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：http://jmeter.apache.org/download_jmeter.cgi。在jmeter官网中有两处下载：Binaries为jmeter应用程序下载。Source为源码下载。下载的时候可以在Binaries处自己选择想要下载的格式，.tgz和.zip。这里我选择第一个.tgz。（两个是一样的，下载后只是解压格式不一样） 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JMTER_HOME”环境变量，并修改完后让配置立即生效 （四）、安装ANT 1、下载ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：https://ant.apache.org/bindownload.cgi 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“ANT_HOME”环境变量，并修改完后让配置立即生效 3、配置ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter目录下的ant-jmeter-1.1.1.jar文件复制到ANT文件夹的lib目录下 （五）、安装svn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install subversion安装完成后svn --version查看当前svn版本 （六）、安装apache 1、安装 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install -y httpd 暗转完成后输入httpd -v查看当前版本 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看完当前版本后访问该镜像，【http://ip地址:端口】 （七）、安装jenkins 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址 ：https://jenkins.io/download/ 选择一个与自己docker镜像相匹配的jenkins包，或者下载java的版本。这里为了教学方便所以选择下载java版本 2、将jenkins包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jenkins包文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行jenkins 3、jenkins基础配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;启动后访问地址：http://ip地址:7890/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;根据jenkins提示在docker镜像中找到对应路径文件，并打开复制内容，黏贴。黏贴后安装推介的插件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;创建初始化帐号（最高权限） 三、文件环境准备 （一）、文件目录准备 1、svn新建jmeterCase &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建jmeterCase文件夹用于存放jmeter自动化测试脚本 （二）、jmeter脚本数据准备 （三）、ANT数据文件准备 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个.xml的ANT编译文件内容格式如下 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!--Project为整个量的根目录；name随便写,可自行更改；default默认执行什么任务,下面有个target name = &quot;all&quot;；basedir为.代表当前目录--&gt; &lt;project name=&quot;jmeter_test&quot; default=&quot;all&quot; basedir=&quot;/var/www/jmeterCase/case/&quot;&gt; &lt;tstamp&gt; &lt;!-- 这里是加入了年月日时分秒,用来加在报告的后缀上--&gt; &lt;format property=&quot;time&quot; pattern=&quot;yyyyMMddhhmmss&quot; /&gt; &lt;/tstamp&gt; &lt;!-- 需要改成自己本地的 Jmeter 目录,写到bin目录的上一步就可以--&gt; &lt;property name=&quot;jmeter.home&quot; value=&quot;/home/ubuntu/softWare/qjclouds/apache-jmeter-5.0&quot; /&gt; &lt;!-- jmeter生成jtl格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.jtl.dir&quot; value=&quot;/var/www/jmeterCase/report/jtl&quot; /&gt; &lt;!-- jmeter生成html格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.html.dir&quot; value=&quot;/var/www/html/report&quot; /&gt; &lt;!-- 生成的报告的前缀ReportName的value可以自定义值,下面的jtl和html的名字是用变量来的也不需要改 --&gt; &lt;property name=&quot;ReportName&quot; value=&quot;${caseName}&quot; /&gt; &lt;property name=&quot;jmeter.result.jtlName&quot; value=&quot;${jmeter.result.jtl.dir}/${ReportName}${time}.jtl&quot; /&gt; &lt;property name=&quot;jmeter.result.htmlName&quot; value=&quot;${jmeter.result.html.dir}/${ReportName}${time}.html&quot; /&gt; &lt;!-- 接收测试报告的邮箱,不用这个发邮件，可以删除 --&gt; &lt;property name=&quot;mail_to&quot; value=&quot;xxxx@xxxxx.com&quot; /&gt; &lt;!-- 电脑地址,也不用，可以删除 --&gt; &lt;property name=&quot;ComputerName&quot; value=&quot;Admin&quot; /&gt; &lt;!-- 对应到上面的，default为all，下面调用了两个：test和report--&gt; &lt;target name=&quot;all&quot;&gt; &lt;antcall target=&quot;test&quot; /&gt; &lt;antcall target=&quot;report&quot; /&gt; &lt;/target&gt; &lt;!-- 对应到上面的target为test --&gt; &lt;target name=&quot;test&quot;&gt; &lt;taskdef name=&quot;jmeter&quot; classname=&quot;org.programmerplanet.ant.taskdefs.jmeter.JMeterTask&quot; /&gt; &lt;jmeter jmeterhome=&quot;${jmeter.home}&quot; resultlog=&quot;${jmeter.result.jtlName}&quot;&gt; &lt;!-- 声明要运行的脚本。&quot;*.jmx&quot;指包含此目录下的所有jmeter脚本,脚本要执行某一个就写死哪个 --&gt; &lt;testplans dir=&quot;/var/www/jmeterCase/case&quot; includes=&quot;${caseName}.jmx&quot; /&gt; &lt;property name=&quot;jmeter.save.saveservice.output_format&quot; value=&quot;xml&quot;/&gt; &lt;/jmeter&gt; &lt;/target&gt; &lt;path id=&quot;xslt.classpath&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;xalan*.jar&quot;/&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;serializer*.jar&quot;/&gt; &lt;/path&gt; &lt;!-- 对应到上面的target为report --&gt; &lt;target name=&quot;report&quot;&gt; &lt;tstamp&gt;&lt;format property=&quot;report.datestamp&quot; pattern=&quot;yyyy/MM/dd HH:mm&quot;/&gt;&lt;/tstamp&gt; &lt;xslt classpathref=&quot;xslt.classpath&quot; force=&quot;true&quot; in=&quot;${jmeter.result.jtlName}&quot; out=&quot;${jmeter.result.htmlName}&quot; style=&quot;${jmeter.home}/extras/jmeter.results.shanhe.me.xsl&quot; &gt; &lt;param name=&quot;dateReport&quot; expression=&quot;${report.datestamp}&quot;/&gt; &lt;/xslt&gt; &lt;!-- 因为上面生成报告的时候，不会将相关的图片也一起拷贝至目标目录，所以，需要手动拷贝 --&gt; &lt;copy todir=&quot;${jmeter.result.html.dir}&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/extras&quot;&gt; &lt;include name=&quot;collapse.png&quot; /&gt; &lt;include name=&quot;expand.png&quot; /&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;/target&gt; &lt;!-- 发送邮件 --&gt; &lt;/project&gt; 注意：这里个modle的脚本文件名称用${caseName}代替了 （四）DINGDING文件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;因为整个自动化结构都是由钉钉通知的所以首先要对钉钉消息进行模版化。在新建模版化json文件之前，我们需要先在DingDing上创建一个群，并在群内开启一个钉钉机器人，新建一个json文件内容如下： { &quot;msgtype&quot;: &quot;link&quot;, &quot;link&quot;: { &quot;text&quot;: &quot;jmeter编译成功&quot;, &quot;title&quot;: &quot;接口自动化环境通知！！！&quot;, &quot;picUrl&quot;: &quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1547116083262&amp;di=a123ecc9c1ae1b57809a51e83a81369a&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180623%2Fa55f0483026a41bf861e3c82afb7b9b4.jpeg&quot;, &quot;messageUrl&quot;: &quot;http://xxx.xxx.xxx.xxx/report/${html}&quot; } } 注意：这里个modle的脚本文件名称用${caseName}代替了 （五）、文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter脚本名称与ANT编译文件名称改为一致的文件名称例如：demo.xml、demo.jmx。改完名称后将jmeter脚本上传到jmeterCase文件夹下case文件夹。 （六）、服务器文件目录准备 1、新建文件夹bin、DingDing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;命令：mkdir 目录名称 2、模版文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将demo.xml、demo.json文件上传到bin目录 3、检出jmeterCase目录 四、sh命令准备 （一）、创建新的ANT启动.xml文件sh 内容如下： home=/var/www cp ${home}/bin/demo.xml ${home}/bin/$1.xml sed -i -e &#39;s/${caseName}/&#39;$1&#39;/g&#39; ${home}/bin/$1.xml mv ${home}/bin/$1.xml ${home}/jmeterCase/case/$1.xml svn add ${home}/jmeterCase/case/$1.xml svn commit -m 新增$1.xml文件 ${home}/jmeterCase/case/$1.xml （二）、发送钉钉消息sh 内容如下： #定义jmeter自动化home文件夹 home=/var/www if [ ! -f ${home}/jmeterCase/case/&quot;$1&quot;.xml ]; then sh -x ${home}/bin/createAntXML.sh $1 fi #更新html报告文件夹 svn up ${home}/html/ #更新用例文件夹 svn up ${home}/jmeterCase/ #调用ant执行jmeter脚本并生成报告 ant -f ${home}/jmeterCase/case/$1.xml #创建随机变量文件名 random=${RANDOM} #遍历report目录下以参数$1开头的文件并排序，将内容吧写入到随机文件 ls -t ${home}/html/report | grep $1 &gt;&gt;${home}/html/report/${random}.txt #读取随机文件的第一行文本 file=$(head -1 $home/html/report/${random}.txt) #删除随机文件 rm -rf ${home}/html/report/${random}.txt #删除钉钉消息文件 rm -rf ${home}/DingDing/$1.json #复制消息文件 cp ${home}/DingDing/msg.json ${home}/DingDing/$1.json #替换url sed -i -e &#39;s/${html}/&#39;${file}&#39;/g&#39; ${home}/DingDing/$1.json #替换消息标题 sed -i -e &#39;s/jmeter编译成功/【&#39;$1&#39;】jmeter脚本编译成功，点击查阅：http:\/\/111.230.223.145\/report\/&#39;$file&#39;/g&#39; ${home}/DingDing/$1.json #读取json文件 json=$(head -n 100 ${home}/DingDing/$1.json) #发送钉钉消息 if [ $(grep -c &quot;class=\&quot;failure\&quot;&quot; ${home}/html/report/${file}) -eq 1 ]; then curl https://oapi.dingtalk.com/robot/send?access_token=992debb70f5fe66037383d5e7635e99cdc1608957affc6c4256127b500526c5a -H &#39;Content-Type: application/json&#39; -H &quot;Data_Type:msg&quot; -X POST -d &quot;${json}&quot; fi 注意：最后发送钉钉消息时将之前创建的DingDing机器人的token换成自己的“access_token” 五、jenkins配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个job &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;配置参数化构建 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;添加需要执行的命令" />
<link rel="canonical" href="https://uzzz.org/2019/07/30/792985.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/30/792985.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-30T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"jmeter接口自动化测试环境部署 注意：以下内容适应用于公司测试团队小，同时技术不足以开发或者不愿意投入时间精力开发接口自动化测试平台的测试团队。同时本文章内容是使用docker技术实现搭建，当然如果公司没有使用docker技术的也适用。将docker镜像看作是一台服务器即可。但是docker并不是虚拟机。他只是服务器中的一个进程。请读者不要混淆。 另外需要该文章pdf版本的读者可在百度网盘下载 链接:https://pan.baidu.com/s/1N7lkkh29YZgPB4RJF8Ywvg 密码:rked 一、概述 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmeter是做API和性能测试的一把利器。也是接口自动化测试的一种非常棒的一款开源的测试软件。本次接口自动化的环境搭建主要围绕着jmeter展开。主要用到的工具／应用程序有：jmeter+ant+apache／tomcat+jenkins+DingDing+SVN。搭建自动化测试环境的时候注意，无论是任何的框架或者说是架构都是围绕着简单、易用、功能强大三个特点来开展的。所以我们要做的就是尽可能能的减少重复性的操作。让使用者能够节省时间的同时尽可能的保证该架构的稳定性。 结构图如下： 注意：该内容讲解的所有内容均在docker镜像中操作、如果有自己服务器的同学可以直接使用服务器进行操作 二、环境准备环境搭建 （一）Linux docker环境搭建 1、centos安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;如果linux环境中安装了yum工具包那么直接使用yum install docker便可以直接安装了，在安装过程中如果询问直接‘y’就好 使用docker --version可以查看当前的docker版本 2、ubuntu安装docker &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;前提条件：Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的 Ubuntu 版本是否支持 Docker。 通过 uname -r 命令查看你当前的内核版本 检查完版本后在命令行中输入wget -qO- https://get.docker.com/ | sh 输入当前用户的密码后，就会下载脚本并且安装Docker及依赖包。 安装完成后有个提示： If you would like to use Docker as a non-root user, you should now consider adding your user to the &quot;docker&quot; group with something like: sudo usermod -aG docker runoob Remember that you will have to log out and back in for this to take effect! 使用docker --version可以查看当前的docker版本 3、启动docker service docker start 4、下载linux镜像文件 5、搜索镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;搜索ssh镜像文件docker search ssh 6、下载镜像 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载镜像文件到本地 docker pull jdeathe/centos-ssh 7、检查与查看 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看镜像文件是否下载成功 docker images 8、运行docker镜像并开启所需端口 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1)运行镜像 “docker run -it --name jmeterTest -d -p 7890:8080 -p 7891:22 -p 7892:80 jdeathe/centos-ssh”此命令会运行docker仓库中的jdeathe/centos-ssh镜像并重新命名为jmeterTest 并且会将镜像中的8080、22、80端口映射到docker宿主机的7890、7891、7892上。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2)查看正在运行的docker镜像 “docker ps” &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3)进入docker镜像内执行sh命令 “docker exec -it jmeterTest bash”，如果此时发现主机名称变成了12位的字符便成功了，不过你会发现字符是你启动docker镜像的时候返回给你的前12位字符 （二）、安装JDK 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址：https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html， 2、上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter压缩包上传到服务器，由于docker下载的镜像是比较干净的镜像所以有很多我们常见的命令不能执行，需要我们手动的去下载。所以先使用rz或者scp命令将压缩包上传到宿主机，退到宿主机只要执行exit命令就可以了 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JAVA_HOME”环境变量，并修改完后让配置立即生效 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看java版本 java -version （三）、安装jmeter 1、下载jmeter &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：http://jmeter.apache.org/download_jmeter.cgi。在jmeter官网中有两处下载：Binaries为jmeter应用程序下载。Source为源码下载。下载的时候可以在Binaries处自己选择想要下载的格式，.tgz和.zip。这里我选择第一个.tgz。（两个是一样的，下载后只是解压格式不一样） 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JMTER_HOME”环境变量，并修改完后让配置立即生效 （四）、安装ANT 1、下载ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：https://ant.apache.org/bindownload.cgi 2、将jmeter压缩包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“ANT_HOME”环境变量，并修改完后让配置立即生效 3、配置ANT &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter目录下的ant-jmeter-1.1.1.jar文件复制到ANT文件夹的lib目录下 （五）、安装svn &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install subversion安装完成后svn --version查看当前svn版本 （六）、安装apache 1、安装 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install -y httpd 暗转完成后输入httpd -v查看当前版本 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看完当前版本后访问该镜像，【http://ip地址:端口】 （七）、安装jenkins 1、下载 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址 ：https://jenkins.io/download/ 选择一个与自己docker镜像相匹配的jenkins包，或者下载java的版本。这里为了教学方便所以选择下载java版本 2、将jenkins包上传到服务器。 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jenkins包文件到运行的镜像中 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行jenkins 3、jenkins基础配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;启动后访问地址：http://ip地址:7890/ &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;根据jenkins提示在docker镜像中找到对应路径文件，并打开复制内容，黏贴。黏贴后安装推介的插件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;创建初始化帐号（最高权限） 三、文件环境准备 （一）、文件目录准备 1、svn新建jmeterCase &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建jmeterCase文件夹用于存放jmeter自动化测试脚本 （二）、jmeter脚本数据准备 （三）、ANT数据文件准备 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个.xml的ANT编译文件内容格式如下 &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; &lt;!--Project为整个量的根目录；name随便写,可自行更改；default默认执行什么任务,下面有个target name = &quot;all&quot;；basedir为.代表当前目录--&gt; &lt;project name=&quot;jmeter_test&quot; default=&quot;all&quot; basedir=&quot;/var/www/jmeterCase/case/&quot;&gt; &lt;tstamp&gt; &lt;!-- 这里是加入了年月日时分秒,用来加在报告的后缀上--&gt; &lt;format property=&quot;time&quot; pattern=&quot;yyyyMMddhhmmss&quot; /&gt; &lt;/tstamp&gt; &lt;!-- 需要改成自己本地的 Jmeter 目录,写到bin目录的上一步就可以--&gt; &lt;property name=&quot;jmeter.home&quot; value=&quot;/home/ubuntu/softWare/qjclouds/apache-jmeter-5.0&quot; /&gt; &lt;!-- jmeter生成jtl格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.jtl.dir&quot; value=&quot;/var/www/jmeterCase/report/jtl&quot; /&gt; &lt;!-- jmeter生成html格式的结果报告的路径--&gt; &lt;property name=&quot;jmeter.result.html.dir&quot; value=&quot;/var/www/html/report&quot; /&gt; &lt;!-- 生成的报告的前缀ReportName的value可以自定义值,下面的jtl和html的名字是用变量来的也不需要改 --&gt; &lt;property name=&quot;ReportName&quot; value=&quot;${caseName}&quot; /&gt; &lt;property name=&quot;jmeter.result.jtlName&quot; value=&quot;${jmeter.result.jtl.dir}/${ReportName}${time}.jtl&quot; /&gt; &lt;property name=&quot;jmeter.result.htmlName&quot; value=&quot;${jmeter.result.html.dir}/${ReportName}${time}.html&quot; /&gt; &lt;!-- 接收测试报告的邮箱,不用这个发邮件，可以删除 --&gt; &lt;property name=&quot;mail_to&quot; value=&quot;xxxx@xxxxx.com&quot; /&gt; &lt;!-- 电脑地址,也不用，可以删除 --&gt; &lt;property name=&quot;ComputerName&quot; value=&quot;Admin&quot; /&gt; &lt;!-- 对应到上面的，default为all，下面调用了两个：test和report--&gt; &lt;target name=&quot;all&quot;&gt; &lt;antcall target=&quot;test&quot; /&gt; &lt;antcall target=&quot;report&quot; /&gt; &lt;/target&gt; &lt;!-- 对应到上面的target为test --&gt; &lt;target name=&quot;test&quot;&gt; &lt;taskdef name=&quot;jmeter&quot; classname=&quot;org.programmerplanet.ant.taskdefs.jmeter.JMeterTask&quot; /&gt; &lt;jmeter jmeterhome=&quot;${jmeter.home}&quot; resultlog=&quot;${jmeter.result.jtlName}&quot;&gt; &lt;!-- 声明要运行的脚本。&quot;*.jmx&quot;指包含此目录下的所有jmeter脚本,脚本要执行某一个就写死哪个 --&gt; &lt;testplans dir=&quot;/var/www/jmeterCase/case&quot; includes=&quot;${caseName}.jmx&quot; /&gt; &lt;property name=&quot;jmeter.save.saveservice.output_format&quot; value=&quot;xml&quot;/&gt; &lt;/jmeter&gt; &lt;/target&gt; &lt;path id=&quot;xslt.classpath&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;xalan*.jar&quot;/&gt; &lt;fileset dir=&quot;${jmeter.home}/lib&quot; includes=&quot;serializer*.jar&quot;/&gt; &lt;/path&gt; &lt;!-- 对应到上面的target为report --&gt; &lt;target name=&quot;report&quot;&gt; &lt;tstamp&gt;&lt;format property=&quot;report.datestamp&quot; pattern=&quot;yyyy/MM/dd HH:mm&quot;/&gt;&lt;/tstamp&gt; &lt;xslt classpathref=&quot;xslt.classpath&quot; force=&quot;true&quot; in=&quot;${jmeter.result.jtlName}&quot; out=&quot;${jmeter.result.htmlName}&quot; style=&quot;${jmeter.home}/extras/jmeter.results.shanhe.me.xsl&quot; &gt; &lt;param name=&quot;dateReport&quot; expression=&quot;${report.datestamp}&quot;/&gt; &lt;/xslt&gt; &lt;!-- 因为上面生成报告的时候，不会将相关的图片也一起拷贝至目标目录，所以，需要手动拷贝 --&gt; &lt;copy todir=&quot;${jmeter.result.html.dir}&quot;&gt; &lt;fileset dir=&quot;${jmeter.home}/extras&quot;&gt; &lt;include name=&quot;collapse.png&quot; /&gt; &lt;include name=&quot;expand.png&quot; /&gt; &lt;/fileset&gt; &lt;/copy&gt; &lt;/target&gt; &lt;!-- 发送邮件 --&gt; &lt;/project&gt; 注意：这里个modle的脚本文件名称用${caseName}代替了 （四）DINGDING文件 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;因为整个自动化结构都是由钉钉通知的所以首先要对钉钉消息进行模版化。在新建模版化json文件之前，我们需要先在DingDing上创建一个群，并在群内开启一个钉钉机器人，新建一个json文件内容如下： { &quot;msgtype&quot;: &quot;link&quot;, &quot;link&quot;: { &quot;text&quot;: &quot;jmeter编译成功&quot;, &quot;title&quot;: &quot;接口自动化环境通知！！！&quot;, &quot;picUrl&quot;: &quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1547116083262&amp;di=a123ecc9c1ae1b57809a51e83a81369a&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180623%2Fa55f0483026a41bf861e3c82afb7b9b4.jpeg&quot;, &quot;messageUrl&quot;: &quot;http://xxx.xxx.xxx.xxx/report/${html}&quot; } } 注意：这里个modle的脚本文件名称用${caseName}代替了 （五）、文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter脚本名称与ANT编译文件名称改为一致的文件名称例如：demo.xml、demo.jmx。改完名称后将jmeter脚本上传到jmeterCase文件夹下case文件夹。 （六）、服务器文件目录准备 1、新建文件夹bin、DingDing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;命令：mkdir 目录名称 2、模版文件上传 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将demo.xml、demo.json文件上传到bin目录 3、检出jmeterCase目录 四、sh命令准备 （一）、创建新的ANT启动.xml文件sh 内容如下： home=/var/www cp ${home}/bin/demo.xml ${home}/bin/$1.xml sed -i -e &#39;s/${caseName}/&#39;$1&#39;/g&#39; ${home}/bin/$1.xml mv ${home}/bin/$1.xml ${home}/jmeterCase/case/$1.xml svn add ${home}/jmeterCase/case/$1.xml svn commit -m 新增$1.xml文件 ${home}/jmeterCase/case/$1.xml （二）、发送钉钉消息sh 内容如下： #定义jmeter自动化home文件夹 home=/var/www if [ ! -f ${home}/jmeterCase/case/&quot;$1&quot;.xml ]; then sh -x ${home}/bin/createAntXML.sh $1 fi #更新html报告文件夹 svn up ${home}/html/ #更新用例文件夹 svn up ${home}/jmeterCase/ #调用ant执行jmeter脚本并生成报告 ant -f ${home}/jmeterCase/case/$1.xml #创建随机变量文件名 random=${RANDOM} #遍历report目录下以参数$1开头的文件并排序，将内容吧写入到随机文件 ls -t ${home}/html/report | grep $1 &gt;&gt;${home}/html/report/${random}.txt #读取随机文件的第一行文本 file=$(head -1 $home/html/report/${random}.txt) #删除随机文件 rm -rf ${home}/html/report/${random}.txt #删除钉钉消息文件 rm -rf ${home}/DingDing/$1.json #复制消息文件 cp ${home}/DingDing/msg.json ${home}/DingDing/$1.json #替换url sed -i -e &#39;s/${html}/&#39;${file}&#39;/g&#39; ${home}/DingDing/$1.json #替换消息标题 sed -i -e &#39;s/jmeter编译成功/【&#39;$1&#39;】jmeter脚本编译成功，点击查阅：http:\\/\\/111.230.223.145\\/report\\/&#39;$file&#39;/g&#39; ${home}/DingDing/$1.json #读取json文件 json=$(head -n 100 ${home}/DingDing/$1.json) #发送钉钉消息 if [ $(grep -c &quot;class=\\&quot;failure\\&quot;&quot; ${home}/html/report/${file}) -eq 1 ]; then curl https://oapi.dingtalk.com/robot/send?access_token=992debb70f5fe66037383d5e7635e99cdc1608957affc6c4256127b500526c5a -H &#39;Content-Type: application/json&#39; -H &quot;Data_Type:msg&quot; -X POST -d &quot;${json}&quot; fi 注意：最后发送钉钉消息时将之前创建的DingDing机器人的token换成自己的“access_token” 五、jenkins配置 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个job &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;配置参数化构建 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;添加需要执行的命令","@type":"BlogPosting","url":"https://uzzz.org/2019/07/30/792985.html","headline":"jmeter接口自动化测试环境部署（ant+jmeter+jenkins+svn+钉钉）","dateModified":"2019-07-30T00:00:00+08:00","datePublished":"2019-07-30T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/30/792985.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>jmeter接口自动化测试环境部署（ant+jmeter+jenkins+svn+钉钉）</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-light"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <h2><a id="jmeter_2"></a>jmeter接口自动化测试环境部署</h2> 
  <p>注意：以下内容适应用于公司测试团队小，同时技术不足以开发或者不愿意投入时间精力开发接口自动化测试平台的测试团队。同时本文章内容是使用docker技术实现搭建，当然如果公司没有使用docker技术的也适用。将docker镜像看作是一台服务器即可。但是docker并不是虚拟机。他只是服务器中的一个进程。请读者不要混淆。</p> 
  <p>另外需要该文章pdf版本的读者可在百度网盘下载<br> 链接:<a href="https://pan.baidu.com/s/1N7lkkh29YZgPB4RJF8Ywvg" rel="nofollow">https://pan.baidu.com/s/1N7lkkh29YZgPB4RJF8Ywvg</a> 密码:rked</p> 
  <p>一、概述<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;jmeter是做API和性能测试的一把利器。也是接口自动化测试的一种非常棒的一款开源的测试软件。本次接口自动化的环境搭建主要围绕着jmeter展开。主要用到的工具／应用程序有：jmeter+ant+apache／tomcat+jenkins+DingDing+SVN。搭建自动化测试环境的时候注意，无论是任何的框架或者说是架构都是围绕着简单、易用、功能强大三个特点来开展的。所以我们要做的就是尽可能能的减少重复性的操作。让使用者能够节省时间的同时尽可能的保证该架构的稳定性。<br> 结构图如下：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113103880.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 注意：该内容讲解的所有内容均在docker镜像中操作、如果有自己服务器的同学可以直接使用服务器进行操作</p> 
  <p>二、环境准备环境搭建<br> （一）Linux docker环境搭建<br> 1、centos安装docker<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;如果linux环境中安装了yum工具包那么直接使用yum install docker便可以直接安装了，在安装过程中如果询问直接‘y’就好<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113117644.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 使用docker --version可以查看当前的docker版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113124292.png" alt="在这里插入图片描述"><br> 2、ubuntu安装docker<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;前提条件：Docker 要求 Ubuntu 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的 Ubuntu 版本是否支持 Docker。<br> 通过 uname -r 命令查看你当前的内核版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113131764.png" alt="在这里插入图片描述"><br> 检查完版本后在命令行中输入wget -qO- <a href="https://get.docker.com/" rel="nofollow" data-token="d6571417dcc456d840810b556f21ac4e">https://get.docker.com/</a> | sh<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113138900.png" alt="在这里插入图片描述"><br> 输入当前用户的密码后，就会下载脚本并且安装Docker及依赖包。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113144603.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113150455.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 安装完成后有个提示：</p> 
  <pre><code>    If you would like to use Docker as a non-root user, you should now consider
    adding your user to the "docker" group with something like:
    sudo usermod -aG docker runoob
   Remember that you will have to log out and back in for this to take effect!  
</code></pre> 
  <p>使用docker --version可以查看当前的docker版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113218391.png" alt="在这里插入图片描述"><br> 3、启动docker</p> 
  <pre><code>service docker start
</code></pre> 
  <p>4、下载linux镜像文件<br> 5、搜索镜像<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;搜索ssh镜像文件docker search ssh<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113255409.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 6、下载镜像<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载镜像文件到本地 docker pull jdeathe/centos-ssh<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113316505.png" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/20190730113231759.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70"><br> 7、检查与查看<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看镜像文件是否下载成功 docker images<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113328791.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 8、运行docker镜像并开启所需端口<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1)运行镜像 “docker run -it --name jmeterTest -d -p 7890:8080 -p 7891:22 -p 7892:80 jdeathe/centos-ssh”此命令会运行docker仓库中的jdeathe/centos-ssh镜像并重新命名为jmeterTest 并且会将镜像中的8080、22、80端口映射到docker宿主机的7890、7891、7892上。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113342613.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2)查看正在运行的docker镜像 “docker ps”<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113348541.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3)进入docker镜像内执行sh命令 “docker exec -it jmeterTest bash”，如果此时发现主机名称变成了12位的字符便成功了，不过你会发现字符是你启动docker镜像的时候返回给你的前12位字符<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113355648.png" alt="在这里插入图片描述"><br> （二）、安装JDK<br> 1、下载<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址：<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html%EF%BC%8C" rel="nofollow" data-token="205664330eda6c95da79d0873e330523">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html，</a><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113404422.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 2、上传<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter压缩包上传到服务器，由于docker下载的镜像是比较干净的镜像所以有很多我们常见的命令不能执行，需要我们手动的去下载。所以先使用rz或者scp命令将压缩包上传到宿主机，退到宿主机只要执行exit命令就可以了<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113411265.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113415312.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113420977.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JAVA_HOME”环境变量，并修改完后让配置立即生效<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113431603.png" alt="在这里插入图片描述"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113436226.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看java版本 java -version<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113443241.png" alt="在这里插入图片描述"><br> （三）、安装jmeter<br> 1、下载jmeter<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：<a href="http://jmeter.apache.org/download_jmeter.cgi%E3%80%82%E5%9C%A8jmeter%E5%AE%98%E7%BD%91%E4%B8%AD%E6%9C%89%E4%B8%A4%E5%A4%84%E4%B8%8B%E8%BD%BD%EF%BC%9ABinaries%E4%B8%BAjmeter%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%8B%E8%BD%BD%E3%80%82Source%E4%B8%BA%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E3%80%82%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%97%B6%E5%80%99%E5%8F%AF%E4%BB%A5%E5%9C%A8Binaries%E5%A4%84%E8%87%AA%E5%B7%B1%E9%80%89%E6%8B%A9%E6%83%B3%E8%A6%81%E4%B8%8B%E8%BD%BD%E7%9A%84%E6%A0%BC%E5%BC%8F%EF%BC%8C.tgz%E5%92%8C.zip%E3%80%82%E8%BF%99%E9%87%8C%E6%88%91%E9%80%89%E6%8B%A9%E7%AC%AC%E4%B8%80%E4%B8%AA.tgz%E3%80%82%EF%BC%88%E4%B8%A4%E4%B8%AA%E6%98%AF%E4%B8%80%E6%A0%B7%E7%9A%84%EF%BC%8C%E4%B8%8B%E8%BD%BD%E5%90%8E%E5%8F%AA%E6%98%AF%E8%A7%A3%E5%8E%8B%E6%A0%BC%E5%BC%8F%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%89" rel="nofollow" data-token="acccbe0f19e5453b8779701b3d36192c">http://jmeter.apache.org/download_jmeter.cgi。在jmeter官网中有两处下载：Binaries为jmeter应用程序下载。Source为源码下载。下载的时候可以在Binaries处自己选择想要下载的格式，.tgz和.zip。这里我选择第一个.tgz。（两个是一样的，下载后只是解压格式不一样）</a><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113450959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>2、将jmeter压缩包上传到服务器。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113458765.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113502539.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113507614.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“JMTER_HOME”环境变量，并修改完后让配置立即生效<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113514978.png" alt="在这里插入图片描述"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113519525.png" alt="在这里插入图片描述"></p> 
  <p>（四）、安装ANT<br> 1、下载ANT<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;地址：<a href="https://ant.apache.org/bindownload.cgi" rel="nofollow" data-token="ffda2dc3a19a1d3e50d39d6e5eef4413">https://ant.apache.org/bindownload.cgi</a><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113527580.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 2、将jmeter压缩包上传到服务器。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113535235.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jmeter压缩文件到运行的镜像中<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113540396.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将镜像文件中的jmeter压缩包解压到镜像的usr/local目录下<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113546273.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新增jmeter“ANT_HOME”环境变量，并修改完后让配置立即生效<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113550757.png" alt="在这里插入图片描述"><br> 3、配置ANT<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter目录下的ant-jmeter-1.1.1.jar文件复制到ANT文件夹的lib目录下<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113556648.png" alt="在这里插入图片描述"></p> 
  <p>（五）、安装svn<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install subversion安装完成后svn --version查看当前svn版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113601614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> （六）、安装apache<br> 1、安装<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;执行命令：yum install -y httpd 暗转完成后输入httpd -v查看当前版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113612841.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查看完当前版本后访问该镜像，【<a href="http://xn--ip-im8ckc" rel="nofollow" data-token="0cf8cd57fa116f4f726fc8b8103af2a3">http://ip地址</a>:端口】<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113618112.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> （七）、安装jenkins<br> 1、下载<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;下载地址 ：<a href="https://jenkins.io/download/" rel="nofollow" data-token="346fb6a8706c7f9139105ccf37069d5d">https://jenkins.io/download/</a> 选择一个与自己docker镜像相匹配的jenkins包，或者下载java的版本。这里为了教学方便所以选择下载java版本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113623413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> 2、将jenkins包上传到服务器。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113631553.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;复制jenkins包文件到运行的镜像中<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113636331.png" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;运行jenkins<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113640762.png" alt="在这里插入图片描述"><br> 3、jenkins基础配置<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;启动后访问地址：<a href="http://xn--ip-im8ckc:7890/" rel="nofollow" data-token="af1187acacacf60f7d35d9cb44ee58ee">http://ip地址:7890/</a><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113646338.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;根据jenkins提示在docker镜像中找到对应路径文件，并打开复制内容，黏贴。黏贴后安装推介的插件<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113655132.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113738431.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;创建初始化帐号（最高权限）</p> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113727197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="![在这里插入图片描述](https://img-blog.csdnimg.cn/20190730113700501.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70"><br> 三、文件环境准备<br> （一）、文件目录准备<br> 1、svn新建jmeterCase<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建jmeterCase文件夹用于存放jmeter自动化测试脚本<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113753645.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> （二）、jmeter脚本数据准备<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019073011375941.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> （三）、ANT数据文件准备<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个.xml的ANT编译文件内容格式如下</p> 
  <pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!--Project为整个量的根目录；name随便写,可自行更改；default默认执行什么任务,下面有个target name = "all"；basedir为.代表当前目录--&gt;
&lt;project name="jmeter_test" default="all" basedir="/var/www/jmeterCase/case/"&gt;
    &lt;tstamp&gt;
        &lt;!-- 这里是加入了年月日时分秒,用来加在报告的后缀上--&gt;
        &lt;format property="time" pattern="yyyyMMddhhmmss" /&gt;
    &lt;/tstamp&gt;
    &lt;!-- 需要改成自己本地的 Jmeter 目录,写到bin目录的上一步就可以--&gt;
    &lt;property name="jmeter.home" value="/home/ubuntu/softWare/qjclouds/apache-jmeter-5.0" /&gt;
    &lt;!-- jmeter生成jtl格式的结果报告的路径--&gt;
    &lt;property name="jmeter.result.jtl.dir" value="/var/www/jmeterCase/report/jtl" /&gt;
    &lt;!-- jmeter生成html格式的结果报告的路径--&gt;
    &lt;property name="jmeter.result.html.dir" value="/var/www/html/report" /&gt;

    &lt;!-- 生成的报告的前缀ReportName的value可以自定义值,下面的jtl和html的名字是用变量来的也不需要改 --&gt;
    &lt;property name="ReportName" value="${caseName}" /&gt;
    &lt;property name="jmeter.result.jtlName" value="${jmeter.result.jtl.dir}/${ReportName}${time}.jtl" /&gt;
    &lt;property name="jmeter.result.htmlName" value="${jmeter.result.html.dir}/${ReportName}${time}.html" /&gt;
    &lt;!-- 接收测试报告的邮箱,不用这个发邮件，可以删除 --&gt;
    &lt;property name="mail_to" value="xxxx@xxxxx.com" /&gt;
    &lt;!-- 电脑地址,也不用，可以删除 --&gt;
    &lt;property name="ComputerName" value="Admin" /&gt;
    &lt;!-- 对应到上面的，default为all，下面调用了两个：test和report--&gt;
    &lt;target name="all"&gt;
        &lt;antcall target="test" /&gt;
        &lt;antcall target="report" /&gt;
    &lt;/target&gt;
    &lt;!-- 对应到上面的target为test --&gt;
    &lt;target name="test"&gt;
        &lt;taskdef name="jmeter" classname="org.programmerplanet.ant.taskdefs.jmeter.JMeterTask" /&gt;
        &lt;jmeter jmeterhome="${jmeter.home}" resultlog="${jmeter.result.jtlName}"&gt;
            &lt;!-- 声明要运行的脚本。"*.jmx"指包含此目录下的所有jmeter脚本,脚本要执行某一个就写死哪个 --&gt;
            &lt;testplans dir="/var/www/jmeterCase/case" includes="${caseName}.jmx" /&gt;
            &lt;property name="jmeter.save.saveservice.output_format" value="xml"/&gt;
        &lt;/jmeter&gt;
    &lt;/target&gt;
    &lt;path id="xslt.classpath"&gt;
        &lt;fileset dir="${jmeter.home}/lib" includes="xalan*.jar"/&gt;
        &lt;fileset dir="${jmeter.home}/lib" includes="serializer*.jar"/&gt;
    &lt;/path&gt;
    &lt;!-- 对应到上面的target为report --&gt;
    &lt;target name="report"&gt;
        &lt;tstamp&gt;&lt;format property="report.datestamp" pattern="yyyy/MM/dd HH:mm"/&gt;&lt;/tstamp&gt;
        &lt;xslt classpathref="xslt.classpath" force="true" in="${jmeter.result.jtlName}" out="${jmeter.result.htmlName}" style="${jmeter.home}/extras/jmeter.results.shanhe.me.xsl" 
        &gt;
         &lt;param name="dateReport" expression="${report.datestamp}"/&gt;
         &lt;/xslt&gt;
        &lt;!-- 因为上面生成报告的时候，不会将相关的图片也一起拷贝至目标目录，所以，需要手动拷贝 --&gt;
        &lt;copy todir="${jmeter.result.html.dir}"&gt;
            &lt;fileset dir="${jmeter.home}/extras"&gt;
                &lt;include name="collapse.png" /&gt;
                &lt;include name="expand.png" /&gt;
            &lt;/fileset&gt;
        &lt;/copy&gt;
    &lt;/target&gt;
    &lt;!-- 发送邮件 --&gt;
&lt;/project&gt;
</code></pre> 
  <p>注意：这里个modle的脚本文件名称用${caseName}代替了<br> （四）DINGDING文件<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;因为整个自动化结构都是由钉钉通知的所以首先要对钉钉消息进行模版化。在新建模版化json文件之前，我们需要先在DingDing上创建一个群，并在群内开启一个钉钉机器人，新建一个json文件内容如下：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113827337.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code>{
    "msgtype": "link",
    "link": {
        "text": "jmeter编译成功",
        "title": "接口自动化环境通知！！！",
        "picUrl": "https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1547116083262&amp;di=a123ecc9c1ae1b57809a51e83a81369a&amp;imgtype=0&amp;src=http%3A%2F%2F5b0988e595225.cdn.sohucs.com%2Fimages%2F20180623%2Fa55f0483026a41bf861e3c82afb7b9b4.jpeg",
        "messageUrl": "http://xxx.xxx.xxx.xxx/report/${html}"
    }
}
</code></pre> 
  <p>注意：这里个modle的脚本文件名称用${caseName}代替了</p> 
  <p>（五）、文件上传<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将jmeter脚本名称与ANT编译文件名称改为一致的文件名称例如：demo.xml、demo.jmx。改完名称后将jmeter脚本上传到jmeterCase文件夹下case文件夹。<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113841604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> （六）、服务器文件目录准备<br> 1、新建文件夹bin、DingDing<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;命令：mkdir 目录名称<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113847717.png" alt="在这里插入图片描述"><br> 2、模版文件上传<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;将demo.xml、demo.json文件上传到bin目录<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113851748.png" alt="在这里插入图片描述"></p> 
  <p>3、检出jmeterCase目录</p> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113857319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113906122.png" alt="在这里插入图片描述">四、sh命令准备<br> （一）、创建新的ANT启动.xml文件sh<br> 内容如下：</p> 
  <pre><code>home=/var/www
cp ${home}/bin/demo.xml ${home}/bin/$1.xml
sed -i -e 's/${caseName}/'$1'/g' ${home}/bin/$1.xml
mv ${home}/bin/$1.xml ${home}/jmeterCase/case/$1.xml
svn add ${home}/jmeterCase/case/$1.xml
svn commit  -m 新增$1.xml文件 ${home}/jmeterCase/case/$1.xml
</code></pre> 
  <p>（二）、发送钉钉消息sh</p> 
  <p>内容如下：<br> #定义jmeter自动化home文件夹</p> 
  <pre><code>home=/var/www
if [ ! -f ${home}/jmeterCase/case/"$1".xml ]; then
sh -x ${home}/bin/createAntXML.sh $1
fi
#更新html报告文件夹
svn up ${home}/html/
#更新用例文件夹
svn up ${home}/jmeterCase/
#调用ant执行jmeter脚本并生成报告
ant -f ${home}/jmeterCase/case/$1.xml
#创建随机变量文件名
random=${RANDOM}
#遍历report目录下以参数$1开头的文件并排序，将内容吧写入到随机文件
ls -t ${home}/html/report | grep $1 &gt;&gt;${home}/html/report/${random}.txt
#读取随机文件的第一行文本
file=$(head -1 $home/html/report/${random}.txt)
#删除随机文件
rm -rf ${home}/html/report/${random}.txt
#删除钉钉消息文件
rm -rf ${home}/DingDing/$1.json
#复制消息文件
cp ${home}/DingDing/msg.json ${home}/DingDing/$1.json
#替换url
sed -i -e 's/${html}/'${file}'/g' ${home}/DingDing/$1.json
#替换消息标题
sed -i -e 's/jmeter编译成功/【'$1'】jmeter脚本编译成功，点击查阅：http:\/\/111.230.223.145\/report\/'$file'/g' ${home}/DingDing/$1.json
#读取json文件
json=$(head -n 100 ${home}/DingDing/$1.json)
#发送钉钉消息
if [ $(grep -c "class=\"failure\"" ${home}/html/report/${file}) -eq  1 ]; then
	curl https://oapi.dingtalk.com/robot/send?access_token=992debb70f5fe66037383d5e7635e99cdc1608957affc6c4256127b500526c5a -H  'Content-Type: application/json'  -H "Data_Type:msg" -X POST -d  "${json}"
fi
</code></pre> 
  <p>注意：最后发送钉钉消息时将之前创建的DingDing机器人的token换成自己的“access_token”</p> 
  <p>五、jenkins配置</p> 
  <p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;新建一个job<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019073011391762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;配置参数化构建<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113922672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;添加需要执行的命令<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730113927231.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDAxOTQwNg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
