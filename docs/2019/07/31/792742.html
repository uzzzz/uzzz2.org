<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>CDH大数据集群搭建 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="CDH大数据集群搭建" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="目录 简介 1. 软件环境 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 2.2 关闭防火墙 2.3 永久修改设置主机名 2.4 配置映射文件 2.5 配置ssh免密登录 2.6 安装jdk 2.7 关闭selinux 安全模块 3.环境准备 3.1 私有网络软件仓库 3.1.1 上传镜像 3.1.2 挂载镜像 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 3.1.4 安装createrepo(如果已经安装省略) 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 3.2.2 使用网络系统镜像 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 3.3.2 创建CDH网络镜像 3.3.3 子节点挂载网络镜像 3.3.4 关闭防火墙(所有节点) 3.3.5 增加开启自启项(所有节点) 3.3.6 安装时钟服务ntp 3.3.6.1 主节点安装时钟服务器 3.3.6.2 子节点安装时钟服务并同步到主节点 3.4 安装mysql 3.4.1 安装 3.4.2 修改root用户密码 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 3.4.3.2 Cloudera的元数据库 3.4.4 开启远程访问 4. CM安装 4.1 配置CM的yum源 4.2 安装CM 5. CDH集群安装 5.1 选择子节点 5.2 CDH和CM的具体网络位置的选择 5.2.1 选择CDH的位置 5.2.2 选择CM的位置 5.3 分发JDK 5.4 Agent的安装和配置 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点 简介 Apache Hadoop 由Apache 公司开源的Hadoop版本。涵盖了最原生的Hadoop特性，所有的Hadoop发行版均基于该版本进行改进。 Cloudera CDH 由Cloudera公司发行的Hadoop版本，全称（Cloudera’s Distribution Including Apache Hadoop）。该版本在基于原生Apache Hadoop版本进行改进，添加了补丁和自行开发的组件，更加稳定易用。目前国内使用最多的版本。 Hortonworks Ambari -Ambari是Hortonworks开源的Hadoop平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。 1、技术细节：hadoop版本、组件及功能选择 2、易于部署：管理工具选择、版本更新、补丁添加等等 3、易于维护：集群管理、容灾能力等 4、成本：版本费用、计费模式和许可证 5、企业应用集成的支持：选择的Hadoop应用和现有企业其他应用集成的支持。 1. 软件环境 名称 版本 Linux CentOS 7x64 CM 5.12.1 CDH 5.12.1 主机名 内存 CPU IP 角色 cdh01 5G 1核2线程 192.168.88.121 CM server,agent cdh02 2G 1核2线程 192.168.88.122 agent cdh03 2G 1核2线程 192.168.88.123 agent 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 修改配置文件: vi /etc/sysconfig/network-scripts/ifcfg-eno16777736 注释#BOOTPROTO=“dhcp” 添加 IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 其他节点同理TYPE=&quot;Ethernet&quot; #BOOTPROTO=&quot;dhcp&quot; DEFROUTE=&quot;yes&quot; PEERDNS=&quot;yes&quot; PEERROUTES=&quot;yes&quot; IPV4_FAILURE_FATAL=&quot;no&quot; IPV6INIT=&quot;yes&quot; IPV6_AUTOCONF=&quot;yes&quot; IPV6_DEFROUTE=&quot;yes&quot; IPV6_PEERDNS=&quot;yes&quot; IPV6_PEERROUTES=&quot;yes&quot; IPV6_FAILURE_FATAL=&quot;no&quot; NAME=&quot;eno16777736&quot; UUID=&quot;858a5a33-4c55-49e9-8b59-1cfeb56d4b8b&quot; DEVICE=&quot;eno16777736&quot; ONBOOT=&quot;yes&quot; IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 2.2 关闭防火墙 关闭: systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 2.3 永久修改设置主机名 vi /etc/hostname 注意：需要重启生效-&gt;reboot 2.4 配置映射文件 vi /etc/hosts #127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 #::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.88.121 cdh01 192.168.88.122 cdh02 192.168.88.123 cdh03 2.5 配置ssh免密登录 生成密钥对:ssh-keygen ssh-copy-id cdh01 ssh-copy-id cdh02 ssh-copy-id cdh03 2.6 安装jdk 2.7 关闭selinux 安全模块 vim /etc/selinux/config （将SELINUX改为disabled） 重启所有节点，检查是否关闭getenforce 3.环境准备 3.1 私有网络软件仓库 在集群安装的过程中，要求每个节点都必须挂载光驱， 而对于每台节点都手动的去挂载光驱太麻烦，也不方便。这里使用每个节点都指向同一个私有网络镜像来解决这个问题。 我们的集群采用的是全离线安装，也不可能逐个节点的安装，同样是也使用指向同一个私有的网络软件包来解决 因此选择在cdh01上搭建一个私有的网络软件仓库，以下是搭建的全过程。 3.1.1 上传镜像 搭建私有网络镜像使用的镜像文件最好就使用安装系统的镜像，这里是选择了CentOS7x64的镜像，将其上传到cdh01的/disk下（需新建/disk目录） 3.1.2 挂载镜像 mkdir -p /media/CentOS 挂载镜像：mount -o loop /disk/CentOS-7-x86_64.iso /media/CentOS/ cd /etc/yum.repos.d mv CentOS-Base.repo CentOS-Base.repo.bak vi CentOS-Media.repo -&gt; 将enable=0改成enable=1 清除yum的缓存： yum clean metadata yum clean dbcache 查看是否挂载成功：yum list | wc -l 这是统计镜像中有多少个软件包的命令，CentOS7x64位的系统的软件包个数一般在3000以上 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 检查是否安装:service httpd status 安装:yum install -y httpd 启动http服务，并让其开机自启： service httpd start chkconfig httpd on 由于http的默认端口为80，通过浏览器访问： 192.168.88.121:80 创建网络软件仓库目录：mkdir –p /var/www/html http默认将上面的目录作为软件仓库的目录 3.1.4 安装createrepo(如果已经安装省略) 该软件使用来生成http镜像的网络识别路径的： yum install createrepo 到此 私有的网络软件仓库搭建完成 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 将从镜像中挂载的文件拷贝到软件仓库的目录中 cp -r /media/CentOS /var/www/html/ 删除目录repodata cd /var/www/html/CentOS rm -rf ./repodata 生成新的软件路径目录repodata createrepo . 查看:192.168.88.121/CentOS 到此网络镜像创建成功。 3.2.2 使用网络系统镜像 解除对镜像文件的挂载：umount /media/CentOS 如上图 ，目录下无文件则说明解除挂载成功。 如果出现下图说明还有进程在使用/medis/CentOS挂载点，那么此时可以借助fuser命令找出占用目录/medis/CentOS的所有进程，然后kill掉，此时就可以umount 了 修改文件CentOS-Media.repo让其指向刚才创建的网络镜像 vi /etc/yum.repos.d/CentOS-Media.repo 修改:baseurl=http://192.168.88.121/CentOS/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 清除yum的缓存， 并查看软件包个数（参考3.1.2） 到此，cdh01网络系统镜像挂载完成，可以将镜像文件删除了。 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 CM下载地址(总地址) http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/ http://archive.cloudera.com/cm5/cm/5/ 下载rmp仓库文件: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/cloudera-manager.repo http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/mirrors 分开下载RMP: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-agent-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-daemons-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-db-2-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.14.1/RPMS/x86_64/enterprise-debuginfo-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/jdk-6u31-linux-amd64.rpm 通过xftp上传cm和CDH安装包到软件仓库目录中/var/www/html/（注意：相关的目录需要自己创建）,目录结构如下 3.3.2 创建CDH网络镜像 下载地址：http://archive.cloudera.com/cdh5/parcels/5.12.1/ 通过xftp上传cdh安装压缩包到软件仓库目录中（注意：相关的目录需要自己创建，三个文件一个也不能少） 不需要解压，到此cdh的网络软件镜像创建成功，也可以通过浏览器访问查看详情 3.3.3 子节点挂载网络镜像 将主节点的 /etc/ yum.repos.d下的CentOS-Media.repo文件分发到各子节点的目录/etc/ yum.repos.d下： scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 在所有子节点执行如下命令: mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak 再清除yum的缓存，查看网络镜像软件包的个数（具体命令参考3.1.2） 到此，子节点网络镜像挂载完成。 3.3.4 关闭防火墙(所有节点) systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 3.3.5 增加开启自启项(所有节点) vi /etc/rc.local 添加 echo 0 &gt; /proc/sys/vm/swappiness echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/defrag swapoff -a 3.3.6 安装时钟服务ntp 时钟服务器安装在主节点上，子节点的时钟服服务全部同步到主节点的时钟服务器上。 3.3.6.1 主节点安装时钟服务器 安装时钟服务ntp: yum -y install ntp 启动，并注册到开机自启： service ntpd start chkconfig ntpd on 查看ntpd的状态：service ntpd status 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 表明服务器是跟自己同步 server 127.127.1.0 fudge 127.127.1.0 statum 10 重启ntp服务service ntpd restart 3.3.6.2 子节点安装时钟服务并同步到主节点 ntp服务安装,参考3.4.61，主要的区别在于配置的修改上 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 server cdh01 重启ntp服务service ntpd restart 时钟会自动同步的（需要一定的时间）。查看同步状态的命令：ntpstat 3.4 安装mysql 安装mysql的用处是提供cm存储集群信息以及hive的元数据库的。只需要安装一个mysql数据库即可，虽说mysql可以随意安装在集群的任意接节点，这里还是建议安装在cm。 安装mysql的过程如下： 3.4.1 安装 yum -y install mysql-server 启动并开启开机启动： service mysqld start chkconfig mysqld on 3.4.2 修改root用户密码 mysqladmin -u root password “root” 登录mysql:mysql -uroot -proot 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.3.2 Cloudera的元数据库 create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.4 开启远程访问 选择mysql库: use mysql; 修改访问权限表:grant all privileges on . to “root”@&quot;%&quot; identified by “root” with grant option; 刷新权限：flush privileges; 查看是否开启远程访问：select user,password,host from user; 上图的最后一行表示已经开启了root用的远程访问。 符号%表示所有主机。到此 mysql安装完毕。 4. CM安装 在3.3.1中我们只是建立了CM的网络软件镜像，但是我们并没有让系统识别，现在开始一步步安装CM 由于CM只要安装在主节点cdh01上，因此一下操作仅仅只在cdh01上执行。 4.1 配置CM的yum源 从CM网络镜像中拷贝cloudera-manager.repo cp /var/www/html/cm5.12/cloudera-manager.repo /etc/yum.repos.d/ cd /etc/yum.repos.d/ vi cloudera-manager.repo baseurl=http://192.168.88.121/cm5.12/ gpgkey =http://192.168.88.121/cm5.12/RPM-GPG-KEY-cloudera gpgcheck = 0 检查:yum repolist 备份:cp cloudera-manager.repo cloudera-cm.repo 4.2 安装CM 找到CM安装的引导文件：cloudera-manager-installer.bin 可从http://archive.cloudera.com/cm5/installer/5.12.1/下载，一定要对应你的CM的版本。将其上传到/opt下 赋予其执行权限:chmod 755 cloudera-manager-installer.bin 到此就可以开始安装CM了,执行命令：/opt/cloudera-manager-installer.bin 出现安装引导界面：-&gt;next-&gt;next-&gt;yes-&gt;next-&gt;yes就会开始安装jdk， 因此并不需要事先安装jdk-&gt;安装CM服务（有点慢， 耐心等待）-&gt;成功 我们可以通过命令查看cloudera的服务是否启动： service cloudera-scm-server status 访问:http://cdh01:7180 用户名密码均为admin，登录后进行cdh集群安装界面。到此CM安装完成。 5. CDH集群安装 5.1 选择子节点 在登录了后，进入的第一个界面是cloudera的最终用户许可条款和条件,勾选是的，再点继续，进入CDH版本选择界面，这里选择免费版， 再点击继续，进行感谢界面：直接点击继续，进入了节点选择界面：在这个界面我们需要填入，我们集群的所有节点主机名（可从任意节点的hosts文件中拷贝。），以英文逗号分隔，填完了后点击搜索： 5.2 CDH和CM的具体网络位置的选择 在确认主机无误后，点击继续，就可以进入CDH和CM的网络位置选择界面。 5.2.1 选择CDH的位置 先点击 更多选项，进入CDH网络位置选择界面,修改成我们自己的CDH网络软件镜像的地址：http://192.168.88.121/cdh/ 5.2.2 选择CM的位置 在选择了CDH后，我们继续点击 自定义存储库 来选择我们自己的CM：其实呢，就是把配置cloudera-cm.repo（参考4.1）的配置拿出来，在界面上填一遍，我们的填写如下： 填写完成后，就会进入给每个节点安装cloudera-scm-agent的界面，再点击继续前，我们需要将hadoop-cm中安装CM时安装的JDK文件分发到每个子节点，不然子节点在安装cloudera-scm-agent会包错。 5.3 分发JDK 在hadoop-cm安装CM时，CM会将JDK安装到/usr/java/目录下,因此我们把hadoop-cm整个java目录分发给所有的子节点就好了，在hadoop-cm下执行： scp -r /usr/java cdh02:/usr/ scp -r /usr/java cdh03:/usr/ 5.4 Agent的安装和配置 Jdk分发完成后，点击继续，进入jdk安装选项,由于我们已经分发，这个就不需要勾选，直接点击继续，进入选择是否启动单用户模式:这里选择不启用，直接点击继续，进入节点通信选择：我们这里使用 所有用户接收相同的密码，填入密码后，点击继续，进行agent安装界面， 耐心等待安装完成，分发为完成后，点击继续，进入agent主机检查： 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点" />
<meta property="og:description" content="目录 简介 1. 软件环境 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 2.2 关闭防火墙 2.3 永久修改设置主机名 2.4 配置映射文件 2.5 配置ssh免密登录 2.6 安装jdk 2.7 关闭selinux 安全模块 3.环境准备 3.1 私有网络软件仓库 3.1.1 上传镜像 3.1.2 挂载镜像 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 3.1.4 安装createrepo(如果已经安装省略) 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 3.2.2 使用网络系统镜像 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 3.3.2 创建CDH网络镜像 3.3.3 子节点挂载网络镜像 3.3.4 关闭防火墙(所有节点) 3.3.5 增加开启自启项(所有节点) 3.3.6 安装时钟服务ntp 3.3.6.1 主节点安装时钟服务器 3.3.6.2 子节点安装时钟服务并同步到主节点 3.4 安装mysql 3.4.1 安装 3.4.2 修改root用户密码 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 3.4.3.2 Cloudera的元数据库 3.4.4 开启远程访问 4. CM安装 4.1 配置CM的yum源 4.2 安装CM 5. CDH集群安装 5.1 选择子节点 5.2 CDH和CM的具体网络位置的选择 5.2.1 选择CDH的位置 5.2.2 选择CM的位置 5.3 分发JDK 5.4 Agent的安装和配置 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点 简介 Apache Hadoop 由Apache 公司开源的Hadoop版本。涵盖了最原生的Hadoop特性，所有的Hadoop发行版均基于该版本进行改进。 Cloudera CDH 由Cloudera公司发行的Hadoop版本，全称（Cloudera’s Distribution Including Apache Hadoop）。该版本在基于原生Apache Hadoop版本进行改进，添加了补丁和自行开发的组件，更加稳定易用。目前国内使用最多的版本。 Hortonworks Ambari -Ambari是Hortonworks开源的Hadoop平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。 1、技术细节：hadoop版本、组件及功能选择 2、易于部署：管理工具选择、版本更新、补丁添加等等 3、易于维护：集群管理、容灾能力等 4、成本：版本费用、计费模式和许可证 5、企业应用集成的支持：选择的Hadoop应用和现有企业其他应用集成的支持。 1. 软件环境 名称 版本 Linux CentOS 7x64 CM 5.12.1 CDH 5.12.1 主机名 内存 CPU IP 角色 cdh01 5G 1核2线程 192.168.88.121 CM server,agent cdh02 2G 1核2线程 192.168.88.122 agent cdh03 2G 1核2线程 192.168.88.123 agent 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 修改配置文件: vi /etc/sysconfig/network-scripts/ifcfg-eno16777736 注释#BOOTPROTO=“dhcp” 添加 IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 其他节点同理TYPE=&quot;Ethernet&quot; #BOOTPROTO=&quot;dhcp&quot; DEFROUTE=&quot;yes&quot; PEERDNS=&quot;yes&quot; PEERROUTES=&quot;yes&quot; IPV4_FAILURE_FATAL=&quot;no&quot; IPV6INIT=&quot;yes&quot; IPV6_AUTOCONF=&quot;yes&quot; IPV6_DEFROUTE=&quot;yes&quot; IPV6_PEERDNS=&quot;yes&quot; IPV6_PEERROUTES=&quot;yes&quot; IPV6_FAILURE_FATAL=&quot;no&quot; NAME=&quot;eno16777736&quot; UUID=&quot;858a5a33-4c55-49e9-8b59-1cfeb56d4b8b&quot; DEVICE=&quot;eno16777736&quot; ONBOOT=&quot;yes&quot; IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 2.2 关闭防火墙 关闭: systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 2.3 永久修改设置主机名 vi /etc/hostname 注意：需要重启生效-&gt;reboot 2.4 配置映射文件 vi /etc/hosts #127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 #::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.88.121 cdh01 192.168.88.122 cdh02 192.168.88.123 cdh03 2.5 配置ssh免密登录 生成密钥对:ssh-keygen ssh-copy-id cdh01 ssh-copy-id cdh02 ssh-copy-id cdh03 2.6 安装jdk 2.7 关闭selinux 安全模块 vim /etc/selinux/config （将SELINUX改为disabled） 重启所有节点，检查是否关闭getenforce 3.环境准备 3.1 私有网络软件仓库 在集群安装的过程中，要求每个节点都必须挂载光驱， 而对于每台节点都手动的去挂载光驱太麻烦，也不方便。这里使用每个节点都指向同一个私有网络镜像来解决这个问题。 我们的集群采用的是全离线安装，也不可能逐个节点的安装，同样是也使用指向同一个私有的网络软件包来解决 因此选择在cdh01上搭建一个私有的网络软件仓库，以下是搭建的全过程。 3.1.1 上传镜像 搭建私有网络镜像使用的镜像文件最好就使用安装系统的镜像，这里是选择了CentOS7x64的镜像，将其上传到cdh01的/disk下（需新建/disk目录） 3.1.2 挂载镜像 mkdir -p /media/CentOS 挂载镜像：mount -o loop /disk/CentOS-7-x86_64.iso /media/CentOS/ cd /etc/yum.repos.d mv CentOS-Base.repo CentOS-Base.repo.bak vi CentOS-Media.repo -&gt; 将enable=0改成enable=1 清除yum的缓存： yum clean metadata yum clean dbcache 查看是否挂载成功：yum list | wc -l 这是统计镜像中有多少个软件包的命令，CentOS7x64位的系统的软件包个数一般在3000以上 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 检查是否安装:service httpd status 安装:yum install -y httpd 启动http服务，并让其开机自启： service httpd start chkconfig httpd on 由于http的默认端口为80，通过浏览器访问： 192.168.88.121:80 创建网络软件仓库目录：mkdir –p /var/www/html http默认将上面的目录作为软件仓库的目录 3.1.4 安装createrepo(如果已经安装省略) 该软件使用来生成http镜像的网络识别路径的： yum install createrepo 到此 私有的网络软件仓库搭建完成 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 将从镜像中挂载的文件拷贝到软件仓库的目录中 cp -r /media/CentOS /var/www/html/ 删除目录repodata cd /var/www/html/CentOS rm -rf ./repodata 生成新的软件路径目录repodata createrepo . 查看:192.168.88.121/CentOS 到此网络镜像创建成功。 3.2.2 使用网络系统镜像 解除对镜像文件的挂载：umount /media/CentOS 如上图 ，目录下无文件则说明解除挂载成功。 如果出现下图说明还有进程在使用/medis/CentOS挂载点，那么此时可以借助fuser命令找出占用目录/medis/CentOS的所有进程，然后kill掉，此时就可以umount 了 修改文件CentOS-Media.repo让其指向刚才创建的网络镜像 vi /etc/yum.repos.d/CentOS-Media.repo 修改:baseurl=http://192.168.88.121/CentOS/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 清除yum的缓存， 并查看软件包个数（参考3.1.2） 到此，cdh01网络系统镜像挂载完成，可以将镜像文件删除了。 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 CM下载地址(总地址) http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/ http://archive.cloudera.com/cm5/cm/5/ 下载rmp仓库文件: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/cloudera-manager.repo http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/mirrors 分开下载RMP: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-agent-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-daemons-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-db-2-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.14.1/RPMS/x86_64/enterprise-debuginfo-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/jdk-6u31-linux-amd64.rpm 通过xftp上传cm和CDH安装包到软件仓库目录中/var/www/html/（注意：相关的目录需要自己创建）,目录结构如下 3.3.2 创建CDH网络镜像 下载地址：http://archive.cloudera.com/cdh5/parcels/5.12.1/ 通过xftp上传cdh安装压缩包到软件仓库目录中（注意：相关的目录需要自己创建，三个文件一个也不能少） 不需要解压，到此cdh的网络软件镜像创建成功，也可以通过浏览器访问查看详情 3.3.3 子节点挂载网络镜像 将主节点的 /etc/ yum.repos.d下的CentOS-Media.repo文件分发到各子节点的目录/etc/ yum.repos.d下： scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 在所有子节点执行如下命令: mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak 再清除yum的缓存，查看网络镜像软件包的个数（具体命令参考3.1.2） 到此，子节点网络镜像挂载完成。 3.3.4 关闭防火墙(所有节点) systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 3.3.5 增加开启自启项(所有节点) vi /etc/rc.local 添加 echo 0 &gt; /proc/sys/vm/swappiness echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/defrag swapoff -a 3.3.6 安装时钟服务ntp 时钟服务器安装在主节点上，子节点的时钟服服务全部同步到主节点的时钟服务器上。 3.3.6.1 主节点安装时钟服务器 安装时钟服务ntp: yum -y install ntp 启动，并注册到开机自启： service ntpd start chkconfig ntpd on 查看ntpd的状态：service ntpd status 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 表明服务器是跟自己同步 server 127.127.1.0 fudge 127.127.1.0 statum 10 重启ntp服务service ntpd restart 3.3.6.2 子节点安装时钟服务并同步到主节点 ntp服务安装,参考3.4.61，主要的区别在于配置的修改上 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 server cdh01 重启ntp服务service ntpd restart 时钟会自动同步的（需要一定的时间）。查看同步状态的命令：ntpstat 3.4 安装mysql 安装mysql的用处是提供cm存储集群信息以及hive的元数据库的。只需要安装一个mysql数据库即可，虽说mysql可以随意安装在集群的任意接节点，这里还是建议安装在cm。 安装mysql的过程如下： 3.4.1 安装 yum -y install mysql-server 启动并开启开机启动： service mysqld start chkconfig mysqld on 3.4.2 修改root用户密码 mysqladmin -u root password “root” 登录mysql:mysql -uroot -proot 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.3.2 Cloudera的元数据库 create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.4 开启远程访问 选择mysql库: use mysql; 修改访问权限表:grant all privileges on . to “root”@&quot;%&quot; identified by “root” with grant option; 刷新权限：flush privileges; 查看是否开启远程访问：select user,password,host from user; 上图的最后一行表示已经开启了root用的远程访问。 符号%表示所有主机。到此 mysql安装完毕。 4. CM安装 在3.3.1中我们只是建立了CM的网络软件镜像，但是我们并没有让系统识别，现在开始一步步安装CM 由于CM只要安装在主节点cdh01上，因此一下操作仅仅只在cdh01上执行。 4.1 配置CM的yum源 从CM网络镜像中拷贝cloudera-manager.repo cp /var/www/html/cm5.12/cloudera-manager.repo /etc/yum.repos.d/ cd /etc/yum.repos.d/ vi cloudera-manager.repo baseurl=http://192.168.88.121/cm5.12/ gpgkey =http://192.168.88.121/cm5.12/RPM-GPG-KEY-cloudera gpgcheck = 0 检查:yum repolist 备份:cp cloudera-manager.repo cloudera-cm.repo 4.2 安装CM 找到CM安装的引导文件：cloudera-manager-installer.bin 可从http://archive.cloudera.com/cm5/installer/5.12.1/下载，一定要对应你的CM的版本。将其上传到/opt下 赋予其执行权限:chmod 755 cloudera-manager-installer.bin 到此就可以开始安装CM了,执行命令：/opt/cloudera-manager-installer.bin 出现安装引导界面：-&gt;next-&gt;next-&gt;yes-&gt;next-&gt;yes就会开始安装jdk， 因此并不需要事先安装jdk-&gt;安装CM服务（有点慢， 耐心等待）-&gt;成功 我们可以通过命令查看cloudera的服务是否启动： service cloudera-scm-server status 访问:http://cdh01:7180 用户名密码均为admin，登录后进行cdh集群安装界面。到此CM安装完成。 5. CDH集群安装 5.1 选择子节点 在登录了后，进入的第一个界面是cloudera的最终用户许可条款和条件,勾选是的，再点继续，进入CDH版本选择界面，这里选择免费版， 再点击继续，进行感谢界面：直接点击继续，进入了节点选择界面：在这个界面我们需要填入，我们集群的所有节点主机名（可从任意节点的hosts文件中拷贝。），以英文逗号分隔，填完了后点击搜索： 5.2 CDH和CM的具体网络位置的选择 在确认主机无误后，点击继续，就可以进入CDH和CM的网络位置选择界面。 5.2.1 选择CDH的位置 先点击 更多选项，进入CDH网络位置选择界面,修改成我们自己的CDH网络软件镜像的地址：http://192.168.88.121/cdh/ 5.2.2 选择CM的位置 在选择了CDH后，我们继续点击 自定义存储库 来选择我们自己的CM：其实呢，就是把配置cloudera-cm.repo（参考4.1）的配置拿出来，在界面上填一遍，我们的填写如下： 填写完成后，就会进入给每个节点安装cloudera-scm-agent的界面，再点击继续前，我们需要将hadoop-cm中安装CM时安装的JDK文件分发到每个子节点，不然子节点在安装cloudera-scm-agent会包错。 5.3 分发JDK 在hadoop-cm安装CM时，CM会将JDK安装到/usr/java/目录下,因此我们把hadoop-cm整个java目录分发给所有的子节点就好了，在hadoop-cm下执行： scp -r /usr/java cdh02:/usr/ scp -r /usr/java cdh03:/usr/ 5.4 Agent的安装和配置 Jdk分发完成后，点击继续，进入jdk安装选项,由于我们已经分发，这个就不需要勾选，直接点击继续，进入选择是否启动单用户模式:这里选择不启用，直接点击继续，进入节点通信选择：我们这里使用 所有用户接收相同的密码，填入密码后，点击继续，进行agent安装界面， 耐心等待安装完成，分发为完成后，点击继续，进入agent主机检查： 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点" />
<link rel="canonical" href="https://uzzz.org/2019/07/31/792742.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/31/792742.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-31T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"目录 简介 1. 软件环境 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 2.2 关闭防火墙 2.3 永久修改设置主机名 2.4 配置映射文件 2.5 配置ssh免密登录 2.6 安装jdk 2.7 关闭selinux 安全模块 3.环境准备 3.1 私有网络软件仓库 3.1.1 上传镜像 3.1.2 挂载镜像 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 3.1.4 安装createrepo(如果已经安装省略) 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 3.2.2 使用网络系统镜像 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 3.3.2 创建CDH网络镜像 3.3.3 子节点挂载网络镜像 3.3.4 关闭防火墙(所有节点) 3.3.5 增加开启自启项(所有节点) 3.3.6 安装时钟服务ntp 3.3.6.1 主节点安装时钟服务器 3.3.6.2 子节点安装时钟服务并同步到主节点 3.4 安装mysql 3.4.1 安装 3.4.2 修改root用户密码 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 3.4.3.2 Cloudera的元数据库 3.4.4 开启远程访问 4. CM安装 4.1 配置CM的yum源 4.2 安装CM 5. CDH集群安装 5.1 选择子节点 5.2 CDH和CM的具体网络位置的选择 5.2.1 选择CDH的位置 5.2.2 选择CM的位置 5.3 分发JDK 5.4 Agent的安装和配置 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点 简介 Apache Hadoop 由Apache 公司开源的Hadoop版本。涵盖了最原生的Hadoop特性，所有的Hadoop发行版均基于该版本进行改进。 Cloudera CDH 由Cloudera公司发行的Hadoop版本，全称（Cloudera’s Distribution Including Apache Hadoop）。该版本在基于原生Apache Hadoop版本进行改进，添加了补丁和自行开发的组件，更加稳定易用。目前国内使用最多的版本。 Hortonworks Ambari -Ambari是Hortonworks开源的Hadoop平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。 1、技术细节：hadoop版本、组件及功能选择 2、易于部署：管理工具选择、版本更新、补丁添加等等 3、易于维护：集群管理、容灾能力等 4、成本：版本费用、计费模式和许可证 5、企业应用集成的支持：选择的Hadoop应用和现有企业其他应用集成的支持。 1. 软件环境 名称 版本 Linux CentOS 7x64 CM 5.12.1 CDH 5.12.1 主机名 内存 CPU IP 角色 cdh01 5G 1核2线程 192.168.88.121 CM server,agent cdh02 2G 1核2线程 192.168.88.122 agent cdh03 2G 1核2线程 192.168.88.123 agent 2. 虚拟机配置 2.1 设置网络IP(NAT模式) 修改配置文件: vi /etc/sysconfig/network-scripts/ifcfg-eno16777736 注释#BOOTPROTO=“dhcp” 添加 IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 其他节点同理TYPE=&quot;Ethernet&quot; #BOOTPROTO=&quot;dhcp&quot; DEFROUTE=&quot;yes&quot; PEERDNS=&quot;yes&quot; PEERROUTES=&quot;yes&quot; IPV4_FAILURE_FATAL=&quot;no&quot; IPV6INIT=&quot;yes&quot; IPV6_AUTOCONF=&quot;yes&quot; IPV6_DEFROUTE=&quot;yes&quot; IPV6_PEERDNS=&quot;yes&quot; IPV6_PEERROUTES=&quot;yes&quot; IPV6_FAILURE_FATAL=&quot;no&quot; NAME=&quot;eno16777736&quot; UUID=&quot;858a5a33-4c55-49e9-8b59-1cfeb56d4b8b&quot; DEVICE=&quot;eno16777736&quot; ONBOOT=&quot;yes&quot; IPADDR=192.168.88.121 NETMASK=255.255.255.0 GATEWAY=192.168.88.2 DNS1=192.168.88.2 2.2 关闭防火墙 关闭: systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 2.3 永久修改设置主机名 vi /etc/hostname 注意：需要重启生效-&gt;reboot 2.4 配置映射文件 vi /etc/hosts #127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 #::1 localhost localhost.localdomain localhost6 localhost6.localdomain6 192.168.88.121 cdh01 192.168.88.122 cdh02 192.168.88.123 cdh03 2.5 配置ssh免密登录 生成密钥对:ssh-keygen ssh-copy-id cdh01 ssh-copy-id cdh02 ssh-copy-id cdh03 2.6 安装jdk 2.7 关闭selinux 安全模块 vim /etc/selinux/config （将SELINUX改为disabled） 重启所有节点，检查是否关闭getenforce 3.环境准备 3.1 私有网络软件仓库 在集群安装的过程中，要求每个节点都必须挂载光驱， 而对于每台节点都手动的去挂载光驱太麻烦，也不方便。这里使用每个节点都指向同一个私有网络镜像来解决这个问题。 我们的集群采用的是全离线安装，也不可能逐个节点的安装，同样是也使用指向同一个私有的网络软件包来解决 因此选择在cdh01上搭建一个私有的网络软件仓库，以下是搭建的全过程。 3.1.1 上传镜像 搭建私有网络镜像使用的镜像文件最好就使用安装系统的镜像，这里是选择了CentOS7x64的镜像，将其上传到cdh01的/disk下（需新建/disk目录） 3.1.2 挂载镜像 mkdir -p /media/CentOS 挂载镜像：mount -o loop /disk/CentOS-7-x86_64.iso /media/CentOS/ cd /etc/yum.repos.d mv CentOS-Base.repo CentOS-Base.repo.bak vi CentOS-Media.repo -&gt; 将enable=0改成enable=1 清除yum的缓存： yum clean metadata yum clean dbcache 查看是否挂载成功：yum list | wc -l 这是统计镜像中有多少个软件包的命令，CentOS7x64位的系统的软件包个数一般在3000以上 3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务) 检查是否安装:service httpd status 安装:yum install -y httpd 启动http服务，并让其开机自启： service httpd start chkconfig httpd on 由于http的默认端口为80，通过浏览器访问： 192.168.88.121:80 创建网络软件仓库目录：mkdir –p /var/www/html http默认将上面的目录作为软件仓库的目录 3.1.4 安装createrepo(如果已经安装省略) 该软件使用来生成http镜像的网络识别路径的： yum install createrepo 到此 私有的网络软件仓库搭建完成 3.2 挂载网络系统镜像 3.2.1 创建网络系统镜像 将从镜像中挂载的文件拷贝到软件仓库的目录中 cp -r /media/CentOS /var/www/html/ 删除目录repodata cd /var/www/html/CentOS rm -rf ./repodata 生成新的软件路径目录repodata createrepo . 查看:192.168.88.121/CentOS 到此网络镜像创建成功。 3.2.2 使用网络系统镜像 解除对镜像文件的挂载：umount /media/CentOS 如上图 ，目录下无文件则说明解除挂载成功。 如果出现下图说明还有进程在使用/medis/CentOS挂载点，那么此时可以借助fuser命令找出占用目录/medis/CentOS的所有进程，然后kill掉，此时就可以umount 了 修改文件CentOS-Media.repo让其指向刚才创建的网络镜像 vi /etc/yum.repos.d/CentOS-Media.repo 修改:baseurl=http://192.168.88.121/CentOS/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 清除yum的缓存， 并查看软件包个数（参考3.1.2） 到此，cdh01网络系统镜像挂载完成，可以将镜像文件删除了。 3.3 创建CM和CDH网络软件镜像 3.3.1 创建CM网络软件镜像 CM下载地址(总地址) http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/ http://archive.cloudera.com/cm5/cm/5/ 下载rmp仓库文件: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/cloudera-manager.repo http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/mirrors 分开下载RMP: http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-agent-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-daemons-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-db-2-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.14.1/RPMS/x86_64/enterprise-debuginfo-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/jdk-6u31-linux-amd64.rpm 通过xftp上传cm和CDH安装包到软件仓库目录中/var/www/html/（注意：相关的目录需要自己创建）,目录结构如下 3.3.2 创建CDH网络镜像 下载地址：http://archive.cloudera.com/cdh5/parcels/5.12.1/ 通过xftp上传cdh安装压缩包到软件仓库目录中（注意：相关的目录需要自己创建，三个文件一个也不能少） 不需要解压，到此cdh的网络软件镜像创建成功，也可以通过浏览器访问查看详情 3.3.3 子节点挂载网络镜像 将主节点的 /etc/ yum.repos.d下的CentOS-Media.repo文件分发到各子节点的目录/etc/ yum.repos.d下： scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/ scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/ 在所有子节点执行如下命令: mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak 再清除yum的缓存，查看网络镜像软件包的个数（具体命令参考3.1.2） 到此，子节点网络镜像挂载完成。 3.3.4 关闭防火墙(所有节点) systemctl stop firewalld systemctl disable firewalld 查看:systemctl status firewalld 3.3.5 增加开启自启项(所有节点) vi /etc/rc.local 添加 echo 0 &gt; /proc/sys/vm/swappiness echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/defrag swapoff -a 3.3.6 安装时钟服务ntp 时钟服务器安装在主节点上，子节点的时钟服服务全部同步到主节点的时钟服务器上。 3.3.6.1 主节点安装时钟服务器 安装时钟服务ntp: yum -y install ntp 启动，并注册到开机自启： service ntpd start chkconfig ntpd on 查看ntpd的状态：service ntpd status 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 表明服务器是跟自己同步 server 127.127.1.0 fudge 127.127.1.0 statum 10 重启ntp服务service ntpd restart 3.3.6.2 子节点安装时钟服务并同步到主节点 ntp服务安装,参考3.4.61，主要的区别在于配置的修改上 配置时钟服务器，vi /etc/ntp.conf 1.注释放开:表明时钟同步的网段 restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap 2.server 0…server 1…server 2…server 3…注释掉 3.添加 server cdh01 重启ntp服务service ntpd restart 时钟会自动同步的（需要一定的时间）。查看同步状态的命令：ntpstat 3.4 安装mysql 安装mysql的用处是提供cm存储集群信息以及hive的元数据库的。只需要安装一个mysql数据库即可，虽说mysql可以随意安装在集群的任意接节点，这里还是建议安装在cm。 安装mysql的过程如下： 3.4.1 安装 yum -y install mysql-server 启动并开启开机启动： service mysqld start chkconfig mysqld on 3.4.2 修改root用户密码 mysqladmin -u root password “root” 登录mysql:mysql -uroot -proot 3.4.3 创建相关数据库 3.4.3.1 Hive的元数据库 create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.3.2 Cloudera的元数据库 create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci; 3.4.4 开启远程访问 选择mysql库: use mysql; 修改访问权限表:grant all privileges on . to “root”@&quot;%&quot; identified by “root” with grant option; 刷新权限：flush privileges; 查看是否开启远程访问：select user,password,host from user; 上图的最后一行表示已经开启了root用的远程访问。 符号%表示所有主机。到此 mysql安装完毕。 4. CM安装 在3.3.1中我们只是建立了CM的网络软件镜像，但是我们并没有让系统识别，现在开始一步步安装CM 由于CM只要安装在主节点cdh01上，因此一下操作仅仅只在cdh01上执行。 4.1 配置CM的yum源 从CM网络镜像中拷贝cloudera-manager.repo cp /var/www/html/cm5.12/cloudera-manager.repo /etc/yum.repos.d/ cd /etc/yum.repos.d/ vi cloudera-manager.repo baseurl=http://192.168.88.121/cm5.12/ gpgkey =http://192.168.88.121/cm5.12/RPM-GPG-KEY-cloudera gpgcheck = 0 检查:yum repolist 备份:cp cloudera-manager.repo cloudera-cm.repo 4.2 安装CM 找到CM安装的引导文件：cloudera-manager-installer.bin 可从http://archive.cloudera.com/cm5/installer/5.12.1/下载，一定要对应你的CM的版本。将其上传到/opt下 赋予其执行权限:chmod 755 cloudera-manager-installer.bin 到此就可以开始安装CM了,执行命令：/opt/cloudera-manager-installer.bin 出现安装引导界面：-&gt;next-&gt;next-&gt;yes-&gt;next-&gt;yes就会开始安装jdk， 因此并不需要事先安装jdk-&gt;安装CM服务（有点慢， 耐心等待）-&gt;成功 我们可以通过命令查看cloudera的服务是否启动： service cloudera-scm-server status 访问:http://cdh01:7180 用户名密码均为admin，登录后进行cdh集群安装界面。到此CM安装完成。 5. CDH集群安装 5.1 选择子节点 在登录了后，进入的第一个界面是cloudera的最终用户许可条款和条件,勾选是的，再点继续，进入CDH版本选择界面，这里选择免费版， 再点击继续，进行感谢界面：直接点击继续，进入了节点选择界面：在这个界面我们需要填入，我们集群的所有节点主机名（可从任意节点的hosts文件中拷贝。），以英文逗号分隔，填完了后点击搜索： 5.2 CDH和CM的具体网络位置的选择 在确认主机无误后，点击继续，就可以进入CDH和CM的网络位置选择界面。 5.2.1 选择CDH的位置 先点击 更多选项，进入CDH网络位置选择界面,修改成我们自己的CDH网络软件镜像的地址：http://192.168.88.121/cdh/ 5.2.2 选择CM的位置 在选择了CDH后，我们继续点击 自定义存储库 来选择我们自己的CM：其实呢，就是把配置cloudera-cm.repo（参考4.1）的配置拿出来，在界面上填一遍，我们的填写如下： 填写完成后，就会进入给每个节点安装cloudera-scm-agent的界面，再点击继续前，我们需要将hadoop-cm中安装CM时安装的JDK文件分发到每个子节点，不然子节点在安装cloudera-scm-agent会包错。 5.3 分发JDK 在hadoop-cm安装CM时，CM会将JDK安装到/usr/java/目录下,因此我们把hadoop-cm整个java目录分发给所有的子节点就好了，在hadoop-cm下执行： scp -r /usr/java cdh02:/usr/ scp -r /usr/java cdh03:/usr/ 5.4 Agent的安装和配置 Jdk分发完成后，点击继续，进入jdk安装选项,由于我们已经分发，这个就不需要勾选，直接点击继续，进入选择是否启动单用户模式:这里选择不启用，直接点击继续，进入节点通信选择：我们这里使用 所有用户接收相同的密码，填入密码后，点击继续，进行agent安装界面， 耐心等待安装完成，分发为完成后，点击继续，进入agent主机检查： 6. 安装flume 7.安装hive 8.安装kafka 9.高可用配置 10.配置调整 11.添加子节点","@type":"BlogPosting","url":"https://uzzz.org/2019/07/31/792742.html","headline":"CDH大数据集群搭建","dateModified":"2019-07-31T00:00:00+08:00","datePublished":"2019-07-31T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/31/792742.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>CDH大数据集群搭建</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p></p>
  <div class="toc">
   <h3>目录</h3>
   <ul>
    <ul>
     <li><a href="#_1" rel="nofollow" data-token="48e624b5795e9beb816613e7c81cdebb">简介</a></li>
     <li><a href="#1__13" rel="nofollow" data-token="1e59263bc488cdb9d16748a35197bc1d">1. 软件环境</a></li>
     <li><a href="#2__25" rel="nofollow" data-token="28e8116677b7bf650795594c44e50abd">2. 虚拟机配置</a></li>
     <ul>
      <li><a href="#21_IPNAT_26" rel="nofollow" data-token="4466a50034965e80cbb3339a760e7ad3">2.1 设置网络IP(NAT模式)</a></li>
      <li><a href="#22__58" rel="nofollow" data-token="9bffd062b7427aab18dbd8c1c003ae43">2.2 关闭防火墙</a></li>
      <li><a href="#23__64" rel="nofollow" data-token="402fecfb3ad5b0caa0be79c74df444b0">2.3 永久修改设置主机名</a></li>
      <li><a href="#24__66" rel="nofollow" data-token="846ce5578fdb01a44b4339a8223e83d3">2.4 配置映射文件</a></li>
      <li><a href="#25_ssh_75" rel="nofollow" data-token="267834aced008617976160e49949685d">2.5 配置ssh免密登录</a></li>
      <li><a href="#26_jdk_80" rel="nofollow" data-token="8c2c70150e2e6da1c0428f9dc8ed539a">2.6 安装jdk</a></li>
      <li><a href="#27_selinux__81" rel="nofollow" data-token="bfe362eb320fe6a711842719e2b170d3">2.7 关闭selinux 安全模块</a></li>
     </ul>
     <li><a href="#3_84" rel="nofollow" data-token="553c1fb86273f8caa44a5fccaa31a9c0">3.环境准备</a></li>
     <ul>
      <li><a href="#31__85" rel="nofollow" data-token="fba2a8e6cb6a4c9123ce11693eb85bc5">3.1 私有网络软件仓库</a></li>
      <ul>
       <li><a href="#311	_89" rel="nofollow" data-token="efff86af576c8db550f337a0cd999c5a">3.1.1 上传镜像</a></li>
       <li><a href="#312	_91" rel="nofollow" data-token="e771d8114f129db185c848b3987bcab6">3.1.2 挂载镜像</a></li>
       <li><a href="#313	httpb_102" rel="nofollow" data-token="347071d32c17c8a9f4070037b6c953eb">3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务)</a></li>
       <li><a href="#314	createrepo_112" rel="nofollow" data-token="fa8e030c2961f1712bd4c64b56609d2b">3.1.4 安装createrepo(如果已经安装省略)</a></li>
      </ul>
      <li><a href="#32	_116" rel="nofollow" data-token="0d182fccb6b085a529d75466433b9af0">3.2 挂载网络系统镜像</a></li>
      <ul>
       <li><a href="#321	_117" rel="nofollow" data-token="1e97336b7ff29de53a971d6cd8f790b4">3.2.1 创建网络系统镜像</a></li>
       <li><a href="#322	_128" rel="nofollow" data-token="f62afb8ec38f1e35537534f4cced3057">3.2.2 使用网络系统镜像</a></li>
      </ul>
      <li><a href="#33_CMCDH_142" rel="nofollow" data-token="f2ac9e8f91973334f2b64bf3d879b07d">3.3 创建CM和CDH网络软件镜像</a></li>
      <ul>
       <li><a href="#331	CM_143" rel="nofollow" data-token="0d532f4cb4bba131e880953a88f7b526">3.3.1 创建CM网络软件镜像</a></li>
       <li><a href="#332	CDH_164" rel="nofollow" data-token="179f18ac6b86992a435e598c6ef4082d">3.3.2 创建CDH网络镜像</a></li>
       <li><a href="#333__168" rel="nofollow" data-token="36ecd00a084c294599f7ceeec91d780e">3.3.3 子节点挂载网络镜像</a></li>
       <li><a href="#334	_176" rel="nofollow" data-token="bf157df2052af19d4d56357c2a771003">3.3.4 关闭防火墙(所有节点)</a></li>
       <li><a href="#335	_180" rel="nofollow" data-token="a4ebf49ec1f1812fd2846784ad321c13">3.3.5 增加开启自启项(所有节点)</a></li>
       <li><a href="#336	ntp_187" rel="nofollow" data-token="b0121fc681a5a87c1a75c537e97b1784">3.3.6 安装时钟服务ntp</a></li>
       <ul>
        <li><a href="#3361	_189" rel="nofollow" data-token="5e2d0569adbcb1ee14730d3b034ab8a7">3.3.6.1 主节点安装时钟服务器</a></li>
        <li><a href="#3362	_203" rel="nofollow" data-token="6f739e1413ca859aef5eaf9a635bf6b7">3.3.6.2 子节点安装时钟服务并同步到主节点</a></li>
       </ul>
      </ul>
      <li><a href="#34	mysql_212" rel="nofollow" data-token="1e13f75319ca4ee673f1d02d695f4601">3.4 安装mysql</a></li>
      <ul>
       <li><a href="#341	_215" rel="nofollow" data-token="b4279dc028b73d02008756992ad5fcb3">3.4.1 安装</a></li>
       <li><a href="#342	root_220" rel="nofollow" data-token="e8fe9072574ee2cbbaf78fc886de327a">3.4.2 修改root用户密码</a></li>
      </ul>
      <li><a href="#343	_223" rel="nofollow" data-token="2dc56d01ced21b23bd7471b1099be1f9">3.4.3 创建相关数据库</a></li>
      <ul>
       <li><a href="#3431	Hive_224" rel="nofollow" data-token="b2b699427781781c4e6331461cc4ea52">3.4.3.1 Hive的元数据库</a></li>
       <li><a href="#3432	Cloudera_226" rel="nofollow" data-token="43d6af792956fd08559fbb201f764107">3.4.3.2 Cloudera的元数据库</a></li>
      </ul>
      <li><a href="#344	_228" rel="nofollow" data-token="6a3dfc9ac4444f31419a7d8e4dc35782">3.4.4 开启远程访问</a></li>
     </ul>
     <li><a href="#4_CM_237" rel="nofollow" data-token="1e5cd731143a7276eb15c6bac68cfc39">4. CM安装</a></li>
     <ul>
      <li><a href="#41_CMyum_240" rel="nofollow" data-token="10dc43b48a3b09ef75755c98311474d7">4.1 配置CM的yum源</a></li>
      <li><a href="#42	CM_251" rel="nofollow" data-token="d3f0229fe09cfc71a01dbfe4118f2a68">4.2 安装CM</a></li>
     </ul>
     <li><a href="#5_CDH_261" rel="nofollow" data-token="cb1b4ecb12ff7f5c941b4baa24f1bc3c">5. CDH集群安装</a></li>
     <ul>
      <li><a href="#51	_262" rel="nofollow" data-token="a89cdcedb2557bb665546ee08468cf33">5.1 选择子节点</a></li>
      <li><a href="#52	CDHCM_264" rel="nofollow" data-token="720e2dc8c2352127c061e8ef3ec827a0">5.2 CDH和CM的具体网络位置的选择</a></li>
      <ul>
       <li><a href="#521	CDH_266" rel="nofollow" data-token="f5d862229d7d1c5605bf7f88c0bc9758">5.2.1 选择CDH的位置</a></li>
       <li><a href="#522	CM_269" rel="nofollow" data-token="0239a2c18843ad218b7ce4c7c096835b">5.2.2 选择CM的位置</a></li>
      </ul>
      <li><a href="#53	JDK_273" rel="nofollow" data-token="d47dbd1ea2d56de5690ad47a723ad9a2">5.3 分发JDK</a></li>
      <li><a href="#54	Agent_277" rel="nofollow" data-token="ce4369497b1de2d1ff823b7f79de35da">5.4 Agent的安装和配置</a></li>
     </ul>
     <li><a href="#6_flume_279" rel="nofollow" data-token="97cf02fc267e51c804d6a9df9d494eac">6. 安装flume</a></li>
     <li><a href="#7hive_280" rel="nofollow" data-token="74cb50634d179c5d537c4020f86d88a7">7.安装hive</a></li>
     <li><a href="#8kafka_281" rel="nofollow" data-token="6fc91dc283bc633b42672213d4a35d5d">8.安装kafka</a></li>
     <li><a href="#9_282" rel="nofollow" data-token="cf571172a71222cf44d59a855839b143">9.高可用配置</a></li>
     <li><a href="#10_283" rel="nofollow" data-token="0f8921ef1f62c5e0cf1dcc8f34330952">10.配置调整</a></li>
     <li><a href="#11_284" rel="nofollow" data-token="ae2f3b4477ae8963361c6b8afea7aa41">11.添加子节点</a></li>
    </ul>
   </ul>
  </div>
  <p></p> 
  <h2><a id="_1"></a>简介</h2> 
  <ul> 
   <li>Apache Hadoop<br> 由Apache 公司开源的Hadoop版本。涵盖了最原生的Hadoop特性，所有的Hadoop发行版均基于该版本进行改进。</li> 
   <li>Cloudera CDH<br> 由Cloudera公司发行的Hadoop版本，全称（Cloudera’s Distribution Including Apache Hadoop）。该版本在基于原生Apache Hadoop版本进行改进，添加了补丁和自行开发的组件，更加稳定易用。目前国内使用最多的版本。</li> 
   <li>Hortonworks Ambari<br> -Ambari是Hortonworks开源的Hadoop平台的管理软件，具备Hadoop组件的安装、管理、运维等基本功能，提供Web UI进行可视化的集群管理，简化了大数据平台的安装、使用难度。<br> 1、技术细节：hadoop版本、组件及功能选择<br> 2、易于部署：管理工具选择、版本更新、补丁添加等等<br> 3、易于维护：集群管理、容灾能力等<br> 4、成本：版本费用、计费模式和许可证<br> 5、企业应用集成的支持：选择的Hadoop应用和现有企业其他应用集成的支持。</li> 
  </ul> 
  <h2><a id="1__13"></a>1. 软件环境</h2> 
  <table> 
   <thead> 
    <tr> 
     <th>名称</th> 
     <th>版本</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td>Linux</td> 
     <td>CentOS 7x64</td> 
    </tr> 
    <tr> 
     <td>CM</td> 
     <td>5.12.1</td> 
    </tr> 
    <tr> 
     <td>CDH</td> 
     <td>5.12.1</td> 
    </tr> 
   </tbody> 
  </table> 
  <table> 
   <thead> 
    <tr> 
     <th>主机名</th> 
     <th>内存</th> 
     <th>CPU</th> 
     <th>IP</th> 
     <th>角色</th> 
    </tr> 
   </thead> 
   <tbody> 
    <tr> 
     <td>cdh01</td> 
     <td>5G</td> 
     <td>1核2线程</td> 
     <td>192.168.88.121</td> 
     <td>CM server,agent</td> 
    </tr> 
    <tr> 
     <td>cdh02</td> 
     <td>2G</td> 
     <td>1核2线程</td> 
     <td>192.168.88.122</td> 
     <td>agent</td> 
    </tr> 
    <tr> 
     <td>cdh03</td> 
     <td>2G</td> 
     <td>1核2线程</td> 
     <td>192.168.88.123</td> 
     <td>agent</td> 
    </tr> 
   </tbody> 
  </table>
  <h2><a id="2__25"></a>2. 虚拟机配置</h2> 
  <h3><a id="21_IPNAT_26"></a>2.1 设置网络IP(NAT模式)</h3> 
  <ul> 
   <li>修改配置文件:<br> vi /etc/sysconfig/network-scripts/ifcfg-eno16777736</li> 
   <li>注释#BOOTPROTO=“dhcp”</li> 
   <li>添加<br> IPADDR=192.168.88.121<br> NETMASK=255.255.255.0<br> GATEWAY=192.168.88.2<br> DNS1=192.168.88.2</li> 
   <li>其他节点同理<pre><code class="prism language-xml">TYPE="Ethernet"
#BOOTPROTO="dhcp"
DEFROUTE="yes"
PEERDNS="yes"
PEERROUTES="yes"
IPV4_FAILURE_FATAL="no"
IPV6INIT="yes"
IPV6_AUTOCONF="yes"
IPV6_DEFROUTE="yes"
IPV6_PEERDNS="yes"
IPV6_PEERROUTES="yes"
IPV6_FAILURE_FATAL="no"
NAME="eno16777736"
UUID="858a5a33-4c55-49e9-8b59-1cfeb56d4b8b"
DEVICE="eno16777736"
ONBOOT="yes"
IPADDR=192.168.88.121
NETMASK=255.255.255.0
GATEWAY=192.168.88.2
DNS1=192.168.88.2
</code></pre> </li> 
  </ul> 
  <h3><a id="22__58"></a>2.2 关闭防火墙</h3> 
  <ul> 
   <li>关闭:<br> systemctl stop firewalld<br> systemctl disable firewalld</li> 
   <li>查看:systemctl status firewalld</li> 
  </ul> 
  <h3><a id="23__64"></a>2.3 永久修改设置主机名</h3> 
  <ul> 
   <li>vi /etc/hostname 注意：需要重启生效-&gt;reboot</li> 
  </ul> 
  <h3><a id="24__66"></a>2.4 配置映射文件</h3> 
  <ul> 
   <li>vi /etc/hosts<pre><code class="prism language-xml"> #127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
 #::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
 192.168.88.121 cdh01
 192.168.88.122 cdh02
 192.168.88.123 cdh03
</code></pre> </li> 
  </ul> 
  <h3><a id="25_ssh_75"></a>2.5 配置ssh免密登录</h3> 
  <ul> 
   <li>生成密钥对:ssh-keygen</li> 
   <li>ssh-copy-id cdh01</li> 
   <li>ssh-copy-id cdh02</li> 
   <li>ssh-copy-id cdh03</li> 
  </ul> 
  <h3><a id="26_jdk_80"></a>2.6 安装jdk</h3> 
  <h3><a id="27_selinux__81"></a>2.7 关闭selinux 安全模块</h3> 
  <ul> 
   <li>vim /etc/selinux/config （将SELINUX改为disabled）</li> 
   <li>重启所有节点，检查是否关闭getenforce</li> 
  </ul> 
  <h2><a id="3_84"></a>3.环境准备</h2> 
  <h3><a id="31__85"></a>3.1 私有网络软件仓库</h3> 
  <ul> 
   <li>在集群安装的过程中，要求每个节点都必须挂载光驱， 而对于每台节点都手动的去挂载光驱太麻烦，也不方便。这里使用每个节点都指向同一个私有网络镜像来解决这个问题。<br> 我们的集群采用的是全离线安装，也不可能逐个节点的安装，同样是也使用指向同一个私有的网络软件包来解决<br> 因此选择在cdh01上搭建一个私有的网络软件仓库，以下是搭建的全过程。</li> 
  </ul> 
  <h4><a id="311	_89"></a>3.1.1 上传镜像</h4> 
  <ul> 
   <li>搭建私有网络镜像使用的镜像文件最好就使用安装系统的镜像，这里是选择了CentOS7x64的镜像，将其上传到cdh01的/disk下（需新建/disk目录）</li> 
  </ul> 
  <h4><a id="312	_91"></a>3.1.2 挂载镜像</h4> 
  <ul> 
   <li>mkdir -p /media/CentOS</li> 
   <li>挂载镜像：mount -o loop /disk/CentOS-7-x86_64.iso /media/CentOS/</li> 
   <li>cd /etc/yum.repos.d</li> 
   <li>mv CentOS-Base.repo CentOS-Base.repo.bak</li> 
   <li>vi CentOS-Media.repo -&gt; 将enable=0改成enable=1</li> 
   <li>清除yum的缓存：<br> yum clean metadata<br> yum clean dbcache</li> 
   <li>查看是否挂载成功：yum list | wc -l<br> 这是统计镜像中有多少个软件包的命令，CentOS7x64位的系统的软件包个数一般在3000以上</li> 
  </ul> 
  <h4><a id="313	httpb_102"></a>3.1.3 安装http(如果已经安装可以省略，但是需要启动，一b般最小化安装不会安装此服务)</h4> 
  <ul> 
   <li>检查是否安装:service httpd status</li> 
   <li>安装:yum install -y httpd</li> 
   <li>启动http服务，并让其开机自启：<br> service httpd start<br> chkconfig httpd on</li> 
   <li>由于http的默认端口为80，通过浏览器访问：<br> 192.168.88.121:80</li> 
   <li>创建网络软件仓库目录：mkdir –p /var/www/html<br> http默认将上面的目录作为软件仓库的目录</li> 
  </ul> 
  <h4><a id="314	createrepo_112"></a>3.1.4 安装createrepo(如果已经安装省略)</h4> 
  <ul> 
   <li>该软件使用来生成http镜像的网络识别路径的：<br> yum install createrepo</li> 
   <li>到此 私有的网络软件仓库搭建完成</li> 
  </ul> 
  <h3><a id="32	_116"></a>3.2 挂载网络系统镜像</h3> 
  <h4><a id="321	_117"></a>3.2.1 创建网络系统镜像</h4> 
  <ul> 
   <li>将从镜像中挂载的文件拷贝到软件仓库的目录中<br> cp -r /media/CentOS /var/www/html/</li> 
   <li>删除目录repodata<br> cd /var/www/html/CentOS<br> rm -rf ./repodata</li> 
   <li>生成新的软件路径目录repodata<br> createrepo .<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730133235206.png" alt="在这里插入图片描述"></li> 
   <li>查看:192.168.88.121/CentOS<br> 到此网络镜像创建成功。</li> 
  </ul> 
  <h4><a id="322	_128"></a>3.2.2 使用网络系统镜像</h4> 
  <ul> 
   <li> <p>解除对镜像文件的挂载：umount /media/CentOS<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730131041489.png" alt="在这里插入图片描述"><br> 如上图 ，目录下无文件则说明解除挂载成功。<br> 如果出现下图说明还有进程在使用/medis/CentOS挂载点，那么此时可以借助fuser命令找出占用目录/medis/CentOS的所有进程，然后kill掉，此时就可以umount 了<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730131213698.png" alt="在这里插入图片描述"></p> </li> 
   <li> <p>修改文件CentOS-Media.repo让其指向刚才创建的网络镜像<br> vi /etc/yum.repos.d/CentOS-Media.repo<br> 修改:baseurl=http://192.168.88.121/CentOS/<br> scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/<br> scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/</p> </li> 
   <li> <p>清除yum的缓存， 并查看软件包个数（参考3.1.2）<br> 到此，cdh01网络系统镜像挂载完成，可以将镜像文件删除了。</p> </li> 
  </ul> 
  <h3><a id="33_CMCDH_142"></a>3.3 创建CM和CDH网络软件镜像</h3> 
  <h4><a id="331	CM_143"></a>3.3.1 创建CM网络软件镜像</h4> 
  <ul> 
   <li> <p>CM下载地址(总地址)<br> <a href="http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/" rel="nofollow" data-token="57b9949d9baa1034da3ebd1493915c1e">http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/</a><br> <a href="http://archive.cloudera.com/cm5/cm/5/" rel="nofollow" data-token="f226735ffa912500a5ccb5b0d18a3863">http://archive.cloudera.com/cm5/cm/5/</a><br> 下载rmp仓库文件:<br> <a href="http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/cloudera-manager.repo" rel="nofollow" data-token="647b2870bf61cee06f4ea49facb360af">http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/cloudera-manager.repo</a><br> <a href="http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera" rel="nofollow" data-token="032a98ccf2d7d1f7f4d4f1e59cc666cf">http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/RPM-GPG-KEY-cloudera</a> <br> <a href="http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/mirrors" rel="nofollow" data-token="bbfb0dcfae25409d9169260b41868aa3">http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/mirrors</a><br> 分开下载RMP:</p> <pre><code class="prism language-xml">http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-agent-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-daemons-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/cloudera-manager-server-db-2-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.14.1/RPMS/x86_64/enterprise-debuginfo-5.14.1-1.cm5141.p0.1.el7.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm
http://archive.cloudera.com/cm5/redhat/7/x86_64/cm/5.12.1/RPMS/x86_64/jdk-6u31-linux-amd64.rpm
</code></pre> </li> 
   <li> <p>通过xftp上传cm和CDH安装包到软件仓库目录中/var/www/html/（注意：相关的目录需要自己创建）,目录结构如下<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730203920189.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RmeUJsb2c=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> </li> 
  </ul> 
  <h4><a id="332	CDH_164"></a>3.3.2 创建CDH网络镜像</h4> 
  <ul> 
   <li>下载地址：<a href="http://archive.cloudera.com/cdh5/parcels/5.12.1/" rel="nofollow" data-token="86002f38b3fb512ad08f7860da814a4c">http://archive.cloudera.com/cdh5/parcels/5.12.1/</a></li> 
   <li>通过xftp上传cdh安装压缩包到软件仓库目录中（注意：相关的目录需要自己创建，三个文件一个也不能少）</li> 
   <li>不需要解压，到此cdh的网络软件镜像创建成功，也可以通过浏览器访问查看详情</li> 
  </ul> 
  <h4><a id="333__168"></a>3.3.3 子节点挂载网络镜像</h4> 
  <ul> 
   <li>将主节点的 /etc/ yum.repos.d下的CentOS-Media.repo文件分发到各子节点的目录/etc/ yum.repos.d下：<br> scp -r /etc/yum.repos.d/CentOS-Media.repo cdh02:/etc/yum.repos.d/<br> scp -r /etc/yum.repos.d/CentOS-Media.repo cdh03:/etc/yum.repos.d/</li> 
   <li>在所有子节点执行如下命令:<br> mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak</li> 
   <li>再清除yum的缓存，查看网络镜像软件包的个数（具体命令参考3.1.2）</li> 
   <li>到此，子节点网络镜像挂载完成。</li> 
  </ul> 
  <h4><a id="334	_176"></a>3.3.4 关闭防火墙(所有节点)</h4> 
  <ul> 
   <li>systemctl stop firewalld<br> systemctl disable firewalld<br> 查看:systemctl status firewalld</li> 
  </ul> 
  <h4><a id="335	_180"></a>3.3.5 增加开启自启项(所有节点)</h4> 
  <ul> 
   <li>vi /etc/rc.local<br> 添加<br> echo 0 &gt; /proc/sys/vm/swappiness<br> echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled<br> echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/defrag<br> swapoff -a</li> 
  </ul> 
  <h4><a id="336	ntp_187"></a>3.3.6 安装时钟服务ntp</h4> 
  <ul> 
   <li>时钟服务器安装在主节点上，子节点的时钟服服务全部同步到主节点的时钟服务器上。</li> 
  </ul> 
  <h5><a id="3361	_189"></a>3.3.6.1 主节点安装时钟服务器</h5> 
  <ul> 
   <li>安装时钟服务ntp: yum -y install ntp</li> 
   <li>启动，并注册到开机自启：<br> service ntpd start<br> chkconfig ntpd on</li> 
   <li>查看ntpd的状态：service ntpd status</li> 
   <li>配置时钟服务器，vi /etc/ntp.conf<br> 1.注释放开:表明时钟同步的网段<br> restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap<br> 2.server 0…server 1…server 2…server 3…注释掉<br> 3.添加 表明服务器是跟自己同步<br> server 127.127.1.0<br> fudge 127.127.1.0 statum 10</li> 
   <li>重启ntp服务service ntpd restart</li> 
  </ul> 
  <h5><a id="3362	_203"></a>3.3.6.2 子节点安装时钟服务并同步到主节点</h5> 
  <ul> 
   <li>ntp服务安装,参考3.4.61，主要的区别在于配置的修改上</li> 
   <li>配置时钟服务器，vi /etc/ntp.conf<br> 1.注释放开:表明时钟同步的网段<br> restrict 192.168.88.0 mask 255.255.255.0 nomodify notrap<br> 2.server 0…server 1…server 2…server 3…注释掉<br> 3.添加 server cdh01</li> 
   <li>重启ntp服务service ntpd restart</li> 
   <li>时钟会自动同步的（需要一定的时间）。查看同步状态的命令：ntpstat</li> 
  </ul> 
  <h3><a id="34	mysql_212"></a>3.4 安装mysql</h3> 
  <ul> 
   <li>安装mysql的用处是提供cm存储集群信息以及hive的元数据库的。只需要安装一个mysql数据库即可，虽说mysql可以随意安装在集群的任意接节点，这里还是建议安装在cm。<br> 安装mysql的过程如下：</li> 
  </ul> 
  <h4><a id="341	_215"></a>3.4.1 安装</h4> 
  <ul> 
   <li>yum -y install mysql-server</li> 
   <li>启动并开启开机启动：<br> service mysqld start<br> chkconfig mysqld on</li> 
  </ul> 
  <h4><a id="342	root_220"></a>3.4.2 修改root用户密码</h4> 
  <ul> 
   <li>mysqladmin -u root password “root”</li> 
   <li>登录mysql:mysql -uroot -proot</li> 
  </ul> 
  <h3><a id="343	_223"></a>3.4.3 创建相关数据库</h3> 
  <h4><a id="3431	Hive_224"></a>3.4.3.1 Hive的元数据库</h4> 
  <ul> 
   <li>create database hive DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</li> 
  </ul> 
  <h4><a id="3432	Cloudera_226"></a>3.4.3.2 Cloudera的元数据库</h4> 
  <ul> 
   <li>create database amon DEFAULT CHARSET utf8 COLLATE utf8_general_ci;</li> 
  </ul> 
  <h3><a id="344	_228"></a>3.4.4 开启远程访问</h3> 
  <ul> 
   <li>选择mysql库: use mysql;</li> 
   <li>修改访问权限表:grant all privileges on <em>.</em> to “root”@"%" identified by “root” with grant option;</li> 
   <li>刷新权限：flush privileges;</li> 
   <li>查看是否开启远程访问：select user,password,host from user;<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730213013642.png" alt="在这里插入图片描述"> 上图的最后一行表示已经开启了root用的远程访问。 符号%表示所有主机。到此 mysql安装完毕。</li> 
  </ul> 
  <h2><a id="4_CM_237"></a>4. CM安装</h2> 
  <ul> 
   <li>在3.3.1中我们只是建立了CM的网络软件镜像，但是我们并没有让系统识别，现在开始一步步安装CM<br> 由于CM只要安装在主节点cdh01上，因此一下操作仅仅只在cdh01上执行。</li> 
  </ul> 
  <h3><a id="41_CMyum_240"></a>4.1 配置CM的yum源</h3> 
  <ul> 
   <li>从CM网络镜像中拷贝cloudera-manager.repo<br> cp /var/www/html/cm5.12/cloudera-manager.repo /etc/yum.repos.d/</li> 
   <li>cd /etc/yum.repos.d/<br> vi cloudera-manager.repo<br> baseurl=http://192.168.88.121/cm5.12/<br> gpgkey =http://192.168.88.121/cm5.12/RPM-GPG-KEY-cloudera<br> gpgcheck = 0</li> 
   <li>检查:yum repolist<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190730171630560.png" alt="在这里插入图片描述"></li> 
   <li>备份:cp cloudera-manager.repo cloudera-cm.repo</li> 
  </ul> 
  <h3><a id="42	CM_251"></a>4.2 安装CM</h3> 
  <ul> 
   <li>找到CM安装的引导文件：cloudera-manager-installer.bin<br> 可从http://archive.cloudera.com/cm5/installer/5.12.1/下载，一定要对应你的CM的版本。将其上传到/opt下</li> 
   <li>赋予其执行权限:chmod 755 cloudera-manager-installer.bin</li> 
   <li>到此就可以开始安装CM了,执行命令：/opt/cloudera-manager-installer.bin</li> 
   <li>出现安装引导界面：-&gt;next-&gt;next-&gt;yes-&gt;next-&gt;yes就会开始安装jdk， 因此并不需要事先安装jdk-&gt;安装CM服务（有点慢， 耐心等待）-&gt;成功</li> 
   <li>我们可以通过命令查看cloudera的服务是否启动：<br> service cloudera-scm-server status</li> 
   <li>访问:<a href="http://cdh01:7180" rel="nofollow" data-token="56ec2de6b38e009b9621efe9c27c5030">http://cdh01:7180</a><br> 用户名密码均为admin，登录后进行cdh集群安装界面。到此CM安装完成。</li> 
  </ul> 
  <h2><a id="5_CDH_261"></a>5. CDH集群安装</h2> 
  <h3><a id="51	_262"></a>5.1 选择子节点</h3> 
  <ul> 
   <li>在登录了后，进入的第一个界面是cloudera的最终用户许可条款和条件,勾选是的，再点继续，进入CDH版本选择界面，这里选择免费版， 再点击继续，进行感谢界面：直接点击继续，进入了节点选择界面：在这个界面我们需要填入，我们集群的所有节点主机名（可从任意节点的hosts文件中拷贝。），以英文逗号分隔，填完了后点击搜索：</li> 
  </ul> 
  <h3><a id="52	CDHCM_264"></a>5.2 CDH和CM的具体网络位置的选择</h3> 
  <ul> 
   <li>在确认主机无误后，点击继续，就可以进入CDH和CM的网络位置选择界面。</li> 
  </ul> 
  <h4><a id="521	CDH_266"></a>5.2.1 选择CDH的位置</h4> 
  <ul> 
   <li>先点击 更多选项，进入CDH网络位置选择界面,修改成我们自己的CDH网络软件镜像的地址：<a href="http://192.168.88.121/cdh/" rel="nofollow" data-token="c9d9971657e30d9de0276cc12d1129f7">http://192.168.88.121/cdh/</a><br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019073113352037.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RmeUJsb2c=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li> 
  </ul> 
  <h4><a id="522	CM_269"></a>5.2.2 选择CM的位置</h4> 
  <ul> 
   <li>在选择了CDH后，我们继续点击 自定义存储库 来选择我们自己的CM：其实呢，就是把配置cloudera-cm.repo（参考4.1）的配置拿出来，在界面上填一遍，我们的填写如下：<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190731134104892.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RmeUJsb2c=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li> 
   <li>填写完成后，就会进入给每个节点安装cloudera-scm-agent的界面，再点击继续前，我们需要将hadoop-cm中安装CM时安装的JDK文件分发到每个子节点，不然子节点在安装cloudera-scm-agent会包错。</li> 
  </ul> 
  <h3><a id="53	JDK_273"></a>5.3 分发JDK</h3> 
  <ul> 
   <li>在hadoop-cm安装CM时，CM会将JDK安装到/usr/java/目录下,因此我们把hadoop-cm整个java目录分发给所有的子节点就好了，在hadoop-cm下执行：<br> scp -r /usr/java cdh02:/usr/<br> scp -r /usr/java cdh03:/usr/</li> 
  </ul> 
  <h3><a id="54	Agent_277"></a>5.4 Agent的安装和配置</h3> 
  <ul> 
   <li>Jdk分发完成后，点击继续，进入jdk安装选项,由于我们已经分发，这个就不需要勾选，直接点击继续，进入选择是否启动单用户模式:这里选择不启用，直接点击继续，进入节点通信选择：我们这里使用 所有用户接收相同的密码，填入密码后，点击继续，进行agent安装界面， 耐心等待安装完成，分发为完成后，点击继续，进入agent主机检查：</li> 
  </ul> 
  <h2><a id="6_flume_279"></a>6. 安装flume</h2> 
  <h2><a id="7hive_280"></a>7.安装hive</h2> 
  <h2><a id="8kafka_281"></a>8.安装kafka</h2> 
  <h2><a id="9_282"></a>9.高可用配置</h2> 
  <h2><a id="10_283"></a>10.配置调整</h2> 
  <h2><a id="11_284"></a>11.添加子节点</h2> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
