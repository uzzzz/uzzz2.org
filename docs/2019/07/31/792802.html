<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>PostgreSQL的日志文件和数据加载 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="PostgreSQL的日志文件和数据加载" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="墨墨导读：本文主要介绍PostgreSQL的日志文件参数及注意事项，从csv日志中载入数据库。通过灵活的数据加载方式，让SQL在处理很多问题上更加简捷便利。 &nbsp;运行日志参数 1.1 运行日志主要参数 运行日志主要相关的参数如下，默认没有开启的话没有log目录，开启后会自动生成。 1.2&nbsp; 注意事项 设置csv格式日志的话一定要设置logging_collector 为 on pg10版本的运行日志一般在$PGDATA/log目录下 log目录是开启运行日志后自动生成的 可以通过log_rotation_age来设置多久重新生成一个日志文件 可以通过log_rotation_size来设置多大的日志来重新生成日志文件 上面两个都需要配合log_truncate_on_rotation 为 on来使用 可以开启log_duration来记录sql执行时间 可以开启log_statement来记录数据库ddl 1.3&nbsp; csv日志载入数据库 Oracle有外部表，pg也有fdw。oracle可以用外部表的方式将alert日志载入到数据库中用SQL来查看。PG可以用copy命令将csv日志载入到数据库中用SQL来查看。这种方式都可以很方便得用sql来查询想要的日志内容。这种方式的有点是显而易见的，就是可以很容易得用SQL来查询和过滤日志，pg的日志文件可以截断分割成若干小文件，可以载入自己需要的日志。而Oracle的alert通常会很大。 缺点也是显而易见的，如果数据库挂了就不能用这种方式来查看日志。而且pg的csv日志不容易直接阅读。 1.3.1 创建日志表 创建了一个数据库和新的表来载入日志 postgres=# create database test;CREATE DATABASEpostgres=# \c testYou are now connected to database &quot;test&quot; as user &quot;pg12&quot;.test=# CREATE TABLE pg_logtest-# (test(# log_time timestamp(3) with time zone,test(# user_name text,test(# database_name text,test(# process_id integer,test(# connection_from text,test(# session_id text,test(# session_line_num bigint,test(# command_tag text,test(# session_start_time timestamp with time zone,test(# virtual_transaction_id text,test(# transaction_id bigint,test(# error_severity text,test(# sql_state_code text,test(# message text,test(# detail text,test(# hint text,test(# internal_query text,test(# internal_query_pos integer,test(# context text,test(# query text,test(# query_pos integer,test(# location text,test(# application_name text,test(# PRIMARY KEY (session_id, session_line_num)test(# );CREATE TABLEtest=# 1.3.2 查看日志文件名字 [pg12@whf307 ~]$ cd $PGDATA/log[pg12@whf307 log]$ ls -rtltotal 24-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$[pg12@whf307 log]$ pwd/soft/pg_data/log[pg12@whf307 log]$ 1.3.3 载入到数据库 [pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# \d List of relations Schema | Name | Type | Owner --------+--------+-------+------- public | pg_log | table | pg12(1 row)test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-30_133324.csv&#39; with csv; COPY 32 1.3.4 查看日志 这样就可以用sql来查看了。执行一个普通查询 test=# select relfilenode from pg_class where relname=&#39;pg_log&#39;; relfilenode ------------- 16385(1 row) 载入最新的日志。这里可以重复载入，不会覆盖之前的数据。 [pg12@whf307 log]$ ls -rtltotal 32-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 4545 May 31 00:37 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-31_000000.csv&#39; with csv; COPY&nbsp;28 再次查看日志 test=# SELECT COUNT(*) FROM PG_LOG; count ------- 60(1 row)test=# select log_time at time zone &#39;UTC&#39; ,database_name,connection_from,query from pg_log where log_time&gt;to_timestamp(&#39;2019-05-31 14:35:00&#39;,&#39;yyyy-mm-dd hh24:mi:ss&#39;); timezone | database_name | connection_from | query -------------------------+---------------+-----------------+----------------------------------------------------------- 2019-05-31 06:35:42.843 | test | [local] | 2019-05-31 06:35:57.582 | test | [local] | 2019-05-31 06:36:54.369 | test | [local] | selectt relfilenode from pg_class where relname=&#39;pg_log&#39;; 2019-05-31 06:36:58.002 | test | [local] | 2019-05-31 06:37:00.192 | test | [local] | 2019-05-31 06:37:11.651 | | [local] | 2019-05-31 06:37:11.651 | test | [local] | (7 rows) 可以看到记录数变成了60，之前的记录没有被覆盖，我们可以一直使用该表，可以用sql来查看sql，数据库，登录时间等等的所有日志。 查看日志起始结束时间： test=# select min(log_time) at time zone &#39;UTC&#39;,max(log_time) at time zone &#39;UTC&#39; from pg_log; timezone | timezone -------------------------+------------------------- 2019-05-30 19:33:24.892 | 2019-05-31 06:37:11.651(1 row) 有了灵活的数据加载方式，让SQL处理很多问题更加简捷便利。 扩展阅读 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（上） 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（下） 解读年度数据库PostgreSQL：如何处理并发控制（一） “王者对战”之 MySQL 8 vs PostgreSQL 10 大象起舞：用PostgreSQL解海盗分金问题 解读年度数据库PostgreSQL：如何巧妙地实现缓冲区管理器 解读年度数据库PostgreSQL：如何处理并发控制（一） 数据和云，半年文章精选（文末赠书） 美女DBA带你了解PostgreSQL用户及角色 从Oracle到PostgreSQL：最全控制文件 数据和云 ID：OraNews 如有收获，请划至底部，点击“在看”，谢谢！ 云和恩墨大讲堂 | 一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<meta property="og:description" content="墨墨导读：本文主要介绍PostgreSQL的日志文件参数及注意事项，从csv日志中载入数据库。通过灵活的数据加载方式，让SQL在处理很多问题上更加简捷便利。 &nbsp;运行日志参数 1.1 运行日志主要参数 运行日志主要相关的参数如下，默认没有开启的话没有log目录，开启后会自动生成。 1.2&nbsp; 注意事项 设置csv格式日志的话一定要设置logging_collector 为 on pg10版本的运行日志一般在$PGDATA/log目录下 log目录是开启运行日志后自动生成的 可以通过log_rotation_age来设置多久重新生成一个日志文件 可以通过log_rotation_size来设置多大的日志来重新生成日志文件 上面两个都需要配合log_truncate_on_rotation 为 on来使用 可以开启log_duration来记录sql执行时间 可以开启log_statement来记录数据库ddl 1.3&nbsp; csv日志载入数据库 Oracle有外部表，pg也有fdw。oracle可以用外部表的方式将alert日志载入到数据库中用SQL来查看。PG可以用copy命令将csv日志载入到数据库中用SQL来查看。这种方式都可以很方便得用sql来查询想要的日志内容。这种方式的有点是显而易见的，就是可以很容易得用SQL来查询和过滤日志，pg的日志文件可以截断分割成若干小文件，可以载入自己需要的日志。而Oracle的alert通常会很大。 缺点也是显而易见的，如果数据库挂了就不能用这种方式来查看日志。而且pg的csv日志不容易直接阅读。 1.3.1 创建日志表 创建了一个数据库和新的表来载入日志 postgres=# create database test;CREATE DATABASEpostgres=# \c testYou are now connected to database &quot;test&quot; as user &quot;pg12&quot;.test=# CREATE TABLE pg_logtest-# (test(# log_time timestamp(3) with time zone,test(# user_name text,test(# database_name text,test(# process_id integer,test(# connection_from text,test(# session_id text,test(# session_line_num bigint,test(# command_tag text,test(# session_start_time timestamp with time zone,test(# virtual_transaction_id text,test(# transaction_id bigint,test(# error_severity text,test(# sql_state_code text,test(# message text,test(# detail text,test(# hint text,test(# internal_query text,test(# internal_query_pos integer,test(# context text,test(# query text,test(# query_pos integer,test(# location text,test(# application_name text,test(# PRIMARY KEY (session_id, session_line_num)test(# );CREATE TABLEtest=# 1.3.2 查看日志文件名字 [pg12@whf307 ~]$ cd $PGDATA/log[pg12@whf307 log]$ ls -rtltotal 24-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$[pg12@whf307 log]$ pwd/soft/pg_data/log[pg12@whf307 log]$ 1.3.3 载入到数据库 [pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# \d List of relations Schema | Name | Type | Owner --------+--------+-------+------- public | pg_log | table | pg12(1 row)test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-30_133324.csv&#39; with csv; COPY 32 1.3.4 查看日志 这样就可以用sql来查看了。执行一个普通查询 test=# select relfilenode from pg_class where relname=&#39;pg_log&#39;; relfilenode ------------- 16385(1 row) 载入最新的日志。这里可以重复载入，不会覆盖之前的数据。 [pg12@whf307 log]$ ls -rtltotal 32-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 4545 May 31 00:37 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-31_000000.csv&#39; with csv; COPY&nbsp;28 再次查看日志 test=# SELECT COUNT(*) FROM PG_LOG; count ------- 60(1 row)test=# select log_time at time zone &#39;UTC&#39; ,database_name,connection_from,query from pg_log where log_time&gt;to_timestamp(&#39;2019-05-31 14:35:00&#39;,&#39;yyyy-mm-dd hh24:mi:ss&#39;); timezone | database_name | connection_from | query -------------------------+---------------+-----------------+----------------------------------------------------------- 2019-05-31 06:35:42.843 | test | [local] | 2019-05-31 06:35:57.582 | test | [local] | 2019-05-31 06:36:54.369 | test | [local] | selectt relfilenode from pg_class where relname=&#39;pg_log&#39;; 2019-05-31 06:36:58.002 | test | [local] | 2019-05-31 06:37:00.192 | test | [local] | 2019-05-31 06:37:11.651 | | [local] | 2019-05-31 06:37:11.651 | test | [local] | (7 rows) 可以看到记录数变成了60，之前的记录没有被覆盖，我们可以一直使用该表，可以用sql来查看sql，数据库，登录时间等等的所有日志。 查看日志起始结束时间： test=# select min(log_time) at time zone &#39;UTC&#39;,max(log_time) at time zone &#39;UTC&#39; from pg_log; timezone | timezone -------------------------+------------------------- 2019-05-30 19:33:24.892 | 2019-05-31 06:37:11.651(1 row) 有了灵活的数据加载方式，让SQL处理很多问题更加简捷便利。 扩展阅读 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（上） 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（下） 解读年度数据库PostgreSQL：如何处理并发控制（一） “王者对战”之 MySQL 8 vs PostgreSQL 10 大象起舞：用PostgreSQL解海盗分金问题 解读年度数据库PostgreSQL：如何巧妙地实现缓冲区管理器 解读年度数据库PostgreSQL：如何处理并发控制（一） 数据和云，半年文章精选（文末赠书） 美女DBA带你了解PostgreSQL用户及角色 从Oracle到PostgreSQL：最全控制文件 数据和云 ID：OraNews 如有收获，请划至底部，点击“在看”，谢谢！ 云和恩墨大讲堂 | 一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂" />
<link rel="canonical" href="https://uzzz.org/2019/07/31/792802.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/31/792802.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-31T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"墨墨导读：本文主要介绍PostgreSQL的日志文件参数及注意事项，从csv日志中载入数据库。通过灵活的数据加载方式，让SQL在处理很多问题上更加简捷便利。 &nbsp;运行日志参数 1.1 运行日志主要参数 运行日志主要相关的参数如下，默认没有开启的话没有log目录，开启后会自动生成。 1.2&nbsp; 注意事项 设置csv格式日志的话一定要设置logging_collector 为 on pg10版本的运行日志一般在$PGDATA/log目录下 log目录是开启运行日志后自动生成的 可以通过log_rotation_age来设置多久重新生成一个日志文件 可以通过log_rotation_size来设置多大的日志来重新生成日志文件 上面两个都需要配合log_truncate_on_rotation 为 on来使用 可以开启log_duration来记录sql执行时间 可以开启log_statement来记录数据库ddl 1.3&nbsp; csv日志载入数据库 Oracle有外部表，pg也有fdw。oracle可以用外部表的方式将alert日志载入到数据库中用SQL来查看。PG可以用copy命令将csv日志载入到数据库中用SQL来查看。这种方式都可以很方便得用sql来查询想要的日志内容。这种方式的有点是显而易见的，就是可以很容易得用SQL来查询和过滤日志，pg的日志文件可以截断分割成若干小文件，可以载入自己需要的日志。而Oracle的alert通常会很大。 缺点也是显而易见的，如果数据库挂了就不能用这种方式来查看日志。而且pg的csv日志不容易直接阅读。 1.3.1 创建日志表 创建了一个数据库和新的表来载入日志 postgres=# create database test;CREATE DATABASEpostgres=# \\c testYou are now connected to database &quot;test&quot; as user &quot;pg12&quot;.test=# CREATE TABLE pg_logtest-# (test(# log_time timestamp(3) with time zone,test(# user_name text,test(# database_name text,test(# process_id integer,test(# connection_from text,test(# session_id text,test(# session_line_num bigint,test(# command_tag text,test(# session_start_time timestamp with time zone,test(# virtual_transaction_id text,test(# transaction_id bigint,test(# error_severity text,test(# sql_state_code text,test(# message text,test(# detail text,test(# hint text,test(# internal_query text,test(# internal_query_pos integer,test(# context text,test(# query text,test(# query_pos integer,test(# location text,test(# application_name text,test(# PRIMARY KEY (session_id, session_line_num)test(# );CREATE TABLEtest=# 1.3.2 查看日志文件名字 [pg12@whf307 ~]$ cd $PGDATA/log[pg12@whf307 log]$ ls -rtltotal 24-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$[pg12@whf307 log]$ pwd/soft/pg_data/log[pg12@whf307 log]$ 1.3.3 载入到数据库 [pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# \\d List of relations Schema | Name | Type | Owner --------+--------+-------+------- public | pg_log | table | pg12(1 row)test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-30_133324.csv&#39; with csv; COPY 32 1.3.4 查看日志 这样就可以用sql来查看了。执行一个普通查询 test=# select relfilenode from pg_class where relname=&#39;pg_log&#39;; relfilenode ------------- 16385(1 row) 载入最新的日志。这里可以重复载入，不会覆盖之前的数据。 [pg12@whf307 log]$ ls -rtltotal 32-rw------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log-rw------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv-rw------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log-rw------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv-rw------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log-rw------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv-rw------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log-rw------- 1 pg12 pg12 4545 May 31 00:37 postgresql-2019-05-31_000000.csv[pg12@whf307 log]$ psql testpsql (12beta1)Type &quot;help&quot; for help.test=# copy pg_log from &#39;/soft/pg_data/log/postgresql-2019-05-31_000000.csv&#39; with csv; COPY&nbsp;28 再次查看日志 test=# SELECT COUNT(*) FROM PG_LOG; count ------- 60(1 row)test=# select log_time at time zone &#39;UTC&#39; ,database_name,connection_from,query from pg_log where log_time&gt;to_timestamp(&#39;2019-05-31 14:35:00&#39;,&#39;yyyy-mm-dd hh24:mi:ss&#39;); timezone | database_name | connection_from | query -------------------------+---------------+-----------------+----------------------------------------------------------- 2019-05-31 06:35:42.843 | test | [local] | 2019-05-31 06:35:57.582 | test | [local] | 2019-05-31 06:36:54.369 | test | [local] | selectt relfilenode from pg_class where relname=&#39;pg_log&#39;; 2019-05-31 06:36:58.002 | test | [local] | 2019-05-31 06:37:00.192 | test | [local] | 2019-05-31 06:37:11.651 | | [local] | 2019-05-31 06:37:11.651 | test | [local] | (7 rows) 可以看到记录数变成了60，之前的记录没有被覆盖，我们可以一直使用该表，可以用sql来查看sql，数据库，登录时间等等的所有日志。 查看日志起始结束时间： test=# select min(log_time) at time zone &#39;UTC&#39;,max(log_time) at time zone &#39;UTC&#39; from pg_log; timezone | timezone -------------------------+------------------------- 2019-05-30 19:33:24.892 | 2019-05-31 06:37:11.651(1 row) 有了灵活的数据加载方式，让SQL处理很多问题更加简捷便利。 扩展阅读 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（上） 《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（下） 解读年度数据库PostgreSQL：如何处理并发控制（一） “王者对战”之 MySQL 8 vs PostgreSQL 10 大象起舞：用PostgreSQL解海盗分金问题 解读年度数据库PostgreSQL：如何巧妙地实现缓冲区管理器 解读年度数据库PostgreSQL：如何处理并发控制（一） 数据和云，半年文章精选（文末赠书） 美女DBA带你了解PostgreSQL用户及角色 从Oracle到PostgreSQL：最全控制文件 数据和云 ID：OraNews 如有收获，请划至底部，点击“在看”，谢谢！ 云和恩墨大讲堂 | 一个分享交流的地方 长按，识别二维码，加入万人交流社群 请备注：云和恩墨大讲堂","@type":"BlogPosting","url":"https://uzzz.org/2019/07/31/792802.html","headline":"PostgreSQL的日志文件和数据加载","dateModified":"2019-07-31T00:00:00+08:00","datePublished":"2019-07-31T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/31/792802.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>PostgreSQL的日志文件和数据加载</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div class="htmledit_views" id="content_views"> 
  <div class="rich_media_content" id="js_content"> 
   <p style="clear:both;min-height:1em;"><strong><span style="font-size:15px;">墨墨导读：</span></strong><span style="font-size:15px;">本文主要介绍PostgreSQL的日志文件参数及注意事项，从csv日志中载入数据库。通过灵活的数据加载方式，让SQL在处理很多问题上更加简捷便利。</span></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;"></span><br></p>
   <p style="line-height:1.5em;"><span style="font-size:17px;">&nbsp;<strong><span style="color:rgb(0,122,170);">运行日志参数</span></strong></span></p>
   <hr style="border-style:solid;border-width:1px 0 0;border-color:rgba(0,0,0,.1);">
   <p style="line-height:1.5em;"><span style="font-size:15px;"><strong><br></strong></span><span style="font-size:16px;"><strong>1.1 运行日志主要参数</strong></span><br></p>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">运行日志主要相关的参数如下，默认没有开启的话没有log目录，开启后会自动生成。</span></p>
   <p style="line-height:1.5em;"><br></p>
   <p style="text-align:center;"><img class="rich_pages" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/bURPjgFpGMTX0zO53DdksCIciacLXmBjxK19SZFPqxSvZYOpQSrV0XW8GyzumScZ0Owkq0jQRoxeRxKn8wTibgWw/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <br>
   <p style="line-height:1.5em;"><span style="font-size:16px;"><strong>1.2&nbsp; 注意事项</strong></span></p>
   <p style="line-height:1.5em;"><span style="font-size:16px;"><strong><br></strong></span></p>
   <ul class="list-paddingleft-2" style="list-style-type:disc;">
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">设置csv格式日志的话一定要设置logging_collector 为 on</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">pg10版本的运行日志一般在$PGDATA/log目录下</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">log目录是开启运行日志后自动生成的</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">可以通过log_rotation_age来设置多久重新生成一个日志文件</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">可以通过log_rotation_size来设置多大的日志来重新生成日志文件</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">上面两个都需要配合log_truncate_on_rotation 为 on来使用</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">可以开启log_duration来记录sql执行时间</span></p></li>
    <li><p style="line-height:1.5em;"><span style="font-size:15px;">可以开启log_statement来记录数据库ddl</span></p></li>
   </ul>
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:16px;"><strong>1.3&nbsp; csv日志载入数据库</strong></span><span style="font-size:15px;"></span></p>
   <p style="line-height:1.5em;"><br><span style="font-size:15px;">Oracle有外部表，pg也有fdw。</span><span style="font-size:15px;">oracle可以用外部表的方式将alert日志载入到数据库中用SQL来查看。</span><span style="font-size:15px;">PG可以用copy命令将csv日志载入到数据库中用SQL来查看。</span><span style="font-size:15px;">这种方式都可以很方便得用sql来查询想要的日志内容。</span><span style="font-size:15px;">这种方式的有点是显而易见的，就是可以很容易得用SQL来查询和过滤日志，pg的日志文件可以截断分割成若干小文件，可以载入自己需要的日志。</span><span style="font-size:15px;">而Oracle的alert通常会很大。</span><br><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">缺点也是显而易见的，如果数据库挂了就不能用这种方式来查看日志。</span><span style="font-size:15px;">而且pg的csv日志不容易直接阅读。</span></p>
   <p style="line-height:2em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;"><strong><span style="color:rgb(0,0,0);">1.3.1 创建日志表</span></strong></span></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;"><strong><span style="color:rgb(0,0,0);"><br></span></strong></span></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">创建了一个数据库和新的表来载入日志</span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">postgres=<span class="code-snippet__comment"># create database test;</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">DATABASE</span></span></code><code><span class="code-snippet_outer">postgres=<span class="code-snippet__comment"># \c test</span></span></code><code><span class="code-snippet_outer">You <span class="code-snippet__keyword">are</span> <span class="code-snippet__keyword">now</span> connected <span class="code-snippet__keyword">to</span> <span class="code-snippet__keyword">database</span> <span class="code-snippet__string">"test"</span> <span class="code-snippet__keyword">as</span> <span class="code-snippet__keyword">user</span> <span class="code-snippet__string">"pg12"</span>.</span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>=<span class="code-snippet__comment"># CREATE TABLE pg_log</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>-<span class="code-snippet__comment"># (</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># log_time timestamp(3) with time zone,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># user_name text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># database_name text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># process_id integer,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># connection_from text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># session_id text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># session_line_num bigint,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># command_tag text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># session_start_time timestamp with time zone,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># virtual_transaction_id text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># transaction_id bigint,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># error_severity text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># sql_state_code text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># message text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># detail text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># hint text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># internal_query text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># internal_query_pos integer,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># context text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># query text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># query_pos integer,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># location text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># application_name text,</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># PRIMARY KEY (session_id, session_line_num)</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>(<span class="code-snippet__comment"># );</span></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">CREATE</span> <span class="code-snippet__keyword">TABLE</span></span></code><code><span class="code-snippet_outer"><span class="code-snippet__keyword">test</span>=<span class="code-snippet__comment">#</span></span></code></pre>
   <p style="line-height:1.5em;"><span style="color:rgb(136,136,136);font-size:15px;"><strong><br></strong></span></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,0,0);"><strong><span style="font-size:15px;">1.3.2 查看日志文件名字</span></strong></span></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,0,0);"><strong><span style="font-size:15px;"><br></span></strong></span><span style="color:rgb(136,136,136);font-size:15px;"></span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">[pg12@whf307 ~]$ cd $PGDATA/<span class="code-snippet__keyword">log</span></span></code><code><span class="code-snippet_outer">[pg12@whf307 <span class="code-snippet__keyword">log</span>]$ ls -rtl</span></code><code><span class="code-snippet_outer">total <span class="code-snippet__number">24</span></span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">166</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">13</span>:<span class="code-snippet__number">32</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133202</span>.log</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">496</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">13</span>:<span class="code-snippet__number">32</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133202</span>.csv</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">0</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">13</span>:<span class="code-snippet__number">32</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133254</span>.log</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">170</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">13</span>:<span class="code-snippet__number">32</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133254</span>.csv</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">166</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">13</span>:<span class="code-snippet__number">33</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133324</span>.log</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">6566</span> May <span class="code-snippet__number">30</span> <span class="code-snippet__number">16</span>:<span class="code-snippet__number">16</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">30_133324</span>.csv</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">0</span> May <span class="code-snippet__number">31</span> <span class="code-snippet__number">00</span>:<span class="code-snippet__number">00</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">31_000000</span>.log</span></code><code><span class="code-snippet_outer">-rw------- <span class="code-snippet__number">1</span> pg12 pg12 <span class="code-snippet__number">0</span> May <span class="code-snippet__number">31</span> <span class="code-snippet__number">00</span>:<span class="code-snippet__number">00</span> postgresql-<span class="code-snippet__number">2019</span>-<span class="code-snippet__number">05</span>-<span class="code-snippet__number">31_000000</span>.csv</span></code><code><span class="code-snippet_outer">[pg12@whf307 <span class="code-snippet__keyword">log</span>]$</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">[pg12@whf307 <span class="code-snippet__keyword">log</span>]$ pwd</span></code><code><span class="code-snippet_outer">/soft/pg_data/<span class="code-snippet__keyword">log</span></span></code><code><span class="code-snippet_outer">[pg12@whf307 <span class="code-snippet__keyword">log</span>]$</span></code></pre>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,0,0);font-size:15px;"><strong>1.3.3 载入到数据库</strong></span></p>
   <p style="line-height:1.5em;"><span style="color:rgb(136,136,136);font-size:15px;"></span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">[pg12@whf307 <span class="code-snippet__built_in">log</span>]$ psql <span class="code-snippet__built_in">test</span></span></code><code><span class="code-snippet_outer">psql (12beta1)</span></code><code><span class="code-snippet_outer">Type <span class="code-snippet__string">"help"</span> <span class="code-snippet__keyword">for</span> <span class="code-snippet__built_in">help</span>.</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">test</span>=<span class="code-snippet__comment"># \d</span></span></code><code><span class="code-snippet_outer"> List of relations</span></code><code><span class="code-snippet_outer"> Schema | Name | Type | Owner </span></code><code><span class="code-snippet_outer">--------+--------+-------+-------</span></code><code><span class="code-snippet_outer"> public | pg_log | table | pg12</span></code><code><span class="code-snippet_outer">(1 row)</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">test</span>=<span class="code-snippet__comment"># copy pg_log from '/soft/pg_data/log/postgresql-2019-05-30_133324.csv' with csv; </span></span></code><code><span class="code-snippet_outer">COPY 32</span></code></pre>
   <p style="line-height:2em;"><br></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,0,0);"><span style="font-size:15px;"><strong>1.3.4 查看日志</strong></span></span></p>
   <p style="line-height:1.5em;"><span style="color:rgb(0,0,0);"><span style="font-size:15px;"><br></span></span></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">这样就可以用sql来查看了。</span><span style="font-size:15px;">执行一个普通查询</span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">test=<span class="code-snippet__comment"># select relfilenode from pg_class where relname='pg_log';</span></span></code><code><span class="code-snippet_outer"> relfilenode </span></code><code><span class="code-snippet_outer">-------------</span></code><code><span class="code-snippet_outer"> 16385</span></code><code><span class="code-snippet_outer">(1 row)</span></code></pre>
   <p style="line-height:2em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">载入最新的日志。</span><span style="font-size:15px;">这里可以重复载入，不会覆盖之前的数据。</span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">[pg12@whf307 log]$ ls -rtl</span></code><code><span class="code-snippet_outer">total 32</span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 166 May 30 13:32 postgresql-2019-05-30_133202.log</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 496 May 30 13:32 postgresql-2019-05-30_133202.csv</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 0 May 30 13:32 postgresql-2019-05-30_133254.log</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 170 May 30 13:32 postgresql-2019-05-30_133254.csv</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 166 May 30 13:33 postgresql-2019-05-30_133324.log</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 6566 May 30 16:16 postgresql-2019-05-30_133324.csv</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 0 May 31 00:00 postgresql-2019-05-31_000000.log</span></span></code><code><span class="code-snippet_outer">-rw<span class="code-snippet__comment">------- 1 pg12 pg12 4545 May 31 00:37 postgresql-2019-05-31_000000.csv</span></span></code><code><span class="code-snippet_outer">[pg12@whf307 log]$ psql test</span></code><code><span class="code-snippet_outer">psql (12beta1)</span></code><code><span class="code-snippet_outer">Type "<span class="code-snippet__keyword">help</span><span class="code-snippet__string">" for help.</span></span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer">test=# copy pg_log from '/soft/pg_data/log/postgresql-2019-05-31_000000.csv' with csv; </span></code><code><span class="code-snippet_outer">COPY&nbsp;28</span></code></pre>
   <p style="line-height:1.5em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">再</span><span style="font-size:15px;">次查看日志</span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer"><span class="code-snippet__built_in">test</span>=<span class="code-snippet__comment"># SELECT COUNT(*) FROM PG_LOG;</span></span></code><code><span class="code-snippet_outer"> count </span></code><code><span class="code-snippet_outer">-------</span></code><code><span class="code-snippet_outer"> 60</span></code><code><span class="code-snippet_outer">(1 row)</span></code><code><span class="code-snippet_outer"><br></span></code><code><span class="code-snippet_outer"><span class="code-snippet__built_in">test</span>=<span class="code-snippet__comment"># select log_time at time zone 'UTC' ,database_name,connection_from,query from pg_log where log_time&gt;to_timestamp('2019-05-31 14:35:00','yyyy-mm-dd hh24:mi:ss');</span></span></code><code><span class="code-snippet_outer"> timezone | database_name | connection_from | query </span></code><code><span class="code-snippet_outer">-------------------------+---------------+-----------------+-----------------------------------------------------------</span></code><code><span class="code-snippet_outer"> 2019-05-31 06:35:42.843 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer"> 2019-05-31 06:35:57.582 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer"> 2019-05-31 06:36:54.369 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | selectt relfilenode from pg_class <span class="code-snippet__built_in">where</span> relname=<span class="code-snippet__string">'pg_log'</span>;</span></code><code><span class="code-snippet_outer"> 2019-05-31 06:36:58.002 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer"> 2019-05-31 06:37:00.192 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer"> 2019-05-31 06:37:11.651 | | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer"> 2019-05-31 06:37:11.651 | <span class="code-snippet__built_in">test</span> | [<span class="code-snippet__built_in">local</span>] | </span></code><code><span class="code-snippet_outer">(7 rows)</span></code></pre>
   <p style="line-height:2em;"><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">可以看到记录数变成了60，之前的记录没有被覆盖，我们可以一直使用该表，可以用sql来查看sql，数据库，登录时间等等的所有日志。</span><br></p>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">查看日志起始结束时间：</span></p>
   <ul class="code-snippet__line-index code-snippet__js">
    <li></li>
    <li></li>
    <li></li>
    <li></li>
    <li></li>
   </ul>
   <pre class="code-snippet__js"><code><span class="code-snippet_outer">test=# select min(log_time) at time zone <span class="code-snippet__string">'UTC'</span>,max(log_time) at time zone <span class="code-snippet__string">'UTC'</span> <span class="code-snippet__keyword">from</span> pg_log;</span></code><code><span class="code-snippet_outer"> timezone | timezone </span></code><code><span class="code-snippet_outer">-------------------------+-------------------------</span></code><code><span class="code-snippet_outer"> <span class="code-snippet__number">2019</span><span class="code-snippet__number">-05</span><span class="code-snippet__number">-30</span> <span class="code-snippet__number">19</span>:<span class="code-snippet__number">33</span>:<span class="code-snippet__number">24.892</span> | <span class="code-snippet__number">2019</span><span class="code-snippet__number">-05</span><span class="code-snippet__number">-31</span> <span class="code-snippet__number">06</span>:<span class="code-snippet__number">37</span>:<span class="code-snippet__number">11.651</span></span></code><code><span class="code-snippet_outer">(<span class="code-snippet__number">1</span> row)</span></code></pre>
   <p><br></p>
   <p style="line-height:1.5em;"><span style="font-size:15px;">有了灵活的数据加载方式，让SQL处理很多问题更加简捷便利。</span></p>
   <p><br></p>
   <p style="text-align:center;"><img class="rich_pages" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQWicvicCQuGja79R4FCY1ibDhFEXk1Jl7b0ErZubRCibvDk6O1RDTaMZOCHiaOwvJ2ehicBefcXicws2k9A/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></p>
   <p><br></p>
   <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;font-style:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;text-align:left;"><strong><span style="font-size:16px;color:rgb(0,122,170);">扩展阅读</span></strong></p>
   <hr style="color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;font-style:normal;font-weight:normal;letter-spacing:.544px;text-align:justify;text-indent:0px;text-transform:none;word-spacing:0px;border-style:solid;border-width:1px 0px 0px;border-color:rgba(0,0,0,.0980392);">
   <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;font-style:normal;font-weight:normal;letter-spacing:.544px;text-align:justify;text-indent:0px;text-transform:none;word-spacing:0px;"><br></p>
   <ol class="list-paddingleft-2" style="list-style-type:decimal;margin-left:0px;">
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281851&amp;idx=2&amp;sn=0d39c9a979fb36f8a06e1a3e6b9ab326&amp;chksm=be478f6d8930067bbefd3c293813cc09d5685434b201202e309af67eb6b82f7b1066a9381a72&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（上）</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281867&amp;idx=1&amp;sn=fc686da6e493fbba5128721368b561aa&amp;chksm=be478f9d8930068b5a1794fa3d64a46919761b6721ed2f26ca1fa9b0c5c3d1bcdaae8d0034ee&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">《PostgreSQL 指南：内幕探索》之基础备份与时间点恢复（下）</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281938&amp;idx=1&amp;sn=35bf70a4f98c64f35e0067767dc3fe72&amp;chksm=be478fc4893006d2a7cd6c3d831b66518c2fa2e6fac3b653c8e859d85c18db96e5f7e87227cb&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">解读年度数据库PostgreSQL：如何处理并发控制（一）</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281707&amp;idx=1&amp;sn=52fdb59331e5decd81f48d5099a11436&amp;chksm=be478efd893007ebac6557db83ad04963802de1c9504d4121476914161dc9c295bbf9ee9e1d8&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">“王者对战”之 MySQL 8 vs PostgreSQL 10</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650278396&amp;idx=1&amp;sn=a46e0d651aaae992273e5d023ff0b63f&amp;chksm=be4791ea893018fc3abca7be4538e08028b5c96453fd6c9941877946ce64cd197b9190d0790a&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">大象起舞：用PostgreSQL解海盗分金问题</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281957&amp;idx=2&amp;sn=b00263adac072ff91b61d048863f6637&amp;chksm=be478ff3893006e5b302e272e5377df416963014120a586429b10e62339e565d97b85a32da09&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">解读年度数据库PostgreSQL：如何巧妙地实现缓冲区管理器</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281938&amp;idx=1&amp;sn=35bf70a4f98c64f35e0067767dc3fe72&amp;chksm=be478fc4893006d2a7cd6c3d831b66518c2fa2e6fac3b653c8e859d85c18db96e5f7e87227cb&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">解读年度数据库PostgreSQL：如何处理并发控制（一）</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650281866&amp;idx=1&amp;sn=489001936b4855c88bf7b32e738ebc9d&amp;chksm=be478f9c8930068a930f647645f33bcc9fea4efec8c528751edb281393ae69f7a11273239788&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;"><span style="font-size:15px;">数据和云，半年文章精选（文末赠书）</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650282106&amp;idx=1&amp;sn=4f1bf98a4bf40a7832ab0122276e6b5f&amp;chksm=be47806c8930097aff218f5e31cf51178eddf83a22745f9f99135438691fe1028af0e099790f&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;font-size:15px;"><span style="font-size:15px;">美女DBA带你了解PostgreSQL用户及角色</span></a></p></li>
    <li><p style="clear:both;min-height:1em;"><a href="http://mp.weixin.qq.com/s?__biz=MjM5MDAxOTk2MQ==&amp;mid=2650282083&amp;idx=1&amp;sn=75e27180d30f9d35137c66f581d33f23&amp;chksm=be478075893009637f49c2891063a906db95adb4374460463d1f69e6ed7fe32565e5c3bfb918&amp;scene=21#wechat_redirect" rel="nofollow" style="color:rgb(87,107,149);text-decoration:underline;font-size:15px;"><span style="font-size:15px;">从Oracle到PostgreSQL：最全控制文件</span></a><br></p></li>
   </ol>
   <p style="clear:both;min-height:1em;"><br></p>
   <p style="clear:both;min-height:1em;color:rgb(51,51,51);font-family:'-apple-system-font', BlinkMacSystemFont, 'Helvetica Neue', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei UI', 'Microsoft YaHei', Arial, sans-serif;font-size:17px;font-style:normal;font-weight:normal;letter-spacing:.544px;text-indent:0px;text-transform:none;word-spacing:0px;text-align:center;"><img class="rich_pages" style="width:677px;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/bURPjgFpGMQnRjjteV8phCiaMcjpaUhFlI0LR5yhSjr6IkkHuOJTib3O1MmH9pzGdTeJaaj4Mdo8NLE3OwtSX2Dg/640?wx_fmt=png" alt="640?wx_fmt=png"></p>
   <img style="width:190px;margin-left:auto;" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/Ljib4So7yuWgrROticJ29kqjZicMFskI3WfZxbRorYgxoNEHwGiaMll7WyzNia5Q1tSARXL2ajJ8nt36dGNZ2BMgaOw/640?wx_fmt=png" alt="640?wx_fmt=png">
   <p style="text-align:center;"><strong><span style="font-size:15px;">数据和云</span></strong></p>
   <p style="text-align:center;"><strong><span style="font-size:15px;">ID：OraNews<br></span></strong></p>
   <p style="text-align:center;"><strong><span style="font-size:15px;">如有收获，请划至底部，点击“<span style="font-size:15px;color:#007aaa;">在看</span>”，谢谢！</span></strong></p>
   <p><br></p>
   <p><strong><span style="font-size:16px;color:#8dcbbf;">云和恩墨大讲堂 | </span></strong><span style="font-size:16px;color:#8dcbbf;">一个分享交流的地方</span></p>
   <p style="min-height:1em;"><span style="font-size:14px;color:#8dcbbf;">长按，识别二维码，加入<strong>万人</strong>交流社群</span></p>
   <p style="min-height:1em;"><span style="font-size:14px;color:#8dcbbf;"><br></span></p>
   <strong><img style="border-width:1px;border-style:dashed;border-color:#a8a4ab;" border="0" src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_jpg/bURPjgFpGMQnRjjteV8phCiaMcjpaUhFl1D6bDIoewT46xSXZrPD8GzwcAG53WxGpqyZzA3HxwLpFFK79RcWFVQ/640?wx_fmt=jpeg" alt="640?wx_fmt=jpeg"></strong>
   <p style="color:#23150a;font-size:medium;min-height:1em;"><span style="font-size:12px;"><strong><span style="color:#8dcbbf;">请备注：云和恩墨大讲堂</span></strong></span></p>
  </div> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
