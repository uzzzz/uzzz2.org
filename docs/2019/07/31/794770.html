<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>python之自动化部署SpringCloud，且脱离python环境运行 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="python之自动化部署SpringCloud，且脱离python环境运行" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="文件结构如上图 删除镜像 import re from 连接linux主机 import Host def delete_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) # 1.移除117：docker service 服务 run_once01 = host117.run_once(&#39;docker service ls&#39;) service_id_config_list = re.findall(&#39;(\\S{12})\\s{8}config&#39;, run_once01) if len(service_id_config_list) &gt; 0: service_rm_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_config_list[0]) print(&#39;service config移除情况：&#39; + service_rm_info + &#39;\n&#39;) service_id_sys_list = re.findall(&#39;(\\S{12})\\s{8}rz-sys&#39;, run_once01) if len(service_id_sys_list) &gt; 0: service_sys_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_sys_list[0]) print(&#39;service sys移除情况&#39; + service_sys_info + &#39;\n&#39;) service_id_base_list = re.findall(&#39;(\\S{12})\\s{8}rz-base-info&#39;, run_once01) if len(service_id_base_list) &gt; 0: service_base_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_base_list[0]) print(&#39;service base移除情况：&#39; + service_base_info + &#39;\n&#39;) service_id_api_list = re.findall(&#39;(\\S{12})\\s{8}rz-api-sh&#39;, run_once01) if len(service_id_api_list) &gt; 0: service_api_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_api_list[0]) print(&#39;service api 移除情况：&#39; + service_api_info + &#39;\n&#39;) # 2.停止121：web-admin 服务--移除web-admin服务 run_once02 = host121.run_once(&#39;docker ps&#39;) ps_id_web_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once02) if len(ps_id_web_list) &gt; 0: for i in range(0, len(ps_id_web_list)): ps_stop_web_info = host121.run_once(&#39;docker stop %s&#39; % ps_id_web_list[i]) ps_rm_web_info = host121.run_once(&#39;docker rm %s&#39; % ps_id_web_list[i]) print(&#39;ps web容器移除情况：&#39; + ps_rm_web_info + &#39;\n&#39;) # 3.停止118：eureka 服务 run_once03 = host118.run_once(&#39;docker ps&#39;) ps_id_eureka_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03) if len(ps_id_eureka_list) &gt; 0: for i in range(0, len(ps_id_eureka_list)): ps_stop_eureka_info = host118.run_once(&#39;docker stop %s&#39; % ps_id_eureka_list[i]) print(&#39;ps eureka 容器停止情况：&#39; + ps_stop_eureka_info + &#39;\n&#39;) # 4.移除容器 run_once04 = host121.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once04) ps_a_id_sys_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once04) ps_a_id_base_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once04) ps_a_id_api_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once04) ps_a_id_web_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once04) if len(ps_a_id_config_list) &gt; 0: for i in range(0, len(ps_a_id_config_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list) &gt; 0: for i in range(0, len(ps_a_id_sys_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list) &gt; 0: for i in range(0, len(ps_a_id_base_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list) &gt; 0: for i in range(0, len(ps_a_id_api_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list) &gt; 0: for i in range(0, len(ps_a_id_web_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once041 = host120.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once041) ps_a_id_sys_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once041) ps_a_id_base_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once041) ps_a_id_api_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once041) ps_a_id_web_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once041) if len(ps_a_id_config_list1) &gt; 0: for i in range(0, len(ps_a_id_config_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list1) &gt; 0: for i in range(0, len(ps_a_id_sys_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list1) &gt; 0: for i in range(0, len(ps_a_id_base_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list1) &gt; 0: for i in range(0, len(ps_a_id_api_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list1) &gt; 0: for i in range(0, len(ps_a_id_web_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once042 = host118.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once042) ps_a_id_sys_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once042) ps_a_id_base_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once042) ps_a_id_api_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once042) ps_a_id_web_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once042) if len(ps_a_id_config_list2) &gt; 0: for i in range(0, len(ps_a_id_config_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list2) &gt; 0: for i in range(0, len(ps_a_id_sys_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list2) &gt; 0: for i in range(0, len(ps_a_id_base_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list2) &gt; 0: for i in range(0, len(ps_a_id_api_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list2) &gt; 0: for i in range(0, len(ps_a_id_web_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) # 5.移除121、120、118镜像 run_once05 = host121.run_once(&#39;docker images&#39;) images_id_config_list = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_sys_list = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_base_list = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_api_list = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_web_list = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) if len(images_id_config_list) &gt; 0: for i in range(0, len(images_id_config_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_config_list[i]) print(&#39;移除镜像121config:&#39; + str(i)) if len(images_id_sys_list) &gt; 0: for i in range(0, len(images_id_sys_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_sys_list[i]) print(&#39;移除镜像121sys&#39; + str(i)) if len(images_id_base_list) &gt; 0: for i in range(0, len(images_id_base_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_base_list[i]) print(&#39;移除镜像121base&#39; + str(i)) if len(images_id_api_list) &gt; 0: for i in range(0, len(images_id_api_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_api_list[i]) print(&#39;移除镜像121api&#39; + str(i)) if len(images_id_web_list) &gt; 0: for i in range(0, len(images_id_web_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_web_list[i]) print(&#39;移除镜像121web&#39; + str(i)) run_once051 = host120.run_once(&#39;docker images&#39;) images_id_config_list1 = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_sys_list1 = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_base_list1 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_api_list1 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_web_list1 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) if len(images_id_config_list1) &gt; 0: for i in range(0, len(images_id_config_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_config_list1[i]) print(&#39;移除镜像120config&#39; + str(i)) if len(images_id_sys_list1) &gt; 0: for i in range(0, len(images_id_sys_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_sys_list1[i]) print(&#39;移除镜像120sys&#39; + str(i)) if len(images_id_base_list1) &gt; 0: for i in range(0, len(images_id_base_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_base_list1[i]) print(&#39;移除镜像120base&#39; + str(i)) if len(images_id_api_list1) &gt; 0: for i in range(0, len(images_id_api_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_api_list1[i]) print(&#39;移除镜像120api&#39; + str(i)) if len(images_id_web_list1) &gt; 0: for i in range(0, len(images_id_web_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_web_list1[i]) print(&#39;移除镜像120web&#39; + str(i)) run_once052 = host118.run_once(&#39;docker images&#39;) images_id_config_list2 = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_sys_list2 = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_base_list2 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_api_list2 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_web_list2 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) if len(images_id_config_list2) &gt; 0: for i in range(0, len(images_id_config_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_config_list2[i]) print(&#39;移除镜像118config&#39; + str(i)) if len(images_id_sys_list2) &gt; 0: for i in range(0, len(images_id_sys_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_sys_list2[i]) print(&#39;移除镜像118sys&#39; + str(i)) if len(images_id_base_list2) &gt; 0: for i in range(0, len(images_id_base_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_base_list2[i]) print(&#39;移除镜像118base&#39; + str(i)) if len(images_id_api_list2) &gt; 0: for i in range(0, len(images_id_api_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_api_list2[i]) print(&#39;移除镜像118api&#39; + str(i)) if len(images_id_web_list2) &gt; 0: for i in range(0, len(images_id_web_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_web_list2[i]) print(&#39;移除镜像118web&#39; + str(i)) print(&#39;*&#39; * 50 + &quot;删除完成&quot; + &#39;*&#39; * 50) 上传文件 from 连接linux主机 import Host def upload(): host = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) local_path_api = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-api-sh\target\rz-api-sh-0.0.1.jar&#39; remote_path_api = &#39;/home/docker/gkzy/rz-api-sh/&#39; local_path_base = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-base-info\target\rz-base-info-0.0.1.jar&#39; remote_path_base = &#39;/home/docker/gkzy/rz-base-info/&#39; local_path_config = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-config\target\rz-config-0.0.1.jar&#39; remote_path_config = &#39;/home/docker/gkzy/rz-config/&#39; local_path_sys = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-sys\target\rz-sys-0.0.1.jar&#39; remote_path_sys = &#39;/home/docker/gkzy/rz-sys/&#39; local_path_web = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-web-admin\target\rz-web-admin-0.0.1.jar&#39; remote_path_web = &#39;/home/docker/gkzy/rz-web-admin/&#39; host.upload(local_path_api, remote_path_api) host.upload(local_path_base, remote_path_base) host.upload(local_path_config, remote_path_config) host.upload(local_path_sys, remote_path_sys) host.upload(local_path_web, remote_path_web) print(&#39;*&#39; * 50 + &quot;上传文件完成&quot; + &#39;*&#39; * 50) 启动镜像 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) 连接linux主机 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) logo.ico https://www.easyicon.net/ 注意一定要下载ico格式。强行改后缀报错。 Main启动函数： from 删除镜像 import delete_images from 上传文件 import upload from 启动镜像 import start_images if __name__ == &#39;__main__&#39;: delete_images() upload() start_images() 打包exe文件： 黑窗口cd到Main.py所在文件路径下：pyinstaller -F -i logo.ico Main.py 有特殊需求，可以通过修改Main.space文件来达成。" />
<meta property="og:description" content="文件结构如上图 删除镜像 import re from 连接linux主机 import Host def delete_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) # 1.移除117：docker service 服务 run_once01 = host117.run_once(&#39;docker service ls&#39;) service_id_config_list = re.findall(&#39;(\\S{12})\\s{8}config&#39;, run_once01) if len(service_id_config_list) &gt; 0: service_rm_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_config_list[0]) print(&#39;service config移除情况：&#39; + service_rm_info + &#39;\n&#39;) service_id_sys_list = re.findall(&#39;(\\S{12})\\s{8}rz-sys&#39;, run_once01) if len(service_id_sys_list) &gt; 0: service_sys_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_sys_list[0]) print(&#39;service sys移除情况&#39; + service_sys_info + &#39;\n&#39;) service_id_base_list = re.findall(&#39;(\\S{12})\\s{8}rz-base-info&#39;, run_once01) if len(service_id_base_list) &gt; 0: service_base_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_base_list[0]) print(&#39;service base移除情况：&#39; + service_base_info + &#39;\n&#39;) service_id_api_list = re.findall(&#39;(\\S{12})\\s{8}rz-api-sh&#39;, run_once01) if len(service_id_api_list) &gt; 0: service_api_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_api_list[0]) print(&#39;service api 移除情况：&#39; + service_api_info + &#39;\n&#39;) # 2.停止121：web-admin 服务--移除web-admin服务 run_once02 = host121.run_once(&#39;docker ps&#39;) ps_id_web_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once02) if len(ps_id_web_list) &gt; 0: for i in range(0, len(ps_id_web_list)): ps_stop_web_info = host121.run_once(&#39;docker stop %s&#39; % ps_id_web_list[i]) ps_rm_web_info = host121.run_once(&#39;docker rm %s&#39; % ps_id_web_list[i]) print(&#39;ps web容器移除情况：&#39; + ps_rm_web_info + &#39;\n&#39;) # 3.停止118：eureka 服务 run_once03 = host118.run_once(&#39;docker ps&#39;) ps_id_eureka_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03) if len(ps_id_eureka_list) &gt; 0: for i in range(0, len(ps_id_eureka_list)): ps_stop_eureka_info = host118.run_once(&#39;docker stop %s&#39; % ps_id_eureka_list[i]) print(&#39;ps eureka 容器停止情况：&#39; + ps_stop_eureka_info + &#39;\n&#39;) # 4.移除容器 run_once04 = host121.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once04) ps_a_id_sys_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once04) ps_a_id_base_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once04) ps_a_id_api_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once04) ps_a_id_web_list = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once04) if len(ps_a_id_config_list) &gt; 0: for i in range(0, len(ps_a_id_config_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list) &gt; 0: for i in range(0, len(ps_a_id_sys_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list) &gt; 0: for i in range(0, len(ps_a_id_base_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list) &gt; 0: for i in range(0, len(ps_a_id_api_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list) &gt; 0: for i in range(0, len(ps_a_id_web_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once041 = host120.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once041) ps_a_id_sys_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once041) ps_a_id_base_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once041) ps_a_id_api_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once041) ps_a_id_web_list1 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once041) if len(ps_a_id_config_list1) &gt; 0: for i in range(0, len(ps_a_id_config_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list1) &gt; 0: for i in range(0, len(ps_a_id_sys_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list1) &gt; 0: for i in range(0, len(ps_a_id_base_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list1) &gt; 0: for i in range(0, len(ps_a_id_api_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list1) &gt; 0: for i in range(0, len(ps_a_id_web_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once042 = host118.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-config&#39;, run_once042) ps_a_id_sys_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once042) ps_a_id_base_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once042) ps_a_id_api_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once042) ps_a_id_web_list2 = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once042) if len(ps_a_id_config_list2) &gt; 0: for i in range(0, len(ps_a_id_config_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list2) &gt; 0: for i in range(0, len(ps_a_id_sys_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list2) &gt; 0: for i in range(0, len(ps_a_id_base_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list2) &gt; 0: for i in range(0, len(ps_a_id_api_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list2) &gt; 0: for i in range(0, len(ps_a_id_web_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) # 5.移除121、120、118镜像 run_once05 = host121.run_once(&#39;docker images&#39;) images_id_config_list = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_sys_list = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_base_list = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_api_list = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) images_id_web_list = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once05) if len(images_id_config_list) &gt; 0: for i in range(0, len(images_id_config_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_config_list[i]) print(&#39;移除镜像121config:&#39; + str(i)) if len(images_id_sys_list) &gt; 0: for i in range(0, len(images_id_sys_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_sys_list[i]) print(&#39;移除镜像121sys&#39; + str(i)) if len(images_id_base_list) &gt; 0: for i in range(0, len(images_id_base_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_base_list[i]) print(&#39;移除镜像121base&#39; + str(i)) if len(images_id_api_list) &gt; 0: for i in range(0, len(images_id_api_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_api_list[i]) print(&#39;移除镜像121api&#39; + str(i)) if len(images_id_web_list) &gt; 0: for i in range(0, len(images_id_web_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_web_list[i]) print(&#39;移除镜像121web&#39; + str(i)) run_once051 = host120.run_once(&#39;docker images&#39;) images_id_config_list1 = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_sys_list1 = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_base_list1 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_api_list1 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) images_id_web_list1 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once051) if len(images_id_config_list1) &gt; 0: for i in range(0, len(images_id_config_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_config_list1[i]) print(&#39;移除镜像120config&#39; + str(i)) if len(images_id_sys_list1) &gt; 0: for i in range(0, len(images_id_sys_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_sys_list1[i]) print(&#39;移除镜像120sys&#39; + str(i)) if len(images_id_base_list1) &gt; 0: for i in range(0, len(images_id_base_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_base_list1[i]) print(&#39;移除镜像120base&#39; + str(i)) if len(images_id_api_list1) &gt; 0: for i in range(0, len(images_id_api_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_api_list1[i]) print(&#39;移除镜像120api&#39; + str(i)) if len(images_id_web_list1) &gt; 0: for i in range(0, len(images_id_web_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_web_list1[i]) print(&#39;移除镜像120web&#39; + str(i)) run_once052 = host118.run_once(&#39;docker images&#39;) images_id_config_list2 = re.findall(&#39;172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_sys_list2 = re.findall(&#39;172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_base_list2 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_api_list2 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) images_id_web_list2 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})&#39;, run_once052) if len(images_id_config_list2) &gt; 0: for i in range(0, len(images_id_config_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_config_list2[i]) print(&#39;移除镜像118config&#39; + str(i)) if len(images_id_sys_list2) &gt; 0: for i in range(0, len(images_id_sys_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_sys_list2[i]) print(&#39;移除镜像118sys&#39; + str(i)) if len(images_id_base_list2) &gt; 0: for i in range(0, len(images_id_base_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_base_list2[i]) print(&#39;移除镜像118base&#39; + str(i)) if len(images_id_api_list2) &gt; 0: for i in range(0, len(images_id_api_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_api_list2[i]) print(&#39;移除镜像118api&#39; + str(i)) if len(images_id_web_list2) &gt; 0: for i in range(0, len(images_id_web_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_web_list2[i]) print(&#39;移除镜像118web&#39; + str(i)) print(&#39;*&#39; * 50 + &quot;删除完成&quot; + &#39;*&#39; * 50) 上传文件 from 连接linux主机 import Host def upload(): host = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) local_path_api = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-api-sh\target\rz-api-sh-0.0.1.jar&#39; remote_path_api = &#39;/home/docker/gkzy/rz-api-sh/&#39; local_path_base = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-base-info\target\rz-base-info-0.0.1.jar&#39; remote_path_base = &#39;/home/docker/gkzy/rz-base-info/&#39; local_path_config = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-config\target\rz-config-0.0.1.jar&#39; remote_path_config = &#39;/home/docker/gkzy/rz-config/&#39; local_path_sys = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-sys\target\rz-sys-0.0.1.jar&#39; remote_path_sys = &#39;/home/docker/gkzy/rz-sys/&#39; local_path_web = r&#39;C:\Users\nijiajin\Desktop\cshop\rz-web-admin\target\rz-web-admin-0.0.1.jar&#39; remote_path_web = &#39;/home/docker/gkzy/rz-web-admin/&#39; host.upload(local_path_api, remote_path_api) host.upload(local_path_base, remote_path_base) host.upload(local_path_config, remote_path_config) host.upload(local_path_sys, remote_path_sys) host.upload(local_path_web, remote_path_web) print(&#39;*&#39; * 50 + &quot;上传文件完成&quot; + &#39;*&#39; * 50) 启动镜像 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) 连接linux主机 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) logo.ico https://www.easyicon.net/ 注意一定要下载ico格式。强行改后缀报错。 Main启动函数： from 删除镜像 import delete_images from 上传文件 import upload from 启动镜像 import start_images if __name__ == &#39;__main__&#39;: delete_images() upload() start_images() 打包exe文件： 黑窗口cd到Main.py所在文件路径下：pyinstaller -F -i logo.ico Main.py 有特殊需求，可以通过修改Main.space文件来达成。" />
<link rel="canonical" href="https://uzzz.org/2019/07/31/794770.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/31/794770.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-31T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"文件结构如上图 删除镜像 import re from 连接linux主机 import Host def delete_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) # 1.移除117：docker service 服务 run_once01 = host117.run_once(&#39;docker service ls&#39;) service_id_config_list = re.findall(&#39;(\\\\S{12})\\\\s{8}config&#39;, run_once01) if len(service_id_config_list) &gt; 0: service_rm_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_config_list[0]) print(&#39;service config移除情况：&#39; + service_rm_info + &#39;\\n&#39;) service_id_sys_list = re.findall(&#39;(\\\\S{12})\\\\s{8}rz-sys&#39;, run_once01) if len(service_id_sys_list) &gt; 0: service_sys_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_sys_list[0]) print(&#39;service sys移除情况&#39; + service_sys_info + &#39;\\n&#39;) service_id_base_list = re.findall(&#39;(\\\\S{12})\\\\s{8}rz-base-info&#39;, run_once01) if len(service_id_base_list) &gt; 0: service_base_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_base_list[0]) print(&#39;service base移除情况：&#39; + service_base_info + &#39;\\n&#39;) service_id_api_list = re.findall(&#39;(\\\\S{12})\\\\s{8}rz-api-sh&#39;, run_once01) if len(service_id_api_list) &gt; 0: service_api_info = host117.run_once(&#39;docker service rm %s&#39; % service_id_api_list[0]) print(&#39;service api 移除情况：&#39; + service_api_info + &#39;\\n&#39;) # 2.停止121：web-admin 服务--移除web-admin服务 run_once02 = host121.run_once(&#39;docker ps&#39;) ps_id_web_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once02) if len(ps_id_web_list) &gt; 0: for i in range(0, len(ps_id_web_list)): ps_stop_web_info = host121.run_once(&#39;docker stop %s&#39; % ps_id_web_list[i]) ps_rm_web_info = host121.run_once(&#39;docker rm %s&#39; % ps_id_web_list[i]) print(&#39;ps web容器移除情况：&#39; + ps_rm_web_info + &#39;\\n&#39;) # 3.停止118：eureka 服务 run_once03 = host118.run_once(&#39;docker ps&#39;) ps_id_eureka_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03) if len(ps_id_eureka_list) &gt; 0: for i in range(0, len(ps_id_eureka_list)): ps_stop_eureka_info = host118.run_once(&#39;docker stop %s&#39; % ps_id_eureka_list[i]) print(&#39;ps eureka 容器停止情况：&#39; + ps_stop_eureka_info + &#39;\\n&#39;) # 4.移除容器 run_once04 = host121.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-config&#39;, run_once04) ps_a_id_sys_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once04) ps_a_id_base_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once04) ps_a_id_api_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once04) ps_a_id_web_list = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once04) if len(ps_a_id_config_list) &gt; 0: for i in range(0, len(ps_a_id_config_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list) &gt; 0: for i in range(0, len(ps_a_id_sys_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list) &gt; 0: for i in range(0, len(ps_a_id_base_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list) &gt; 0: for i in range(0, len(ps_a_id_api_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list) &gt; 0: for i in range(0, len(ps_a_id_web_list)): host121.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once041 = host120.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list1 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-config&#39;, run_once041) ps_a_id_sys_list1 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once041) ps_a_id_base_list1 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once041) ps_a_id_api_list1 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once041) ps_a_id_web_list1 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once041) if len(ps_a_id_config_list1) &gt; 0: for i in range(0, len(ps_a_id_config_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list1) &gt; 0: for i in range(0, len(ps_a_id_sys_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list1) &gt; 0: for i in range(0, len(ps_a_id_base_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list1) &gt; 0: for i in range(0, len(ps_a_id_api_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list1) &gt; 0: for i in range(0, len(ps_a_id_web_list1)): host120.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list1[i]) print(&#39;移除容器121config：&#39; + str(i)) run_once042 = host118.run_once(&#39;docker ps -a&#39;) ps_a_id_config_list2 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-config&#39;, run_once042) ps_a_id_sys_list2 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-sys&#39;, run_once042) ps_a_id_base_list2 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-base-info&#39;, run_once042) ps_a_id_api_list2 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-api-sh&#39;, run_once042) ps_a_id_web_list2 = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-web-admin&#39;, run_once042) if len(ps_a_id_config_list2) &gt; 0: for i in range(0, len(ps_a_id_config_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_config_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_sys_list2) &gt; 0: for i in range(0, len(ps_a_id_sys_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_sys_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_base_list2) &gt; 0: for i in range(0, len(ps_a_id_base_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_base_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_api_list2) &gt; 0: for i in range(0, len(ps_a_id_api_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_api_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) if len(ps_a_id_web_list2) &gt; 0: for i in range(0, len(ps_a_id_web_list2)): host118.run_once(&#39;docker rm %s&#39; % ps_a_id_web_list2[i]) print(&#39;移除容器121config：&#39; + str(i)) # 5.移除121、120、118镜像 run_once05 = host121.run_once(&#39;docker images&#39;) images_id_config_list = re.findall(&#39;172.17.20.117:5000/rz-config\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once05) images_id_sys_list = re.findall(&#39;172.17.20.117:5000/rz-sys\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once05) images_id_base_list = re.findall(&#39;172.17.20.117:5000/rz-base-info\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once05) images_id_api_list = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once05) images_id_web_list = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once05) if len(images_id_config_list) &gt; 0: for i in range(0, len(images_id_config_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_config_list[i]) print(&#39;移除镜像121config:&#39; + str(i)) if len(images_id_sys_list) &gt; 0: for i in range(0, len(images_id_sys_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_sys_list[i]) print(&#39;移除镜像121sys&#39; + str(i)) if len(images_id_base_list) &gt; 0: for i in range(0, len(images_id_base_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_base_list[i]) print(&#39;移除镜像121base&#39; + str(i)) if len(images_id_api_list) &gt; 0: for i in range(0, len(images_id_api_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_api_list[i]) print(&#39;移除镜像121api&#39; + str(i)) if len(images_id_web_list) &gt; 0: for i in range(0, len(images_id_web_list)): host121.run_once(&#39;docker rmi %s&#39; % images_id_web_list[i]) print(&#39;移除镜像121web&#39; + str(i)) run_once051 = host120.run_once(&#39;docker images&#39;) images_id_config_list1 = re.findall(&#39;172.17.20.117:5000/rz-config\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once051) images_id_sys_list1 = re.findall(&#39;172.17.20.117:5000/rz-sys\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once051) images_id_base_list1 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once051) images_id_api_list1 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once051) images_id_web_list1 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once051) if len(images_id_config_list1) &gt; 0: for i in range(0, len(images_id_config_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_config_list1[i]) print(&#39;移除镜像120config&#39; + str(i)) if len(images_id_sys_list1) &gt; 0: for i in range(0, len(images_id_sys_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_sys_list1[i]) print(&#39;移除镜像120sys&#39; + str(i)) if len(images_id_base_list1) &gt; 0: for i in range(0, len(images_id_base_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_base_list1[i]) print(&#39;移除镜像120base&#39; + str(i)) if len(images_id_api_list1) &gt; 0: for i in range(0, len(images_id_api_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_api_list1[i]) print(&#39;移除镜像120api&#39; + str(i)) if len(images_id_web_list1) &gt; 0: for i in range(0, len(images_id_web_list1)): host120.run_once(&#39;docker rmi %s&#39; % images_id_web_list1[i]) print(&#39;移除镜像120web&#39; + str(i)) run_once052 = host118.run_once(&#39;docker images&#39;) images_id_config_list2 = re.findall(&#39;172.17.20.117:5000/rz-config\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once052) images_id_sys_list2 = re.findall(&#39;172.17.20.117:5000/rz-sys\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once052) images_id_base_list2 = re.findall(&#39;172.17.20.117:5000/rz-base-info\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once052) images_id_api_list2 = re.findall(&#39;172.17.20.117:5000/rz-api-sh\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once052) images_id_web_list2 = re.findall(&#39;172.17.20.117:5000/rz-web-admin\\\\s{2,10}\\\\S{6}\\\\s{14}(\\\\S{12})&#39;, run_once052) if len(images_id_config_list2) &gt; 0: for i in range(0, len(images_id_config_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_config_list2[i]) print(&#39;移除镜像118config&#39; + str(i)) if len(images_id_sys_list2) &gt; 0: for i in range(0, len(images_id_sys_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_sys_list2[i]) print(&#39;移除镜像118sys&#39; + str(i)) if len(images_id_base_list2) &gt; 0: for i in range(0, len(images_id_base_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_base_list2[i]) print(&#39;移除镜像118base&#39; + str(i)) if len(images_id_api_list2) &gt; 0: for i in range(0, len(images_id_api_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_api_list2[i]) print(&#39;移除镜像118api&#39; + str(i)) if len(images_id_web_list2) &gt; 0: for i in range(0, len(images_id_web_list2)): host118.run_once(&#39;docker rmi %s&#39; % images_id_web_list2[i]) print(&#39;移除镜像118web&#39; + str(i)) print(&#39;*&#39; * 50 + &quot;删除完成&quot; + &#39;*&#39; * 50) 上传文件 from 连接linux主机 import Host def upload(): host = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) local_path_api = r&#39;C:\\Users\\nijiajin\\Desktop\\cshop\\rz-api-sh\\target\\rz-api-sh-0.0.1.jar&#39; remote_path_api = &#39;/home/docker/gkzy/rz-api-sh/&#39; local_path_base = r&#39;C:\\Users\\nijiajin\\Desktop\\cshop\\rz-base-info\\target\\rz-base-info-0.0.1.jar&#39; remote_path_base = &#39;/home/docker/gkzy/rz-base-info/&#39; local_path_config = r&#39;C:\\Users\\nijiajin\\Desktop\\cshop\\rz-config\\target\\rz-config-0.0.1.jar&#39; remote_path_config = &#39;/home/docker/gkzy/rz-config/&#39; local_path_sys = r&#39;C:\\Users\\nijiajin\\Desktop\\cshop\\rz-sys\\target\\rz-sys-0.0.1.jar&#39; remote_path_sys = &#39;/home/docker/gkzy/rz-sys/&#39; local_path_web = r&#39;C:\\Users\\nijiajin\\Desktop\\cshop\\rz-web-admin\\target\\rz-web-admin-0.0.1.jar&#39; remote_path_web = &#39;/home/docker/gkzy/rz-web-admin/&#39; host.upload(local_path_api, remote_path_api) host.upload(local_path_base, remote_path_base) host.upload(local_path_config, remote_path_config) host.upload(local_path_sys, remote_path_sys) host.upload(local_path_web, remote_path_web) print(&#39;*&#39; * 50 + &quot;上传文件完成&quot; + &#39;*&#39; * 50) 启动镜像 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) 连接linux主机 import re import time from 连接linux主机 import Host def start_images(): host117 = Host(&#39;172.17.20.117&#39;, &#39;root&#39;, &#39;123456&#39;) host118 = Host(&#39;172.17.20.118&#39;, &#39;root&#39;, &#39;qweqaz123&#39;) host120 = Host(&#39;172.17.20.120&#39;, &#39;root&#39;, &#39;123456&#39;) host121 = Host(&#39;172.17.20.121&#39;, &#39;root&#39;, &#39;123456&#39;) run_once03 = host118.run_once(&#39;docker ps -a&#39;) ps_id_eureka = re.findall(&#39;(\\\\S{12})\\\\s{8}172.17.20.117:5000/rz-eureka&#39;, run_once03)[0] # 5.上传config、sys、base-info、api、admin文件 # TODO # 6.运行脚本文件，生成镜像并推送私有仓库 once = host117.run_once(&#39;/home/docker/gkzy/docker_build_gkzy.sh&#39;) print(once) # 7.启动eureka ps_stop_eureka_info = host118.run_once(&#39;docker start %s&#39; % ps_id_eureka) print(&quot;启动eureka：&quot; + ps_stop_eureka_info) # 8.分别启动config、sys、base、api、admin run_config = host117.run_once( &#39;docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-config&#39;) print(&#39;启动config：&#39; + run_config) time.sleep(30) run_sys = host117.run_once( &#39;docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-sys&#39;) print(&#39;启动sys：&#39; + run_sys) time.sleep(5) run_base = host117.run_once( &#39;docker service create --replicas 3 --name rz-base-info --network springcloud_overlay -p 7772:7772 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-base-info&#39;) print(&#39;启动base：&#39; + run_base) time.sleep(5) run_api = host117.run_once( &#39;docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-api-sh&#39;) print(&#39;启动api：&#39; + run_api) run_web = host121.run_once( &#39;docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e &quot;EUREKA_SERVER_ADDRESS=eureka&quot; -e &quot;MYSQL_SERVER=172.17.20.120:3306&quot; -e &quot;REDIS_SERVER=172.17.20.120&quot; 172.17.20.117:5000/rz-web-admin&#39;) print(&#39;启动web：&#39; + run_web) print(&#39;*&#39; * 50 + &quot;启动完成&quot; + &#39;*&#39; * 50) logo.ico https://www.easyicon.net/ 注意一定要下载ico格式。强行改后缀报错。 Main启动函数： from 删除镜像 import delete_images from 上传文件 import upload from 启动镜像 import start_images if __name__ == &#39;__main__&#39;: delete_images() upload() start_images() 打包exe文件： 黑窗口cd到Main.py所在文件路径下：pyinstaller -F -i logo.ico Main.py 有特殊需求，可以通过修改Main.space文件来达成。","@type":"BlogPosting","url":"https://uzzz.org/2019/07/31/794770.html","headline":"python之自动化部署SpringCloud，且脱离python环境运行","dateModified":"2019-07-31T00:00:00+08:00","datePublished":"2019-07-31T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/31/794770.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>python之自动化部署SpringCloud，且脱离python环境运行</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div class="htmledit_views" id="content_views"> 
  <p><img alt="" class="has" height="241" src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190731161454649.png" width="210"></p> 
  <p>文件结构如上图</p> 
  <p><strong>删除镜像</strong></p> 
  <pre class="has">
<code class="language-python">import re
from 连接linux主机 import Host


def delete_images():
    host117 = Host('172.17.20.117', 'root', '123456')
    host118 = Host('172.17.20.118', 'root', 'qweqaz123')
    host120 = Host('172.17.20.120', 'root', '123456')
    host121 = Host('172.17.20.121', 'root', '123456')

    # 1.移除117：docker service 服务

    run_once01 = host117.run_once('docker service ls')
    service_id_config_list = re.findall('(\\S{12})\\s{8}config', run_once01)
    if len(service_id_config_list) &gt; 0:
        service_rm_info = host117.run_once('docker service rm %s' % service_id_config_list[0])
        print('service config移除情况：' + service_rm_info + '\n')
    service_id_sys_list = re.findall('(\\S{12})\\s{8}rz-sys', run_once01)
    if len(service_id_sys_list) &gt; 0:
        service_sys_info = host117.run_once('docker service rm %s' % service_id_sys_list[0])
        print('service sys移除情况' + service_sys_info + '\n')
    service_id_base_list = re.findall('(\\S{12})\\s{8}rz-base-info', run_once01)
    if len(service_id_base_list) &gt; 0:
        service_base_info = host117.run_once('docker service rm %s' % service_id_base_list[0])
        print('service base移除情况：' + service_base_info + '\n')
    service_id_api_list = re.findall('(\\S{12})\\s{8}rz-api-sh', run_once01)
    if len(service_id_api_list) &gt; 0:
        service_api_info = host117.run_once('docker service rm %s' % service_id_api_list[0])
        print('service api 移除情况：' + service_api_info + '\n')

    # 2.停止121：web-admin 服务--移除web-admin服务

    run_once02 = host121.run_once('docker ps')
    ps_id_web_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin', run_once02)
    if len(ps_id_web_list) &gt; 0:
        for i in range(0, len(ps_id_web_list)):
            ps_stop_web_info = host121.run_once('docker stop %s' % ps_id_web_list[i])
            ps_rm_web_info = host121.run_once('docker rm %s' % ps_id_web_list[i])
            print('ps web容器移除情况：' + ps_rm_web_info + '\n')
    # 3.停止118：eureka 服务

    run_once03 = host118.run_once('docker ps')
    ps_id_eureka_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka', run_once03)
    if len(ps_id_eureka_list) &gt; 0:
        for i in range(0, len(ps_id_eureka_list)):
            ps_stop_eureka_info = host118.run_once('docker stop %s' % ps_id_eureka_list[i])
            print('ps eureka 容器停止情况：' + ps_stop_eureka_info + '\n')
    # 4.移除容器
    run_once04 = host121.run_once('docker ps -a')
    ps_a_id_config_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-config', run_once04)
    ps_a_id_sys_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-sys', run_once04)
    ps_a_id_base_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info', run_once04)
    ps_a_id_api_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh', run_once04)
    ps_a_id_web_list = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin', run_once04)
    if len(ps_a_id_config_list) &gt; 0:
        for i in range(0, len(ps_a_id_config_list)):
            host121.run_once('docker rm %s' % ps_a_id_config_list[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_sys_list) &gt; 0:
        for i in range(0, len(ps_a_id_sys_list)):
            host121.run_once('docker rm %s' % ps_a_id_sys_list[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_base_list) &gt; 0:
        for i in range(0, len(ps_a_id_base_list)):
            host121.run_once('docker rm %s' % ps_a_id_base_list[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_api_list) &gt; 0:
        for i in range(0, len(ps_a_id_api_list)):
            host121.run_once('docker rm %s' % ps_a_id_api_list[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_web_list) &gt; 0:
        for i in range(0, len(ps_a_id_web_list)):
            host121.run_once('docker rm %s' % ps_a_id_web_list[i])
            print('移除容器121config：' + str(i))

    run_once041 = host120.run_once('docker ps -a')
    ps_a_id_config_list1 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-config', run_once041)
    ps_a_id_sys_list1 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-sys', run_once041)
    ps_a_id_base_list1 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info', run_once041)
    ps_a_id_api_list1 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh', run_once041)
    ps_a_id_web_list1 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin', run_once041)
    if len(ps_a_id_config_list1) &gt; 0:
        for i in range(0, len(ps_a_id_config_list1)):
            host120.run_once('docker rm %s' % ps_a_id_config_list1[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_sys_list1) &gt; 0:
        for i in range(0, len(ps_a_id_sys_list1)):
            host120.run_once('docker rm %s' % ps_a_id_sys_list1[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_base_list1) &gt; 0:
        for i in range(0, len(ps_a_id_base_list1)):
            host120.run_once('docker rm %s' % ps_a_id_base_list1[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_api_list1) &gt; 0:
        for i in range(0, len(ps_a_id_api_list1)):
            host120.run_once('docker rm %s' % ps_a_id_api_list1[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_web_list1) &gt; 0:
        for i in range(0, len(ps_a_id_web_list1)):
            host120.run_once('docker rm %s' % ps_a_id_web_list1[i])
            print('移除容器121config：' + str(i))

    run_once042 = host118.run_once('docker ps -a')
    ps_a_id_config_list2 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-config', run_once042)
    ps_a_id_sys_list2 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-sys', run_once042)
    ps_a_id_base_list2 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-base-info', run_once042)
    ps_a_id_api_list2 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-api-sh', run_once042)
    ps_a_id_web_list2 = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-web-admin', run_once042)
    if len(ps_a_id_config_list2) &gt; 0:
        for i in range(0, len(ps_a_id_config_list2)):
            host118.run_once('docker rm %s' % ps_a_id_config_list2[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_sys_list2) &gt; 0:
        for i in range(0, len(ps_a_id_sys_list2)):
            host118.run_once('docker rm %s' % ps_a_id_sys_list2[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_base_list2) &gt; 0:
        for i in range(0, len(ps_a_id_base_list2)):
            host118.run_once('docker rm %s' % ps_a_id_base_list2[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_api_list2) &gt; 0:
        for i in range(0, len(ps_a_id_api_list2)):
            host118.run_once('docker rm %s' % ps_a_id_api_list2[i])
            print('移除容器121config：' + str(i))
    if len(ps_a_id_web_list2) &gt; 0:
        for i in range(0, len(ps_a_id_web_list2)):
            host118.run_once('docker rm %s' % ps_a_id_web_list2[i])
            print('移除容器121config：' + str(i))

    # 5.移除121、120、118镜像

    run_once05 = host121.run_once('docker images')
    images_id_config_list = re.findall('172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once05)
    images_id_sys_list = re.findall('172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once05)
    images_id_base_list = re.findall('172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once05)
    images_id_api_list = re.findall('172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once05)
    images_id_web_list = re.findall('172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once05)
    if len(images_id_config_list) &gt; 0:
        for i in range(0, len(images_id_config_list)):
            host121.run_once('docker rmi %s' % images_id_config_list[i])
            print('移除镜像121config:' + str(i))
    if len(images_id_sys_list) &gt; 0:
        for i in range(0, len(images_id_sys_list)):
            host121.run_once('docker rmi %s' % images_id_sys_list[i])
            print('移除镜像121sys' + str(i))
    if len(images_id_base_list) &gt; 0:
        for i in range(0, len(images_id_base_list)):
            host121.run_once('docker rmi %s' % images_id_base_list[i])
            print('移除镜像121base' + str(i))
    if len(images_id_api_list) &gt; 0:
        for i in range(0, len(images_id_api_list)):
            host121.run_once('docker rmi %s' % images_id_api_list[i])
            print('移除镜像121api' + str(i))
    if len(images_id_web_list) &gt; 0:
        for i in range(0, len(images_id_web_list)):
            host121.run_once('docker rmi %s' % images_id_web_list[i])
            print('移除镜像121web' + str(i))

    run_once051 = host120.run_once('docker images')
    images_id_config_list1 = re.findall('172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once051)
    images_id_sys_list1 = re.findall('172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once051)
    images_id_base_list1 = re.findall('172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once051)
    images_id_api_list1 = re.findall('172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once051)
    images_id_web_list1 = re.findall('172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once051)
    if len(images_id_config_list1) &gt; 0:
        for i in range(0, len(images_id_config_list1)):
            host120.run_once('docker rmi %s' % images_id_config_list1[i])
            print('移除镜像120config' + str(i))
    if len(images_id_sys_list1) &gt; 0:
        for i in range(0, len(images_id_sys_list1)):
            host120.run_once('docker rmi %s' % images_id_sys_list1[i])
            print('移除镜像120sys' + str(i))
    if len(images_id_base_list1) &gt; 0:
        for i in range(0, len(images_id_base_list1)):
            host120.run_once('docker rmi %s' % images_id_base_list1[i])
            print('移除镜像120base' + str(i))
    if len(images_id_api_list1) &gt; 0:
        for i in range(0, len(images_id_api_list1)):
            host120.run_once('docker rmi %s' % images_id_api_list1[i])
            print('移除镜像120api' + str(i))
    if len(images_id_web_list1) &gt; 0:
        for i in range(0, len(images_id_web_list1)):
            host120.run_once('docker rmi %s' % images_id_web_list1[i])
            print('移除镜像120web' + str(i))

    run_once052 = host118.run_once('docker images')
    images_id_config_list2 = re.findall('172.17.20.117:5000/rz-config\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once052)
    images_id_sys_list2 = re.findall('172.17.20.117:5000/rz-sys\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once052)
    images_id_base_list2 = re.findall('172.17.20.117:5000/rz-base-info\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once052)
    images_id_api_list2 = re.findall('172.17.20.117:5000/rz-api-sh\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once052)
    images_id_web_list2 = re.findall('172.17.20.117:5000/rz-web-admin\\s{2,10}\\S{6}\\s{14}(\\S{12})', run_once052)
    if len(images_id_config_list2) &gt; 0:
        for i in range(0, len(images_id_config_list2)):
            host118.run_once('docker rmi %s' % images_id_config_list2[i])
            print('移除镜像118config' + str(i))
    if len(images_id_sys_list2) &gt; 0:
        for i in range(0, len(images_id_sys_list2)):
            host118.run_once('docker rmi %s' % images_id_sys_list2[i])
            print('移除镜像118sys' + str(i))
    if len(images_id_base_list2) &gt; 0:
        for i in range(0, len(images_id_base_list2)):
            host118.run_once('docker rmi %s' % images_id_base_list2[i])
            print('移除镜像118base' + str(i))
    if len(images_id_api_list2) &gt; 0:
        for i in range(0, len(images_id_api_list2)):
            host118.run_once('docker rmi %s' % images_id_api_list2[i])
            print('移除镜像118api' + str(i))
    if len(images_id_web_list2) &gt; 0:
        for i in range(0, len(images_id_web_list2)):
            host118.run_once('docker rmi %s' % images_id_web_list2[i])
            print('移除镜像118web' + str(i))
    print('*' * 50 + "删除完成" + '*' * 50)
</code></pre> 
  <p><strong>上传文件</strong></p> 
  <pre class="has">
<code class="language-python">from 连接linux主机 import Host


def upload():
    host = Host('172.17.20.117', 'root', '123456')

    local_path_api = r'C:\Users\nijiajin\Desktop\cshop\rz-api-sh\target\rz-api-sh-0.0.1.jar'
    remote_path_api = '/home/docker/gkzy/rz-api-sh/'

    local_path_base = r'C:\Users\nijiajin\Desktop\cshop\rz-base-info\target\rz-base-info-0.0.1.jar'
    remote_path_base = '/home/docker/gkzy/rz-base-info/'

    local_path_config = r'C:\Users\nijiajin\Desktop\cshop\rz-config\target\rz-config-0.0.1.jar'
    remote_path_config = '/home/docker/gkzy/rz-config/'

    local_path_sys = r'C:\Users\nijiajin\Desktop\cshop\rz-sys\target\rz-sys-0.0.1.jar'
    remote_path_sys = '/home/docker/gkzy/rz-sys/'

    local_path_web = r'C:\Users\nijiajin\Desktop\cshop\rz-web-admin\target\rz-web-admin-0.0.1.jar'
    remote_path_web = '/home/docker/gkzy/rz-web-admin/'

    host.upload(local_path_api, remote_path_api)
    host.upload(local_path_base, remote_path_base)
    host.upload(local_path_config, remote_path_config)
    host.upload(local_path_sys, remote_path_sys)
    host.upload(local_path_web, remote_path_web)
    print('*' * 50 + "上传文件完成" + '*' * 50)
</code></pre> 
  <p><strong>启动镜像</strong></p> 
  <pre class="has">
<code class="language-python">import re
import time
from 连接linux主机 import Host


def start_images():
    host117 = Host('172.17.20.117', 'root', '123456')
    host118 = Host('172.17.20.118', 'root', 'qweqaz123')
    host120 = Host('172.17.20.120', 'root', '123456')
    host121 = Host('172.17.20.121', 'root', '123456')

    run_once03 = host118.run_once('docker ps -a')
    ps_id_eureka = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka', run_once03)[0]
    # 5.上传config、sys、base-info、api、admin文件
    # TODO
    # 6.运行脚本文件，生成镜像并推送私有仓库
    once = host117.run_once('/home/docker/gkzy/docker_build_gkzy.sh')
    print(once)
    # 7.启动eureka
    ps_stop_eureka_info = host118.run_once('docker start %s' % ps_id_eureka)
    print("启动eureka：" + ps_stop_eureka_info)
    # 8.分别启动config、sys、base、api、admin
    run_config = host117.run_once(
        'docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-config')
    print('启动config：' + run_config)
    time.sleep(30)
    run_sys = host117.run_once(
        'docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-sys')
    print('启动sys：' + run_sys)
    time.sleep(5)
    run_base = host117.run_once(
        'docker service create --replicas 3 --name rz-base-info  --network springcloud_overlay -p 7772:7772 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-base-info')
    print('启动base：' + run_base)
    time.sleep(5)
    run_api = host117.run_once(
        'docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-api-sh')
    print('启动api：' + run_api)
    run_web = host121.run_once(
        'docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-web-admin')
    print('启动web：' + run_web)
    print('*' * 50 + "启动完成" + '*' * 50)
</code></pre> 
  <p><strong>连接linux主机</strong></p> 
  <pre class="has">
<code class="language-python">import re
import time
from 连接linux主机 import Host


def start_images():
    host117 = Host('172.17.20.117', 'root', '123456')
    host118 = Host('172.17.20.118', 'root', 'qweqaz123')
    host120 = Host('172.17.20.120', 'root', '123456')
    host121 = Host('172.17.20.121', 'root', '123456')

    run_once03 = host118.run_once('docker ps -a')
    ps_id_eureka = re.findall('(\\S{12})\\s{8}172.17.20.117:5000/rz-eureka', run_once03)[0]
    # 5.上传config、sys、base-info、api、admin文件
    # TODO
    # 6.运行脚本文件，生成镜像并推送私有仓库
    once = host117.run_once('/home/docker/gkzy/docker_build_gkzy.sh')
    print(once)
    # 7.启动eureka
    ps_stop_eureka_info = host118.run_once('docker start %s' % ps_id_eureka)
    print("启动eureka：" + ps_stop_eureka_info)
    # 8.分别启动config、sys、base、api、admin
    run_config = host117.run_once(
        'docker service create --replicas 1 --name config --network springcloud_overlay -p 7762:7762 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-config')
    print('启动config：' + run_config)
    time.sleep(30)
    run_sys = host117.run_once(
        'docker service create --replicas 2 --name rz-sys --network springcloud_overlay -p 7768:7768 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-sys')
    print('启动sys：' + run_sys)
    time.sleep(5)
    run_base = host117.run_once(
        'docker service create --replicas 3 --name rz-base-info  --network springcloud_overlay -p 7772:7772 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-base-info')
    print('启动base：' + run_base)
    time.sleep(5)
    run_api = host117.run_once(
        'docker service create --replicas 4 --name rz-api-sh --network springcloud_overlay -p 7758:7758 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-api-sh')
    print('启动api：' + run_api)
    run_web = host121.run_once(
        'docker run -d -v /etc/localtime:/etc/localtime:ro --name rz-web-admin --network=springcloud_overlay --network-alias=eureka -p 7782:7782 -e "EUREKA_SERVER_ADDRESS=eureka" -e "MYSQL_SERVER=172.17.20.120:3306" -e "REDIS_SERVER=172.17.20.120" 172.17.20.117:5000/rz-web-admin')
    print('启动web：' + run_web)
    print('*' * 50 + "启动完成" + '*' * 50)
</code></pre> 
  <p><strong>logo.ico</strong></p> 
  <p><a href="https://www.easyicon.net/" rel="nofollow" data-token="58214b07b6bb3261c0887280f667e1d7">https://www.easyicon.net/</a></p> 
  <p>注意一定要下载ico格式。强行改后缀报错。</p> 
  <p><strong>Main启动函数：</strong></p> 
  <pre class="has">
<code class="language-python">from 删除镜像 import delete_images
from 上传文件 import upload
from 启动镜像 import start_images

if __name__ == '__main__':
    delete_images()
    upload()
    start_images()
</code></pre> 
  <p><strong>打包exe文件：</strong></p> 
  <p><strong>黑窗口cd到Main.py所在文件路径下：pyinstaller -F -i logo.ico Main.py</strong><br> 有特殊需求，可以通过修改Main.space文件来达成。</p> 
 </div> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
