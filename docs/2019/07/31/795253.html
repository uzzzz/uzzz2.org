<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="文章目录 一、K-Means使用 load_iris 二、KMeans++实现 三、KMeans基本框架实现 有趣的事，Python永远不会缺席 培训说明 聚类总结（一）K-means、层次、DBSCAN、均值漂移、K-Means 、KNN https://blog.csdn.net/u010986753/article/details/97821890 聚类（二）原 聚类总结（二）聚类性能评估、肘部法则、轮廓系数 https://blog.csdn.net/u010986753/article/details/97885955 聚类（三）k-means++、k-means参数、Mini Batch K-Means https://blog.csdn.net/u010986753/article/details/97916856 聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris https://blog.csdn.net/u010986753/article/details/97922554 一、K-Means使用 load_iris 代码 # coding = utf-8 # 2019/7/31 Luckyxxt：有趣的事，Python永远不会缺席！ # https://www.cnblogs.com/huangyc/p/10229064.html import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D #3D的库 from sklearn.cluster import KMeans from sklearn import datasets np.random.seed(5) #设置随机数种子 iris = datasets.load_iris() X = iris.data y = iris.target estimators = [(&#39;k_means_iris_8&#39;, KMeans(n_clusters=8)),#k=8的kmeans (&#39;k_means_iris_3&#39;, KMeans(n_clusters=3)), #k=3的kmeans (&#39;k_means_iris_bad_init&#39;, KMeans(n_clusters=3, n_init=1,init=&#39;random&#39;)) #k=3，随机初始化的kmeans ] fignum = 1 titles = [&#39;8 clusters&#39;, &#39;3 clusters&#39;, &#39;3 clusters, bad initialization&#39;] for name, est in estimators: fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) est.fit(X) #fit建立模型 labels = est.labels_ #获得模型聚类后的label ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=labels.astype(np.float), edgecolor=&#39;k&#39;) #绘制X中的第3，0，2个维度的特征 ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) #设置坐标轴名 ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(titles[fignum - 1]) #设置图的名字 ax.dist = 12 fignum = fignum + 1 plt.show() # 绘制数据真实标签 fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) for name, label in [(&#39;Setosa&#39;, 0),(&#39;Versicolour&#39;, 1),(&#39;Virginica&#39;, 2)]: # 寻找特征的均值点 ax.text3D(X[y == label, 3].mean(),X[y == label, 0].mean(),X[y == label, 2].mean() + 2, name, horizontalalignment=&#39;center&#39;,bbox=dict(alpha=.2, edgecolor=&#39;w&#39;, facecolor=&#39;w&#39;)) y = np.choose(y, [1, 2, 0]).astype(np.float) ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=y, edgecolor=&#39;k&#39;) ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(&#39;Ground Truth&#39;) ax.dist = 12 fig.show() #绘制整张图 解释 对数据用k=8去聚类。因为数据本身只有3类，所以聚类效果不好。 对数据用k=3去聚类，效果不错。 还是用k=3去聚类，但是改变初始化方式init=random，n_init=1，这样的随机初始化，最后的效果会不好。 最后一张图是数据本身的label，和第二幅相差不大。 二、KMeans++实现 # kmeans++的初始化方式，加速聚类速度 def _k_means_plus_plus(self, dataset): n_samples, n_features = dataset.shape centers = np.empty((self.k, n_features)) # n_local_trials是每次选择候选点个数 n_local_trials = None if n_local_trials is None: n_local_trials = 2 + int(np.log(self.k)) # 第一个随机点 center_id = self.random_state.randint(n_samples) centers[0] = dataset[center_id] # closest_dist_sq是每个样本，到所有中心点最近距离 # 假设现在有3个中心点，closest_dist_sq = [min(样本1到3个中心距离),min(样本2到3个中心距离),...min(样本n到3个中心距离)] closest_dist_sq = distance(centers[0, np.newaxis], dataset) # current_pot所有最短距离的和 current_pot = closest_dist_sq.sum() for c in range(1, self.k): # 选出n_local_trials随机址，并映射到current_pot的长度 rand_vals = self.random_state.random_sample(n_local_trials) * current_pot # np.cumsum([1,2,3,4]) = [1, 3, 6, 10]，就是累加当前索引前面的值 # np.searchsorted搜索随机出的rand_vals落在np.cumsum(closest_dist_sq)中的位置。 # candidate_ids候选节点的索引 candidate_ids = np.searchsorted(np.cumsum(closest_dist_sq), rand_vals) # best_candidate最好的候选节点 # best_pot最好的候选节点计算出的距离和 # best_dist_sq最好的候选节点计算出的距离列表 best_candidate = None best_pot = None best_dist_sq = None for trial in range(n_local_trials): # 计算每个样本到候选节点的欧式距离 distance_to_candidate = distance(dataset[candidate_ids[trial], np.newaxis], dataset) # 计算每个候选节点的距离序列new_dist_sq， 距离总和new_pot new_dist_sq = np.minimum(closest_dist_sq, distance_to_candidate) new_pot = new_dist_sq.sum() # 选择最小的new_pot if (best_candidate is None) or (new_pot &lt; best_pot): best_candidate = candidate_ids[trial] best_pot = new_pot best_dist_sq = new_dist_sq centers[c] = dataset[best_candidate] current_pot = best_pot closest_dist_sq = best_dist_sq return centers 三、KMeans基本框架实现 class KMeansBase(object): def __init__(self, n_clusters = 8, init = &quot;random&quot;, max_iter = 300, random_state = None, n_init = 10, tol = 1e-4): self.k = n_clusters # 聚类个数 self.init = init # 输出化方式 self.max_iter = max_iter # 最大迭代次数 self.random_state = check_random_state(random_state) #随机数 self.n_init = n_init # 进行多次聚类，选择最好的一次 self.tol = tol # 停止聚类的阈值 # fit对train建立模型 def fit(self, dataset): self.tol = self._tolerance(dataset, self.tol) bestError = None bestCenters = None bestLabels = None for i in range(self.n_init): labels, centers, error = self._kmeans(dataset) if bestError == None or error &lt; bestError: bestError = error bestCenters = centers bestLabels = labels self.centers = bestCenters return bestLabels, bestCenters, bestError # predict根据训练好的模型预测新的数据 def predict(self, X): return self.update_labels_error(X, self.centers)[0] # 合并fit和predict def fit_predict(self, dataset): self.fit(dataset) return self.predict(dataset) # kmeans的主要方法，完成一次聚类的过程 def _kmeans(self, dataset): self.dataset = np.array(dataset) bestError = None bestCenters = None bestLabels = None centerShiftTotal = 0 centers = self._init_centroids(dataset) for i in range(self.max_iter): oldCenters = centers.copy() labels, error = self.update_labels_error(dataset, centers) centers = self.update_centers(dataset, labels) if bestError == None or error &lt; bestError: bestLabels = labels.copy() bestCenters = centers.copy() bestError = error ## oldCenters和centers的偏移量 centerShiftTotal = np.linalg.norm(oldCenters - centers) ** 2 if centerShiftTotal &lt;= self.tol: break #由于上面的循环，最后一步更新了centers，所以如果和旧的centers不一样的话，再更新一次labels，error if centerShiftTotal &gt; 0: bestLabels, bestError = self.update_labels_error(dataset, bestCenters) return bestLabels, bestCenters, bestError # k个数据点，随机生成 def _init_centroids(self, dataset): n_samples = dataset.shape[0] centers = [] if self.init == &quot;random&quot;: seeds = self.random_state.permutation(n_samples)[:self.k] centers = dataset[seeds] elif self.init == &quot;k-means++&quot;: pass return np.array(centers) # 把tol和dataset相关联 def _tolerance(self, dataset, tol): variances = np.var(dataset, axis=0) return np.mean(variances) * tol # 更新每个点的标签，和计算误差 def update_labels_error(self, dataset, centers): labels = self.assign_points(dataset, centers) new_means = defaultdict(list) error = 0 for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) error += np.sqrt(np.sum(np.square(points - newCenter))) return labels, error # 更新中心点 def update_centers(self, dataset, labels): new_means = defaultdict(list) centers = [] for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) centers.append(newCenter) return np.array(centers) # 分配每个点到最近的center def assign_points(self, dataset, centers): labels = [] for point in dataset: shortest = float(&quot;inf&quot;) # 正无穷 shortest_index = 0 for i in range(len(centers)): val = distance(point[np.newaxis], centers[i]) if val &lt; shortest: shortest = val shortest_index = i labels.append(shortest_index) return labels 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。" />
<meta property="og:description" content="文章目录 一、K-Means使用 load_iris 二、KMeans++实现 三、KMeans基本框架实现 有趣的事，Python永远不会缺席 培训说明 聚类总结（一）K-means、层次、DBSCAN、均值漂移、K-Means 、KNN https://blog.csdn.net/u010986753/article/details/97821890 聚类（二）原 聚类总结（二）聚类性能评估、肘部法则、轮廓系数 https://blog.csdn.net/u010986753/article/details/97885955 聚类（三）k-means++、k-means参数、Mini Batch K-Means https://blog.csdn.net/u010986753/article/details/97916856 聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris https://blog.csdn.net/u010986753/article/details/97922554 一、K-Means使用 load_iris 代码 # coding = utf-8 # 2019/7/31 Luckyxxt：有趣的事，Python永远不会缺席！ # https://www.cnblogs.com/huangyc/p/10229064.html import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D #3D的库 from sklearn.cluster import KMeans from sklearn import datasets np.random.seed(5) #设置随机数种子 iris = datasets.load_iris() X = iris.data y = iris.target estimators = [(&#39;k_means_iris_8&#39;, KMeans(n_clusters=8)),#k=8的kmeans (&#39;k_means_iris_3&#39;, KMeans(n_clusters=3)), #k=3的kmeans (&#39;k_means_iris_bad_init&#39;, KMeans(n_clusters=3, n_init=1,init=&#39;random&#39;)) #k=3，随机初始化的kmeans ] fignum = 1 titles = [&#39;8 clusters&#39;, &#39;3 clusters&#39;, &#39;3 clusters, bad initialization&#39;] for name, est in estimators: fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) est.fit(X) #fit建立模型 labels = est.labels_ #获得模型聚类后的label ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=labels.astype(np.float), edgecolor=&#39;k&#39;) #绘制X中的第3，0，2个维度的特征 ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) #设置坐标轴名 ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(titles[fignum - 1]) #设置图的名字 ax.dist = 12 fignum = fignum + 1 plt.show() # 绘制数据真实标签 fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) for name, label in [(&#39;Setosa&#39;, 0),(&#39;Versicolour&#39;, 1),(&#39;Virginica&#39;, 2)]: # 寻找特征的均值点 ax.text3D(X[y == label, 3].mean(),X[y == label, 0].mean(),X[y == label, 2].mean() + 2, name, horizontalalignment=&#39;center&#39;,bbox=dict(alpha=.2, edgecolor=&#39;w&#39;, facecolor=&#39;w&#39;)) y = np.choose(y, [1, 2, 0]).astype(np.float) ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=y, edgecolor=&#39;k&#39;) ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(&#39;Ground Truth&#39;) ax.dist = 12 fig.show() #绘制整张图 解释 对数据用k=8去聚类。因为数据本身只有3类，所以聚类效果不好。 对数据用k=3去聚类，效果不错。 还是用k=3去聚类，但是改变初始化方式init=random，n_init=1，这样的随机初始化，最后的效果会不好。 最后一张图是数据本身的label，和第二幅相差不大。 二、KMeans++实现 # kmeans++的初始化方式，加速聚类速度 def _k_means_plus_plus(self, dataset): n_samples, n_features = dataset.shape centers = np.empty((self.k, n_features)) # n_local_trials是每次选择候选点个数 n_local_trials = None if n_local_trials is None: n_local_trials = 2 + int(np.log(self.k)) # 第一个随机点 center_id = self.random_state.randint(n_samples) centers[0] = dataset[center_id] # closest_dist_sq是每个样本，到所有中心点最近距离 # 假设现在有3个中心点，closest_dist_sq = [min(样本1到3个中心距离),min(样本2到3个中心距离),...min(样本n到3个中心距离)] closest_dist_sq = distance(centers[0, np.newaxis], dataset) # current_pot所有最短距离的和 current_pot = closest_dist_sq.sum() for c in range(1, self.k): # 选出n_local_trials随机址，并映射到current_pot的长度 rand_vals = self.random_state.random_sample(n_local_trials) * current_pot # np.cumsum([1,2,3,4]) = [1, 3, 6, 10]，就是累加当前索引前面的值 # np.searchsorted搜索随机出的rand_vals落在np.cumsum(closest_dist_sq)中的位置。 # candidate_ids候选节点的索引 candidate_ids = np.searchsorted(np.cumsum(closest_dist_sq), rand_vals) # best_candidate最好的候选节点 # best_pot最好的候选节点计算出的距离和 # best_dist_sq最好的候选节点计算出的距离列表 best_candidate = None best_pot = None best_dist_sq = None for trial in range(n_local_trials): # 计算每个样本到候选节点的欧式距离 distance_to_candidate = distance(dataset[candidate_ids[trial], np.newaxis], dataset) # 计算每个候选节点的距离序列new_dist_sq， 距离总和new_pot new_dist_sq = np.minimum(closest_dist_sq, distance_to_candidate) new_pot = new_dist_sq.sum() # 选择最小的new_pot if (best_candidate is None) or (new_pot &lt; best_pot): best_candidate = candidate_ids[trial] best_pot = new_pot best_dist_sq = new_dist_sq centers[c] = dataset[best_candidate] current_pot = best_pot closest_dist_sq = best_dist_sq return centers 三、KMeans基本框架实现 class KMeansBase(object): def __init__(self, n_clusters = 8, init = &quot;random&quot;, max_iter = 300, random_state = None, n_init = 10, tol = 1e-4): self.k = n_clusters # 聚类个数 self.init = init # 输出化方式 self.max_iter = max_iter # 最大迭代次数 self.random_state = check_random_state(random_state) #随机数 self.n_init = n_init # 进行多次聚类，选择最好的一次 self.tol = tol # 停止聚类的阈值 # fit对train建立模型 def fit(self, dataset): self.tol = self._tolerance(dataset, self.tol) bestError = None bestCenters = None bestLabels = None for i in range(self.n_init): labels, centers, error = self._kmeans(dataset) if bestError == None or error &lt; bestError: bestError = error bestCenters = centers bestLabels = labels self.centers = bestCenters return bestLabels, bestCenters, bestError # predict根据训练好的模型预测新的数据 def predict(self, X): return self.update_labels_error(X, self.centers)[0] # 合并fit和predict def fit_predict(self, dataset): self.fit(dataset) return self.predict(dataset) # kmeans的主要方法，完成一次聚类的过程 def _kmeans(self, dataset): self.dataset = np.array(dataset) bestError = None bestCenters = None bestLabels = None centerShiftTotal = 0 centers = self._init_centroids(dataset) for i in range(self.max_iter): oldCenters = centers.copy() labels, error = self.update_labels_error(dataset, centers) centers = self.update_centers(dataset, labels) if bestError == None or error &lt; bestError: bestLabels = labels.copy() bestCenters = centers.copy() bestError = error ## oldCenters和centers的偏移量 centerShiftTotal = np.linalg.norm(oldCenters - centers) ** 2 if centerShiftTotal &lt;= self.tol: break #由于上面的循环，最后一步更新了centers，所以如果和旧的centers不一样的话，再更新一次labels，error if centerShiftTotal &gt; 0: bestLabels, bestError = self.update_labels_error(dataset, bestCenters) return bestLabels, bestCenters, bestError # k个数据点，随机生成 def _init_centroids(self, dataset): n_samples = dataset.shape[0] centers = [] if self.init == &quot;random&quot;: seeds = self.random_state.permutation(n_samples)[:self.k] centers = dataset[seeds] elif self.init == &quot;k-means++&quot;: pass return np.array(centers) # 把tol和dataset相关联 def _tolerance(self, dataset, tol): variances = np.var(dataset, axis=0) return np.mean(variances) * tol # 更新每个点的标签，和计算误差 def update_labels_error(self, dataset, centers): labels = self.assign_points(dataset, centers) new_means = defaultdict(list) error = 0 for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) error += np.sqrt(np.sum(np.square(points - newCenter))) return labels, error # 更新中心点 def update_centers(self, dataset, labels): new_means = defaultdict(list) centers = [] for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) centers.append(newCenter) return np.array(centers) # 分配每个点到最近的center def assign_points(self, dataset, centers): labels = [] for point in dataset: shortest = float(&quot;inf&quot;) # 正无穷 shortest_index = 0 for i in range(len(centers)): val = distance(point[np.newaxis], centers[i]) if val &lt; shortest: shortest = val shortest_index = i labels.append(shortest_index) return labels 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。" />
<link rel="canonical" href="https://uzzz.org/2019/07/31/795253.html" />
<meta property="og:url" content="https://uzzz.org/2019/07/31/795253.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-07-31T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"文章目录 一、K-Means使用 load_iris 二、KMeans++实现 三、KMeans基本框架实现 有趣的事，Python永远不会缺席 培训说明 聚类总结（一）K-means、层次、DBSCAN、均值漂移、K-Means 、KNN https://blog.csdn.net/u010986753/article/details/97821890 聚类（二）原 聚类总结（二）聚类性能评估、肘部法则、轮廓系数 https://blog.csdn.net/u010986753/article/details/97885955 聚类（三）k-means++、k-means参数、Mini Batch K-Means https://blog.csdn.net/u010986753/article/details/97916856 聚类（四）KMeans基本框架\\KMeans++实现\\K-Means使用 load_iris https://blog.csdn.net/u010986753/article/details/97922554 一、K-Means使用 load_iris 代码 # coding = utf-8 # 2019/7/31 Luckyxxt：有趣的事，Python永远不会缺席！ # https://www.cnblogs.com/huangyc/p/10229064.html import numpy as np import matplotlib.pyplot as plt from mpl_toolkits.mplot3d import Axes3D #3D的库 from sklearn.cluster import KMeans from sklearn import datasets np.random.seed(5) #设置随机数种子 iris = datasets.load_iris() X = iris.data y = iris.target estimators = [(&#39;k_means_iris_8&#39;, KMeans(n_clusters=8)),#k=8的kmeans (&#39;k_means_iris_3&#39;, KMeans(n_clusters=3)), #k=3的kmeans (&#39;k_means_iris_bad_init&#39;, KMeans(n_clusters=3, n_init=1,init=&#39;random&#39;)) #k=3，随机初始化的kmeans ] fignum = 1 titles = [&#39;8 clusters&#39;, &#39;3 clusters&#39;, &#39;3 clusters, bad initialization&#39;] for name, est in estimators: fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) est.fit(X) #fit建立模型 labels = est.labels_ #获得模型聚类后的label ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=labels.astype(np.float), edgecolor=&#39;k&#39;) #绘制X中的第3，0，2个维度的特征 ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) #设置坐标轴名 ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(titles[fignum - 1]) #设置图的名字 ax.dist = 12 fignum = fignum + 1 plt.show() # 绘制数据真实标签 fig = plt.figure(fignum, figsize=(4, 3)) ax = Axes3D(fig, rect=[0, 0, .95, 1], elev=48, azim=134) for name, label in [(&#39;Setosa&#39;, 0),(&#39;Versicolour&#39;, 1),(&#39;Virginica&#39;, 2)]: # 寻找特征的均值点 ax.text3D(X[y == label, 3].mean(),X[y == label, 0].mean(),X[y == label, 2].mean() + 2, name, horizontalalignment=&#39;center&#39;,bbox=dict(alpha=.2, edgecolor=&#39;w&#39;, facecolor=&#39;w&#39;)) y = np.choose(y, [1, 2, 0]).astype(np.float) ax.scatter(X[:, 3], X[:, 0], X[:, 2], c=y, edgecolor=&#39;k&#39;) ax.w_xaxis.set_ticklabels([]) ax.w_yaxis.set_ticklabels([]) ax.w_zaxis.set_ticklabels([]) ax.set_xlabel(&#39;Petal width&#39;) ax.set_ylabel(&#39;Sepal length&#39;) ax.set_zlabel(&#39;Petal length&#39;) ax.set_title(&#39;Ground Truth&#39;) ax.dist = 12 fig.show() #绘制整张图 解释 对数据用k=8去聚类。因为数据本身只有3类，所以聚类效果不好。 对数据用k=3去聚类，效果不错。 还是用k=3去聚类，但是改变初始化方式init=random，n_init=1，这样的随机初始化，最后的效果会不好。 最后一张图是数据本身的label，和第二幅相差不大。 二、KMeans++实现 # kmeans++的初始化方式，加速聚类速度 def _k_means_plus_plus(self, dataset): n_samples, n_features = dataset.shape centers = np.empty((self.k, n_features)) # n_local_trials是每次选择候选点个数 n_local_trials = None if n_local_trials is None: n_local_trials = 2 + int(np.log(self.k)) # 第一个随机点 center_id = self.random_state.randint(n_samples) centers[0] = dataset[center_id] # closest_dist_sq是每个样本，到所有中心点最近距离 # 假设现在有3个中心点，closest_dist_sq = [min(样本1到3个中心距离),min(样本2到3个中心距离),...min(样本n到3个中心距离)] closest_dist_sq = distance(centers[0, np.newaxis], dataset) # current_pot所有最短距离的和 current_pot = closest_dist_sq.sum() for c in range(1, self.k): # 选出n_local_trials随机址，并映射到current_pot的长度 rand_vals = self.random_state.random_sample(n_local_trials) * current_pot # np.cumsum([1,2,3,4]) = [1, 3, 6, 10]，就是累加当前索引前面的值 # np.searchsorted搜索随机出的rand_vals落在np.cumsum(closest_dist_sq)中的位置。 # candidate_ids候选节点的索引 candidate_ids = np.searchsorted(np.cumsum(closest_dist_sq), rand_vals) # best_candidate最好的候选节点 # best_pot最好的候选节点计算出的距离和 # best_dist_sq最好的候选节点计算出的距离列表 best_candidate = None best_pot = None best_dist_sq = None for trial in range(n_local_trials): # 计算每个样本到候选节点的欧式距离 distance_to_candidate = distance(dataset[candidate_ids[trial], np.newaxis], dataset) # 计算每个候选节点的距离序列new_dist_sq， 距离总和new_pot new_dist_sq = np.minimum(closest_dist_sq, distance_to_candidate) new_pot = new_dist_sq.sum() # 选择最小的new_pot if (best_candidate is None) or (new_pot &lt; best_pot): best_candidate = candidate_ids[trial] best_pot = new_pot best_dist_sq = new_dist_sq centers[c] = dataset[best_candidate] current_pot = best_pot closest_dist_sq = best_dist_sq return centers 三、KMeans基本框架实现 class KMeansBase(object): def __init__(self, n_clusters = 8, init = &quot;random&quot;, max_iter = 300, random_state = None, n_init = 10, tol = 1e-4): self.k = n_clusters # 聚类个数 self.init = init # 输出化方式 self.max_iter = max_iter # 最大迭代次数 self.random_state = check_random_state(random_state) #随机数 self.n_init = n_init # 进行多次聚类，选择最好的一次 self.tol = tol # 停止聚类的阈值 # fit对train建立模型 def fit(self, dataset): self.tol = self._tolerance(dataset, self.tol) bestError = None bestCenters = None bestLabels = None for i in range(self.n_init): labels, centers, error = self._kmeans(dataset) if bestError == None or error &lt; bestError: bestError = error bestCenters = centers bestLabels = labels self.centers = bestCenters return bestLabels, bestCenters, bestError # predict根据训练好的模型预测新的数据 def predict(self, X): return self.update_labels_error(X, self.centers)[0] # 合并fit和predict def fit_predict(self, dataset): self.fit(dataset) return self.predict(dataset) # kmeans的主要方法，完成一次聚类的过程 def _kmeans(self, dataset): self.dataset = np.array(dataset) bestError = None bestCenters = None bestLabels = None centerShiftTotal = 0 centers = self._init_centroids(dataset) for i in range(self.max_iter): oldCenters = centers.copy() labels, error = self.update_labels_error(dataset, centers) centers = self.update_centers(dataset, labels) if bestError == None or error &lt; bestError: bestLabels = labels.copy() bestCenters = centers.copy() bestError = error ## oldCenters和centers的偏移量 centerShiftTotal = np.linalg.norm(oldCenters - centers) ** 2 if centerShiftTotal &lt;= self.tol: break #由于上面的循环，最后一步更新了centers，所以如果和旧的centers不一样的话，再更新一次labels，error if centerShiftTotal &gt; 0: bestLabels, bestError = self.update_labels_error(dataset, bestCenters) return bestLabels, bestCenters, bestError # k个数据点，随机生成 def _init_centroids(self, dataset): n_samples = dataset.shape[0] centers = [] if self.init == &quot;random&quot;: seeds = self.random_state.permutation(n_samples)[:self.k] centers = dataset[seeds] elif self.init == &quot;k-means++&quot;: pass return np.array(centers) # 把tol和dataset相关联 def _tolerance(self, dataset, tol): variances = np.var(dataset, axis=0) return np.mean(variances) * tol # 更新每个点的标签，和计算误差 def update_labels_error(self, dataset, centers): labels = self.assign_points(dataset, centers) new_means = defaultdict(list) error = 0 for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) error += np.sqrt(np.sum(np.square(points - newCenter))) return labels, error # 更新中心点 def update_centers(self, dataset, labels): new_means = defaultdict(list) centers = [] for assignment, point in zip(labels, dataset): new_means[assignment].append(point) for points in new_means.values(): newCenter = np.mean(points, axis=0) centers.append(newCenter) return np.array(centers) # 分配每个点到最近的center def assign_points(self, dataset, centers): labels = [] for point in dataset: shortest = float(&quot;inf&quot;) # 正无穷 shortest_index = 0 for i in range(len(centers)): val = distance(point[np.newaxis], centers[i]) if val &lt; shortest: shortest = val shortest_index = i labels.append(shortest_index) return labels 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。","@type":"BlogPosting","url":"https://uzzz.org/2019/07/31/795253.html","headline":"聚类（四）KMeans基本框架\\KMeans++实现\\K-Means使用 load_iris","dateModified":"2019-07-31T00:00:00+08:00","datePublished":"2019-07-31T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/07/31/795253.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p></p>
  <div class="toc">
   <h3>文章目录</h3>
   <ul>
    <li><a href="#KMeans_load_iris_6" rel="nofollow" data-token="9bd58d8030fc9e6bc3bfd6cfb1142999">一、K-Means使用 load_iris</a></li>
    <li><a href="#KMeans_90" rel="nofollow" data-token="77959e095021eaba5adb047d938e7a7a">二、KMeans++实现</a></li>
    <li><a href="#KMeans_148" rel="nofollow" data-token="9321fbd3a068e6c5c044a1fe23fe2abe">三、KMeans基本框架实现</a></li>
    <li><a href="#Python_278" rel="nofollow" data-token="3f90ed5673c4170292abc0fa648b617e">有趣的事，Python永远不会缺席</a></li>
    <li><a href="#strongstrongbr_292" rel="nofollow" data-token="a71eff2744c78d67d67af6500b03fb85"><strong>培训说明</strong><br></a></li>
   </ul>
  </div>
  <br> 聚类总结（一）K-means、层次、DBSCAN、均值漂移、K-Means 、KNN 
  <a href="https://blog.csdn.net/u010986753/article/details/97821890" rel="nofollow" data-token="6f527d2b6ffd00eaa6d31e9f3a7ed8a7">https://blog.csdn.net/u010986753/article/details/97821890</a>
  <br> 聚类（二）原 聚类总结（二）聚类性能评估、肘部法则、轮廓系数 
  <a href="https://blog.csdn.net/u010986753/article/details/97885955" rel="nofollow" data-token="d81c673488342d80495fcaa20ee4dfac">https://blog.csdn.net/u010986753/article/details/97885955</a>
  <br> 聚类（三）k-means++、k-means参数、Mini Batch K-Means 
  <a href="https://blog.csdn.net/u010986753/article/details/97916856" rel="nofollow" data-token="92f085accab208eb61915b26142aceed">https://blog.csdn.net/u010986753/article/details/97916856</a>
  <br> 聚类（四）KMeans基本框架\KMeans++实现\K-Means使用 load_iris 
  <a href="https://blog.csdn.net/u010986753/article/details/97922554" rel="nofollow" data-token="fcf7aaa1aff112f1cecde78bf33d7e73">https://blog.csdn.net/u010986753/article/details/97922554</a>
  <p></p> 
  <h1><a id="KMeans_load_iris_6"></a>一、K-Means使用 load_iris</h1> 
  <p><strong>代码</strong></p> 
  <pre><code class="prism language-python"><span class="token comment"># coding = utf-8</span>
<span class="token comment"># 2019/7/31 Luckyxxt：有趣的事，Python永远不会缺席！</span>
<span class="token comment"># https://www.cnblogs.com/huangyc/p/10229064.html</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D <span class="token comment">#3D的库</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>cluster <span class="token keyword">import</span> KMeans
<span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets

np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#设置随机数种子</span>

iris <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> iris<span class="token punctuation">.</span>data
y <span class="token operator">=</span> iris<span class="token punctuation">.</span>target

estimators <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'k_means_iris_8'</span><span class="token punctuation">,</span> KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">#k=8的kmeans</span>
              <span class="token punctuation">(</span><span class="token string">'k_means_iris_3'</span><span class="token punctuation">,</span> KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">#k=3的kmeans</span>
              <span class="token punctuation">(</span><span class="token string">'k_means_iris_bad_init'</span><span class="token punctuation">,</span> KMeans<span class="token punctuation">(</span>n_clusters<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> n_init<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>init<span class="token operator">=</span><span class="token string">'random'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#k=3，随机初始化的kmeans</span>
              <span class="token punctuation">]</span>

fignum <span class="token operator">=</span> <span class="token number">1</span>
titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'8 clusters'</span><span class="token punctuation">,</span> <span class="token string">'3 clusters'</span><span class="token punctuation">,</span> <span class="token string">'3 clusters, bad initialization'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> name<span class="token punctuation">,</span> est <span class="token keyword">in</span> estimators<span class="token punctuation">:</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>fignum<span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">,</span> rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> elev<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">,</span> azim<span class="token operator">=</span><span class="token number">134</span><span class="token punctuation">)</span>
    est<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token comment">#fit建立模型</span>
    labels <span class="token operator">=</span> est<span class="token punctuation">.</span>labels_ <span class="token comment">#获得模型聚类后的label</span>

    ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
               c<span class="token operator">=</span>labels<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span> <span class="token comment">#绘制X中的第3，0，2个维度的特征</span>

    ax<span class="token punctuation">.</span>w_xaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>w_yaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>w_zaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Petal width'</span><span class="token punctuation">)</span> <span class="token comment">#设置坐标轴名</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Sepal length'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'Petal length'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>fignum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#设置图的名字</span>
    ax<span class="token punctuation">.</span>dist <span class="token operator">=</span> <span class="token number">12</span>
    fignum <span class="token operator">=</span> fignum <span class="token operator">+</span> <span class="token number">1</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 绘制数据真实标签</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>fignum<span class="token punctuation">,</span> figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">,</span> rect<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.95</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> elev<span class="token operator">=</span><span class="token number">48</span><span class="token punctuation">,</span> azim<span class="token operator">=</span><span class="token number">134</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> name<span class="token punctuation">,</span> label <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'Setosa'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'Versicolour'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token string">'Virginica'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token comment"># 寻找特征的均值点</span>
    ax<span class="token punctuation">.</span>text3D<span class="token punctuation">(</span>X<span class="token punctuation">[</span>y <span class="token operator">==</span> label<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span>y <span class="token operator">==</span> label<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>X<span class="token punctuation">[</span>y <span class="token operator">==</span> label<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span>
              horizontalalignment<span class="token operator">=</span><span class="token string">'center'</span><span class="token punctuation">,</span>bbox<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>alpha<span class="token operator">=</span><span class="token number">.2</span><span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">,</span> facecolor<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

y <span class="token operator">=</span> np<span class="token punctuation">.</span>choose<span class="token punctuation">(</span>y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token operator">=</span>y<span class="token punctuation">,</span> edgecolor<span class="token operator">=</span><span class="token string">'k'</span><span class="token punctuation">)</span>

ax<span class="token punctuation">.</span>w_xaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>w_yaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>w_zaxis<span class="token punctuation">.</span>set_ticklabels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'Petal width'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Sepal length'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'Petal length'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Ground Truth'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>dist <span class="token operator">=</span> <span class="token number">12</span>

fig<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#绘制整张图</span>
</code></pre> 
  <center>
   <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019073117112527.png"> 
   <center>
    <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190731171301591.png"> 
    <center>
     <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190731171329527.png"> 
    </center>
   </center>
  </center>
  <p><strong>解释</strong></p> 
  <ul> 
   <li>对数据用k=8去聚类。因为数据本身只有3类，所以聚类效果不好。</li> 
   <li>对数据用k=3去聚类，效果不错。</li> 
   <li>还是用k=3去聚类，但是改变初始化方式init=random，n_init=1，这样的随机初始化，最后的效果会不好。</li> 
   <li>最后一张图是数据本身的label，和第二幅相差不大。</li> 
  </ul> 
  <center>
   <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190731222824522.png"> 
  </center>
  <h1><a id="KMeans_90"></a>二、KMeans++实现</h1> 
  <pre><code class="prism language-python"><span class="token comment"># kmeans++的初始化方式，加速聚类速度</span>
<span class="token keyword">def</span> <span class="token function">_k_means_plus_plus</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n_samples<span class="token punctuation">,</span> n_features <span class="token operator">=</span> dataset<span class="token punctuation">.</span>shape
    centers <span class="token operator">=</span> np<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">,</span> n_features<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># n_local_trials是每次选择候选点个数</span>
    n_local_trials <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> n_local_trials <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        n_local_trials <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token builtin">int</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>log<span class="token punctuation">(</span>self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 第一个随机点</span>
    center_id <span class="token operator">=</span> self<span class="token punctuation">.</span>random_state<span class="token punctuation">.</span>randint<span class="token punctuation">(</span>n_samples<span class="token punctuation">)</span>
    centers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span>center_id<span class="token punctuation">]</span>

    <span class="token comment"># closest_dist_sq是每个样本，到所有中心点最近距离</span>
    <span class="token comment"># 假设现在有3个中心点，closest_dist_sq = [min(样本1到3个中心距离),min(样本2到3个中心距离),...min(样本n到3个中心距离)]</span>
    closest_dist_sq <span class="token operator">=</span> distance<span class="token punctuation">(</span>centers<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>newaxis<span class="token punctuation">]</span><span class="token punctuation">,</span> dataset<span class="token punctuation">)</span>

    <span class="token comment"># current_pot所有最短距离的和</span>
    current_pot <span class="token operator">=</span> closest_dist_sq<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 选出n_local_trials随机址，并映射到current_pot的长度</span>
        rand_vals <span class="token operator">=</span> self<span class="token punctuation">.</span>random_state<span class="token punctuation">.</span>random_sample<span class="token punctuation">(</span>n_local_trials<span class="token punctuation">)</span> <span class="token operator">*</span> current_pot
        <span class="token comment"># np.cumsum([1,2,3,4]) = [1, 3, 6, 10]，就是累加当前索引前面的值</span>
        <span class="token comment"># np.searchsorted搜索随机出的rand_vals落在np.cumsum(closest_dist_sq)中的位置。</span>
        <span class="token comment"># candidate_ids候选节点的索引</span>
        candidate_ids <span class="token operator">=</span> np<span class="token punctuation">.</span>searchsorted<span class="token punctuation">(</span>np<span class="token punctuation">.</span>cumsum<span class="token punctuation">(</span>closest_dist_sq<span class="token punctuation">)</span><span class="token punctuation">,</span> rand_vals<span class="token punctuation">)</span>

        <span class="token comment"># best_candidate最好的候选节点</span>
        <span class="token comment"># best_pot最好的候选节点计算出的距离和</span>
        <span class="token comment"># best_dist_sq最好的候选节点计算出的距离列表</span>
        best_candidate <span class="token operator">=</span> <span class="token boolean">None</span>
        best_pot <span class="token operator">=</span> <span class="token boolean">None</span>
        best_dist_sq <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> trial <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n_local_trials<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 计算每个样本到候选节点的欧式距离</span>
            distance_to_candidate <span class="token operator">=</span> distance<span class="token punctuation">(</span>dataset<span class="token punctuation">[</span>candidate_ids<span class="token punctuation">[</span>trial<span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>newaxis<span class="token punctuation">]</span><span class="token punctuation">,</span> dataset<span class="token punctuation">)</span>

            <span class="token comment"># 计算每个候选节点的距离序列new_dist_sq， 距离总和new_pot</span>
            new_dist_sq <span class="token operator">=</span> np<span class="token punctuation">.</span>minimum<span class="token punctuation">(</span>closest_dist_sq<span class="token punctuation">,</span> distance_to_candidate<span class="token punctuation">)</span>
            new_pot <span class="token operator">=</span> new_dist_sq<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

            <span class="token comment"># 选择最小的new_pot</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>best_candidate <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>new_pot <span class="token operator">&lt;</span> best_pot<span class="token punctuation">)</span><span class="token punctuation">:</span>
                best_candidate <span class="token operator">=</span> candidate_ids<span class="token punctuation">[</span>trial<span class="token punctuation">]</span>
                best_pot <span class="token operator">=</span> new_pot
                best_dist_sq <span class="token operator">=</span> new_dist_sq

        centers<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span>best_candidate<span class="token punctuation">]</span>
        current_pot <span class="token operator">=</span> best_pot
        closest_dist_sq <span class="token operator">=</span> best_dist_sq

    <span class="token keyword">return</span> centers
</code></pre> 
  <h1><a id="KMeans_148"></a>三、KMeans基本框架实现</h1> 
  <pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">KMeansBase</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n_clusters <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">,</span> init <span class="token operator">=</span> <span class="token string">"random"</span><span class="token punctuation">,</span> max_iter <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> random_state <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> n_init <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> tol <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>k <span class="token operator">=</span> n_clusters <span class="token comment"># 聚类个数</span>
        self<span class="token punctuation">.</span>init <span class="token operator">=</span> init <span class="token comment"># 输出化方式</span>
        self<span class="token punctuation">.</span>max_iter <span class="token operator">=</span> max_iter <span class="token comment"># 最大迭代次数</span>
        self<span class="token punctuation">.</span>random_state <span class="token operator">=</span> check_random_state<span class="token punctuation">(</span>random_state<span class="token punctuation">)</span> <span class="token comment">#随机数</span>
        self<span class="token punctuation">.</span>n_init <span class="token operator">=</span> n_init <span class="token comment"># 进行多次聚类，选择最好的一次</span>
        self<span class="token punctuation">.</span>tol <span class="token operator">=</span> tol <span class="token comment"># 停止聚类的阈值</span>

    <span class="token comment"># fit对train建立模型</span>
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>tol <span class="token operator">=</span> self<span class="token punctuation">.</span>_tolerance<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tol<span class="token punctuation">)</span>

        bestError <span class="token operator">=</span> <span class="token boolean">None</span>
        bestCenters <span class="token operator">=</span> <span class="token boolean">None</span>
        bestLabels <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>n_init<span class="token punctuation">)</span><span class="token punctuation">:</span>
            labels<span class="token punctuation">,</span> centers<span class="token punctuation">,</span> error <span class="token operator">=</span> self<span class="token punctuation">.</span>_kmeans<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
            <span class="token keyword">if</span> bestError <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token operator">or</span> error <span class="token operator">&lt;</span> bestError<span class="token punctuation">:</span>
                bestError <span class="token operator">=</span> error
                bestCenters <span class="token operator">=</span> centers
                bestLabels <span class="token operator">=</span> labels
        self<span class="token punctuation">.</span>centers <span class="token operator">=</span> bestCenters
        <span class="token keyword">return</span> bestLabels<span class="token punctuation">,</span> bestCenters<span class="token punctuation">,</span> bestError

    <span class="token comment"># predict根据训练好的模型预测新的数据</span>
    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> X<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update_labels_error<span class="token punctuation">(</span>X<span class="token punctuation">,</span> self<span class="token punctuation">.</span>centers<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># 合并fit和predict</span>
    <span class="token keyword">def</span> <span class="token function">fit_predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>

    <span class="token comment"># kmeans的主要方法，完成一次聚类的过程</span>
    <span class="token keyword">def</span> <span class="token function">_kmeans</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>dataset <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>
        bestError <span class="token operator">=</span> <span class="token boolean">None</span>
        bestCenters <span class="token operator">=</span> <span class="token boolean">None</span>
        bestLabels <span class="token operator">=</span> <span class="token boolean">None</span>
        centerShiftTotal <span class="token operator">=</span> <span class="token number">0</span>
        centers <span class="token operator">=</span> self<span class="token punctuation">.</span>_init_centroids<span class="token punctuation">(</span>dataset<span class="token punctuation">)</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>max_iter<span class="token punctuation">)</span><span class="token punctuation">:</span>
            oldCenters <span class="token operator">=</span> centers<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
            labels<span class="token punctuation">,</span> error <span class="token operator">=</span> self<span class="token punctuation">.</span>update_labels_error<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> centers<span class="token punctuation">)</span>
            centers <span class="token operator">=</span> self<span class="token punctuation">.</span>update_centers<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> labels<span class="token punctuation">)</span>

            <span class="token keyword">if</span> bestError <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token operator">or</span> error <span class="token operator">&lt;</span> bestError<span class="token punctuation">:</span>
                bestLabels <span class="token operator">=</span> labels<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                bestCenters <span class="token operator">=</span> centers<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>
                bestError <span class="token operator">=</span> error

            <span class="token comment">## oldCenters和centers的偏移量</span>
            centerShiftTotal <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>oldCenters <span class="token operator">-</span> centers<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span>
            <span class="token keyword">if</span> centerShiftTotal <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>tol<span class="token punctuation">:</span>
                <span class="token keyword">break</span>

        <span class="token comment">#由于上面的循环，最后一步更新了centers，所以如果和旧的centers不一样的话，再更新一次labels，error</span>
        <span class="token keyword">if</span> centerShiftTotal <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            bestLabels<span class="token punctuation">,</span> bestError <span class="token operator">=</span> self<span class="token punctuation">.</span>update_labels_error<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> bestCenters<span class="token punctuation">)</span>

        <span class="token keyword">return</span> bestLabels<span class="token punctuation">,</span> bestCenters<span class="token punctuation">,</span> bestError


    <span class="token comment"># k个数据点，随机生成</span>
    <span class="token keyword">def</span> <span class="token function">_init_centroids</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
        n_samples <span class="token operator">=</span> dataset<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        centers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>init <span class="token operator">==</span> <span class="token string">"random"</span><span class="token punctuation">:</span>
            seeds <span class="token operator">=</span> self<span class="token punctuation">.</span>random_state<span class="token punctuation">.</span>permutation<span class="token punctuation">(</span>n_samples<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>k<span class="token punctuation">]</span>
            centers <span class="token operator">=</span> dataset<span class="token punctuation">[</span>seeds<span class="token punctuation">]</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>init <span class="token operator">==</span> <span class="token string">"k-means++"</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>centers<span class="token punctuation">)</span>


    <span class="token comment"># 把tol和dataset相关联</span>
    <span class="token keyword">def</span> <span class="token function">_tolerance</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> tol<span class="token punctuation">)</span><span class="token punctuation">:</span>
        variances <span class="token operator">=</span> np<span class="token punctuation">.</span>var<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>variances<span class="token punctuation">)</span> <span class="token operator">*</span> tol


    <span class="token comment"># 更新每个点的标签，和计算误差</span>
    <span class="token keyword">def</span> <span class="token function">update_labels_error</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> centers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        labels <span class="token operator">=</span> self<span class="token punctuation">.</span>assign_points<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> centers<span class="token punctuation">)</span>
        new_means <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>
        error <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> assignment<span class="token punctuation">,</span> point <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>labels<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
            new_means<span class="token punctuation">[</span>assignment<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>point<span class="token punctuation">)</span>

        <span class="token keyword">for</span> points <span class="token keyword">in</span> new_means<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            newCenter <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>points<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            error <span class="token operator">+=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>points <span class="token operator">-</span> newCenter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> labels<span class="token punctuation">,</span> error

    <span class="token comment"># 更新中心点</span>
    <span class="token keyword">def</span> <span class="token function">update_centers</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> labels<span class="token punctuation">)</span><span class="token punctuation">:</span>
        new_means <span class="token operator">=</span> defaultdict<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">)</span>
        centers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> assignment<span class="token punctuation">,</span> point <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>labels<span class="token punctuation">,</span> dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
            new_means<span class="token punctuation">[</span>assignment<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>point<span class="token punctuation">)</span>

        <span class="token keyword">for</span> points <span class="token keyword">in</span> new_means<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            newCenter <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>points<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
            centers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>newCenter<span class="token punctuation">)</span>

        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>centers<span class="token punctuation">)</span>


    <span class="token comment"># 分配每个点到最近的center</span>
    <span class="token keyword">def</span> <span class="token function">assign_points</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dataset<span class="token punctuation">,</span> centers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        labels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> point <span class="token keyword">in</span> dataset<span class="token punctuation">:</span>
            shortest <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">"inf"</span><span class="token punctuation">)</span>  <span class="token comment"># 正无穷</span>
            shortest_index <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>centers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                val <span class="token operator">=</span> distance<span class="token punctuation">(</span>point<span class="token punctuation">[</span>np<span class="token punctuation">.</span>newaxis<span class="token punctuation">]</span><span class="token punctuation">,</span> centers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> val <span class="token operator">&lt;</span> shortest<span class="token punctuation">:</span>
                    shortest <span class="token operator">=</span> val
                    shortest_index <span class="token operator">=</span> i
            labels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>shortest_index<span class="token punctuation">)</span>
        <span class="token keyword">return</span> labels
</code></pre> 
  <h1><a id="Python_278"></a>有趣的事，Python永远不会缺席</h1> 
  <p><strong>欢迎关注小婷儿的博客</strong><br><br> &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.cnblogs.com/xxtalhr/" rel="nofollow" data-token="c7c749ad88ecfabd3fb0eb24c71b6301">https://www.cnblogs.com/xxtalhr/</a><br><br> <strong>博客园</strong> <a href="https://www.cnblogs.com/xxtalhr/" rel="nofollow" data-token="c7c749ad88ecfabd3fb0eb24c71b6301">https://www.cnblogs.com/xxtalhr/</a><br><br> <strong>CSDN</strong> <a href="https://blog.csdn.net/u010986753" rel="nofollow" data-token="5367eccd45e89274bddeef6f67dbb1a9">https://blog.csdn.net/u010986753</a><br></p> 
  <p><strong>有问题请在博客下留言或加作者：</strong><br> &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群<br> &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025<br> &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429</p> 
  <center>
   <img src="https://img2018.cnblogs.com/blog/1400528/201905/1400528-20190519213410020-442219723.png"> 
  </center>
  <h1><a id="strongstrongbr_292"></a><strong>培训说明</strong><br></h1> 
  <p><strong>OCP培训说明连接</strong> <a href="https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA" rel="nofollow" data-token="1e7bceb90586e4c246da7aae373de7b9">https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA</a><br><br> <strong>OCM培训说明连接</strong> <a href="https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA" rel="nofollow" data-token="d624ea2270c997f7b2449ba0393cb1ca">https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA</a><br></p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://blog.csdn.net/u010986753" rel="nofollow" data-token="5367eccd45e89274bddeef6f67dbb1a9">小婷儿的python</a>正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
