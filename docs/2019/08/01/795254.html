<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>网格搜索 GridSearchCV\训练集、验证集和测试集 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="网格搜索 GridSearchCV\训练集、验证集和测试集" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="文章目录 一、GridSearchCV简介 1.1 参数解释 1.2 简单的网格搜索 iris_svc 二、优化 2.1 训练集、验证集和测试集 2.2 Grid Search with Cross Validation 三、GridSearchCV 3.1 GridSearchCV 代码 3.2 总结 有趣的事，Python永远不会缺席 培训说明 一、GridSearchCV简介   GridSearchCV，它存在的意义就是自动调参，只要把参数输进去，就能给出最优化的结果和参数。但是这个方法适合于小数据集，一旦数据的量级上去了，很难得出结果。这个时候就是需要动脑筋了。数据量比较大的时候可以使用一个快速调优的方法——坐标下降。它其实是一种贪心算法：拿当前对模型影响最大的参数调优，直到最优化；再拿下一个影响最大的参数调优，如此下去，直到所有的参数调整完毕。这个方法的缺点就是可能会调到局部最优而不是全局最优，但是省时间省力，巨大的优势面前，还是试一试吧，后续可以再拿bagging再优化。   通常算法不够好，需要调试参数时必不可少。比如SVM的惩罚因子C，核函数kernel，gamma参数等，对于不同的数据使用不同的参数，结果效果可能差1-5个点，sklearn为我们提供专门调试参数的函数grid_search。   Grid Search：一种调优方法，在参数列表中进行穷举搜索，对每种情况进行训练，找到最优的参数；由此可知，这种方法的主要缺点是 比较耗时！ 1.1 参数解释 from sklearn.model_selection import GridSearchCV GridSearchCV( estimator, param_grid, scoring=None, fit_params=None, n_jobs=1, iid=True, refit=True, cv=None, verbose=0, pre_dispatch=&#39;2*n_jobs&#39;, error_score=&#39;raise&#39;, return_train_score=&#39;warn&#39;) Parameters： estimator：所使用的分类器，或者pipeline param_grid：值为字典或者列表，即需要最优化的参数的取值 scoring：准确度评价标准，默认None,这时需要使用score函数；或者如scoring=‘roc_auc’，根据所选模型不同，评价准则不同。字符串（函数名），或是可调用对象，需要其函数签名形如：scorer(estimator, X, y)；如果是None，则使用estimator的误差估计函数。返回给定测试集合的平均准确率（mean accuracy），浮点型数值。 n_jobs：并行数，int：个数,-1：跟CPU核数一致, 1:默认值。 pre_dispatch：指定总共分发的并行任务数。当n_jobs大于1时，数据将在每个运行点进行复制，这可能导致OOM，而设置pre_dispatch参数，则可以预先划分总共的job数量，使数据最多被复制pre_dispatch次 iid：默认True,为True时，默认为各个样本fold概率分布一致，误差估计为所有样本之和，而非各个fold的平均。 cv：交叉验证参数，默认None，使用三折交叉验证。指定fold数量，默认为3，也可以是yield训练/测试数据的生成器。 refit：默认为True,程序将会以交叉验证训练集得到的最佳参数，重新对所有可用的训练集与开发集进行，作为最终用于性能评估的最佳模型参数。即在搜索参数结束后，用最佳参数结果再次fit一遍全部数据集。 verbose：日志冗长度，int：冗长度，0：不输出训练过程，1：偶尔输出，&gt;1：对每个子模型都输出。 Attributes： best_estimator_：效果最好的分类器 best_score_：成员提供优化过程期间观察到的最好的评分 best_params_：描述了已取得最佳结果的参数的组合 best_index_：对应于最佳候选参数设置的索引(cv_results_数组的索引)。 Methods： decision_function:使用找到的参数最好的分类器调用decision_function。 **fit(X, y=None, groups=None, fit_params):训练 get_params(deep=True):获取这个估计器的参数。 predict(X):用找到的最佳参数调用预估器。(直接预测每个样本属于哪一个类别) predict_log_proda(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分取log情况） predict_proba(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分情况） score(X, y=None)：返回给定数据上的得分，如果预估器已经选出最优的分类器。 transform(X):调用最优分类器进行对X的转换。 1.2 简单的网格搜索 iris_svc from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split iris = load_iris() X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=0)#默认size=0.25 print(&quot;Size of training set:{} size of testing set:{}&quot;.format(X_train.shape[0],X_test.shape[0])) # Size of training set:112 size of testing set:38 # grid search start best_score = 0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C)#对于每种参数可能的组合，进行一次训练； svm.fit(X_train,y_train) score = svm.score(X_test,y_test) if score &gt; best_score:#找到表现最好的参数 best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} #### grid search end print(&quot;Best score:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) &#39;&#39;&#39; Best score:0.97 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 100} &#39;&#39;&#39; 存在的问题：   原始数据集划分成训练集和测试集以后，其中测试集除了用作调整参数，也用来测量模型的好坏；这样做导致最终的评分结果比实际效果要好。（因为测试集在调参过程中，送到了模型里，而我们的目的是将训练模型应用在unseen data上）； 二、优化   对训练集再进行一次划分，分成训练集和验证集，这样划分的结果就是：原始数据划分为3份，分别为：训练集、验证集和测试集；其中训练集用来模型训练，验证集用来调整参数，而测试集用来衡量模型表现好坏。 2.1 训练集、验证集和测试集 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) svm.fit(X_train,y_train) score = svm.score(X_val,y_val) if score &gt; best_score: best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} svm = SVC(**best_parameters) #使用最佳参数，构建新的模型 svm.fit(X_trainval,y_trainval) #使用训练集和验证集进行训练，more data always results in good performance. test_score = svm.score(X_test,y_test) # evaluation模型评估 print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Best score on test set:{:.2f}&quot;.format(test_score)) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： &#39;&#39;&#39; Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.96 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 10} Best score on test set:0.92 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 &#39;&#39;&#39; 2.2 Grid Search with Cross Validation   然而，这种间的的grid search方法，其最终的表现好坏与初始数据的划分结果有很大的关系，为了处理这种情况，我们采用交叉验证的方式来减少偶然性。 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 三、GridSearchCV   交叉验证经常与网格搜索进行结合，作为参数评价的一种方法，这种方法叫做grid search with cross validation。sklearn因此设计了一个这样的类GridSearchCV，这个类实现了fit，predict，score等方法，被当做了一个estimator，使用fit方法，该过程中：（1）搜索到最佳参数；（2）实例化了一个最佳参数的estimator； 3.1 GridSearchCV 代码 from sklearn.model_selection import GridSearchCV from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) #把要调整的参数以及其候选值 列出来； param_grid = {&quot;gamma&quot;:[0.001,0.01,0.1,1,10,100], &quot;C&quot;:[0.001,0.01,0.1,1,10,100]} print(&quot;Parameters:{}&quot;.format(param_grid)) grid_search = GridSearchCV(SVC(),param_grid,cv=5) #实例化一个GridSearchCV类 X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=10) grid_search.fit(X_train,y_train) #训练，找到最优的参数，同时使用最优的参数实例化一个新的SVC estimator。 print(&quot;Test set score:{:.2f}&quot;.format(grid_search.score(X_test,y_test))) print(&quot;Best parameters:{}&quot;.format(grid_search.best_params_)) print(&quot;Best score on train set:{:.2f}&quot;.format(grid_search.best_score_)) &#39;&#39;&#39;运行结果 Size of training set:84 size of validation set:28 size of teseting set:38 Parameters:{&#39;gamma&#39;: [0.001, 0.01, 0.1, 1, 10, 100], &#39;C&#39;: [0.001, 0.01, 0.1, 1, 10, 100]} Test set score:0.97 Best parameters:{&#39;C&#39;: 10, &#39;gamma&#39;: 0.1} Best score on train set:0.98 &#39;&#39;&#39; 3.2 总结 选择并构建训练模型model 将训练模型model投入到GridSearchCV中，得到GridSearchCV模型grid_model 用grid_model拟合训练集数据，选择在validation_dataset上效果最好的参数的模型best_estimator best_estimator 用best_estimator拟合训练集（得到的结果应该与之前不同，因为之前用交叉验证等方法对训练集进行了分割） 用best_estimator拟合测试集 结果可视化：AUC曲线，AUPR曲线 注：Grid Search 调参方法存在的共性弊端就是：耗时；参数越多，候选值越多，耗费时间越长！所以，一般情况下，先定一个大范围，然后再细化。 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。" />
<meta property="og:description" content="文章目录 一、GridSearchCV简介 1.1 参数解释 1.2 简单的网格搜索 iris_svc 二、优化 2.1 训练集、验证集和测试集 2.2 Grid Search with Cross Validation 三、GridSearchCV 3.1 GridSearchCV 代码 3.2 总结 有趣的事，Python永远不会缺席 培训说明 一、GridSearchCV简介   GridSearchCV，它存在的意义就是自动调参，只要把参数输进去，就能给出最优化的结果和参数。但是这个方法适合于小数据集，一旦数据的量级上去了，很难得出结果。这个时候就是需要动脑筋了。数据量比较大的时候可以使用一个快速调优的方法——坐标下降。它其实是一种贪心算法：拿当前对模型影响最大的参数调优，直到最优化；再拿下一个影响最大的参数调优，如此下去，直到所有的参数调整完毕。这个方法的缺点就是可能会调到局部最优而不是全局最优，但是省时间省力，巨大的优势面前，还是试一试吧，后续可以再拿bagging再优化。   通常算法不够好，需要调试参数时必不可少。比如SVM的惩罚因子C，核函数kernel，gamma参数等，对于不同的数据使用不同的参数，结果效果可能差1-5个点，sklearn为我们提供专门调试参数的函数grid_search。   Grid Search：一种调优方法，在参数列表中进行穷举搜索，对每种情况进行训练，找到最优的参数；由此可知，这种方法的主要缺点是 比较耗时！ 1.1 参数解释 from sklearn.model_selection import GridSearchCV GridSearchCV( estimator, param_grid, scoring=None, fit_params=None, n_jobs=1, iid=True, refit=True, cv=None, verbose=0, pre_dispatch=&#39;2*n_jobs&#39;, error_score=&#39;raise&#39;, return_train_score=&#39;warn&#39;) Parameters： estimator：所使用的分类器，或者pipeline param_grid：值为字典或者列表，即需要最优化的参数的取值 scoring：准确度评价标准，默认None,这时需要使用score函数；或者如scoring=‘roc_auc’，根据所选模型不同，评价准则不同。字符串（函数名），或是可调用对象，需要其函数签名形如：scorer(estimator, X, y)；如果是None，则使用estimator的误差估计函数。返回给定测试集合的平均准确率（mean accuracy），浮点型数值。 n_jobs：并行数，int：个数,-1：跟CPU核数一致, 1:默认值。 pre_dispatch：指定总共分发的并行任务数。当n_jobs大于1时，数据将在每个运行点进行复制，这可能导致OOM，而设置pre_dispatch参数，则可以预先划分总共的job数量，使数据最多被复制pre_dispatch次 iid：默认True,为True时，默认为各个样本fold概率分布一致，误差估计为所有样本之和，而非各个fold的平均。 cv：交叉验证参数，默认None，使用三折交叉验证。指定fold数量，默认为3，也可以是yield训练/测试数据的生成器。 refit：默认为True,程序将会以交叉验证训练集得到的最佳参数，重新对所有可用的训练集与开发集进行，作为最终用于性能评估的最佳模型参数。即在搜索参数结束后，用最佳参数结果再次fit一遍全部数据集。 verbose：日志冗长度，int：冗长度，0：不输出训练过程，1：偶尔输出，&gt;1：对每个子模型都输出。 Attributes： best_estimator_：效果最好的分类器 best_score_：成员提供优化过程期间观察到的最好的评分 best_params_：描述了已取得最佳结果的参数的组合 best_index_：对应于最佳候选参数设置的索引(cv_results_数组的索引)。 Methods： decision_function:使用找到的参数最好的分类器调用decision_function。 **fit(X, y=None, groups=None, fit_params):训练 get_params(deep=True):获取这个估计器的参数。 predict(X):用找到的最佳参数调用预估器。(直接预测每个样本属于哪一个类别) predict_log_proda(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分取log情况） predict_proba(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分情况） score(X, y=None)：返回给定数据上的得分，如果预估器已经选出最优的分类器。 transform(X):调用最优分类器进行对X的转换。 1.2 简单的网格搜索 iris_svc from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split iris = load_iris() X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=0)#默认size=0.25 print(&quot;Size of training set:{} size of testing set:{}&quot;.format(X_train.shape[0],X_test.shape[0])) # Size of training set:112 size of testing set:38 # grid search start best_score = 0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C)#对于每种参数可能的组合，进行一次训练； svm.fit(X_train,y_train) score = svm.score(X_test,y_test) if score &gt; best_score:#找到表现最好的参数 best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} #### grid search end print(&quot;Best score:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) &#39;&#39;&#39; Best score:0.97 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 100} &#39;&#39;&#39; 存在的问题：   原始数据集划分成训练集和测试集以后，其中测试集除了用作调整参数，也用来测量模型的好坏；这样做导致最终的评分结果比实际效果要好。（因为测试集在调参过程中，送到了模型里，而我们的目的是将训练模型应用在unseen data上）； 二、优化   对训练集再进行一次划分，分成训练集和验证集，这样划分的结果就是：原始数据划分为3份，分别为：训练集、验证集和测试集；其中训练集用来模型训练，验证集用来调整参数，而测试集用来衡量模型表现好坏。 2.1 训练集、验证集和测试集 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) svm.fit(X_train,y_train) score = svm.score(X_val,y_val) if score &gt; best_score: best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} svm = SVC(**best_parameters) #使用最佳参数，构建新的模型 svm.fit(X_trainval,y_trainval) #使用训练集和验证集进行训练，more data always results in good performance. test_score = svm.score(X_test,y_test) # evaluation模型评估 print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Best score on test set:{:.2f}&quot;.format(test_score)) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： &#39;&#39;&#39; Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.96 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 10} Best score on test set:0.92 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 &#39;&#39;&#39; 2.2 Grid Search with Cross Validation   然而，这种间的的grid search方法，其最终的表现好坏与初始数据的划分结果有很大的关系，为了处理这种情况，我们采用交叉验证的方式来减少偶然性。 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 三、GridSearchCV   交叉验证经常与网格搜索进行结合，作为参数评价的一种方法，这种方法叫做grid search with cross validation。sklearn因此设计了一个这样的类GridSearchCV，这个类实现了fit，predict，score等方法，被当做了一个estimator，使用fit方法，该过程中：（1）搜索到最佳参数；（2）实例化了一个最佳参数的estimator； 3.1 GridSearchCV 代码 from sklearn.model_selection import GridSearchCV from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) #把要调整的参数以及其候选值 列出来； param_grid = {&quot;gamma&quot;:[0.001,0.01,0.1,1,10,100], &quot;C&quot;:[0.001,0.01,0.1,1,10,100]} print(&quot;Parameters:{}&quot;.format(param_grid)) grid_search = GridSearchCV(SVC(),param_grid,cv=5) #实例化一个GridSearchCV类 X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=10) grid_search.fit(X_train,y_train) #训练，找到最优的参数，同时使用最优的参数实例化一个新的SVC estimator。 print(&quot;Test set score:{:.2f}&quot;.format(grid_search.score(X_test,y_test))) print(&quot;Best parameters:{}&quot;.format(grid_search.best_params_)) print(&quot;Best score on train set:{:.2f}&quot;.format(grid_search.best_score_)) &#39;&#39;&#39;运行结果 Size of training set:84 size of validation set:28 size of teseting set:38 Parameters:{&#39;gamma&#39;: [0.001, 0.01, 0.1, 1, 10, 100], &#39;C&#39;: [0.001, 0.01, 0.1, 1, 10, 100]} Test set score:0.97 Best parameters:{&#39;C&#39;: 10, &#39;gamma&#39;: 0.1} Best score on train set:0.98 &#39;&#39;&#39; 3.2 总结 选择并构建训练模型model 将训练模型model投入到GridSearchCV中，得到GridSearchCV模型grid_model 用grid_model拟合训练集数据，选择在validation_dataset上效果最好的参数的模型best_estimator best_estimator 用best_estimator拟合训练集（得到的结果应该与之前不同，因为之前用交叉验证等方法对训练集进行了分割） 用best_estimator拟合测试集 结果可视化：AUC曲线，AUPR曲线 注：Grid Search 调参方法存在的共性弊端就是：耗时；参数越多，候选值越多，耗费时间越长！所以，一般情况下，先定一个大范围，然后再细化。 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。" />
<link rel="canonical" href="https://uzzz.org/2019/08/01/795254.html" />
<meta property="og:url" content="https://uzzz.org/2019/08/01/795254.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-01T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"文章目录 一、GridSearchCV简介 1.1 参数解释 1.2 简单的网格搜索 iris_svc 二、优化 2.1 训练集、验证集和测试集 2.2 Grid Search with Cross Validation 三、GridSearchCV 3.1 GridSearchCV 代码 3.2 总结 有趣的事，Python永远不会缺席 培训说明 一、GridSearchCV简介   GridSearchCV，它存在的意义就是自动调参，只要把参数输进去，就能给出最优化的结果和参数。但是这个方法适合于小数据集，一旦数据的量级上去了，很难得出结果。这个时候就是需要动脑筋了。数据量比较大的时候可以使用一个快速调优的方法——坐标下降。它其实是一种贪心算法：拿当前对模型影响最大的参数调优，直到最优化；再拿下一个影响最大的参数调优，如此下去，直到所有的参数调整完毕。这个方法的缺点就是可能会调到局部最优而不是全局最优，但是省时间省力，巨大的优势面前，还是试一试吧，后续可以再拿bagging再优化。   通常算法不够好，需要调试参数时必不可少。比如SVM的惩罚因子C，核函数kernel，gamma参数等，对于不同的数据使用不同的参数，结果效果可能差1-5个点，sklearn为我们提供专门调试参数的函数grid_search。   Grid Search：一种调优方法，在参数列表中进行穷举搜索，对每种情况进行训练，找到最优的参数；由此可知，这种方法的主要缺点是 比较耗时！ 1.1 参数解释 from sklearn.model_selection import GridSearchCV GridSearchCV( estimator, param_grid, scoring=None, fit_params=None, n_jobs=1, iid=True, refit=True, cv=None, verbose=0, pre_dispatch=&#39;2*n_jobs&#39;, error_score=&#39;raise&#39;, return_train_score=&#39;warn&#39;) Parameters： estimator：所使用的分类器，或者pipeline param_grid：值为字典或者列表，即需要最优化的参数的取值 scoring：准确度评价标准，默认None,这时需要使用score函数；或者如scoring=‘roc_auc’，根据所选模型不同，评价准则不同。字符串（函数名），或是可调用对象，需要其函数签名形如：scorer(estimator, X, y)；如果是None，则使用estimator的误差估计函数。返回给定测试集合的平均准确率（mean accuracy），浮点型数值。 n_jobs：并行数，int：个数,-1：跟CPU核数一致, 1:默认值。 pre_dispatch：指定总共分发的并行任务数。当n_jobs大于1时，数据将在每个运行点进行复制，这可能导致OOM，而设置pre_dispatch参数，则可以预先划分总共的job数量，使数据最多被复制pre_dispatch次 iid：默认True,为True时，默认为各个样本fold概率分布一致，误差估计为所有样本之和，而非各个fold的平均。 cv：交叉验证参数，默认None，使用三折交叉验证。指定fold数量，默认为3，也可以是yield训练/测试数据的生成器。 refit：默认为True,程序将会以交叉验证训练集得到的最佳参数，重新对所有可用的训练集与开发集进行，作为最终用于性能评估的最佳模型参数。即在搜索参数结束后，用最佳参数结果再次fit一遍全部数据集。 verbose：日志冗长度，int：冗长度，0：不输出训练过程，1：偶尔输出，&gt;1：对每个子模型都输出。 Attributes： best_estimator_：效果最好的分类器 best_score_：成员提供优化过程期间观察到的最好的评分 best_params_：描述了已取得最佳结果的参数的组合 best_index_：对应于最佳候选参数设置的索引(cv_results_数组的索引)。 Methods： decision_function:使用找到的参数最好的分类器调用decision_function。 **fit(X, y=None, groups=None, fit_params):训练 get_params(deep=True):获取这个估计器的参数。 predict(X):用找到的最佳参数调用预估器。(直接预测每个样本属于哪一个类别) predict_log_proda(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分取log情况） predict_proba(X):用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分情况） score(X, y=None)：返回给定数据上的得分，如果预估器已经选出最优的分类器。 transform(X):调用最优分类器进行对X的转换。 1.2 简单的网格搜索 iris_svc from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split iris = load_iris() X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=0)#默认size=0.25 print(&quot;Size of training set:{} size of testing set:{}&quot;.format(X_train.shape[0],X_test.shape[0])) # Size of training set:112 size of testing set:38 # grid search start best_score = 0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C)#对于每种参数可能的组合，进行一次训练； svm.fit(X_train,y_train) score = svm.score(X_test,y_test) if score &gt; best_score:#找到表现最好的参数 best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} #### grid search end print(&quot;Best score:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) &#39;&#39;&#39; Best score:0.97 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 100} &#39;&#39;&#39; 存在的问题：   原始数据集划分成训练集和测试集以后，其中测试集除了用作调整参数，也用来测量模型的好坏；这样做导致最终的评分结果比实际效果要好。（因为测试集在调参过程中，送到了模型里，而我们的目的是将训练模型应用在unseen data上）； 二、优化   对训练集再进行一次划分，分成训练集和验证集，这样划分的结果就是：原始数据划分为3份，分别为：训练集、验证集和测试集；其中训练集用来模型训练，验证集用来调整参数，而测试集用来衡量模型表现好坏。 2.1 训练集、验证集和测试集 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) svm.fit(X_train,y_train) score = svm.score(X_val,y_val) if score &gt; best_score: best_score = score best_parameters = {&#39;gamma&#39;:gamma,&#39;C&#39;:C} svm = SVC(**best_parameters) #使用最佳参数，构建新的模型 svm.fit(X_trainval,y_trainval) #使用训练集和验证集进行训练，more data always results in good performance. test_score = svm.score(X_test,y_test) # evaluation模型评估 print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Best score on test set:{:.2f}&quot;.format(test_score)) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： &#39;&#39;&#39; Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.96 Best parameters:{&#39;gamma&#39;: 0.001, &#39;C&#39;: 10} Best score on test set:0.92 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 &#39;&#39;&#39; 2.2 Grid Search with Cross Validation   然而，这种间的的grid search方法，其最终的表现好坏与初始数据的划分结果有很大的关系，为了处理这种情况，我们采用交叉验证的方式来减少偶然性。 from sklearn.model_selection import cross_val_score from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) best_score = 0.0 for gamma in [0.001,0.01,0.1,1,10,100]: for C in [0.001,0.01,0.1,1,10,100]: svm = SVC(gamma=gamma,C=C) scores = cross_val_score(svm,X_trainval,y_trainval,cv=5) #5折交叉验证 score = scores.mean() #取平均数 if score &gt; best_score: best_score = score best_parameters = {&quot;gamma&quot;:gamma,&quot;C&quot;:C} svm = SVC(**best_parameters) svm.fit(X_trainval,y_trainval) test_score = svm.score(X_test,y_test) print(&quot;Best score on validation set:{:.2f}&quot;.format(best_score)) print(&quot;Best parameters:{}&quot;.format(best_parameters)) print(&quot;Score on testing set:{:.2f}&quot;.format(test_score)) 运行结果： Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.97 Best parameters:{&#39;gamma&#39;: 0.01, &#39;C&#39;: 100} Score on testing set:0.97 三、GridSearchCV   交叉验证经常与网格搜索进行结合，作为参数评价的一种方法，这种方法叫做grid search with cross validation。sklearn因此设计了一个这样的类GridSearchCV，这个类实现了fit，predict，score等方法，被当做了一个estimator，使用fit方法，该过程中：（1）搜索到最佳参数；（2）实例化了一个最佳参数的estimator； 3.1 GridSearchCV 代码 from sklearn.model_selection import GridSearchCV from sklearn.datasets import load_iris from sklearn.svm import SVC from sklearn.model_selection import train_test_split # https://www.cnblogs.com/ysugyl/p/8711205.html iris = load_iris() X_trainval,X_test,y_trainval,y_test = train_test_split(iris.data,iris.target,random_state=0) X_train,X_val,y_train,y_val = train_test_split(X_trainval,y_trainval,random_state=1) print(&quot;Size of training set:{} size of validation set:{} size of teseting set:{}&quot;.format(X_train.shape[0],X_val.shape[0],X_test.shape[0])) #把要调整的参数以及其候选值 列出来； param_grid = {&quot;gamma&quot;:[0.001,0.01,0.1,1,10,100], &quot;C&quot;:[0.001,0.01,0.1,1,10,100]} print(&quot;Parameters:{}&quot;.format(param_grid)) grid_search = GridSearchCV(SVC(),param_grid,cv=5) #实例化一个GridSearchCV类 X_train,X_test,y_train,y_test = train_test_split(iris.data,iris.target,random_state=10) grid_search.fit(X_train,y_train) #训练，找到最优的参数，同时使用最优的参数实例化一个新的SVC estimator。 print(&quot;Test set score:{:.2f}&quot;.format(grid_search.score(X_test,y_test))) print(&quot;Best parameters:{}&quot;.format(grid_search.best_params_)) print(&quot;Best score on train set:{:.2f}&quot;.format(grid_search.best_score_)) &#39;&#39;&#39;运行结果 Size of training set:84 size of validation set:28 size of teseting set:38 Parameters:{&#39;gamma&#39;: [0.001, 0.01, 0.1, 1, 10, 100], &#39;C&#39;: [0.001, 0.01, 0.1, 1, 10, 100]} Test set score:0.97 Best parameters:{&#39;C&#39;: 10, &#39;gamma&#39;: 0.1} Best score on train set:0.98 &#39;&#39;&#39; 3.2 总结 选择并构建训练模型model 将训练模型model投入到GridSearchCV中，得到GridSearchCV模型grid_model 用grid_model拟合训练集数据，选择在validation_dataset上效果最好的参数的模型best_estimator best_estimator 用best_estimator拟合训练集（得到的结果应该与之前不同，因为之前用交叉验证等方法对训练集进行了分割） 用best_estimator拟合测试集 结果可视化：AUC曲线，AUPR曲线 注：Grid Search 调参方法存在的共性弊端就是：耗时；参数越多，候选值越多，耗费时间越长！所以，一般情况下，先定一个大范围，然后再细化。 有趣的事，Python永远不会缺席 欢迎关注小婷儿的博客 &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解 &nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;https://www.cnblogs.com/xxtalhr/ 博客园 https://www.cnblogs.com/xxtalhr/ CSDN https://blog.csdn.net/u010986753 有问题请在博客下留言或加作者： &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群 &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025 &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429 培训说明 OCP培训说明连接 https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA OCM培训说明连接 https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA &nbsp;&nbsp;&nbsp;&nbsp; 小婷儿的python正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。","@type":"BlogPosting","url":"https://uzzz.org/2019/08/01/795254.html","headline":"网格搜索 GridSearchCV\\训练集、验证集和测试集","dateModified":"2019-08-01T00:00:00+08:00","datePublished":"2019-08-01T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/08/01/795254.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>网格搜索 GridSearchCV\训练集、验证集和测试集</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix">  
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-dark"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p></p>
  <div class="toc">
   <h3>文章目录</h3>
   <ul>
    <li><a href="#GridSearchCV_1" rel="nofollow" data-token="596cc0c94e084befffb157199b353e62">一、GridSearchCV简介</a></li>
    <ul>
     <li><a href="#11__5" rel="nofollow" data-token="876ffcf4be90b682cd58f209c11c721d">1.1 参数解释</a></li>
     <li><a href="#12__iris_svc_56" rel="nofollow" data-token="e2969b19b44ee4f7997939fe6aa9a643">1.2 简单的网格搜索 iris_svc</a></li>
    </ul>
    <li><a href="#_89" rel="nofollow" data-token="4e58d5afe8d9cc0dbdb182441d03539c">二、优化</a></li>
    <ul>
     <li><a href="#21__92" rel="nofollow" data-token="5a3c7d68084d7579162b3a715ffe6ad1">2.1 训练集、验证集和测试集</a></li>
     <li><a href="#22_Grid_Search_with_Cross_Validation_151" rel="nofollow" data-token="fe2f794d7be39474e26b515d24cc9739">2.2 Grid Search with Cross Validation</a></li>
    </ul>
    <li><a href="#GridSearchCV_190" rel="nofollow" data-token="7186bb2e70b8cdb2491a1cf309bc1ca3">三、GridSearchCV</a></li>
    <ul>
     <li><a href="#31_GridSearchCV__192" rel="nofollow" data-token="9f3788c5244d4af7aa171b657889c8ae">3.1 GridSearchCV 代码</a></li>
     <li><a href="#32__226" rel="nofollow" data-token="9c0fd7c8cfd138b8dc6c0b6923db62fe">3.2 总结</a></li>
    </ul>
    <li><a href="#Python_242" rel="nofollow" data-token="ffbf5727bbbd7d466d72ac965d1b0ece">有趣的事，Python永远不会缺席</a></li>
    <li><a href="#strongstrongbr_256" rel="nofollow" data-token="db7a064a7c70559de498716c4001dde3"><strong>培训说明</strong><br></a></li>
   </ul>
  </div>
  <p></p> 
  <h1><a id="GridSearchCV_1"></a>一、GridSearchCV简介</h1> 
  <p>  GridSearchCV，它存在的意义就是<strong>自动调参</strong>，只要把参数输进去，就能给出最优化的结果和参数。但是这个方法<strong>适合于小数据集</strong>，一旦数据的量级上去了，很难得出结果。这个时候就是需要动脑筋了。<strong>数据量比较大</strong>的时候可以使用一个<strong>快速调优的方法——坐标下降</strong>。它其实是一种贪心算法：拿当前对模型影响最大的参数调优，直到最优化；再拿下一个影响最大的参数调优，如此下去，直到所有的参数调整完毕。这个方法的缺点就是可能会调到局部最优而不是全局最优，但是省时间省力，巨大的优势面前，还是试一试吧，后续可以再拿bagging再优化。<br>   通常算法不够好，需要调试参数时必不可少。比如SVM的惩罚因子C，核函数kernel，gamma参数等，对于不同的数据使用不同的参数，结果效果可能差1-5个点，sklearn为我们提供专门调试参数的函数grid_search。<br>   Grid Search：一种调优方法，在参数列表中进行<strong>穷举搜索</strong>，对每种情况进行训练，找到最优的参数；由此可知，这种方法的主要缺点是 <strong>比较耗时</strong>！</p> 
  <h2><a id="11__5"></a>1.1 参数解释</h2> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
GridSearchCV<span class="token punctuation">(</span>
    estimator<span class="token punctuation">,</span>
    param_grid<span class="token punctuation">,</span>
    scoring<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    fit_params<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    n_jobs<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
    iid<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    refit<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    cv<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    verbose<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
    pre_dispatch<span class="token operator">=</span><span class="token string">'2*n_jobs'</span><span class="token punctuation">,</span>
    error_score<span class="token operator">=</span><span class="token string">'raise'</span><span class="token punctuation">,</span>
    return_train_score<span class="token operator">=</span><span class="token string">'warn'</span><span class="token punctuation">)</span>
</code></pre> 
  <p><strong>Parameters：</strong></p> 
  <p><strong>estimator</strong>：所使用的分类器，或者pipeline<br> <strong>param_grid</strong>：值为字典或者列表，即需要最优化的参数的取值<br> <strong>scoring</strong>：准确度评价标准，默认None,这时需要使用score函数；或者如scoring=‘roc_auc’，根据所选模型不同，评价准则不同。字符串（函数名），或是可调用对象，需要其函数签名形如：scorer(estimator, X, y)；如果是None，则使用estimator的误差估计函数。<strong>返回给定测试集合的平均准确率（mean accuracy），浮点型数值。</strong><br> <strong>n_jobs</strong>：并行数，int：个数,-1：跟CPU核数一致, 1:默认值。<br> <strong>pre_dispatch</strong>：指定总共分发的并行任务数。当n_jobs大于1时，数据将在每个运行点进行复制，这可能导致OOM，而设置pre_dispatch参数，则可以预先划分总共的job数量，使数据最多被复制pre_dispatch次<br> <strong>iid</strong>：默认True,为True时，默认为各个样本fold概率分布一致，误差估计为所有样本之和，而非各个fold的平均。<br> <strong>cv</strong>：交叉验证参数，默认None，使用三折交叉验证。指定fold数量，默认为3，也可以是yield训练/测试数据的生成器。<br> <strong>refit</strong>：默认为True,程序将会以交叉验证训练集得到的最佳参数，重新对所有可用的训练集与开发集进行，作为最终用于性能评估的最佳模型参数。即在搜索参数结束后，用最佳参数结果再次fit一遍全部数据集。<br> <strong>verbose</strong>：日志冗长度，int：冗长度，0：不输出训练过程，1：偶尔输出，&gt;1：对每个子模型都输出。</p> 
  <p><strong>Attributes：</strong></p> 
  <p><strong>best_estimator_</strong>：效果最好的分类器</p> 
  <p><strong>best_score_</strong>：成员提供优化过程期间观察到的最好的评分</p> 
  <p><strong>best_params_</strong>：描述了已取得最佳结果的参数的组合</p> 
  <p><strong>best_index_</strong>：对应于最佳候选参数设置的索引(cv_results_数组的索引)。</p> 
  <p><strong>Methods：</strong></p> 
  <p><strong>decision_function</strong>:使用找到的参数最好的分类器调用decision_function。<br> **fit(X, y=None, groups=None, <strong>fit_params)</strong>:训练<br> <strong>get_params(deep=True)</strong>:获取这个估计器的参数。<br> <strong>predict(X)</strong>:用找到的最佳参数调用预估器。(直接预测每个样本属于哪一个类别)<br> <strong>predict_log_proda(X)</strong>:用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分取log情况）<br> <strong>predict_proba(X)</strong>:用找到的最佳参数调用预估器。（得到每个测试集样本在每一个类别的得分情况）<br> <strong>score(X, y=None)</strong>：返回给定数据上的得分，如果预估器已经选出最优的分类器。<br> <strong>transform(X)</strong>:调用最优分类器进行对X的转换。</p> 
  <h2><a id="12__iris_svc_56"></a>1.2 简单的网格搜索 iris_svc</h2> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split

iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">#默认size=0.25</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Size of training set:{} size of testing set:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># Size of training set:112 size of testing set:38</span>
<span class="token comment"># grid search start</span>
best_score <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> gamma <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> C <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span>gamma<span class="token punctuation">,</span>C<span class="token operator">=</span>C<span class="token punctuation">)</span><span class="token comment">#对于每种参数可能的组合，进行一次训练；</span>
        svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
        score <span class="token operator">=</span> svm<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
        <span class="token keyword">if</span> score <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span><span class="token comment">#找到表现最好的参数</span>
            best_score <span class="token operator">=</span> score
            best_parameters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'gamma'</span><span class="token punctuation">:</span>gamma<span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">:</span>C<span class="token punctuation">}</span>
<span class="token comment">#### grid search end</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_parameters<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">''' Best score:0.97 Best parameters:{'gamma': 0.001, 'C': 100} '''</span>
</code></pre> 
  <p><strong>存在的问题：</strong><br>   原始数据集划分成训练集和测试集以后，其中测试集除了用作调整参数，也用来测量模型的好坏；这样做导致最终的评分结果比实际效果要好。（因为测试集在调参过程中，送到了模型里，而我们的目的是将训练模型应用在unseen data上）；</p> 
  <h1><a id="_89"></a>二、优化</h1> 
  <p>  对训练集再进行一次划分，分成训练集和验证集，这样划分的结果就是：原始数据划分为3份，分别为：<strong>训练集、验证集和测试集</strong>；其中训练集用来模型训练，验证集用来调整参数，而测试集用来衡量模型表现好坏。</p> 
  <h2><a id="21__92"></a>2.1 训练集、验证集和测试集</h2> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment"># https://www.cnblogs.com/ysugyl/p/8711205.html</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_trainval<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span>X_val<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Size of training set:{} size of validation set:{} size of teseting set:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_val<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

best_score <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token keyword">for</span> gamma <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> C <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span>gamma<span class="token punctuation">,</span>C<span class="token operator">=</span>C<span class="token punctuation">)</span>
        svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span>
        score <span class="token operator">=</span> svm<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_val<span class="token punctuation">,</span>y_val<span class="token punctuation">)</span>
        <span class="token keyword">if</span> score <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
            best_score <span class="token operator">=</span> score
            best_parameters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'gamma'</span><span class="token punctuation">:</span>gamma<span class="token punctuation">,</span><span class="token string">'C'</span><span class="token punctuation">:</span>C<span class="token punctuation">}</span>
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span><span class="token operator">**</span>best_parameters<span class="token punctuation">)</span> <span class="token comment">#使用最佳参数，构建新的模型</span>
svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">)</span> <span class="token comment">#使用训练集和验证集进行训练，more data always results in good performance.</span>
test_score <span class="token operator">=</span> svm<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span> <span class="token comment"># evaluation模型评估</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score on validation set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_parameters<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score on test set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>test_score<span class="token punctuation">)</span><span class="token punctuation">)</span>

best_score <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token keyword">for</span> gamma <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> C <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span>gamma<span class="token punctuation">,</span>C<span class="token operator">=</span>C<span class="token punctuation">)</span>
        scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>svm<span class="token punctuation">,</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#5折交叉验证</span>
        score <span class="token operator">=</span> scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#取平均数</span>
        <span class="token keyword">if</span> score <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
            best_score <span class="token operator">=</span> score
            best_parameters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"gamma"</span><span class="token punctuation">:</span>gamma<span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">:</span>C<span class="token punctuation">}</span>
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span><span class="token operator">**</span>best_parameters<span class="token punctuation">)</span>
svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">)</span>
test_score <span class="token operator">=</span> svm<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score on validation set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_parameters<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Score on testing set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>test_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <p><strong>运行结果：</strong></p> 
  <pre><code class="prism language-python"><span class="token triple-quoted-string string">''' Size of training set:84 size of validation set:28 size of teseting set:38 Best score on validation set:0.96 Best parameters:{'gamma': 0.001, 'C': 10} Best score on test set:0.92 Best score on validation set:0.97 Best parameters:{'gamma': 0.01, 'C': 100} Score on testing set:0.97 '''</span>
</code></pre> 
  <h2><a id="22_Grid_Search_with_Cross_Validation_151"></a>2.2 Grid Search with Cross Validation</h2> 
  <p>  然而，这种间的的grid search方法，其最终的表现好坏与初始数据的划分结果有很大的关系，为了处理这种情况，我们采用交叉验证的方式来减少偶然性。</p> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> cross_val_score
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment"># https://www.cnblogs.com/ysugyl/p/8711205.html</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_trainval<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span>X_val<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Size of training set:{} size of validation set:{} size of teseting set:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_val<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

best_score <span class="token operator">=</span> <span class="token number">0.0</span>
<span class="token keyword">for</span> gamma <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> C <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span>gamma<span class="token operator">=</span>gamma<span class="token punctuation">,</span>C<span class="token operator">=</span>C<span class="token punctuation">)</span>
        scores <span class="token operator">=</span> cross_val_score<span class="token punctuation">(</span>svm<span class="token punctuation">,</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#5折交叉验证</span>
        score <span class="token operator">=</span> scores<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#取平均数</span>
        <span class="token keyword">if</span> score <span class="token operator">&gt;</span> best_score<span class="token punctuation">:</span>
            best_score <span class="token operator">=</span> score
            best_parameters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"gamma"</span><span class="token punctuation">:</span>gamma<span class="token punctuation">,</span><span class="token string">"C"</span><span class="token punctuation">:</span>C<span class="token punctuation">}</span>
svm <span class="token operator">=</span> SVC<span class="token punctuation">(</span><span class="token operator">**</span>best_parameters<span class="token punctuation">)</span>
svm<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">)</span>
test_score <span class="token operator">=</span> svm<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score on validation set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>best_parameters<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Score on testing set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>test_score<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
  <p><strong>运行结果：</strong></p> 
  <pre><code class="prism language-python">Size of training <span class="token builtin">set</span><span class="token punctuation">:</span><span class="token number">84</span> size of validation <span class="token builtin">set</span><span class="token punctuation">:</span><span class="token number">28</span> size of teseting <span class="token builtin">set</span><span class="token punctuation">:</span><span class="token number">38</span>
Best score on validation <span class="token builtin">set</span><span class="token punctuation">:</span><span class="token number">0.97</span>
Best parameters<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token string">'gamma'</span><span class="token punctuation">:</span> <span class="token number">0.01</span><span class="token punctuation">,</span> <span class="token string">'C'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>
Score on testing <span class="token builtin">set</span><span class="token punctuation">:</span><span class="token number">0.97</span>
</code></pre> 
  <h1><a id="GridSearchCV_190"></a>三、GridSearchCV</h1> 
  <p>  交叉验证经常与网格搜索进行结合，作为参数评价的一种方法，这种方法叫做grid search with cross validation。sklearn因此设计了一个这样的类GridSearchCV，这个类实现了fit，predict，score等方法，被当做了一个estimator，使用fit方法，该过程中：（1）搜索到最佳参数；（2）实例化了一个最佳参数的estimator；</p> 
  <h2><a id="31_GridSearchCV__192"></a>3.1 GridSearchCV 代码</h2> 
  <pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> GridSearchCV
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_iris
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>svm <span class="token keyword">import</span> SVC
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment"># https://www.cnblogs.com/ysugyl/p/8711205.html</span>
iris <span class="token operator">=</span> load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X_trainval<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
X_train<span class="token punctuation">,</span>X_val<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_val <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>X_trainval<span class="token punctuation">,</span>y_trainval<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Size of training set:{} size of validation set:{} size of teseting set:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>X_train<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_val<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>X_test<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#把要调整的参数以及其候选值 列出来；</span>
param_grid <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"gamma"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token string">"C"</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">0.001</span><span class="token punctuation">,</span><span class="token number">0.01</span><span class="token punctuation">,</span><span class="token number">0.1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>param_grid<span class="token punctuation">)</span><span class="token punctuation">)</span>

grid_search <span class="token operator">=</span> GridSearchCV<span class="token punctuation">(</span>SVC<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>param_grid<span class="token punctuation">,</span>cv<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">#实例化一个GridSearchCV类</span>
X_train<span class="token punctuation">,</span>X_test<span class="token punctuation">,</span>y_train<span class="token punctuation">,</span>y_test <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>iris<span class="token punctuation">.</span>data<span class="token punctuation">,</span>iris<span class="token punctuation">.</span>target<span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
grid_search<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">,</span>y_train<span class="token punctuation">)</span> <span class="token comment">#训练，找到最优的参数，同时使用最优的参数实例化一个新的SVC estimator。</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Test set score:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>score<span class="token punctuation">(</span>X_test<span class="token punctuation">,</span>y_test<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best parameters:{}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_params_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Best score on train set:{:.2f}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>grid_search<span class="token punctuation">.</span>best_score_<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">'''运行结果 Size of training set:84 size of validation set:28 size of teseting set:38 Parameters:{'gamma': [0.001, 0.01, 0.1, 1, 10, 100], 'C': [0.001, 0.01, 0.1, 1, 10, 100]} Test set score:0.97 Best parameters:{'C': 10, 'gamma': 0.1} Best score on train set:0.98 '''</span>
</code></pre> 
  <h2><a id="32__226"></a>3.2 总结</h2> 
  <ol> 
   <li> <p>选择并构建训练模型model</p> </li> 
   <li> <p>将训练模型model投入到GridSearchCV中，得到GridSearchCV模型grid_model</p> </li> 
   <li> <p>用grid_model拟合训练集数据，选择在validation_dataset上效果最好的参数的模型best_estimator</p> </li> 
   <li> <p>best_estimator</p> </li> 
  </ol> 
  <ul> 
   <li> <p>用best_estimator拟合训练集（得到的结果应该与之前不同，因为之前用交叉验证等方法对训练集进行了分割）</p> </li> 
   <li> <p>用best_estimator拟合测试集</p> </li> 
  </ul> 
  <ol start="5"> 
   <li>结果可视化：AUC曲线，AUPR曲线</li> 
  </ol> 
  <p><strong>注</strong>：Grid Search 调参方法存在的共性弊端就是：耗时；参数越多，候选值越多，耗费时间越长！所以，一般情况下，先定一个大范围，然后再细化。</p> 
  <h1><a id="Python_242"></a>有趣的事，Python永远不会缺席</h1> 
  <p><strong>欢迎关注小婷儿的博客</strong><br><br> &nbsp;&nbsp;&nbsp;&nbsp;文章内容来源于小婷儿的学习笔记，部分整理自网络，若有侵权或不当之处还请谅解</p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp;如需转发，请注明出处：小婷儿的博客python&nbsp;&nbsp;&nbsp;&nbsp;<a href="https://www.cnblogs.com/xxtalhr/" rel="nofollow" data-token="0e67ad3402c59b774a78559657268f79">https://www.cnblogs.com/xxtalhr/</a><br><br> <strong>博客园</strong> <a href="https://www.cnblogs.com/xxtalhr/" rel="nofollow" data-token="0e67ad3402c59b774a78559657268f79">https://www.cnblogs.com/xxtalhr/</a><br><br> <strong>CSDN</strong> <a href="https://blog.csdn.net/u010986753" rel="nofollow" data-token="4ef009a4b76cf6edd578a85f3512983c">https://blog.csdn.net/u010986753</a><br></p> 
  <p><strong>有问题请在博客下留言或加作者：</strong><br> &nbsp;&nbsp;&nbsp;&nbsp; 微信：tinghai87605025 联系我加微信群<br> &nbsp;&nbsp;&nbsp;&nbsp; QQ ：87605025<br> &nbsp;&nbsp;&nbsp;&nbsp; python QQ交流群：py_data 483766429</p> 
  <center>
   <img src="https://img2018.cnblogs.com/blog/1400528/201905/1400528-20190519213410020-442219723.png"> 
  </center>
  <h1><a id="strongstrongbr_256"></a><strong>培训说明</strong><br></h1> 
  <p><strong>OCP培训说明连接</strong> <a href="https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA" rel="nofollow" data-token="afdcb4fd8b31944547a83f297e3100f1">https://mp.weixin.qq.com/s/2cymJ4xiBPtTaHu16HkiuA</a><br><br> <strong>OCM培训说明连接</strong> <a href="https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA" rel="nofollow" data-token="2bf5ee1beaca51764cb4f5798cf89c57">https://mp.weixin.qq.com/s/7-R6Cz8RcJKduVv6YlAxJA</a><br></p> 
  <p>&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://blog.csdn.net/u010986753" rel="nofollow" data-token="4ef009a4b76cf6edd578a85f3512983c">小婷儿的python</a>正在成长中，其中还有很多不足之处，随着学习和工作的深入，会对以往的博客内容逐步改进和完善哒。重要的事多说几遍。。。。。。</p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
