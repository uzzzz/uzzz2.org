<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>k8s核心组件—-kubectl使用 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="k8s核心组件—-kubectl使用" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="文章目录 一、kubectl简介 二、命令行自动补全配置 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 2、kubectl run 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 3、kubectl create 3.1、创建dashboard通过yaml文件 3.2、创建namespace 4、kubectl get：显示一个或多个资源 4.1、kubectl get nodes 4.1.1、获取节点信息 4.1.2、获取节点详细信息 4.1.3、获取节点标签 4.1.4、给节点打标签 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） 4.2.2、获取所有namespace的Pod信息 4.2.3、获取Pod的详细信息 4.2.4、获取Pod的labels 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 4.2.6、获取含有指定标签key的pod 4.2.7、获取含有指定标签key=value的pod 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 4.2.7、获取podIP 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 4.3.2、获取指定namespace信息 4.3.3、获取指定namespace的yaml格式信息 4.3.4、获取指定namespace的json格式信息 4.4、kubectl get rs：获取ReplicaSet控制器信息 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 4.5.2、与ReplicaSet的联系。`rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf` 4.5.3、滚动更新 4.6、kubectl get svc：获取service信息 5、kubectl label：操作标签 5.1、给一个pod打一个没有存在的标签key=value， 5.2、给一个pod已经存在的标签重新赋值 6、kubectl describe：查看资源的详细信息 6.1、查看某个pod的详细信息 7、kubectl delete：删除资源 7.1、删除pods资源 7.2、删除service 8、kubectl edit：修改资源的yaml清单内容 8.1、修改ReplicaSet控制器的yaml清单内容 9、kubectl exec：类似docker exec，进入容器 9.1、进入pod内的容器 9.2、进入pod内指定容器 10、kubectl logs：类似于docker logs，查看容器日志 10.1、查看pod内的容器日志 10.2、查看pod内指定容器的日志 11、kubectl explain 11.1、查看pod资源清单字段 11.2、查看pod资源清单理metadata字段下的字段（以此类推） 11.3、查看ReplicaSet资源清单字段 12、kubectl rollout：管理资源的部署 12.1、查看deployment滚动更新历史版本 12.2、更新一个pod后暂停更新 12.3、解除暂停状态，继续更新 12.4、回滚到指定版本 12.5、监控deployment更新状态 kubectl patch 修改deployment副本数 修改deployment滚动更新策略 kubectl set kubectl set image 修改deployment的镜像版本 修改daemonset的镜像版本 kubectl cluster-info：查看集群信息 kubectl api-versions：查询 Kubernetes API 支持的 API 版本 kubectl api-resources：查看k8s支持的资源类型 查看指定群组支持的资源类型 一、kubectl简介 kubectl 是 Kubernetes 的命令行工具（CLI），是 Kubernetes 用户和管理员必备的管理工具。 kubectl 提供了大量的子命令，方便管理 Kubernetes 集群中的各种功能。以下是查看子命令的帮助命令： kubectl -h：查看子命令列表 kubectl options：查看全局选项 kubectl --help：查看子命令的帮助 kubectl [command] [PARAMS] -o=：设置输出格式（如 json、yaml、jsonpath 等） kubectl explain [RESOURCE]：查看资源的定义 二、命令行自动补全配置 为了方便练习k8s常用命令使用，配置命令行自动补全 Centos yum install -y bash-completion source /usr/share/bash-completion/bash_completion source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc Ubuntu curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.2/bin/linux/amd64/kubectl chmod +x kubectl mv kubectl /usr/local/bin/ sudo mv kubectl /usr/local/bin/ source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 [root@master ~]# kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:23:09Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:14:56Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} 2、kubectl run 用法：kubectl run NAME --image=image [--env=&quot;key=value&quot;] [--port=port] [--replicas=replicas] [--dry-run=bool] [--overrides=inline-json] [--command] -- [COMMAND] [args...] [options] 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 [root@master ~]# kubectl run nginx --image=nginx --replicas=2 --port=80 kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead. deployment.apps/nginx created 3、kubectl create 用法：kubectl create -f FILENAME [options] 3.1、创建dashboard通过yaml文件 可以参考我的另一篇文章：k8s UI组件----Kubernetes Dashboard [root@master yaml]# kubectl create -f kubernetes-dashboard.yaml secret/kubernetes-dashboard-certs created serviceaccount/kubernetes-dashboard created role.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created deployment.apps/kubernetes-dashboard created service/kubernetes-dashboard created 3.2、创建namespace [root@master ~]# kubectl create namespace cyf namespace/cyf created 4、kubectl get：显示一个或多个资源 用法：kubectl get [(-o|--output=)json|yaml|wide|custom-columns=...|custom-columns-file=...|go-template=...|go-template-file=...|jsonpath=...|jsonpath-file=...] (TYPE[.VERSION][.GROUP] [NAME | -l label] | TYPE[.VERSION][.GROUP]/NAME ...) [flags] [options] 4.1、kubectl get nodes 4.1.1、获取节点信息 [root@master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION master Ready master 16h v1.14.2 node1 Ready worker 16h v1.14.2 4.1.2、获取节点详细信息 [root@master ~]# kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME master Ready master 16h v1.14.2 192.168.10.48 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 node1 Ready worker 16h v1.14.2 192.168.10.148 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 4.1.3、获取节点标签 [root@master ~]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS master Ready master 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master= node1 Ready worker 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,node-role.kubernetes.io/worker=worker 4.1.4、给节点打标签 [root@master ~]# kubectl label nodes node1 disktype=ssd node/node1 labeled 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） [root@master ~]# kubectl get pods -n default NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 52s nginx-755464dd6c-ggwzv 1/1 Running 0 52s 4.2.2、获取所有namespace的Pod信息 [root@master ~]# kubectl get pods --all-namespaces [root@master ~]# kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE default nginx-755464dd6c-b56mr 1/1 Running 0 3m12s default nginx-755464dd6c-ggwzv 1/1 Running 0 3m12s kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h kube-system etcd-master 1/1 Running 1 17h kube-system kube-apiserver-master 1/1 Running 1 17h kube-system kube-controller-manager-master 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-4kn7q 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-xpd8f 1/1 Running 1 17h kube-system kube-proxy-htdpc 1/1 Running 1 17h kube-system kube-proxy-q49ff 1/1 Running 1 17h kube-system kube-scheduler-master 1/1 Running 1 17h kube-system kubernetes-dashboard-6c98b7f57c-q6zp7 1/1 Running 1 16h 4.2.3、获取Pod的详细信息 [root@master ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-755464dd6c-b56mr 1/1 Running 0 5m31s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; nginx-755464dd6c-ggwzv 1/1 Running 0 5m31s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; [root@master ~]# kubectl get pods -A -o wide NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default nginx-755464dd6c-b56mr 1/1 Running 0 6m4s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; default nginx-755464dd6c-ggwzv 1/1 Running 0 6m4s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h 10.244.1.9 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h 10.244.1.8 node1 &lt;none&gt; &lt;none&gt; ...... 4.2.4、获取Pod的labels [root@master ~]# kubectl get pods --show-labels NAME READY STATUS RESTARTS AGE LABELS nginx-755464dd6c-b56mr 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx pod-demo 2/2 Running 0 58s apps=myapp,tier=frontend 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 [root@master yaml]# kubectl get pods -L apps,run NAME READY STATUS RESTARTS AGE APPS RUN nginx-755464dd6c-b56mr 1/1 Running 0 27h nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h nginx pod-demo 2/2 Running 0 15m myapp 4.2.6、获取含有指定标签key的pod [root@master yaml]# kubectl get pods -l apps --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 112s apps=myapp,tier=frontend 4.2.7、获取含有指定标签key=value的pod 等值关系：=和!= [root@master yaml]# kubectl get pods -l release=stable --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 39m apps=myapp,release=stable,tier=frontend 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 集合关系： key in （value1，value2...） key notin （value1，value2...） key !key [root@master yaml]# kubectl get pods -l &quot;release in (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-ggwzv 1/1 Running 0 28h [root@master yaml]# kubectl get pods -l &quot;release notin (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 28h pod-demo 2/2 Running 0 53m 4.2.7、获取podIP kubectl get pod pod-name -o jsonpath=’{.status.podIP}’ [root@master ~]# kubectl get pods nginx-755464dd6c-b56mr -o jsonpath=&#39;{.status.podIP}&#39; 10.244.1.11 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 [root@master ~]# kubectl get namespaces NAME STATUS AGE default Active 18h kube-node-lease Active 18h kube-public Active 18h kube-system Active 18h 4.3.2、获取指定namespace信息 [root@master ~]# kubectl get namespaces kube-system NAME STATUS AGE kube-system Active 18h 4.3.3、获取指定namespace的yaml格式信息 [root@master ~]# kubectl get namespaces kube-system -o yaml apiVersion: v1 kind: Namespace metadata: creationTimestamp: &quot;2019-07-29T09:28:58Z&quot; name: kube-system resourceVersion: &quot;10&quot; selfLink: /api/v1/namespaces/kube-system uid: 4ad779da-b1e3-11e9-ac67-0800273a2eb7 spec: finalizers: - kubernetes status: phase: Active 4.3.4、获取指定namespace的json格式信息 [root@master ~]# kubectl get namespaces kube-system -o json { &quot;apiVersion&quot;: &quot;v1&quot;, &quot;kind&quot;: &quot;Namespace&quot;, &quot;metadata&quot;: { &quot;creationTimestamp&quot;: &quot;2019-07-29T09:28:58Z&quot;, &quot;name&quot;: &quot;kube-system&quot;, &quot;resourceVersion&quot;: &quot;10&quot;, &quot;selfLink&quot;: &quot;/api/v1/namespaces/kube-system&quot;, &quot;uid&quot;: &quot;4ad779da-b1e3-11e9-ac67-0800273a2eb7&quot; }, &quot;spec&quot;: { &quot;finalizers&quot;: [ &quot;kubernetes&quot; ] }, &quot;status&quot;: { &quot;phase&quot;: &quot;Active&quot; } } 4.4、kubectl get rs：获取ReplicaSet控制器信息 [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp 2 2 2 24s 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 [root@master yaml]# kubectl get deploy NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h [root@master yaml]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h 4.5.2、与ReplicaSet的联系。rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp-deploy-74fb9bdf9b 2 2 2 48s nginx-755464dd6c 1 1 1 19h [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 7m42s myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 7m42s nginx-755464dd6c-2pgbs 1/1 Running 0 19h 4.5.3、滚动更新 修改版本号后的滚动更新过程 [root@master yaml]# kubectl get pods -w NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 33h nginx-755464dd6c-2pgbs 1/1 Running 0 2d4h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Running 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-g8dgm 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-c7fxx 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h 查看滚动更新后历史版本和现在运行版本 [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-66cfdc5675 3 3 3 100s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 0 0 0 16m myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary 4.6、kubectl get svc：获取service信息 [root@master yaml]# kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 3d5h 5、kubectl label：操作标签 用法：kubectl label [--overwrite] (-f FILENAME | TYPE NAME) KEY_1=VAL_1 ... KEY_N=VAL_N [--resource-version=version] 5.1、给一个pod打一个没有存在的标签key=value， [root@master yaml]# kubectl label pods pod-demo release=canary pod/pod-demo labeled [root@master yaml]# kubectl get pods pod-demo --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 33m apps=myapp,release=canary,tier=frontend 5.2、给一个pod已经存在的标签重新赋值 [root@master yaml]# kubectl label pods pod-demo release=stable error: &#39;release&#39; already has a value (canary), and --overwrite is false [root@master yaml]# kubectl label pods pod-demo release=stable --overwrite pod/pod-demo labeled 6、kubectl describe：查看资源的详细信息 用法：kubectl describe (-f FILENAME | TYPE [NAME_PREFIX | -l label] | TYPE/NAME) [options] 6.1、查看某个pod的详细信息 [root@master yaml]# kubectl describe pods pod-demo Name: pod-demo Namespace: default Priority: 0 PriorityClassName: &lt;none&gt; Node: node1/192.168.10.148 Start Time: Tue, 30 Jul 2019 18:17:38 +0800 Labels: apps=myapp tier=frontend Annotations: &lt;none&gt; Status: Running IP: 10.244.1.14 7、kubectl delete：删除资源 用法：kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)]) [options] 7.1、删除pods资源 [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-l9pbb 1/1 Running 0 7m1s myapp-nlw6m 1/1 Running 0 10m myapp-ppktd 1/1 Running 0 10m myapp-wmbnc 1/1 Running 0 28m myapp-wpfpn 1/1 Running 0 10m [root@master yaml]# kubectl delete pods myapp-l9pbb pod &quot;myapp-l9pbb&quot; deleted [root@master yaml]# 7.2、删除service [root@master yaml]# kubectl delete svc redis service &quot;redis&quot; deleted 8、kubectl edit：修改资源的yaml清单内容 用法：kubectl edit (RESOURCE/NAME | -f FILENAME) [options] 8.1、修改ReplicaSet控制器的yaml清单内容 注意：修改容器版本，不会自动更新（手动删除pod后自动更新：灰度发布） [root@master yaml]# kubectl edit rs myapp replicaset.extensions/myapp edited 9、kubectl exec：类似docker exec，进入容器 用法：kubectl exec POD [-c CONTAINER] -- COMMAND [args...] [options] 9.1、进入pod内的容器 [root@master yaml]# kubectl exec -it myapp-lmj45 -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 9.2、进入pod内指定容器 用法：kubectl exec -it pod-name -c container-name -- /bin/sh [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 10、kubectl logs：类似于docker logs，查看容器日志 用法：kubectl logs [-f] [-p] (POD | TYPE/NAME) [-c CONTAINER] [options] 10.1、查看pod内的容器日志 [root@master yaml]# kubectl logs myapp-lmj45 --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.2、查看pod内指定容器的日志 [root@master yaml]# kubectl logs myapp-lmj45 -c myapp-container --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 11、kubectl explain 用法：kubectl explain RESOURCE [options] 11.1、查看pod资源清单字段 [root@master ~]# kubectl explain pod KIND: Pod VERSION: v1 DESCRIPTION: Pod is a collection of containers that can run on a host. This resource is created by clients and scheduled onto hosts. FIELDS: apiVersion &lt;string&gt; ..... 11.2、查看pod资源清单理metadata字段下的字段（以此类推） [root@master ~]# kubectl explain pod.metadata KIND: Pod VERSION: v1 RESOURCE: metadata &lt;Object&gt; DESCRIPTION: Standard object&#39;s metadata. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata ObjectMeta is metadata that all persisted resources must have, which includes all objects users must create. FIELDS: annotations &lt;map[string]string&gt; ..... 11.3、查看ReplicaSet资源清单字段 [root@master yaml]# kubectl explain rs KIND: ReplicaSet VERSION: extensions/v1beta1 DESCRIPTION: DEPRECATED - This group version of ReplicaSet is deprecated by apps/v1beta2/ReplicaSet. See the release notes for more information. ReplicaSet ensures that a specified number of pod replicas are running at any given time. FIELDS: apiVersion &lt;string&gt; APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: ..... 12、kubectl rollout：管理资源的部署 用法：kubectl rollout SUBCOMMAND [options] 类型： deployments daemonsets statefulsets 12.1、查看deployment滚动更新历史版本 [root@master yaml]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 12.2、更新一个pod后暂停更新 [root@master yaml]# kubectl rollout pause deployment myapp-deploy deployment.extensions/myapp-deploy paused [root@master ~]# kubectl get pods -l app=myapp -w NAME READY STATUS RESTARTS AGE myapp-deploy-66cfdc5675-cnm4m 1/1 Running 0 12s myapp-deploy-66cfdc5675-jzghg 1/1 Running 0 12s myapp-deploy-66cfdc5675-zkc94 1/1 Running 0 12s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 ContainerCreating 0 0s myapp-deploy-668ff4dc58-fq6hp 1/1 Running 0 9s 12.3、解除暂停状态，继续更新 [root@master yaml]# kubectl rollout resume deployment myapp-deploy deployment.extensions/myapp-deploy resumed [root@master yaml]# kubectl rollout status deployment myapp-deploy deployment &quot;myapp-deploy&quot; successfully rolled out 12.4、回滚到指定版本 [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 3 &lt;none&gt; [root@master yaml]# kubectl rollout undo deployment myapp-deploy --to-revision=1 deployment.extensions/myapp-deploy rolled back [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-668ff4dc58 0 0 0 4m myapp ikubernetes/myapp:v3 app=myapp,pod-template-hash=668ff4dc58,release=canary myapp-deploy-66cfdc5675 0 0 0 4m23s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 5 5 5 5m8s myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 2 &lt;none&gt; 3 &lt;none&gt; 4 &lt;none&gt; 12.5、监控deployment更新状态 [root@master yaml]# kubectl rollout status deployment myapp-deploy Waiting for deployment &quot;myapp-deploy&quot; rollout to finish: 1 out of 3 new replicas have been updated... kubectl patch 用法：kubectl patch (-f FILENAME | TYPE NAME) -p PATCH [options] 修改deployment副本数 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:5}}&#39; deployment.extensions/myapp-deploy patched 修改deployment滚动更新策略 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:1,&quot;maxUnavailable&quot;:0}}}}&#39; deployment.extensions/myapp-deploy patched [root@master yaml]# kubectl describe deployments myapp-deploy Name: myapp-deploy Namespace: default CreationTimestamp: Fri, 02 Aug 2019 01:33:47 +0800 Labels: app=myapp release=canary Annotations: deployment.kubernetes.io/revision: 2 kubectl.kubernetes.io/last-applied-configuration: {&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;myapp-deploy&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;replicas&quot;:3... Selector: app=myapp,release=canary Replicas: 5 desired | 5 updated | 5 total | 5 available | 0 unavailable StrategyType: RollingUpdate MinReadySeconds: 0 RollingUpdateStrategy: 0 max unavailable, 1 max surge #已经修改 ..... kubectl set 用法：kubectl set SUBCOMMAND [options] kubectl set image 用法：kubectl set image (-f FILENAME | TYPE NAME) CONTAINER_NAME_1=CONTAINER_IMAGE_1 ... CONTAINER_NAME_N=CONTAINER_IMAGE_N [options] 修改deployment的镜像版本 [root@master yaml]# kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 deployment.extensions/myapp-deploy image updated 修改daemonset的镜像版本 [root@master yaml]# kubectl set image daemonsets filebeat-ds filebeat=ikubernetes/filebeat:5.6.6-alpine daemonset.extensions/filebeat-ds image updated kubectl cluster-info：查看集群信息 [root@master ~]# kubectl cluster-info Kubernetes master is running at https://192.168.10.48:6443 KubeDNS is running at https://192.168.10.48:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;. kubectl api-versions：查询 Kubernetes API 支持的 API 版本 [root@master ~]# kubectl api-versions admissionregistration.k8s.io/v1beta1 apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1 apiregistration.k8s.io/v1beta1 apps/v1 apps/v1beta1 apps/v1beta2 ..... kubectl api-resources：查看k8s支持的资源类型 [root@master ~]# kubectl api-resources NAME SHORTNAMES APIGROUP NAMESPACED KIND bindings true Binding componentstatuses cs false ComponentStatus configmaps cm true ConfigMap endpoints ep true Endpoints events ev true Event limitranges limits true LimitRange namespaces ns false Namespace nodes no false Node 查看指定群组支持的资源类型 [root@master ~]# kubectl api-resources --api-group=storage.k8s.io NAME SHORTNAMES APIGROUP NAMESPACED KIND csidrivers storage.k8s.io false CSIDriver csinodes storage.k8s.io false CSINode storageclasses sc storage.k8s.io false StorageClass volumeattachments storage.k8s.io false VolumeAttachment" />
<meta property="og:description" content="文章目录 一、kubectl简介 二、命令行自动补全配置 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 2、kubectl run 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 3、kubectl create 3.1、创建dashboard通过yaml文件 3.2、创建namespace 4、kubectl get：显示一个或多个资源 4.1、kubectl get nodes 4.1.1、获取节点信息 4.1.2、获取节点详细信息 4.1.3、获取节点标签 4.1.4、给节点打标签 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） 4.2.2、获取所有namespace的Pod信息 4.2.3、获取Pod的详细信息 4.2.4、获取Pod的labels 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 4.2.6、获取含有指定标签key的pod 4.2.7、获取含有指定标签key=value的pod 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 4.2.7、获取podIP 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 4.3.2、获取指定namespace信息 4.3.3、获取指定namespace的yaml格式信息 4.3.4、获取指定namespace的json格式信息 4.4、kubectl get rs：获取ReplicaSet控制器信息 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 4.5.2、与ReplicaSet的联系。`rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf` 4.5.3、滚动更新 4.6、kubectl get svc：获取service信息 5、kubectl label：操作标签 5.1、给一个pod打一个没有存在的标签key=value， 5.2、给一个pod已经存在的标签重新赋值 6、kubectl describe：查看资源的详细信息 6.1、查看某个pod的详细信息 7、kubectl delete：删除资源 7.1、删除pods资源 7.2、删除service 8、kubectl edit：修改资源的yaml清单内容 8.1、修改ReplicaSet控制器的yaml清单内容 9、kubectl exec：类似docker exec，进入容器 9.1、进入pod内的容器 9.2、进入pod内指定容器 10、kubectl logs：类似于docker logs，查看容器日志 10.1、查看pod内的容器日志 10.2、查看pod内指定容器的日志 11、kubectl explain 11.1、查看pod资源清单字段 11.2、查看pod资源清单理metadata字段下的字段（以此类推） 11.3、查看ReplicaSet资源清单字段 12、kubectl rollout：管理资源的部署 12.1、查看deployment滚动更新历史版本 12.2、更新一个pod后暂停更新 12.3、解除暂停状态，继续更新 12.4、回滚到指定版本 12.5、监控deployment更新状态 kubectl patch 修改deployment副本数 修改deployment滚动更新策略 kubectl set kubectl set image 修改deployment的镜像版本 修改daemonset的镜像版本 kubectl cluster-info：查看集群信息 kubectl api-versions：查询 Kubernetes API 支持的 API 版本 kubectl api-resources：查看k8s支持的资源类型 查看指定群组支持的资源类型 一、kubectl简介 kubectl 是 Kubernetes 的命令行工具（CLI），是 Kubernetes 用户和管理员必备的管理工具。 kubectl 提供了大量的子命令，方便管理 Kubernetes 集群中的各种功能。以下是查看子命令的帮助命令： kubectl -h：查看子命令列表 kubectl options：查看全局选项 kubectl --help：查看子命令的帮助 kubectl [command] [PARAMS] -o=：设置输出格式（如 json、yaml、jsonpath 等） kubectl explain [RESOURCE]：查看资源的定义 二、命令行自动补全配置 为了方便练习k8s常用命令使用，配置命令行自动补全 Centos yum install -y bash-completion source /usr/share/bash-completion/bash_completion source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc Ubuntu curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.2/bin/linux/amd64/kubectl chmod +x kubectl mv kubectl /usr/local/bin/ sudo mv kubectl /usr/local/bin/ source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 [root@master ~]# kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:23:09Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:14:56Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} 2、kubectl run 用法：kubectl run NAME --image=image [--env=&quot;key=value&quot;] [--port=port] [--replicas=replicas] [--dry-run=bool] [--overrides=inline-json] [--command] -- [COMMAND] [args...] [options] 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 [root@master ~]# kubectl run nginx --image=nginx --replicas=2 --port=80 kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead. deployment.apps/nginx created 3、kubectl create 用法：kubectl create -f FILENAME [options] 3.1、创建dashboard通过yaml文件 可以参考我的另一篇文章：k8s UI组件----Kubernetes Dashboard [root@master yaml]# kubectl create -f kubernetes-dashboard.yaml secret/kubernetes-dashboard-certs created serviceaccount/kubernetes-dashboard created role.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created deployment.apps/kubernetes-dashboard created service/kubernetes-dashboard created 3.2、创建namespace [root@master ~]# kubectl create namespace cyf namespace/cyf created 4、kubectl get：显示一个或多个资源 用法：kubectl get [(-o|--output=)json|yaml|wide|custom-columns=...|custom-columns-file=...|go-template=...|go-template-file=...|jsonpath=...|jsonpath-file=...] (TYPE[.VERSION][.GROUP] [NAME | -l label] | TYPE[.VERSION][.GROUP]/NAME ...) [flags] [options] 4.1、kubectl get nodes 4.1.1、获取节点信息 [root@master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION master Ready master 16h v1.14.2 node1 Ready worker 16h v1.14.2 4.1.2、获取节点详细信息 [root@master ~]# kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME master Ready master 16h v1.14.2 192.168.10.48 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 node1 Ready worker 16h v1.14.2 192.168.10.148 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 4.1.3、获取节点标签 [root@master ~]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS master Ready master 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master= node1 Ready worker 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,node-role.kubernetes.io/worker=worker 4.1.4、给节点打标签 [root@master ~]# kubectl label nodes node1 disktype=ssd node/node1 labeled 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） [root@master ~]# kubectl get pods -n default NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 52s nginx-755464dd6c-ggwzv 1/1 Running 0 52s 4.2.2、获取所有namespace的Pod信息 [root@master ~]# kubectl get pods --all-namespaces [root@master ~]# kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE default nginx-755464dd6c-b56mr 1/1 Running 0 3m12s default nginx-755464dd6c-ggwzv 1/1 Running 0 3m12s kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h kube-system etcd-master 1/1 Running 1 17h kube-system kube-apiserver-master 1/1 Running 1 17h kube-system kube-controller-manager-master 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-4kn7q 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-xpd8f 1/1 Running 1 17h kube-system kube-proxy-htdpc 1/1 Running 1 17h kube-system kube-proxy-q49ff 1/1 Running 1 17h kube-system kube-scheduler-master 1/1 Running 1 17h kube-system kubernetes-dashboard-6c98b7f57c-q6zp7 1/1 Running 1 16h 4.2.3、获取Pod的详细信息 [root@master ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-755464dd6c-b56mr 1/1 Running 0 5m31s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; nginx-755464dd6c-ggwzv 1/1 Running 0 5m31s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; [root@master ~]# kubectl get pods -A -o wide NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default nginx-755464dd6c-b56mr 1/1 Running 0 6m4s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; default nginx-755464dd6c-ggwzv 1/1 Running 0 6m4s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h 10.244.1.9 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h 10.244.1.8 node1 &lt;none&gt; &lt;none&gt; ...... 4.2.4、获取Pod的labels [root@master ~]# kubectl get pods --show-labels NAME READY STATUS RESTARTS AGE LABELS nginx-755464dd6c-b56mr 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx pod-demo 2/2 Running 0 58s apps=myapp,tier=frontend 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 [root@master yaml]# kubectl get pods -L apps,run NAME READY STATUS RESTARTS AGE APPS RUN nginx-755464dd6c-b56mr 1/1 Running 0 27h nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h nginx pod-demo 2/2 Running 0 15m myapp 4.2.6、获取含有指定标签key的pod [root@master yaml]# kubectl get pods -l apps --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 112s apps=myapp,tier=frontend 4.2.7、获取含有指定标签key=value的pod 等值关系：=和!= [root@master yaml]# kubectl get pods -l release=stable --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 39m apps=myapp,release=stable,tier=frontend 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 集合关系： key in （value1，value2...） key notin （value1，value2...） key !key [root@master yaml]# kubectl get pods -l &quot;release in (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-ggwzv 1/1 Running 0 28h [root@master yaml]# kubectl get pods -l &quot;release notin (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 28h pod-demo 2/2 Running 0 53m 4.2.7、获取podIP kubectl get pod pod-name -o jsonpath=’{.status.podIP}’ [root@master ~]# kubectl get pods nginx-755464dd6c-b56mr -o jsonpath=&#39;{.status.podIP}&#39; 10.244.1.11 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 [root@master ~]# kubectl get namespaces NAME STATUS AGE default Active 18h kube-node-lease Active 18h kube-public Active 18h kube-system Active 18h 4.3.2、获取指定namespace信息 [root@master ~]# kubectl get namespaces kube-system NAME STATUS AGE kube-system Active 18h 4.3.3、获取指定namespace的yaml格式信息 [root@master ~]# kubectl get namespaces kube-system -o yaml apiVersion: v1 kind: Namespace metadata: creationTimestamp: &quot;2019-07-29T09:28:58Z&quot; name: kube-system resourceVersion: &quot;10&quot; selfLink: /api/v1/namespaces/kube-system uid: 4ad779da-b1e3-11e9-ac67-0800273a2eb7 spec: finalizers: - kubernetes status: phase: Active 4.3.4、获取指定namespace的json格式信息 [root@master ~]# kubectl get namespaces kube-system -o json { &quot;apiVersion&quot;: &quot;v1&quot;, &quot;kind&quot;: &quot;Namespace&quot;, &quot;metadata&quot;: { &quot;creationTimestamp&quot;: &quot;2019-07-29T09:28:58Z&quot;, &quot;name&quot;: &quot;kube-system&quot;, &quot;resourceVersion&quot;: &quot;10&quot;, &quot;selfLink&quot;: &quot;/api/v1/namespaces/kube-system&quot;, &quot;uid&quot;: &quot;4ad779da-b1e3-11e9-ac67-0800273a2eb7&quot; }, &quot;spec&quot;: { &quot;finalizers&quot;: [ &quot;kubernetes&quot; ] }, &quot;status&quot;: { &quot;phase&quot;: &quot;Active&quot; } } 4.4、kubectl get rs：获取ReplicaSet控制器信息 [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp 2 2 2 24s 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 [root@master yaml]# kubectl get deploy NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h [root@master yaml]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h 4.5.2、与ReplicaSet的联系。rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp-deploy-74fb9bdf9b 2 2 2 48s nginx-755464dd6c 1 1 1 19h [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 7m42s myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 7m42s nginx-755464dd6c-2pgbs 1/1 Running 0 19h 4.5.3、滚动更新 修改版本号后的滚动更新过程 [root@master yaml]# kubectl get pods -w NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 33h nginx-755464dd6c-2pgbs 1/1 Running 0 2d4h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Running 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-g8dgm 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-c7fxx 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h 查看滚动更新后历史版本和现在运行版本 [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-66cfdc5675 3 3 3 100s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 0 0 0 16m myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary 4.6、kubectl get svc：获取service信息 [root@master yaml]# kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 3d5h 5、kubectl label：操作标签 用法：kubectl label [--overwrite] (-f FILENAME | TYPE NAME) KEY_1=VAL_1 ... KEY_N=VAL_N [--resource-version=version] 5.1、给一个pod打一个没有存在的标签key=value， [root@master yaml]# kubectl label pods pod-demo release=canary pod/pod-demo labeled [root@master yaml]# kubectl get pods pod-demo --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 33m apps=myapp,release=canary,tier=frontend 5.2、给一个pod已经存在的标签重新赋值 [root@master yaml]# kubectl label pods pod-demo release=stable error: &#39;release&#39; already has a value (canary), and --overwrite is false [root@master yaml]# kubectl label pods pod-demo release=stable --overwrite pod/pod-demo labeled 6、kubectl describe：查看资源的详细信息 用法：kubectl describe (-f FILENAME | TYPE [NAME_PREFIX | -l label] | TYPE/NAME) [options] 6.1、查看某个pod的详细信息 [root@master yaml]# kubectl describe pods pod-demo Name: pod-demo Namespace: default Priority: 0 PriorityClassName: &lt;none&gt; Node: node1/192.168.10.148 Start Time: Tue, 30 Jul 2019 18:17:38 +0800 Labels: apps=myapp tier=frontend Annotations: &lt;none&gt; Status: Running IP: 10.244.1.14 7、kubectl delete：删除资源 用法：kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)]) [options] 7.1、删除pods资源 [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-l9pbb 1/1 Running 0 7m1s myapp-nlw6m 1/1 Running 0 10m myapp-ppktd 1/1 Running 0 10m myapp-wmbnc 1/1 Running 0 28m myapp-wpfpn 1/1 Running 0 10m [root@master yaml]# kubectl delete pods myapp-l9pbb pod &quot;myapp-l9pbb&quot; deleted [root@master yaml]# 7.2、删除service [root@master yaml]# kubectl delete svc redis service &quot;redis&quot; deleted 8、kubectl edit：修改资源的yaml清单内容 用法：kubectl edit (RESOURCE/NAME | -f FILENAME) [options] 8.1、修改ReplicaSet控制器的yaml清单内容 注意：修改容器版本，不会自动更新（手动删除pod后自动更新：灰度发布） [root@master yaml]# kubectl edit rs myapp replicaset.extensions/myapp edited 9、kubectl exec：类似docker exec，进入容器 用法：kubectl exec POD [-c CONTAINER] -- COMMAND [args...] [options] 9.1、进入pod内的容器 [root@master yaml]# kubectl exec -it myapp-lmj45 -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 9.2、进入pod内指定容器 用法：kubectl exec -it pod-name -c container-name -- /bin/sh [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 10、kubectl logs：类似于docker logs，查看容器日志 用法：kubectl logs [-f] [-p] (POD | TYPE/NAME) [-c CONTAINER] [options] 10.1、查看pod内的容器日志 [root@master yaml]# kubectl logs myapp-lmj45 --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.2、查看pod内指定容器的日志 [root@master yaml]# kubectl logs myapp-lmj45 -c myapp-container --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 11、kubectl explain 用法：kubectl explain RESOURCE [options] 11.1、查看pod资源清单字段 [root@master ~]# kubectl explain pod KIND: Pod VERSION: v1 DESCRIPTION: Pod is a collection of containers that can run on a host. This resource is created by clients and scheduled onto hosts. FIELDS: apiVersion &lt;string&gt; ..... 11.2、查看pod资源清单理metadata字段下的字段（以此类推） [root@master ~]# kubectl explain pod.metadata KIND: Pod VERSION: v1 RESOURCE: metadata &lt;Object&gt; DESCRIPTION: Standard object&#39;s metadata. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata ObjectMeta is metadata that all persisted resources must have, which includes all objects users must create. FIELDS: annotations &lt;map[string]string&gt; ..... 11.3、查看ReplicaSet资源清单字段 [root@master yaml]# kubectl explain rs KIND: ReplicaSet VERSION: extensions/v1beta1 DESCRIPTION: DEPRECATED - This group version of ReplicaSet is deprecated by apps/v1beta2/ReplicaSet. See the release notes for more information. ReplicaSet ensures that a specified number of pod replicas are running at any given time. FIELDS: apiVersion &lt;string&gt; APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: ..... 12、kubectl rollout：管理资源的部署 用法：kubectl rollout SUBCOMMAND [options] 类型： deployments daemonsets statefulsets 12.1、查看deployment滚动更新历史版本 [root@master yaml]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 12.2、更新一个pod后暂停更新 [root@master yaml]# kubectl rollout pause deployment myapp-deploy deployment.extensions/myapp-deploy paused [root@master ~]# kubectl get pods -l app=myapp -w NAME READY STATUS RESTARTS AGE myapp-deploy-66cfdc5675-cnm4m 1/1 Running 0 12s myapp-deploy-66cfdc5675-jzghg 1/1 Running 0 12s myapp-deploy-66cfdc5675-zkc94 1/1 Running 0 12s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 ContainerCreating 0 0s myapp-deploy-668ff4dc58-fq6hp 1/1 Running 0 9s 12.3、解除暂停状态，继续更新 [root@master yaml]# kubectl rollout resume deployment myapp-deploy deployment.extensions/myapp-deploy resumed [root@master yaml]# kubectl rollout status deployment myapp-deploy deployment &quot;myapp-deploy&quot; successfully rolled out 12.4、回滚到指定版本 [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 3 &lt;none&gt; [root@master yaml]# kubectl rollout undo deployment myapp-deploy --to-revision=1 deployment.extensions/myapp-deploy rolled back [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-668ff4dc58 0 0 0 4m myapp ikubernetes/myapp:v3 app=myapp,pod-template-hash=668ff4dc58,release=canary myapp-deploy-66cfdc5675 0 0 0 4m23s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 5 5 5 5m8s myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 2 &lt;none&gt; 3 &lt;none&gt; 4 &lt;none&gt; 12.5、监控deployment更新状态 [root@master yaml]# kubectl rollout status deployment myapp-deploy Waiting for deployment &quot;myapp-deploy&quot; rollout to finish: 1 out of 3 new replicas have been updated... kubectl patch 用法：kubectl patch (-f FILENAME | TYPE NAME) -p PATCH [options] 修改deployment副本数 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:5}}&#39; deployment.extensions/myapp-deploy patched 修改deployment滚动更新策略 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:1,&quot;maxUnavailable&quot;:0}}}}&#39; deployment.extensions/myapp-deploy patched [root@master yaml]# kubectl describe deployments myapp-deploy Name: myapp-deploy Namespace: default CreationTimestamp: Fri, 02 Aug 2019 01:33:47 +0800 Labels: app=myapp release=canary Annotations: deployment.kubernetes.io/revision: 2 kubectl.kubernetes.io/last-applied-configuration: {&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;myapp-deploy&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;replicas&quot;:3... Selector: app=myapp,release=canary Replicas: 5 desired | 5 updated | 5 total | 5 available | 0 unavailable StrategyType: RollingUpdate MinReadySeconds: 0 RollingUpdateStrategy: 0 max unavailable, 1 max surge #已经修改 ..... kubectl set 用法：kubectl set SUBCOMMAND [options] kubectl set image 用法：kubectl set image (-f FILENAME | TYPE NAME) CONTAINER_NAME_1=CONTAINER_IMAGE_1 ... CONTAINER_NAME_N=CONTAINER_IMAGE_N [options] 修改deployment的镜像版本 [root@master yaml]# kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 deployment.extensions/myapp-deploy image updated 修改daemonset的镜像版本 [root@master yaml]# kubectl set image daemonsets filebeat-ds filebeat=ikubernetes/filebeat:5.6.6-alpine daemonset.extensions/filebeat-ds image updated kubectl cluster-info：查看集群信息 [root@master ~]# kubectl cluster-info Kubernetes master is running at https://192.168.10.48:6443 KubeDNS is running at https://192.168.10.48:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;. kubectl api-versions：查询 Kubernetes API 支持的 API 版本 [root@master ~]# kubectl api-versions admissionregistration.k8s.io/v1beta1 apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1 apiregistration.k8s.io/v1beta1 apps/v1 apps/v1beta1 apps/v1beta2 ..... kubectl api-resources：查看k8s支持的资源类型 [root@master ~]# kubectl api-resources NAME SHORTNAMES APIGROUP NAMESPACED KIND bindings true Binding componentstatuses cs false ComponentStatus configmaps cm true ConfigMap endpoints ep true Endpoints events ev true Event limitranges limits true LimitRange namespaces ns false Namespace nodes no false Node 查看指定群组支持的资源类型 [root@master ~]# kubectl api-resources --api-group=storage.k8s.io NAME SHORTNAMES APIGROUP NAMESPACED KIND csidrivers storage.k8s.io false CSIDriver csinodes storage.k8s.io false CSINode storageclasses sc storage.k8s.io false StorageClass volumeattachments storage.k8s.io false VolumeAttachment" />
<link rel="canonical" href="https://uzzz.org/2019/08/03/792469.html" />
<meta property="og:url" content="https://uzzz.org/2019/08/03/792469.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-03T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"文章目录 一、kubectl简介 二、命令行自动补全配置 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 2、kubectl run 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 3、kubectl create 3.1、创建dashboard通过yaml文件 3.2、创建namespace 4、kubectl get：显示一个或多个资源 4.1、kubectl get nodes 4.1.1、获取节点信息 4.1.2、获取节点详细信息 4.1.3、获取节点标签 4.1.4、给节点打标签 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） 4.2.2、获取所有namespace的Pod信息 4.2.3、获取Pod的详细信息 4.2.4、获取Pod的labels 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 4.2.6、获取含有指定标签key的pod 4.2.7、获取含有指定标签key=value的pod 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 4.2.7、获取podIP 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 4.3.2、获取指定namespace信息 4.3.3、获取指定namespace的yaml格式信息 4.3.4、获取指定namespace的json格式信息 4.4、kubectl get rs：获取ReplicaSet控制器信息 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 4.5.2、与ReplicaSet的联系。`rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf` 4.5.3、滚动更新 4.6、kubectl get svc：获取service信息 5、kubectl label：操作标签 5.1、给一个pod打一个没有存在的标签key=value， 5.2、给一个pod已经存在的标签重新赋值 6、kubectl describe：查看资源的详细信息 6.1、查看某个pod的详细信息 7、kubectl delete：删除资源 7.1、删除pods资源 7.2、删除service 8、kubectl edit：修改资源的yaml清单内容 8.1、修改ReplicaSet控制器的yaml清单内容 9、kubectl exec：类似docker exec，进入容器 9.1、进入pod内的容器 9.2、进入pod内指定容器 10、kubectl logs：类似于docker logs，查看容器日志 10.1、查看pod内的容器日志 10.2、查看pod内指定容器的日志 11、kubectl explain 11.1、查看pod资源清单字段 11.2、查看pod资源清单理metadata字段下的字段（以此类推） 11.3、查看ReplicaSet资源清单字段 12、kubectl rollout：管理资源的部署 12.1、查看deployment滚动更新历史版本 12.2、更新一个pod后暂停更新 12.3、解除暂停状态，继续更新 12.4、回滚到指定版本 12.5、监控deployment更新状态 kubectl patch 修改deployment副本数 修改deployment滚动更新策略 kubectl set kubectl set image 修改deployment的镜像版本 修改daemonset的镜像版本 kubectl cluster-info：查看集群信息 kubectl api-versions：查询 Kubernetes API 支持的 API 版本 kubectl api-resources：查看k8s支持的资源类型 查看指定群组支持的资源类型 一、kubectl简介 kubectl 是 Kubernetes 的命令行工具（CLI），是 Kubernetes 用户和管理员必备的管理工具。 kubectl 提供了大量的子命令，方便管理 Kubernetes 集群中的各种功能。以下是查看子命令的帮助命令： kubectl -h：查看子命令列表 kubectl options：查看全局选项 kubectl --help：查看子命令的帮助 kubectl [command] [PARAMS] -o=：设置输出格式（如 json、yaml、jsonpath 等） kubectl explain [RESOURCE]：查看资源的定义 二、命令行自动补全配置 为了方便练习k8s常用命令使用，配置命令行自动补全 Centos yum install -y bash-completion source /usr/share/bash-completion/bash_completion source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc Ubuntu curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.2/bin/linux/amd64/kubectl chmod +x kubectl mv kubectl /usr/local/bin/ sudo mv kubectl /usr/local/bin/ source &lt;(kubectl completion bash) echo &quot;source &lt;(kubectl completion bash)&quot; &gt;&gt; ~/.bashrc 三、kubectl常用命令总结 1、kubectl version：输出 client 和 server 的版本信息 [root@master ~]# kubectl version Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:23:09Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} Server Version: version.Info{Major:&quot;1&quot;, Minor:&quot;14&quot;, GitVersion:&quot;v1.14.2&quot;, GitCommit:&quot;66049e3b21efe110454d67df4fa62b08ea79a19b&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2019-05-16T16:14:56Z&quot;, GoVersion:&quot;go1.12.5&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} 2、kubectl run 用法：kubectl run NAME --image=image [--env=&quot;key=value&quot;] [--port=port] [--replicas=replicas] [--dry-run=bool] [--overrides=inline-json] [--command] -- [COMMAND] [args...] [options] 2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器 [root@master ~]# kubectl run nginx --image=nginx --replicas=2 --port=80 kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead. deployment.apps/nginx created 3、kubectl create 用法：kubectl create -f FILENAME [options] 3.1、创建dashboard通过yaml文件 可以参考我的另一篇文章：k8s UI组件----Kubernetes Dashboard [root@master yaml]# kubectl create -f kubernetes-dashboard.yaml secret/kubernetes-dashboard-certs created serviceaccount/kubernetes-dashboard created role.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created deployment.apps/kubernetes-dashboard created service/kubernetes-dashboard created 3.2、创建namespace [root@master ~]# kubectl create namespace cyf namespace/cyf created 4、kubectl get：显示一个或多个资源 用法：kubectl get [(-o|--output=)json|yaml|wide|custom-columns=...|custom-columns-file=...|go-template=...|go-template-file=...|jsonpath=...|jsonpath-file=...] (TYPE[.VERSION][.GROUP] [NAME | -l label] | TYPE[.VERSION][.GROUP]/NAME ...) [flags] [options] 4.1、kubectl get nodes 4.1.1、获取节点信息 [root@master ~]# kubectl get nodes NAME STATUS ROLES AGE VERSION master Ready master 16h v1.14.2 node1 Ready worker 16h v1.14.2 4.1.2、获取节点详细信息 [root@master ~]# kubectl get nodes -o wide NAME STATUS ROLES AGE VERSION INTERNAL-IP EXTERNAL-IP OS-IMAGE KERNEL-VERSION CONTAINER-RUNTIME master Ready master 16h v1.14.2 192.168.10.48 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 node1 Ready worker 16h v1.14.2 192.168.10.148 &lt;none&gt; CentOS Linux 7 (Core) 3.10.0-957.el7.x86_64 docker://19.3.1 4.1.3、获取节点标签 [root@master ~]# kubectl get nodes --show-labels NAME STATUS ROLES AGE VERSION LABELS master Ready master 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master= node1 Ready worker 2d v1.14.2 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,node-role.kubernetes.io/worker=worker 4.1.4、给节点打标签 [root@master ~]# kubectl label nodes node1 disktype=ssd node/node1 labeled 4.2、kubectl get pods 4.2.1、获取指定namespace的Pod信息（不加-n默认获取default） [root@master ~]# kubectl get pods -n default NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 52s nginx-755464dd6c-ggwzv 1/1 Running 0 52s 4.2.2、获取所有namespace的Pod信息 [root@master ~]# kubectl get pods --all-namespaces [root@master ~]# kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE default nginx-755464dd6c-b56mr 1/1 Running 0 3m12s default nginx-755464dd6c-ggwzv 1/1 Running 0 3m12s kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h kube-system etcd-master 1/1 Running 1 17h kube-system kube-apiserver-master 1/1 Running 1 17h kube-system kube-controller-manager-master 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-4kn7q 1/1 Running 1 17h kube-system kube-flannel-ds-amd64-xpd8f 1/1 Running 1 17h kube-system kube-proxy-htdpc 1/1 Running 1 17h kube-system kube-proxy-q49ff 1/1 Running 1 17h kube-system kube-scheduler-master 1/1 Running 1 17h kube-system kubernetes-dashboard-6c98b7f57c-q6zp7 1/1 Running 1 16h 4.2.3、获取Pod的详细信息 [root@master ~]# kubectl get pods -o wide NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES nginx-755464dd6c-b56mr 1/1 Running 0 5m31s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; nginx-755464dd6c-ggwzv 1/1 Running 0 5m31s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; [root@master ~]# kubectl get pods -A -o wide NAMESPACE NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES default nginx-755464dd6c-b56mr 1/1 Running 0 6m4s 10.244.1.11 node1 &lt;none&gt; &lt;none&gt; default nginx-755464dd6c-ggwzv 1/1 Running 0 6m4s 10.244.1.10 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-b9cwb 1/1 Running 1 17h 10.244.1.9 node1 &lt;none&gt; &lt;none&gt; kube-system coredns-fb8b8dccf-qcdv2 1/1 Running 1 17h 10.244.1.8 node1 &lt;none&gt; &lt;none&gt; ...... 4.2.4、获取Pod的labels [root@master ~]# kubectl get pods --show-labels NAME READY STATUS RESTARTS AGE LABELS nginx-755464dd6c-b56mr 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h pod-template-hash=755464dd6c,run=nginx pod-demo 2/2 Running 0 58s apps=myapp,tier=frontend 4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白 [root@master yaml]# kubectl get pods -L apps,run NAME READY STATUS RESTARTS AGE APPS RUN nginx-755464dd6c-b56mr 1/1 Running 0 27h nginx nginx-755464dd6c-ggwzv 1/1 Running 0 27h nginx pod-demo 2/2 Running 0 15m myapp 4.2.6、获取含有指定标签key的pod [root@master yaml]# kubectl get pods -l apps --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 112s apps=myapp,tier=frontend 4.2.7、获取含有指定标签key=value的pod 等值关系：=和!= [root@master yaml]# kubectl get pods -l release=stable --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 39m apps=myapp,release=stable,tier=frontend 4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合） 集合关系： key in （value1，value2...） key notin （value1，value2...） key !key [root@master yaml]# kubectl get pods -l &quot;release in (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-ggwzv 1/1 Running 0 28h [root@master yaml]# kubectl get pods -l &quot;release notin (canary,beta,alpha)&quot; NAME READY STATUS RESTARTS AGE nginx-755464dd6c-b56mr 1/1 Running 0 28h pod-demo 2/2 Running 0 53m 4.2.7、获取podIP kubectl get pod pod-name -o jsonpath=’{.status.podIP}’ [root@master ~]# kubectl get pods nginx-755464dd6c-b56mr -o jsonpath=&#39;{.status.podIP}&#39; 10.244.1.11 4.3、kubectl get namespaces：获取namespace信息 4.3.1、获取所有namespace信息 [root@master ~]# kubectl get namespaces NAME STATUS AGE default Active 18h kube-node-lease Active 18h kube-public Active 18h kube-system Active 18h 4.3.2、获取指定namespace信息 [root@master ~]# kubectl get namespaces kube-system NAME STATUS AGE kube-system Active 18h 4.3.3、获取指定namespace的yaml格式信息 [root@master ~]# kubectl get namespaces kube-system -o yaml apiVersion: v1 kind: Namespace metadata: creationTimestamp: &quot;2019-07-29T09:28:58Z&quot; name: kube-system resourceVersion: &quot;10&quot; selfLink: /api/v1/namespaces/kube-system uid: 4ad779da-b1e3-11e9-ac67-0800273a2eb7 spec: finalizers: - kubernetes status: phase: Active 4.3.4、获取指定namespace的json格式信息 [root@master ~]# kubectl get namespaces kube-system -o json { &quot;apiVersion&quot;: &quot;v1&quot;, &quot;kind&quot;: &quot;Namespace&quot;, &quot;metadata&quot;: { &quot;creationTimestamp&quot;: &quot;2019-07-29T09:28:58Z&quot;, &quot;name&quot;: &quot;kube-system&quot;, &quot;resourceVersion&quot;: &quot;10&quot;, &quot;selfLink&quot;: &quot;/api/v1/namespaces/kube-system&quot;, &quot;uid&quot;: &quot;4ad779da-b1e3-11e9-ac67-0800273a2eb7&quot; }, &quot;spec&quot;: { &quot;finalizers&quot;: [ &quot;kubernetes&quot; ] }, &quot;status&quot;: { &quot;phase&quot;: &quot;Active&quot; } } 4.4、kubectl get rs：获取ReplicaSet控制器信息 [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp 2 2 2 24s 4.5、kubectl get deploy &amp;&amp; kubectl get deployment 4.5.1、获取Deployment控制器信息 [root@master yaml]# kubectl get deploy NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h [root@master yaml]# kubectl get deployments NAME READY UP-TO-DATE AVAILABLE AGE myapp-deploy 2/2 2 2 22s nginx 1/1 1 1 19h 4.5.2、与ReplicaSet的联系。rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf [root@master yaml]# kubectl get rs NAME DESIRED CURRENT READY AGE myapp-deploy-74fb9bdf9b 2 2 2 48s nginx-755464dd6c 1 1 1 19h [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 7m42s myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 7m42s nginx-755464dd6c-2pgbs 1/1 Running 0 19h 4.5.3、滚动更新 修改版本号后的滚动更新过程 [root@master yaml]# kubectl get pods -w NAME READY STATUS RESTARTS AGE myapp-deploy-74fb9bdf9b-rd4nf 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Running 0 33h nginx-755464dd6c-2pgbs 1/1 Running 0 2d4h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Pending 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Running 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 Pending 0 33h myapp-deploy-66cfdc5675-g8dgm 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-g8dgm 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 Pending 0 33h myapp-deploy-66cfdc5675-c7fxx 0/1 ContainerCreating 0 33h myapp-deploy-66cfdc5675-c7fxx 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 1/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 Pending 0 33h myapp-deploy-66cfdc5675-xj5qq 0/1 ContainerCreating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-lqm77 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-66cfdc5675-xj5qq 1/1 Running 0 33h myapp-deploy-74fb9bdf9b-slfst 1/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-rd4nf 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h myapp-deploy-74fb9bdf9b-slfst 0/1 Terminating 0 33h 查看滚动更新后历史版本和现在运行版本 [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-66cfdc5675 3 3 3 100s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 0 0 0 16m myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary 4.6、kubectl get svc：获取service信息 [root@master yaml]# kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE kubernetes ClusterIP 10.96.0.1 &lt;none&gt; 443/TCP 3d5h 5、kubectl label：操作标签 用法：kubectl label [--overwrite] (-f FILENAME | TYPE NAME) KEY_1=VAL_1 ... KEY_N=VAL_N [--resource-version=version] 5.1、给一个pod打一个没有存在的标签key=value， [root@master yaml]# kubectl label pods pod-demo release=canary pod/pod-demo labeled [root@master yaml]# kubectl get pods pod-demo --show-labels NAME READY STATUS RESTARTS AGE LABELS pod-demo 2/2 Running 0 33m apps=myapp,release=canary,tier=frontend 5.2、给一个pod已经存在的标签重新赋值 [root@master yaml]# kubectl label pods pod-demo release=stable error: &#39;release&#39; already has a value (canary), and --overwrite is false [root@master yaml]# kubectl label pods pod-demo release=stable --overwrite pod/pod-demo labeled 6、kubectl describe：查看资源的详细信息 用法：kubectl describe (-f FILENAME | TYPE [NAME_PREFIX | -l label] | TYPE/NAME) [options] 6.1、查看某个pod的详细信息 [root@master yaml]# kubectl describe pods pod-demo Name: pod-demo Namespace: default Priority: 0 PriorityClassName: &lt;none&gt; Node: node1/192.168.10.148 Start Time: Tue, 30 Jul 2019 18:17:38 +0800 Labels: apps=myapp tier=frontend Annotations: &lt;none&gt; Status: Running IP: 10.244.1.14 7、kubectl delete：删除资源 用法：kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)]) [options] 7.1、删除pods资源 [root@master yaml]# kubectl get pods NAME READY STATUS RESTARTS AGE myapp-l9pbb 1/1 Running 0 7m1s myapp-nlw6m 1/1 Running 0 10m myapp-ppktd 1/1 Running 0 10m myapp-wmbnc 1/1 Running 0 28m myapp-wpfpn 1/1 Running 0 10m [root@master yaml]# kubectl delete pods myapp-l9pbb pod &quot;myapp-l9pbb&quot; deleted [root@master yaml]# 7.2、删除service [root@master yaml]# kubectl delete svc redis service &quot;redis&quot; deleted 8、kubectl edit：修改资源的yaml清单内容 用法：kubectl edit (RESOURCE/NAME | -f FILENAME) [options] 8.1、修改ReplicaSet控制器的yaml清单内容 注意：修改容器版本，不会自动更新（手动删除pod后自动更新：灰度发布） [root@master yaml]# kubectl edit rs myapp replicaset.extensions/myapp edited 9、kubectl exec：类似docker exec，进入容器 用法：kubectl exec POD [-c CONTAINER] -- COMMAND [args...] [options] 9.1、进入pod内的容器 [root@master yaml]# kubectl exec -it myapp-lmj45 -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 9.2、进入pod内指定容器 用法：kubectl exec -it pod-name -c container-name -- /bin/sh [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # exit [root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container -- /bin/sh / # ls bin dev etc home lib media mnt proc root run sbin srv sys tmp usr var / # 10、kubectl logs：类似于docker logs，查看容器日志 用法：kubectl logs [-f] [-p] (POD | TYPE/NAME) [-c CONTAINER] [options] 10.1、查看pod内的容器日志 [root@master yaml]# kubectl logs myapp-lmj45 --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.2、查看pod内指定容器的日志 [root@master yaml]# kubectl logs myapp-lmj45 -c myapp-container --tail 300 -f 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] &quot;GET / HTTP/1.1&quot; 200 65 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 11、kubectl explain 用法：kubectl explain RESOURCE [options] 11.1、查看pod资源清单字段 [root@master ~]# kubectl explain pod KIND: Pod VERSION: v1 DESCRIPTION: Pod is a collection of containers that can run on a host. This resource is created by clients and scheduled onto hosts. FIELDS: apiVersion &lt;string&gt; ..... 11.2、查看pod资源清单理metadata字段下的字段（以此类推） [root@master ~]# kubectl explain pod.metadata KIND: Pod VERSION: v1 RESOURCE: metadata &lt;Object&gt; DESCRIPTION: Standard object&#39;s metadata. More info: https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata ObjectMeta is metadata that all persisted resources must have, which includes all objects users must create. FIELDS: annotations &lt;map[string]string&gt; ..... 11.3、查看ReplicaSet资源清单字段 [root@master yaml]# kubectl explain rs KIND: ReplicaSet VERSION: extensions/v1beta1 DESCRIPTION: DEPRECATED - This group version of ReplicaSet is deprecated by apps/v1beta2/ReplicaSet. See the release notes for more information. ReplicaSet ensures that a specified number of pod replicas are running at any given time. FIELDS: apiVersion &lt;string&gt; APIVersion defines the versioned schema of this representation of an object. Servers should convert recognized schemas to the latest internal value, and may reject unrecognized values. More info: ..... 12、kubectl rollout：管理资源的部署 用法：kubectl rollout SUBCOMMAND [options] 类型： deployments daemonsets statefulsets 12.1、查看deployment滚动更新历史版本 [root@master yaml]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 12.2、更新一个pod后暂停更新 [root@master yaml]# kubectl rollout pause deployment myapp-deploy deployment.extensions/myapp-deploy paused [root@master ~]# kubectl get pods -l app=myapp -w NAME READY STATUS RESTARTS AGE myapp-deploy-66cfdc5675-cnm4m 1/1 Running 0 12s myapp-deploy-66cfdc5675-jzghg 1/1 Running 0 12s myapp-deploy-66cfdc5675-zkc94 1/1 Running 0 12s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 Pending 0 0s myapp-deploy-668ff4dc58-fq6hp 0/1 ContainerCreating 0 0s myapp-deploy-668ff4dc58-fq6hp 1/1 Running 0 9s 12.3、解除暂停状态，继续更新 [root@master yaml]# kubectl rollout resume deployment myapp-deploy deployment.extensions/myapp-deploy resumed [root@master yaml]# kubectl rollout status deployment myapp-deploy deployment &quot;myapp-deploy&quot; successfully rolled out 12.4、回滚到指定版本 [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 1 &lt;none&gt; 2 &lt;none&gt; 3 &lt;none&gt; [root@master yaml]# kubectl rollout undo deployment myapp-deploy --to-revision=1 deployment.extensions/myapp-deploy rolled back [root@master yaml]# kubectl get rs -o wide NAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTOR myapp-deploy-668ff4dc58 0 0 0 4m myapp ikubernetes/myapp:v3 app=myapp,pod-template-hash=668ff4dc58,release=canary myapp-deploy-66cfdc5675 0 0 0 4m23s myapp ikubernetes/myapp:v2 app=myapp,pod-template-hash=66cfdc5675,release=canary myapp-deploy-74fb9bdf9b 5 5 5 5m8s myapp ikubernetes/myapp:v1 app=myapp,pod-template-hash=74fb9bdf9b,release=canary [root@master ~]# kubectl rollout history deployment myapp-deploy deployment.extensions/myapp-deploy REVISION CHANGE-CAUSE 2 &lt;none&gt; 3 &lt;none&gt; 4 &lt;none&gt; 12.5、监控deployment更新状态 [root@master yaml]# kubectl rollout status deployment myapp-deploy Waiting for deployment &quot;myapp-deploy&quot; rollout to finish: 1 out of 3 new replicas have been updated... kubectl patch 用法：kubectl patch (-f FILENAME | TYPE NAME) -p PATCH [options] 修改deployment副本数 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;replicas&quot;:5}}&#39; deployment.extensions/myapp-deploy patched 修改deployment滚动更新策略 [root@master yaml]# kubectl patch deployment myapp-deploy -p &#39;{&quot;spec&quot;:{&quot;strategy&quot;:{&quot;rollingUpdate&quot;:{&quot;maxSurge&quot;:1,&quot;maxUnavailable&quot;:0}}}}&#39; deployment.extensions/myapp-deploy patched [root@master yaml]# kubectl describe deployments myapp-deploy Name: myapp-deploy Namespace: default CreationTimestamp: Fri, 02 Aug 2019 01:33:47 +0800 Labels: app=myapp release=canary Annotations: deployment.kubernetes.io/revision: 2 kubectl.kubernetes.io/last-applied-configuration: {&quot;apiVersion&quot;:&quot;apps/v1&quot;,&quot;kind&quot;:&quot;Deployment&quot;,&quot;metadata&quot;:{&quot;annotations&quot;:{},&quot;name&quot;:&quot;myapp-deploy&quot;,&quot;namespace&quot;:&quot;default&quot;},&quot;spec&quot;:{&quot;replicas&quot;:3... Selector: app=myapp,release=canary Replicas: 5 desired | 5 updated | 5 total | 5 available | 0 unavailable StrategyType: RollingUpdate MinReadySeconds: 0 RollingUpdateStrategy: 0 max unavailable, 1 max surge #已经修改 ..... kubectl set 用法：kubectl set SUBCOMMAND [options] kubectl set image 用法：kubectl set image (-f FILENAME | TYPE NAME) CONTAINER_NAME_1=CONTAINER_IMAGE_1 ... CONTAINER_NAME_N=CONTAINER_IMAGE_N [options] 修改deployment的镜像版本 [root@master yaml]# kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 deployment.extensions/myapp-deploy image updated 修改daemonset的镜像版本 [root@master yaml]# kubectl set image daemonsets filebeat-ds filebeat=ikubernetes/filebeat:5.6.6-alpine daemonset.extensions/filebeat-ds image updated kubectl cluster-info：查看集群信息 [root@master ~]# kubectl cluster-info Kubernetes master is running at https://192.168.10.48:6443 KubeDNS is running at https://192.168.10.48:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy To further debug and diagnose cluster problems, use &#39;kubectl cluster-info dump&#39;. kubectl api-versions：查询 Kubernetes API 支持的 API 版本 [root@master ~]# kubectl api-versions admissionregistration.k8s.io/v1beta1 apiextensions.k8s.io/v1beta1 apiregistration.k8s.io/v1 apiregistration.k8s.io/v1beta1 apps/v1 apps/v1beta1 apps/v1beta2 ..... kubectl api-resources：查看k8s支持的资源类型 [root@master ~]# kubectl api-resources NAME SHORTNAMES APIGROUP NAMESPACED KIND bindings true Binding componentstatuses cs false ComponentStatus configmaps cm true ConfigMap endpoints ep true Endpoints events ev true Event limitranges limits true LimitRange namespaces ns false Namespace nodes no false Node 查看指定群组支持的资源类型 [root@master ~]# kubectl api-resources --api-group=storage.k8s.io NAME SHORTNAMES APIGROUP NAMESPACED KIND csidrivers storage.k8s.io false CSIDriver csinodes storage.k8s.io false CSINode storageclasses sc storage.k8s.io false StorageClass volumeattachments storage.k8s.io false VolumeAttachment","@type":"BlogPosting","url":"https://uzzz.org/2019/08/03/792469.html","headline":"k8s核心组件—-kubectl使用","dateModified":"2019-08-03T00:00:00+08:00","datePublished":"2019-08-03T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/08/03/792469.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>k8s核心组件----kubectl使用</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-tomorrow-night"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p></p>
  <div class="toc">
   <h3>文章目录</h3>
   <ul>
    <li><a href="#kubectl_1" rel="nofollow" data-token="bbbd80f866d171d34a7dc1c0edb5d341">一、kubectl简介</a></li>
    <li><a href="#_10" rel="nofollow" data-token="7732e26b14f783ad3f0d12485444ba2e">二、命令行自动补全配置</a></li>
    <li><a href="#kubectl_27" rel="nofollow" data-token="fb0fa6de38fa399dab9a1c5106da804c">三、kubectl常用命令总结</a></li>
    <ul>
     <li><a href="#1kubectl_version_client__server__28" rel="nofollow" data-token="5d8038ff5aeaf4b09bb0fed6b602693c">1、kubectl version：输出 client 和 server 的版本信息</a></li>
     <li><a href="#2kubectl_run_34" rel="nofollow" data-token="27af0c0c5fd4e45b0b22d5a325b545d0">2、kubectl run</a></li>
     <ul>
      <li><a href="#21nginx280nginx_37" rel="nofollow" data-token="a952421895a8f4a9d109a1290bfdc067">2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器</a></li>
     </ul>
     <li><a href="#3kubectl_create_43" rel="nofollow" data-token="e12eebf9ca62f6768ddb501fa0e37b10">3、kubectl create</a></li>
     <ul>
      <li><a href="#31dashboardyaml_45" rel="nofollow" data-token="2b2c35785240e0450696f9e7540f03a7">3.1、创建dashboard通过yaml文件</a></li>
      <li><a href="#32namespace_56" rel="nofollow" data-token="c9a9a186a74c20ba1f8dbb9f74a72437">3.2、创建namespace</a></li>
     </ul>
     <li><a href="#4kubectl_get_61" rel="nofollow" data-token="cbb5786838fd007e9d66eded84adec0a">4、kubectl get：显示一个或多个资源</a></li>
     <ul>
      <li><a href="#41kubectl_get_nodes_64" rel="nofollow" data-token="8b9b6c8608a8523939c05173085dcca3">4.1、kubectl get nodes</a></li>
      <ul>
       <li><a href="#411_65" rel="nofollow" data-token="8d0161e3ae422d96955e6528b8837c98">4.1.1、获取节点信息</a></li>
       <li><a href="#412_72" rel="nofollow" data-token="60b039d21e63bde5f62e6cb5eb55cd74">4.1.2、获取节点详细信息</a></li>
       <li><a href="#413_79" rel="nofollow" data-token="4a3e9afc75a8a88afed01d73f14b7b77">4.1.3、获取节点标签</a></li>
       <li><a href="#414_86" rel="nofollow" data-token="79bdfa77338f11def4bcf3d220c99c1a">4.1.4、给节点打标签</a></li>
      </ul>
      <li><a href="#42kubectl_get_pods_91" rel="nofollow" data-token="3e917b8a39dc4f3de7d75b79a96f7d32">4.2、kubectl get pods</a></li>
      <ul>
       <li><a href="#421namespacePodndefault_92" rel="nofollow" data-token="13787d7d05da360f076be35e651779e2">4.2.1、获取指定namespace的Pod信息（不加-n默认获取default）</a></li>
       <li><a href="#422namespacePod_99" rel="nofollow" data-token="2e73b0f2116196e3c3187e5d7e833d2b">4.2.2、获取所有namespace的Pod信息</a></li>
       <li><a href="#423Pod_118" rel="nofollow" data-token="e7e5d17f93a90d6c8d3bb197b34d5ffb">4.2.3、获取Pod的详细信息</a></li>
       <li><a href="#424Podlabels_132" rel="nofollow" data-token="64508438e74c8dc288fa4c3ba7db6455">4.2.4、获取Pod的labels</a></li>
       <li><a href="#425podkeyvalue_141" rel="nofollow" data-token="e073fc030725b927aeacc09f1610f649">4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白</a></li>
       <li><a href="#426keypod_149" rel="nofollow" data-token="dcf22ff910a5105d3e02bf720ccc3808">4.2.6、获取含有指定标签key的pod</a></li>
       <li><a href="#427keyvaluepod_155" rel="nofollow" data-token="d645e60a49a6677f44309b5e683d1511">4.2.7、获取含有指定标签key=value的pod</a></li>
       <li><a href="#428keyvaluepodinnotin_162" rel="nofollow" data-token="1ba35c18ec6812436ee9a2b31652fc7a">4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合）</a></li>
       <li><a href="#427podIP_177" rel="nofollow" data-token="801cff7c2f23d21f90d4bc2d7c1694fa">4.2.7、获取podIP</a></li>
       <li><a href="#_183" rel="nofollow"></a></li>
      </ul>
      <li><a href="#43kubectl_get_namespacesnamespace_184" rel="nofollow" data-token="1813386bee7869405fffca4c56e7f3c0">4.3、kubectl get namespaces：获取namespace信息</a></li>
      <ul>
       <li><a href="#431namespace_185" rel="nofollow" data-token="0049f140cd5498a86a5e71fbce223566">4.3.1、获取所有namespace信息</a></li>
       <li><a href="#432namespace_194" rel="nofollow" data-token="8e4192719d1c3e022e49dd02931971b7">4.3.2、获取指定namespace信息</a></li>
       <li><a href="#433namespaceyaml_200" rel="nofollow" data-token="d80327acb390839bbf3443bf9eb68a4e">4.3.3、获取指定namespace的yaml格式信息</a></li>
       <li><a href="#434namespacejson_217" rel="nofollow" data-token="618fa8ab9f2ec6277d94d0cfb0753aaa">4.3.4、获取指定namespace的json格式信息</a></li>
      </ul>
      <li><a href="#44kubectl_get_rsReplicaSet_240" rel="nofollow" data-token="28d9e11d4e3ee527eb660850cf37fdad">4.4、kubectl get rs：获取ReplicaSet控制器信息</a></li>
      <li><a href="#45kubectl_get_deploy__kubectl_get_deployment_246" rel="nofollow" data-token="54b25ab2f5052efaf0b0d32365acaff5">4.5、kubectl get deploy &amp;&amp; kubectl get deployment</a></li>
      <ul>
       <li><a href="#451Deployment_247" rel="nofollow" data-token="6ee0f0891f7eac4b779f8996174e6f64">4.5.1、获取Deployment控制器信息</a></li>
       <li><a href="#452ReplicaSetrsmyappdeploy74fb9bdf9bdeploymyappdeploypodmyappdeploy74fb9bdf9brd4nf_258" rel="nofollow" data-token="4cea6f007cdf38aea03785cbace33c0e">4.5.2、与ReplicaSet的联系。`rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf`</a></li>
       <li><a href="#453_270" rel="nofollow" data-token="648289355f27b8b42bc60aebddf4237e">4.5.3、滚动更新</a></li>
      </ul>
      <li><a href="#46kubectl_get_svcservice_315" rel="nofollow" data-token="4127807b458dbcd2ac803c7f4597ee58">4.6、kubectl get svc：获取service信息</a></li>
     </ul>
     <li><a href="#5kubectl_label_321" rel="nofollow" data-token="d91da90fd1a2e10c4456646e8b139078">5、kubectl label：操作标签</a></li>
     <ul>
      <li><a href="#51podkeyvalue_323" rel="nofollow" data-token="18b30c6c697eb4d33018c394b62d25b4">5.1、给一个pod打一个没有存在的标签key=value，</a></li>
      <li><a href="#52pod_331" rel="nofollow" data-token="3278df07054f94d0d254a3a2956fd974">5.2、给一个pod已经存在的标签重新赋值</a></li>
     </ul>
     <li><a href="#6kubectl_describe_338" rel="nofollow" data-token="0e9923179acaf03e2c934e149dabb182">6、kubectl describe：查看资源的详细信息</a></li>
     <ul>
      <li><a href="#61pod_340" rel="nofollow" data-token="0ab1de8ee50d874e7d17e474e7fbda60">6.1、查看某个pod的详细信息</a></li>
     </ul>
     <li><a href="#7kubectl_delete_355" rel="nofollow" data-token="2876846828cb58303e72da9196aa0803">7、kubectl delete：删除资源</a></li>
     <ul>
      <li><a href="#71pods_357" rel="nofollow" data-token="c961b67fb3626441590522b308bf7972">7.1、删除pods资源</a></li>
      <li><a href="#72service_370" rel="nofollow" data-token="1149ee54fb39b4cc34ffc8ae1c067f5b">7.2、删除service</a></li>
     </ul>
     <li><a href="#8kubectl_edityaml_375" rel="nofollow" data-token="b83f30c356e59498c1f0d12c7be8a2b8">8、kubectl edit：修改资源的yaml清单内容</a></li>
     <ul>
      <li><a href="#81ReplicaSetyaml_377" rel="nofollow" data-token="4ef04f81d2b470bba61e95c56656f853">8.1、修改ReplicaSet控制器的yaml清单内容</a></li>
     </ul>
     <li><a href="#9kubectl_execdocker_exec_383" rel="nofollow" data-token="8bb901e7c9d8f4f5e536d179f6ee9e1a">9、kubectl exec：类似docker exec，进入容器</a></li>
     <ul>
      <li><a href="#91pod_385" rel="nofollow" data-token="fe5f86268865c96f779c20f21011af1f">9.1、进入pod内的容器</a></li>
      <li><a href="#92pod_396" rel="nofollow" data-token="f51b26936941976ba01396eeb93ad05b">9.2、进入pod内指定容器</a></li>
     </ul>
     <li><a href="#10kubectl_logsdocker_logs_408" rel="nofollow" data-token="048c72b09d19ef0ecd9f2201edae7f40">10、kubectl logs：类似于docker logs，查看容器日志</a></li>
     <ul>
      <li><a href="#101pod_410" rel="nofollow" data-token="c621f78b1cf695767c082af8fa06c6f5">10.1、查看pod内的容器日志</a></li>
      <li><a href="#102pod_419" rel="nofollow" data-token="6697010a6da437c66534625731e06222">10.2、查看pod内指定容器的日志</a></li>
     </ul>
     <li><a href="#11kubectl_explain_428" rel="nofollow" data-token="7c344b8da1c1c21c07f40071344e1db1">11、kubectl explain</a></li>
     <ul>
      <li><a href="#111pod_430" rel="nofollow" data-token="e4da2e53dd1e77c860e605d3fe596e39">11.1、查看pod资源清单字段</a></li>
      <li><a href="#112podmetadata_444" rel="nofollow" data-token="95654e0cb74f74213391b150168f1acb">11.2、查看pod资源清单理metadata字段下的字段（以此类推）</a></li>
      <li><a href="#113ReplicaSet_460" rel="nofollow" data-token="f421b01d15e29893ba144d61713cff52">11.3、查看ReplicaSet资源清单字段</a></li>
     </ul>
     <li><a href="#12kubectl_rollout_479" rel="nofollow" data-token="c6cf383b5b7a74642829d6de561815c9">12、kubectl rollout：管理资源的部署</a></li>
     <ul>
      <li><a href="#121deployment_486" rel="nofollow" data-token="fe5f0269dd17ed27e09d3cb677ec6f13">12.1、查看deployment滚动更新历史版本</a></li>
      <ul>
       <li><a href="#122pod_494" rel="nofollow" data-token="6e3a0db502289e954bc428e539890cc0">12.2、更新一个pod后暂停更新</a></li>
       <li><a href="#123_509" rel="nofollow" data-token="b69752f83d87d6e280eb0e33f5f91f8a">12.3、解除暂停状态，继续更新</a></li>
       <li><a href="#124_516" rel="nofollow" data-token="9ebe366b55a2fb6794fbd337d49b4b55">12.4、回滚到指定版本</a></li>
       <li><a href="#125deployment_538" rel="nofollow" data-token="ce1513a2a5c5b9de011a46b02c05790d">12.5、监控deployment更新状态</a></li>
      </ul>
     </ul>
     <li><a href="#kubectl_patch_544" rel="nofollow" data-token="09cf133f8031d4f187e4fd739482dad6">kubectl patch</a></li>
     <ul>
      <li><a href="#deployment_546" rel="nofollow" data-token="dde7e2674614717c7f988e0e680cf288">修改deployment副本数</a></li>
      <li><a href="#deployment_551" rel="nofollow" data-token="f3e8210473e8bf301f0fc3675ae4a1ca">修改deployment滚动更新策略</a></li>
     </ul>
     <li><a href="#kubectl_set_571" rel="nofollow" data-token="4191d8f7bdc699d1f75923e5d1dee5a4">kubectl set</a></li>
     <ul>
      <li><a href="#kubectl_set_image_573" rel="nofollow" data-token="954736f73fdf1b6ea34e4d944cf97864">kubectl set image</a></li>
      <ul>
       <li><a href="#deployment_575" rel="nofollow" data-token="2bfec1e12aec8d3215e643fae20b8503">修改deployment的镜像版本</a></li>
       <li><a href="#daemonset_580" rel="nofollow" data-token="7e0920e4c7fd6ba4d04852d26896b195">修改daemonset的镜像版本</a></li>
      </ul>
     </ul>
     <li><a href="#kubectl_clusterinfo_585" rel="nofollow" data-token="bd4d02579df7fd1a3a1e3eac37883838">kubectl cluster-info：查看集群信息</a></li>
     <li><a href="#kubectl_apiversions_Kubernetes_API__API__593" rel="nofollow" data-token="215d0e9c581d9d5a3ac451cd5b7a338d">kubectl api-versions：查询 Kubernetes API 支持的 API 版本</a></li>
     <li><a href="#kubectl_apiresourcesk8s_605" rel="nofollow" data-token="af3721f32d877e46d07fa1bea9637862">kubectl api-resources：查看k8s支持的资源类型</a></li>
     <ul>
      <li><a href="#_618" rel="nofollow" data-token="20071849696728ed81052693420954f6">查看指定群组支持的资源类型</a></li>
     </ul>
    </ul>
   </ul>
  </div>
  <p></p> 
  <h1><a id="kubectl_1"></a>一、kubectl简介</h1> 
  <p>kubectl 是 Kubernetes 的命令行工具（CLI），是 Kubernetes 用户和管理员必备的管理工具。</p> 
  <p>kubectl 提供了大量的子命令，方便管理 Kubernetes 集群中的各种功能。以下是查看子命令的帮助命令：</p> 
  <ul> 
   <li>kubectl -h：查看子命令列表</li> 
   <li>kubectl options：查看全局选项</li> 
   <li>kubectl --help：查看子命令的帮助</li> 
   <li>kubectl [command] [PARAMS] -o=：设置输出格式（如 json、yaml、jsonpath 等）</li> 
   <li>kubectl explain [RESOURCE]：查看资源的定义</li> 
  </ul> 
  <h1><a id="_10"></a>二、命令行自动补全配置</h1> 
  <p>为了方便练习k8s常用命令使用，配置命令行自动补全</p> 
  <pre><code>Centos
yum install -y bash-completion
source /usr/share/bash-completion/bash_completion
source &lt;(kubectl completion bash)
echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc

Ubuntu
curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.14.2/bin/linux/amd64/kubectl
chmod +x kubectl 
mv kubectl  /usr/local/bin/
sudo mv kubectl  /usr/local/bin/
source &lt;(kubectl completion bash)
echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc
</code></pre> 
  <h1><a id="kubectl_27"></a>三、kubectl常用命令总结</h1> 
  <h2><a id="1kubectl_version_client__server__28"></a>1、kubectl version：输出 client 和 server 的版本信息</h2> 
  <pre><code>[root@master ~]# kubectl version 
Client Version: version.Info{Major:"1", Minor:"14", GitVersion:"v1.14.2", GitCommit:"66049e3b21efe110454d67df4fa62b08ea79a19b", GitTreeState:"clean", BuildDate:"2019-05-16T16:23:09Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"14", GitVersion:"v1.14.2", GitCommit:"66049e3b21efe110454d67df4fa62b08ea79a19b", GitTreeState:"clean", BuildDate:"2019-05-16T16:14:56Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}
</code></pre> 
  <h2><a id="2kubectl_run_34"></a>2、kubectl run</h2> 
  <p>用法：<code>kubectl run NAME --image=image [--env="key=value"] [--port=port] [--replicas=replicas] [--dry-run=bool] [--overrides=inline-json] [--command] -- [COMMAND] [args...] [options]</code></p> 
  <h3><a id="21nginx280nginx_37"></a>2.1、创建一个镜像为nginx、副本为2、暴露端口为80的nginx容器</h3> 
  <pre><code>[root@master ~]# kubectl run nginx --image=nginx --replicas=2 --port=80
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/nginx created
</code></pre> 
  <h2><a id="3kubectl_create_43"></a>3、kubectl create</h2> 
  <p>用法：<code>kubectl create -f FILENAME [options]</code></p> 
  <h3><a id="31dashboardyaml_45"></a>3.1、创建dashboard通过yaml文件</h3> 
  <p>可以参考我的另一篇文章：<a href="https://blog.csdn.net/cyfblog/article/details/97761406" rel="nofollow" data-token="5f11040f4183654d6dd5c29509edab0a">k8s UI组件----Kubernetes Dashboard</a></p> 
  <pre><code>[root@master yaml]# kubectl create -f kubernetes-dashboard.yaml 
secret/kubernetes-dashboard-certs created
serviceaccount/kubernetes-dashboard created
role.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created
rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard-minimal created
deployment.apps/kubernetes-dashboard created
service/kubernetes-dashboard created
</code></pre> 
  <h3><a id="32namespace_56"></a>3.2、创建namespace</h3> 
  <pre><code>[root@master ~]# kubectl create namespace cyf
namespace/cyf created
</code></pre> 
  <h2><a id="4kubectl_get_61"></a>4、kubectl get：显示一个或多个资源</h2> 
  <p>用法：<code>kubectl get [(-o|--output=)json|yaml|wide|custom-columns=...|custom-columns-file=...|go-template=...|go-template-file=...|jsonpath=...|jsonpath-file=...] (TYPE[.VERSION][.GROUP] [NAME | -l label] | TYPE[.VERSION][.GROUP]/NAME ...) [flags] [options]</code></p> 
  <h3><a id="41kubectl_get_nodes_64"></a>4.1、kubectl get nodes</h3> 
  <h4><a id="411_65"></a>4.1.1、获取节点信息</h4> 
  <pre><code>[root@master ~]# kubectl get nodes
NAME     STATUS   ROLES    AGE   VERSION
master   Ready    master   16h   v1.14.2
node1    Ready    worker   16h   v1.14.2
</code></pre> 
  <h4><a id="412_72"></a>4.1.2、获取节点详细信息</h4> 
  <pre><code>[root@master ~]# kubectl get nodes -o wide
NAME     STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION          CONTAINER-RUNTIME
master   Ready    master   16h   v1.14.2   192.168.10.48    &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.el7.x86_64   docker://19.3.1
node1    Ready    worker   16h   v1.14.2   192.168.10.148   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.el7.x86_64   docker://19.3.1
</code></pre> 
  <h4><a id="413_79"></a>4.1.3、获取节点标签</h4> 
  <pre><code>[root@master ~]# kubectl get nodes --show-labels 
NAME     STATUS   ROLES    AGE   VERSION   LABELS
master   Ready    master   2d    v1.14.2   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=master,kubernetes.io/os=linux,node-role.kubernetes.io/master=
node1    Ready    worker   2d    v1.14.2   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=node1,kubernetes.io/os=linux,node-role.kubernetes.io/worker=worker
</code></pre> 
  <h4><a id="414_86"></a>4.1.4、给节点打标签</h4> 
  <pre><code>[root@master ~]# kubectl label nodes node1 disktype=ssd
node/node1 labeled
</code></pre> 
  <h3><a id="42kubectl_get_pods_91"></a>4.2、kubectl get pods</h3> 
  <h4><a id="421namespacePodndefault_92"></a>4.2.1、获取指定namespace的Pod信息（不加-n默认获取default）</h4> 
  <pre><code>[root@master ~]# kubectl get pods -n default 
NAME                     READY   STATUS    RESTARTS   AGE
nginx-755464dd6c-b56mr   1/1     Running   0          52s
nginx-755464dd6c-ggwzv   1/1     Running   0          52s
</code></pre> 
  <h4><a id="422namespacePod_99"></a>4.2.2、获取所有namespace的Pod信息</h4> 
  <pre><code>[root@master ~]# kubectl get pods --all-namespaces
[root@master ~]# kubectl get pods -A
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE
default       nginx-755464dd6c-b56mr                  1/1     Running   0          3m12s
default       nginx-755464dd6c-ggwzv                  1/1     Running   0          3m12s
kube-system   coredns-fb8b8dccf-b9cwb                 1/1     Running   1          17h
kube-system   coredns-fb8b8dccf-qcdv2                 1/1     Running   1          17h
kube-system   etcd-master                             1/1     Running   1          17h
kube-system   kube-apiserver-master                   1/1     Running   1          17h
kube-system   kube-controller-manager-master          1/1     Running   1          17h
kube-system   kube-flannel-ds-amd64-4kn7q             1/1     Running   1          17h
kube-system   kube-flannel-ds-amd64-xpd8f             1/1     Running   1          17h
kube-system   kube-proxy-htdpc                        1/1     Running   1          17h
kube-system   kube-proxy-q49ff                        1/1     Running   1          17h
kube-system   kube-scheduler-master                   1/1     Running   1          17h
kube-system   kubernetes-dashboard-6c98b7f57c-q6zp7   1/1     Running   1          16h
</code></pre> 
  <h4><a id="423Pod_118"></a>4.2.3、获取Pod的详细信息</h4> 
  <pre><code>[root@master ~]# kubectl get pods -o wide
NAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    NOMINATED NODE   READINESS GATES
nginx-755464dd6c-b56mr   1/1     Running   0          5m31s   10.244.1.11   node1   &lt;none&gt;           &lt;none&gt;
nginx-755464dd6c-ggwzv   1/1     Running   0          5m31s   10.244.1.10   node1   &lt;none&gt;           &lt;none&gt;
[root@master ~]# kubectl get pods -A -o wide
NAMESPACE     NAME                                    READY   STATUS    RESTARTS   AGE    IP               NODE     NOMINATED NODE   READINESS GATES
default       nginx-755464dd6c-b56mr                  1/1     Running   0          6m4s   10.244.1.11      node1    &lt;none&gt;           &lt;none&gt;
default       nginx-755464dd6c-ggwzv                  1/1     Running   0          6m4s   10.244.1.10      node1    &lt;none&gt;           &lt;none&gt;
kube-system   coredns-fb8b8dccf-b9cwb                 1/1     Running   1          17h    10.244.1.9       node1    &lt;none&gt;           &lt;none&gt;
kube-system   coredns-fb8b8dccf-qcdv2                 1/1     Running   1          17h    10.244.1.8       node1    &lt;none&gt;           &lt;none&gt;
......
</code></pre> 
  <h4><a id="424Podlabels_132"></a>4.2.4、获取Pod的labels</h4> 
  <pre><code>[root@master ~]# kubectl get pods --show-labels 
NAME                     READY   STATUS    RESTARTS   AGE   LABELS
nginx-755464dd6c-b56mr   1/1     Running   0          27h   pod-template-hash=755464dd6c,run=nginx
nginx-755464dd6c-ggwzv   1/1     Running   0          27h   pod-template-hash=755464dd6c,run=nginx
pod-demo                 2/2     Running   0          58s   apps=myapp,tier=frontend

</code></pre> 
  <h4><a id="425podkeyvalue_141"></a>4.2.5、查看所有pod对于指定标签的key是否有value，有则显示，没有则空白</h4> 
  <pre><code>[root@master yaml]# kubectl get pods -L apps,run
NAME                     READY   STATUS    RESTARTS   AGE   APPS    RUN
nginx-755464dd6c-b56mr   1/1     Running   0          27h           nginx
nginx-755464dd6c-ggwzv   1/1     Running   0          27h           nginx
pod-demo                 2/2     Running   0          15m   myapp
</code></pre> 
  <h4><a id="426keypod_149"></a>4.2.6、获取含有指定标签key的pod</h4> 
  <pre><code>[root@master yaml]# kubectl get pods -l apps --show-labels 
NAME       READY   STATUS    RESTARTS   AGE    LABELS
pod-demo   2/2     Running   0          112s   apps=myapp,tier=frontend
</code></pre> 
  <h4><a id="427keyvaluepod_155"></a>4.2.7、获取含有指定标签key=value的pod</h4> 
  <p>等值关系：<code>=</code>和<code>!=</code></p> 
  <pre><code>[root@master yaml]# kubectl get pods -l release=stable --show-labels 
NAME       READY   STATUS    RESTARTS   AGE   LABELS
pod-demo   2/2     Running   0          39m   apps=myapp,release=stable,tier=frontend
</code></pre> 
  <h4><a id="428keyvaluepodinnotin_162"></a>4.2.8、获取标签key的value在（不在）集合中的pod（in表示在集合，notin表示不在集合）</h4> 
  <p>集合关系：<br> <code>key in （value1，value2...）</code><br> <code>key notin （value1，value2...）</code><br> <code>key</code><br> <code>!key</code></p> 
  <pre><code>[root@master yaml]# kubectl get pods -l "release in (canary,beta,alpha)"
NAME                     READY   STATUS    RESTARTS   AGE
nginx-755464dd6c-ggwzv   1/1     Running   0          28h
[root@master yaml]# kubectl get pods -l "release notin (canary,beta,alpha)"
NAME                     READY   STATUS    RESTARTS   AGE
nginx-755464dd6c-b56mr   1/1     Running   0          28h
pod-demo                 2/2     Running   0          53m
</code></pre> 
  <h4><a id="427podIP_177"></a>4.2.7、获取podIP</h4> 
  <p>kubectl get pod pod-name -o jsonpath=’{.status.podIP}’</p> 
  <pre><code>[root@master ~]# kubectl get pods nginx-755464dd6c-b56mr -o jsonpath='{.status.podIP}'
10.244.1.11
</code></pre> 
  <h4><a id="_183"></a></h4> 
  <h3><a id="43kubectl_get_namespacesnamespace_184"></a>4.3、kubectl get namespaces：获取namespace信息</h3> 
  <h4><a id="431namespace_185"></a>4.3.1、获取所有namespace信息</h4> 
  <pre><code>[root@master ~]# kubectl get namespaces 
NAME              STATUS   AGE
default           Active   18h
kube-node-lease   Active   18h
kube-public       Active   18h
kube-system       Active   18h
</code></pre> 
  <h4><a id="432namespace_194"></a>4.3.2、获取指定namespace信息</h4> 
  <pre><code>[root@master ~]# kubectl get namespaces kube-system
NAME          STATUS   AGE
kube-system   Active   18h
</code></pre> 
  <h4><a id="433namespaceyaml_200"></a>4.3.3、获取指定namespace的yaml格式信息</h4> 
  <pre><code>[root@master ~]# kubectl get namespaces kube-system -o yaml
apiVersion: v1
kind: Namespace
metadata:
  creationTimestamp: "2019-07-29T09:28:58Z"
  name: kube-system
  resourceVersion: "10"
  selfLink: /api/v1/namespaces/kube-system
  uid: 4ad779da-b1e3-11e9-ac67-0800273a2eb7
spec:
  finalizers:
  - kubernetes
status:
  phase: Active
</code></pre> 
  <h4><a id="434namespacejson_217"></a>4.3.4、获取指定namespace的json格式信息</h4> 
  <pre><code>[root@master ~]# kubectl get namespaces kube-system -o json
{
    "apiVersion": "v1",
    "kind": "Namespace",
    "metadata": {
        "creationTimestamp": "2019-07-29T09:28:58Z",
        "name": "kube-system",
        "resourceVersion": "10",
        "selfLink": "/api/v1/namespaces/kube-system",
        "uid": "4ad779da-b1e3-11e9-ac67-0800273a2eb7"
    },
    "spec": {
        "finalizers": [
            "kubernetes"
        ]
    },
    "status": {
        "phase": "Active"
    }
}
</code></pre> 
  <h3><a id="44kubectl_get_rsReplicaSet_240"></a>4.4、kubectl get rs：获取ReplicaSet控制器信息</h3> 
  <pre><code>[root@master yaml]# kubectl get rs
NAME    DESIRED   CURRENT   READY   AGE
myapp   2         2         2       24s
</code></pre> 
  <h3><a id="45kubectl_get_deploy__kubectl_get_deployment_246"></a>4.5、kubectl get deploy &amp;&amp; kubectl get deployment</h3> 
  <h4><a id="451Deployment_247"></a>4.5.1、获取Deployment控制器信息</h4> 
  <pre><code>[root@master yaml]# kubectl get deploy
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
myapp-deploy   2/2     2            2           22s
nginx          1/1     1            1           19h
[root@master yaml]# kubectl get deployments
NAME           READY   UP-TO-DATE   AVAILABLE   AGE
myapp-deploy   2/2     2            2           22s
nginx          1/1     1            1           19h
</code></pre> 
  <h4><a id="452ReplicaSetrsmyappdeploy74fb9bdf9bdeploymyappdeploypodmyappdeploy74fb9bdf9brd4nf_258"></a>4.5.2、与ReplicaSet的联系。<code>rs名称：myapp-deploy-74fb9bdf9b，deploy名称：myapp-deploy，pod名称：myapp-deploy-74fb9bdf9b-rd4nf</code></h4> 
  <pre><code>[root@master yaml]# kubectl get rs 
NAME                      DESIRED   CURRENT   READY   AGE
myapp-deploy-74fb9bdf9b   2         2         2       48s
nginx-755464dd6c          1         1         1       19h
[root@master yaml]# kubectl get pods
NAME                            READY   STATUS    RESTARTS   AGE
myapp-deploy-74fb9bdf9b-rd4nf   1/1     Running   0          7m42s
myapp-deploy-74fb9bdf9b-slfst   1/1     Running   0          7m42s
nginx-755464dd6c-2pgbs          1/1     Running   0          19h
</code></pre> 
  <h4><a id="453_270"></a>4.5.3、滚动更新</h4> 
  <p>修改版本号后的滚动更新过程</p> 
  <pre><code>[root@master yaml]# kubectl get pods -w
NAME                            READY   STATUS    RESTARTS   AGE
myapp-deploy-74fb9bdf9b-rd4nf   1/1     Running   0          33h
myapp-deploy-74fb9bdf9b-slfst   1/1     Running   0          33h
nginx-755464dd6c-2pgbs          1/1     Running   0          2d4h
myapp-deploy-74fb9bdf9b-lqm77   0/1     Pending   0          33h
myapp-deploy-74fb9bdf9b-lqm77   0/1     Pending   0          33h
myapp-deploy-74fb9bdf9b-lqm77   0/1     ContainerCreating   0          33h
myapp-deploy-74fb9bdf9b-lqm77   1/1     Running             0          33h
myapp-deploy-66cfdc5675-g8dgm   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-g8dgm   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-g8dgm   0/1     ContainerCreating   0          33h
myapp-deploy-66cfdc5675-g8dgm   1/1     Running             0          33h
myapp-deploy-74fb9bdf9b-lqm77   1/1     Terminating         0          33h
myapp-deploy-66cfdc5675-c7fxx   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-c7fxx   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-c7fxx   0/1     ContainerCreating   0          33h
myapp-deploy-66cfdc5675-c7fxx   1/1     Running             0          33h
myapp-deploy-74fb9bdf9b-lqm77   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-rd4nf   1/1     Terminating         0          33h
myapp-deploy-66cfdc5675-xj5qq   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-xj5qq   0/1     Pending             0          33h
myapp-deploy-66cfdc5675-xj5qq   0/1     ContainerCreating   0          33h
myapp-deploy-74fb9bdf9b-lqm77   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-lqm77   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-rd4nf   0/1     Terminating         0          33h
myapp-deploy-66cfdc5675-xj5qq   1/1     Running             0          33h
myapp-deploy-74fb9bdf9b-slfst   1/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-rd4nf   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-rd4nf   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-slfst   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-slfst   0/1     Terminating         0          33h
myapp-deploy-74fb9bdf9b-slfst   0/1     Terminating         0          33h
</code></pre> 
  <p>查看滚动更新后历史版本和现在运行版本</p> 
  <pre><code>[root@master yaml]# kubectl get rs -o wide
NAME                      DESIRED   CURRENT   READY   AGE    CONTAINERS   IMAGES                 SELECTOR
myapp-deploy-66cfdc5675   3         3         3       100s   myapp        ikubernetes/myapp:v2   app=myapp,pod-template-hash=66cfdc5675,release=canary
myapp-deploy-74fb9bdf9b   0         0         0       16m    myapp        ikubernetes/myapp:v1   app=myapp,pod-template-hash=74fb9bdf9b,release=canary
</code></pre> 
  <h3><a id="46kubectl_get_svcservice_315"></a>4.6、kubectl get svc：获取service信息</h3> 
  <pre><code>[root@master yaml]# kubectl get svc
NAME         TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   3d5h
</code></pre> 
  <h2><a id="5kubectl_label_321"></a>5、kubectl label：操作标签</h2> 
  <p>用法：<code>kubectl label [--overwrite] (-f FILENAME | TYPE NAME) KEY_1=VAL_1 ... KEY_N=VAL_N [--resource-version=version]</code></p> 
  <h3><a id="51podkeyvalue_323"></a>5.1、给一个pod打一个没有存在的标签key=value，</h3> 
  <pre><code>[root@master yaml]# kubectl label pods pod-demo release=canary
pod/pod-demo labeled
[root@master yaml]# kubectl get pods pod-demo --show-labels 
NAME       READY   STATUS    RESTARTS   AGE   LABELS
pod-demo   2/2     Running   0          33m   apps=myapp,release=canary,tier=frontend
</code></pre> 
  <h3><a id="52pod_331"></a>5.2、给一个pod已经存在的标签重新赋值</h3> 
  <pre><code>[root@master yaml]# kubectl label pods pod-demo release=stable
error: 'release' already has a value (canary), and --overwrite is false
[root@master yaml]# kubectl label pods pod-demo release=stable --overwrite
pod/pod-demo labeled
</code></pre> 
  <h2><a id="6kubectl_describe_338"></a>6、kubectl describe：查看资源的详细信息</h2> 
  <p>用法：<code>kubectl describe (-f FILENAME | TYPE [NAME_PREFIX | -l label] | TYPE/NAME) [options]</code></p> 
  <h3><a id="61pod_340"></a>6.1、查看某个pod的详细信息</h3> 
  <pre><code>[root@master yaml]# kubectl describe pods pod-demo 
Name:               pod-demo
Namespace:          default
Priority:           0
PriorityClassName:  &lt;none&gt;
Node:               node1/192.168.10.148
Start Time:         Tue, 30 Jul 2019 18:17:38 +0800
Labels:             apps=myapp
                    tier=frontend
Annotations:        &lt;none&gt;
Status:             Running
IP:                 10.244.1.14
</code></pre> 
  <h2><a id="7kubectl_delete_355"></a>7、kubectl delete：删除资源</h2> 
  <p>用法：<code>kubectl delete ([-f FILENAME] | [-k DIRECTORY] | TYPE [(NAME | -l label | --all)]) [options]</code></p> 
  <h3><a id="71pods_357"></a>7.1、删除pods资源</h3> 
  <pre><code>[root@master yaml]# kubectl get pods
NAME          READY   STATUS    RESTARTS   AGE
myapp-l9pbb   1/1     Running   0          7m1s
myapp-nlw6m   1/1     Running   0          10m
myapp-ppktd   1/1     Running   0          10m
myapp-wmbnc   1/1     Running   0          28m
myapp-wpfpn   1/1     Running   0          10m
[root@master yaml]# kubectl delete pods myapp-l9pbb 
pod "myapp-l9pbb" deleted
[root@master yaml]# 
</code></pre> 
  <h3><a id="72service_370"></a>7.2、删除service</h3> 
  <pre><code>[root@master yaml]# kubectl delete svc redis 
service "redis" deleted
</code></pre> 
  <h2><a id="8kubectl_edityaml_375"></a>8、kubectl edit：修改资源的yaml清单内容</h2> 
  <p>用法：<code>kubectl edit (RESOURCE/NAME | -f FILENAME) [options]</code></p> 
  <h3><a id="81ReplicaSetyaml_377"></a>8.1、修改ReplicaSet控制器的yaml清单内容</h3> 
  <p>注意：修改容器版本，不会自动更新（手动删除pod后自动更新：灰度发布）</p> 
  <pre><code>[root@master yaml]# kubectl edit rs myapp 
replicaset.extensions/myapp edited
</code></pre> 
  <h2><a id="9kubectl_execdocker_exec_383"></a>9、kubectl exec：类似docker exec，进入容器</h2> 
  <p>用法：<code>kubectl exec POD [-c CONTAINER] -- COMMAND [args...] [options]</code></p> 
  <h3><a id="91pod_385"></a>9.1、进入pod内的容器</h3> 
  <pre><code>[root@master yaml]# kubectl exec -it myapp-lmj45 -- /bin/sh
/ # ls
bin    dev    etc    home   lib    media  mnt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ # exit
[root@master yaml]# kubectl exec -it myapp-lmj45 sh
/ # ls
bin    dev    etc    home   lib    media  mnt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ # 
</code></pre> 
  <h3><a id="92pod_396"></a>9.2、进入pod内指定容器</h3> 
  <p>用法：<code>kubectl exec -it pod-name -c container-name -- /bin/sh</code></p> 
  <pre><code>[root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container sh
/ # ls
bin    dev    etc    home   lib    media  mnt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ # exit
[root@master yaml]# kubectl exec -it myapp-lmj45 -c myapp-container -- /bin/sh
/ # ls
bin    dev    etc    home   lib    media  mnt    proc   root   run    sbin   srv    sys    tmp    usr    var
/ # 
</code></pre> 
  <h2><a id="10kubectl_logsdocker_logs_408"></a>10、kubectl logs：类似于docker logs，查看容器日志</h2> 
  <p>用法：<code>kubectl logs [-f] [-p] (POD | TYPE/NAME) [-c CONTAINER] [options]</code></p> 
  <h3><a id="101pod_410"></a>10.1、查看pod内的容器日志</h3> 
  <pre><code>[root@master yaml]# kubectl logs myapp-lmj45 --tail 300 -f
10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
</code></pre> 
  <h3><a id="102pod_419"></a>10.2、查看pod内指定容器的日志</h3> 
  <pre><code>[root@master yaml]# kubectl logs myapp-lmj45 -c myapp-container --tail 300 -f
10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:42 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:43 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
10.244.0.0 - - [31/Jul/2019:22:06:44 +0000] "GET / HTTP/1.1" 200 65 "-" "curl/7.29.0" "-"
</code></pre> 
  <h2><a id="11kubectl_explain_428"></a>11、kubectl explain</h2> 
  <p>用法：<code>kubectl explain RESOURCE [options]</code></p> 
  <h3><a id="111pod_430"></a>11.1、查看pod资源清单字段</h3> 
  <pre><code>[root@master ~]# kubectl explain pod
KIND:     Pod
VERSION:  v1

DESCRIPTION:
     Pod is a collection of containers that can run on a host. This resource is
     created by clients and scheduled onto hosts.

FIELDS:
   apiVersion	&lt;string&gt;
.....
</code></pre> 
  <h3><a id="112podmetadata_444"></a>11.2、查看pod资源清单理metadata字段下的字段（以此类推）</h3> 
  <pre><code>[root@master ~]# kubectl explain pod.metadata
KIND:     Pod
VERSION:  v1
RESOURCE: metadata &lt;Object&gt;
DESCRIPTION:
     Standard object's metadata. More info:
     https://git.k8s.io/community/contributors/devel/api-conventions.md#metadata

     ObjectMeta is metadata that all persisted resources must have, which
     includes all objects users must create.
FIELDS:
   annotations	&lt;map[string]string&gt;
.....
</code></pre> 
  <h3><a id="113ReplicaSet_460"></a>11.3、查看ReplicaSet资源清单字段</h3> 
  <pre><code>[root@master yaml]# kubectl explain rs
KIND:     ReplicaSet
VERSION:  extensions/v1beta1

DESCRIPTION:
     DEPRECATED - This group version of ReplicaSet is deprecated by
     apps/v1beta2/ReplicaSet. See the release notes for more information.
     ReplicaSet ensures that a specified number of pod replicas are running at
     any given time.

FIELDS:
   apiVersion	&lt;string&gt;
     APIVersion defines the versioned schema of this representation of an
     object. Servers should convert recognized schemas to the latest internal
     value, and may reject unrecognized values. More info:
 .....
</code></pre> 
  <h2><a id="12kubectl_rollout_479"></a>12、kubectl rollout：管理资源的部署</h2> 
  <p>用法：<code>kubectl rollout SUBCOMMAND [options]</code><br> 类型：</p> 
  <ul> 
   <li>deployments</li> 
   <li>daemonsets</li> 
   <li>statefulsets</li> 
  </ul> 
  <h3><a id="121deployment_486"></a>12.1、查看deployment滚动更新历史版本</h3> 
  <pre><code>[root@master yaml]# kubectl rollout history deployment myapp-deploy 
deployment.extensions/myapp-deploy 
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
2         &lt;none&gt;
</code></pre> 
  <h4><a id="122pod_494"></a>12.2、更新一个pod后暂停更新</h4> 
  <pre><code>[root@master yaml]# kubectl rollout pause deployment myapp-deploy
deployment.extensions/myapp-deploy paused
[root@master ~]# kubectl get pods -l app=myapp -w
NAME                            READY   STATUS    RESTARTS   AGE
myapp-deploy-66cfdc5675-cnm4m   1/1     Running   0          12s
myapp-deploy-66cfdc5675-jzghg   1/1     Running   0          12s
myapp-deploy-66cfdc5675-zkc94   1/1     Running   0          12s
myapp-deploy-668ff4dc58-fq6hp   0/1     Pending   0          0s
myapp-deploy-668ff4dc58-fq6hp   0/1     Pending   0          0s
myapp-deploy-668ff4dc58-fq6hp   0/1     ContainerCreating   0          0s
myapp-deploy-668ff4dc58-fq6hp   1/1     Running             0          9s

</code></pre> 
  <h4><a id="123_509"></a>12.3、解除暂停状态，继续更新</h4> 
  <pre><code>[root@master yaml]# kubectl rollout resume deployment myapp-deploy 
deployment.extensions/myapp-deploy resumed
[root@master yaml]# kubectl rollout status deployment myapp-deploy 
deployment "myapp-deploy" successfully rolled out
</code></pre> 
  <h4><a id="124_516"></a>12.4、回滚到指定版本</h4> 
  <pre><code>[root@master ~]# kubectl rollout history deployment myapp-deploy 
deployment.extensions/myapp-deploy 
REVISION  CHANGE-CAUSE
1         &lt;none&gt;
2         &lt;none&gt;
3         &lt;none&gt;
[root@master yaml]# kubectl rollout undo deployment myapp-deploy --to-revision=1
deployment.extensions/myapp-deploy rolled back
[root@master yaml]# kubectl get rs -o wide
NAME                      DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES                 SELECTOR
myapp-deploy-668ff4dc58   0         0         0       4m      myapp        ikubernetes/myapp:v3   app=myapp,pod-template-hash=668ff4dc58,release=canary
myapp-deploy-66cfdc5675   0         0         0       4m23s   myapp        ikubernetes/myapp:v2   app=myapp,pod-template-hash=66cfdc5675,release=canary
myapp-deploy-74fb9bdf9b   5         5         5       5m8s    myapp        ikubernetes/myapp:v1   app=myapp,pod-template-hash=74fb9bdf9b,release=canary
[root@master ~]# kubectl rollout history deployment myapp-deploy 
deployment.extensions/myapp-deploy 
REVISION  CHANGE-CAUSE
2         &lt;none&gt;
3         &lt;none&gt;
4         &lt;none&gt;
</code></pre> 
  <h4><a id="125deployment_538"></a>12.5、监控deployment更新状态</h4> 
  <pre><code>[root@master yaml]# kubectl rollout status deployment myapp-deploy 
Waiting for deployment "myapp-deploy" rollout to finish: 1 out of 3 new replicas have been updated...
</code></pre> 
  <h2><a id="kubectl_patch_544"></a>kubectl patch</h2> 
  <p>用法：<code>kubectl patch (-f FILENAME | TYPE NAME) -p PATCH [options]</code></p> 
  <h3><a id="deployment_546"></a>修改deployment副本数</h3> 
  <pre><code>[root@master yaml]# kubectl patch deployment myapp-deploy -p '{"spec":{"replicas":5}}'
deployment.extensions/myapp-deploy patched
</code></pre> 
  <h3><a id="deployment_551"></a>修改deployment滚动更新策略</h3> 
  <pre><code>[root@master yaml]# kubectl patch deployment myapp-deploy -p '{"spec":{"strategy":{"rollingUpdate":{"maxSurge":1,"maxUnavailable":0}}}}'
deployment.extensions/myapp-deploy patched
[root@master yaml]# kubectl describe deployments myapp-deploy 
Name:                   myapp-deploy
Namespace:              default
CreationTimestamp:      Fri, 02 Aug 2019 01:33:47 +0800
Labels:                 app=myapp
                        release=canary
Annotations:            deployment.kubernetes.io/revision: 2
                        kubectl.kubernetes.io/last-applied-configuration:
                          {"apiVersion":"apps/v1","kind":"Deployment","metadata":{"annotations":{},"name":"myapp-deploy","namespace":"default"},"spec":{"replicas":3...
Selector:               app=myapp,release=canary
Replicas:               5 desired | 5 updated | 5 total | 5 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  0 max unavailable, 1 max surge #已经修改
.....
</code></pre> 
  <h2><a id="kubectl_set_571"></a>kubectl set</h2> 
  <p>用法：<code>kubectl set SUBCOMMAND [options]</code></p> 
  <h3><a id="kubectl_set_image_573"></a>kubectl set image</h3> 
  <p>用法：<code>kubectl set image (-f FILENAME | TYPE NAME) CONTAINER_NAME_1=CONTAINER_IMAGE_1 ... CONTAINER_NAME_N=CONTAINER_IMAGE_N [options]</code></p> 
  <h4><a id="deployment_575"></a>修改deployment的镜像版本</h4> 
  <pre><code>[root@master yaml]# kubectl set image deployment myapp-deploy myapp=ikubernetes/myapp:v3 
deployment.extensions/myapp-deploy image updated
</code></pre> 
  <h4><a id="daemonset_580"></a>修改daemonset的镜像版本</h4> 
  <pre><code>[root@master yaml]# kubectl set image daemonsets filebeat-ds filebeat=ikubernetes/filebeat:5.6.6-alpine
daemonset.extensions/filebeat-ds image updated
</code></pre> 
  <h2><a id="kubectl_clusterinfo_585"></a>kubectl cluster-info：查看集群信息</h2> 
  <pre><code>[root@master ~]# kubectl cluster-info
Kubernetes master is running at https://192.168.10.48:6443
KubeDNS is running at https://192.168.10.48:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
</code></pre> 
  <h2><a id="kubectl_apiversions_Kubernetes_API__API__593"></a>kubectl api-versions：查询 Kubernetes API 支持的 API 版本</h2> 
  <pre><code>[root@master ~]# kubectl api-versions 
admissionregistration.k8s.io/v1beta1
apiextensions.k8s.io/v1beta1
apiregistration.k8s.io/v1
apiregistration.k8s.io/v1beta1
apps/v1
apps/v1beta1
apps/v1beta2
.....
</code></pre> 
  <h2><a id="kubectl_apiresourcesk8s_605"></a>kubectl api-resources：查看k8s支持的资源类型</h2> 
  <pre><code>[root@master ~]# kubectl api-resources
NAME                              SHORTNAMES   APIGROUP                       NAMESPACED   KIND
bindings                                                                      true         Binding
componentstatuses                 cs                                          false        ComponentStatus
configmaps                        cm                                          true         ConfigMap
endpoints                         ep                                          true         Endpoints
events                            ev                                          true         Event
limitranges                       limits                                      true         LimitRange
namespaces                        ns                                          false        Namespace
nodes                             no                                          false        Node
</code></pre> 
  <h3><a id="_618"></a>查看指定群组支持的资源类型</h3> 
  <pre><code>[root@master ~]# kubectl api-resources --api-group=storage.k8s.io
NAME                SHORTNAMES   APIGROUP         NAMESPACED   KIND
csidrivers                       storage.k8s.io   false        CSIDriver
csinodes                         storage.k8s.io   false        CSINode
storageclasses      sc           storage.k8s.io   false        StorageClass
volumeattachments                storage.k8s.io   false        VolumeAttachment
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
