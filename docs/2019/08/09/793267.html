<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>ORBSLAM2–Frame类 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="ORBSLAM2–Frame类" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="ORBSLAM2--Frame类 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 函数原型 知识点 像素范围的判断 远近距离判断 角度情况判断 根据深度预测尺度 对实参pMP添加属性 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 知识点 深度值的提取和内参的理解 RGBD的Frame进行右图像横坐标填充 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 该函数是运用于局部地图的跟踪里面，在进行局部地图点向当前帧进行投影前，都会对该地图点进行判断是否是处于当前帧的视野范围之内。通过像素范围、远近（深度）情况、角度情况进行判断，如果前面判断成立还会预测出对应的特征点可能出现在第几层金字塔中。 函数原型 /*@brief 判断一个点是否在视野内 * * 计算了重投影坐标，观测方向夹角，预测在当前帧的尺度 * @param pMP MapPoint * @param viewingCosLimit 视角和平均视角的方向阈值 * @return true if is in view * @see SearchLocalPoints() */ bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 知识点 像素范围的判断 / V-D 1) 将MapPoint投影到当前帧, 并判断是否在图像内 const float invz = 1.0f/PcZ; const float u=fx*PcX*invz+cx; const float v=fy*PcY*invz+cy; if(u&lt;mnMinX || u&gt;mnMaxX) return false; if(v&lt;mnMinY || v&gt;mnMaxY) return false; 远近距离判断 根据前面金字塔的计算，可以推测特征点允许被成功提取的距离范围 d m a x = d m ∗ 1. 2 m d_{max}=d_m*1.2^m dmax​=dm​∗1.2m d m i n = d m ∗ 1. 2 m − 1 d_{min}=d_m*1.2^{m-1} dmin​=dm​∗1.2m−1 其中m是该地图点在它的观测关键帧中对应特征点所在的金字塔层，这样每一个MapPoint都有一个观测到该点的帧的距离上下限，超过这范围的帧是认为是观测不到这个点的。相关介绍请看 代码片段 // V-D 3) 计算MapPoint到相机中心的距离, 并判断是否在尺度变化的距离内 const float maxDistance = pMP-&gt;GetMaxDistanceInvariance(); const float minDistance = pMP-&gt;GetMinDistanceInvariance(); // 世界坐标系下，相机到3D点P的向量, 向量方向由相机指向3D点P const cv::Mat PO = P-mOw; const float dist = cv::norm(PO); if(dist&lt;minDistance || dist&gt;maxDistance) return false; 角度情况判断 相机会存在一个视角，每一个MapPoint都会计算出它的平均观测视角，用来当做当前地图点的观测角度向量，那可以比较当前帧观测该点的方向向量和平均观测向量的余弦值来判断是否在允许的观测视角范围内 // V-D 2) 计算当前视角和平均视角夹角的余弦值, 若小于cos(60), 即夹角大于60度则返回 //这个计算理论是怎么样的？ // GetNormal()获得平均观测方向 cv::Mat Pn = pMP-&gt;GetNormal(); //P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn) const float viewCos = PO.dot(Pn)/dist; //其中viewingCosLimit是实参，值为0.5，刚好余弦的60度 if(viewCos&lt;viewingCosLimit) return false; 有一个疑惑，P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn)但是为什么说是得到的是cos(PO,Pn)，并且直接和viewingCosLimit=0.5进行判断呢？？ 根据深度预测尺度 这里是直接通过函数int MapPoint::PredictScale(const float &amp;currentDist, KeyFrame* pKF)进行计算 对实参pMP添加属性 // 标记该点将来要被投影 pMP-&gt;mbTrackInView = true; pMP-&gt;mTrackProjX = u; pMP-&gt;mTrackProjXR = u - mbf*invz; //该3D点投影到双目右侧相机上的横坐标 pMP-&gt;mTrackProjY = v; pMP-&gt;mnTrackScaleLevel = nPredictedLevel; pMP-&gt;mTrackViewCos = viewCos; 以上参数都是仅用与跟踪要的，时刻可能会被改变 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 当前函数是基于RGBD相机的帧被创建的时候才会在构造函数中被调用，一直都是只有双目摄像机才会有右图像，这里是有深度信息和IR设备的基线（估计是摄像头到IR设备的距离），那么这样可以通过 d = f x b Z d=\frac{f_xb}{Z} d=Zfx​b​得到视差，并通过视差和特征点像素横坐标可得到理论上的右图像对应的像素横坐标 u r u_r ur​ ，填充这个的目的是为了在进行G2O优化的时候，基于深度相机下，多一个约束（空间点的深度值也会根据视差公式进行转换得到上的 u r u_r ur​，然后和上一个作差），边的误差值也就变成vector3d类型。 知识点 深度值的提取和内参的理解 要明白像素平面是u做横坐标，v做纵坐标，所以在像素矩阵中应该是（v，u）的提取方式，第v行第u列 实际上像素平面就是相机坐标系的平移和缩放得到的，那么就有相应的像素坐标转换公式 { u = α X ′ + c x v = β Y ′ + c y \begin{cases} u=\alpha X&amp;#x27;+c_x \\ v=\beta Y&amp;#x27;+c_y \\ \end{cases} {u=αX′+cx​v=βY′+cy​​ 其中 α X ′ \alpha X&amp;#x27; αX′和 β Y ′ \beta Y&amp;#x27; βY′分别表示在x和y轴上的缩放， X ′ X&amp;#x27; X′和 Y ′ Y&amp;#x27; Y′ 是物理成像平面的坐标， c x c_x cx​和 c y c_y cy​分别表示平移，根据成像模型和三角形相似原理进行代入得到 { u = α f X Z + c x v = β f Y Z + c y \begin{cases} u=\alpha f\frac{X}{Z}+c_x \\ v=\beta f\frac{Y}{Z}+c_y \\ \end{cases} {u=αfZX​+cx​v=βfZY​+cy​​ X和Z都是像极坐标系的坐标值，那么 α f \alpha f αf就成了基线乘上了横坐标方向的缩放，变成了 f x f_x fx​并且单位是像素，相同的 β f \beta f βf也是一样的，成为 f y f_y fy​ ，它们也都称为焦距，单位是像素，最终 { u = f x X Z + c x v = f y Y Z + c y \begin{cases} u=f_x\frac{X}{Z}+c_x \\ v=f_y\frac{Y}{Z}+c_y \\ \end{cases} {u=fx​ZX​+cx​v=fy​ZY​+cy​​ 可参考链接 存在一个疑问在程序中是直接用未被校正过的特征点的像素坐标在深度图中采集深度，为什么不是用校正过的像素坐标进行深度采集呢？？？ RGBD的Frame进行右图像横坐标填充 从深度图得到特征点的深度信息并且摄像头到IR设备的基线是已知的，那么理论上是可以得到IR位置图像的像素横坐标，所以这里的填充数据就是这个，这主要是为了在后面进行优化的时候多一个约束，误差类型就成了一个vector3d类型。 首先这里和双目相机计算深度信息的原理是一样的 根据三角形 Δ P P L P R \Delta PP_LP_R ΔPPL​PR​ 和 Δ P O L O R \Delta PO_LO_R ΔPOL​OR​的相似关系,有: z − f z = b − u L + u R b \frac{z-f}{z} =\frac{b-u_L+u_R}{b} zz−f​=bb−uL​+uR​​ 整理得到 z = f b d d = u L − u R z=\frac{fb}{d}\qquad d=u_L-u_R z=dfb​d=uL​−uR​ 其中d就是所说的视差，左右图横坐标之差 如程序片段中： mvuRight[i] = kpU.pt.x-mbf/d; 相当于公式 u L − f x b d = u R u_L- \frac{f_xb}{d}=u_R uL​−dfx​b​=uR​ 其中b是双目相机的基线（这里是摄像头到IR设备的距离），d是该特征点的深度值（相当于Z坐标值），在配置文件中直接得到的是 f x b f_xb fx​b的乘积，不会直接给出基线b，因为b和d单位都是物理长度单位，相除就会约去，只剩下 f x f_x fx​的像素单位，符合等式。可参考证明" />
<meta property="og:description" content="ORBSLAM2--Frame类 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 函数原型 知识点 像素范围的判断 远近距离判断 角度情况判断 根据深度预测尺度 对实参pMP添加属性 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 知识点 深度值的提取和内参的理解 RGBD的Frame进行右图像横坐标填充 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 该函数是运用于局部地图的跟踪里面，在进行局部地图点向当前帧进行投影前，都会对该地图点进行判断是否是处于当前帧的视野范围之内。通过像素范围、远近（深度）情况、角度情况进行判断，如果前面判断成立还会预测出对应的特征点可能出现在第几层金字塔中。 函数原型 /*@brief 判断一个点是否在视野内 * * 计算了重投影坐标，观测方向夹角，预测在当前帧的尺度 * @param pMP MapPoint * @param viewingCosLimit 视角和平均视角的方向阈值 * @return true if is in view * @see SearchLocalPoints() */ bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 知识点 像素范围的判断 / V-D 1) 将MapPoint投影到当前帧, 并判断是否在图像内 const float invz = 1.0f/PcZ; const float u=fx*PcX*invz+cx; const float v=fy*PcY*invz+cy; if(u&lt;mnMinX || u&gt;mnMaxX) return false; if(v&lt;mnMinY || v&gt;mnMaxY) return false; 远近距离判断 根据前面金字塔的计算，可以推测特征点允许被成功提取的距离范围 d m a x = d m ∗ 1. 2 m d_{max}=d_m*1.2^m dmax​=dm​∗1.2m d m i n = d m ∗ 1. 2 m − 1 d_{min}=d_m*1.2^{m-1} dmin​=dm​∗1.2m−1 其中m是该地图点在它的观测关键帧中对应特征点所在的金字塔层，这样每一个MapPoint都有一个观测到该点的帧的距离上下限，超过这范围的帧是认为是观测不到这个点的。相关介绍请看 代码片段 // V-D 3) 计算MapPoint到相机中心的距离, 并判断是否在尺度变化的距离内 const float maxDistance = pMP-&gt;GetMaxDistanceInvariance(); const float minDistance = pMP-&gt;GetMinDistanceInvariance(); // 世界坐标系下，相机到3D点P的向量, 向量方向由相机指向3D点P const cv::Mat PO = P-mOw; const float dist = cv::norm(PO); if(dist&lt;minDistance || dist&gt;maxDistance) return false; 角度情况判断 相机会存在一个视角，每一个MapPoint都会计算出它的平均观测视角，用来当做当前地图点的观测角度向量，那可以比较当前帧观测该点的方向向量和平均观测向量的余弦值来判断是否在允许的观测视角范围内 // V-D 2) 计算当前视角和平均视角夹角的余弦值, 若小于cos(60), 即夹角大于60度则返回 //这个计算理论是怎么样的？ // GetNormal()获得平均观测方向 cv::Mat Pn = pMP-&gt;GetNormal(); //P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn) const float viewCos = PO.dot(Pn)/dist; //其中viewingCosLimit是实参，值为0.5，刚好余弦的60度 if(viewCos&lt;viewingCosLimit) return false; 有一个疑惑，P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn)但是为什么说是得到的是cos(PO,Pn)，并且直接和viewingCosLimit=0.5进行判断呢？？ 根据深度预测尺度 这里是直接通过函数int MapPoint::PredictScale(const float &amp;currentDist, KeyFrame* pKF)进行计算 对实参pMP添加属性 // 标记该点将来要被投影 pMP-&gt;mbTrackInView = true; pMP-&gt;mTrackProjX = u; pMP-&gt;mTrackProjXR = u - mbf*invz; //该3D点投影到双目右侧相机上的横坐标 pMP-&gt;mTrackProjY = v; pMP-&gt;mnTrackScaleLevel = nPredictedLevel; pMP-&gt;mTrackViewCos = viewCos; 以上参数都是仅用与跟踪要的，时刻可能会被改变 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 当前函数是基于RGBD相机的帧被创建的时候才会在构造函数中被调用，一直都是只有双目摄像机才会有右图像，这里是有深度信息和IR设备的基线（估计是摄像头到IR设备的距离），那么这样可以通过 d = f x b Z d=\frac{f_xb}{Z} d=Zfx​b​得到视差，并通过视差和特征点像素横坐标可得到理论上的右图像对应的像素横坐标 u r u_r ur​ ，填充这个的目的是为了在进行G2O优化的时候，基于深度相机下，多一个约束（空间点的深度值也会根据视差公式进行转换得到上的 u r u_r ur​，然后和上一个作差），边的误差值也就变成vector3d类型。 知识点 深度值的提取和内参的理解 要明白像素平面是u做横坐标，v做纵坐标，所以在像素矩阵中应该是（v，u）的提取方式，第v行第u列 实际上像素平面就是相机坐标系的平移和缩放得到的，那么就有相应的像素坐标转换公式 { u = α X ′ + c x v = β Y ′ + c y \begin{cases} u=\alpha X&amp;#x27;+c_x \\ v=\beta Y&amp;#x27;+c_y \\ \end{cases} {u=αX′+cx​v=βY′+cy​​ 其中 α X ′ \alpha X&amp;#x27; αX′和 β Y ′ \beta Y&amp;#x27; βY′分别表示在x和y轴上的缩放， X ′ X&amp;#x27; X′和 Y ′ Y&amp;#x27; Y′ 是物理成像平面的坐标， c x c_x cx​和 c y c_y cy​分别表示平移，根据成像模型和三角形相似原理进行代入得到 { u = α f X Z + c x v = β f Y Z + c y \begin{cases} u=\alpha f\frac{X}{Z}+c_x \\ v=\beta f\frac{Y}{Z}+c_y \\ \end{cases} {u=αfZX​+cx​v=βfZY​+cy​​ X和Z都是像极坐标系的坐标值，那么 α f \alpha f αf就成了基线乘上了横坐标方向的缩放，变成了 f x f_x fx​并且单位是像素，相同的 β f \beta f βf也是一样的，成为 f y f_y fy​ ，它们也都称为焦距，单位是像素，最终 { u = f x X Z + c x v = f y Y Z + c y \begin{cases} u=f_x\frac{X}{Z}+c_x \\ v=f_y\frac{Y}{Z}+c_y \\ \end{cases} {u=fx​ZX​+cx​v=fy​ZY​+cy​​ 可参考链接 存在一个疑问在程序中是直接用未被校正过的特征点的像素坐标在深度图中采集深度，为什么不是用校正过的像素坐标进行深度采集呢？？？ RGBD的Frame进行右图像横坐标填充 从深度图得到特征点的深度信息并且摄像头到IR设备的基线是已知的，那么理论上是可以得到IR位置图像的像素横坐标，所以这里的填充数据就是这个，这主要是为了在后面进行优化的时候多一个约束，误差类型就成了一个vector3d类型。 首先这里和双目相机计算深度信息的原理是一样的 根据三角形 Δ P P L P R \Delta PP_LP_R ΔPPL​PR​ 和 Δ P O L O R \Delta PO_LO_R ΔPOL​OR​的相似关系,有: z − f z = b − u L + u R b \frac{z-f}{z} =\frac{b-u_L+u_R}{b} zz−f​=bb−uL​+uR​​ 整理得到 z = f b d d = u L − u R z=\frac{fb}{d}\qquad d=u_L-u_R z=dfb​d=uL​−uR​ 其中d就是所说的视差，左右图横坐标之差 如程序片段中： mvuRight[i] = kpU.pt.x-mbf/d; 相当于公式 u L − f x b d = u R u_L- \frac{f_xb}{d}=u_R uL​−dfx​b​=uR​ 其中b是双目相机的基线（这里是摄像头到IR设备的距离），d是该特征点的深度值（相当于Z坐标值），在配置文件中直接得到的是 f x b f_xb fx​b的乘积，不会直接给出基线b，因为b和d单位都是物理长度单位，相除就会约去，只剩下 f x f_x fx​的像素单位，符合等式。可参考证明" />
<link rel="canonical" href="https://uzzz.org/2019/08/09/793267.html" />
<meta property="og:url" content="https://uzzz.org/2019/08/09/793267.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-09T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"ORBSLAM2--Frame类 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 函数原型 知识点 像素范围的判断 远近距离判断 角度情况判断 根据深度预测尺度 对实参pMP添加属性 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 知识点 深度值的提取和内参的理解 RGBD的Frame进行右图像横坐标填充 bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 函数简介 该函数是运用于局部地图的跟踪里面，在进行局部地图点向当前帧进行投影前，都会对该地图点进行判断是否是处于当前帧的视野范围之内。通过像素范围、远近（深度）情况、角度情况进行判断，如果前面判断成立还会预测出对应的特征点可能出现在第几层金字塔中。 函数原型 /*@brief 判断一个点是否在视野内 * * 计算了重投影坐标，观测方向夹角，预测在当前帧的尺度 * @param pMP MapPoint * @param viewingCosLimit 视角和平均视角的方向阈值 * @return true if is in view * @see SearchLocalPoints() */ bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit) 知识点 像素范围的判断 / V-D 1) 将MapPoint投影到当前帧, 并判断是否在图像内 const float invz = 1.0f/PcZ; const float u=fx*PcX*invz+cx; const float v=fy*PcY*invz+cy; if(u&lt;mnMinX || u&gt;mnMaxX) return false; if(v&lt;mnMinY || v&gt;mnMaxY) return false; 远近距离判断 根据前面金字塔的计算，可以推测特征点允许被成功提取的距离范围 d m a x = d m ∗ 1. 2 m d_{max}=d_m*1.2^m dmax​=dm​∗1.2m d m i n = d m ∗ 1. 2 m − 1 d_{min}=d_m*1.2^{m-1} dmin​=dm​∗1.2m−1 其中m是该地图点在它的观测关键帧中对应特征点所在的金字塔层，这样每一个MapPoint都有一个观测到该点的帧的距离上下限，超过这范围的帧是认为是观测不到这个点的。相关介绍请看 代码片段 // V-D 3) 计算MapPoint到相机中心的距离, 并判断是否在尺度变化的距离内 const float maxDistance = pMP-&gt;GetMaxDistanceInvariance(); const float minDistance = pMP-&gt;GetMinDistanceInvariance(); // 世界坐标系下，相机到3D点P的向量, 向量方向由相机指向3D点P const cv::Mat PO = P-mOw; const float dist = cv::norm(PO); if(dist&lt;minDistance || dist&gt;maxDistance) return false; 角度情况判断 相机会存在一个视角，每一个MapPoint都会计算出它的平均观测视角，用来当做当前地图点的观测角度向量，那可以比较当前帧观测该点的方向向量和平均观测向量的余弦值来判断是否在允许的观测视角范围内 // V-D 2) 计算当前视角和平均视角夹角的余弦值, 若小于cos(60), 即夹角大于60度则返回 //这个计算理论是怎么样的？ // GetNormal()获得平均观测方向 cv::Mat Pn = pMP-&gt;GetNormal(); //P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn) const float viewCos = PO.dot(Pn)/dist; //其中viewingCosLimit是实参，值为0.5，刚好余弦的60度 if(viewCos&lt;viewingCosLimit) return false; 有一个疑惑，P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn)但是为什么说是得到的是cos(PO,Pn)，并且直接和viewingCosLimit=0.5进行判断呢？？ 根据深度预测尺度 这里是直接通过函数int MapPoint::PredictScale(const float &amp;currentDist, KeyFrame* pKF)进行计算 对实参pMP添加属性 // 标记该点将来要被投影 pMP-&gt;mbTrackInView = true; pMP-&gt;mTrackProjX = u; pMP-&gt;mTrackProjXR = u - mbf*invz; //该3D点投影到双目右侧相机上的横坐标 pMP-&gt;mTrackProjY = v; pMP-&gt;mnTrackScaleLevel = nPredictedLevel; pMP-&gt;mTrackViewCos = viewCos; 以上参数都是仅用与跟踪要的，时刻可能会被改变 void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth) 函数简介 当前函数是基于RGBD相机的帧被创建的时候才会在构造函数中被调用，一直都是只有双目摄像机才会有右图像，这里是有深度信息和IR设备的基线（估计是摄像头到IR设备的距离），那么这样可以通过 d = f x b Z d=\\frac{f_xb}{Z} d=Zfx​b​得到视差，并通过视差和特征点像素横坐标可得到理论上的右图像对应的像素横坐标 u r u_r ur​ ，填充这个的目的是为了在进行G2O优化的时候，基于深度相机下，多一个约束（空间点的深度值也会根据视差公式进行转换得到上的 u r u_r ur​，然后和上一个作差），边的误差值也就变成vector3d类型。 知识点 深度值的提取和内参的理解 要明白像素平面是u做横坐标，v做纵坐标，所以在像素矩阵中应该是（v，u）的提取方式，第v行第u列 实际上像素平面就是相机坐标系的平移和缩放得到的，那么就有相应的像素坐标转换公式 { u = α X ′ + c x v = β Y ′ + c y \\begin{cases} u=\\alpha X&amp;#x27;+c_x \\\\ v=\\beta Y&amp;#x27;+c_y \\\\ \\end{cases} {u=αX′+cx​v=βY′+cy​​ 其中 α X ′ \\alpha X&amp;#x27; αX′和 β Y ′ \\beta Y&amp;#x27; βY′分别表示在x和y轴上的缩放， X ′ X&amp;#x27; X′和 Y ′ Y&amp;#x27; Y′ 是物理成像平面的坐标， c x c_x cx​和 c y c_y cy​分别表示平移，根据成像模型和三角形相似原理进行代入得到 { u = α f X Z + c x v = β f Y Z + c y \\begin{cases} u=\\alpha f\\frac{X}{Z}+c_x \\\\ v=\\beta f\\frac{Y}{Z}+c_y \\\\ \\end{cases} {u=αfZX​+cx​v=βfZY​+cy​​ X和Z都是像极坐标系的坐标值，那么 α f \\alpha f αf就成了基线乘上了横坐标方向的缩放，变成了 f x f_x fx​并且单位是像素，相同的 β f \\beta f βf也是一样的，成为 f y f_y fy​ ，它们也都称为焦距，单位是像素，最终 { u = f x X Z + c x v = f y Y Z + c y \\begin{cases} u=f_x\\frac{X}{Z}+c_x \\\\ v=f_y\\frac{Y}{Z}+c_y \\\\ \\end{cases} {u=fx​ZX​+cx​v=fy​ZY​+cy​​ 可参考链接 存在一个疑问在程序中是直接用未被校正过的特征点的像素坐标在深度图中采集深度，为什么不是用校正过的像素坐标进行深度采集呢？？？ RGBD的Frame进行右图像横坐标填充 从深度图得到特征点的深度信息并且摄像头到IR设备的基线是已知的，那么理论上是可以得到IR位置图像的像素横坐标，所以这里的填充数据就是这个，这主要是为了在后面进行优化的时候多一个约束，误差类型就成了一个vector3d类型。 首先这里和双目相机计算深度信息的原理是一样的 根据三角形 Δ P P L P R \\Delta PP_LP_R ΔPPL​PR​ 和 Δ P O L O R \\Delta PO_LO_R ΔPOL​OR​的相似关系,有: z − f z = b − u L + u R b \\frac{z-f}{z} =\\frac{b-u_L+u_R}{b} zz−f​=bb−uL​+uR​​ 整理得到 z = f b d d = u L − u R z=\\frac{fb}{d}\\qquad d=u_L-u_R z=dfb​d=uL​−uR​ 其中d就是所说的视差，左右图横坐标之差 如程序片段中： mvuRight[i] = kpU.pt.x-mbf/d; 相当于公式 u L − f x b d = u R u_L- \\frac{f_xb}{d}=u_R uL​−dfx​b​=uR​ 其中b是双目相机的基线（这里是摄像头到IR设备的距离），d是该特征点的深度值（相当于Z坐标值），在配置文件中直接得到的是 f x b f_xb fx​b的乘积，不会直接给出基线b，因为b和d单位都是物理长度单位，相除就会约去，只剩下 f x f_x fx​的像素单位，符合等式。可参考证明","@type":"BlogPosting","url":"https://uzzz.org/2019/08/09/793267.html","headline":"ORBSLAM2–Frame类","dateModified":"2019-08-09T00:00:00+08:00","datePublished":"2019-08-09T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/08/09/793267.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>ORBSLAM2--Frame类</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-atom-one-light"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <p></p>
  <div class="toc">
   <h3>ORBSLAM2--Frame类</h3>
   <ul>
    <ul>
     <li><a href="#bool_FrameisInFrustumMapPoint_pMP_float_viewingCosLimit_1" rel="nofollow" data-token="75d2ca6580ee215b72eeb3618f1f3e91">bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit)</a></li>
     <ul>
      <li><a href="#_2" rel="nofollow" data-token="fbb926b707a1099c7abebd0ccfffd584">函数简介</a></li>
      <li><a href="#_4" rel="nofollow" data-token="1dcccfbe5fea28c722fc4f606a533258">函数原型</a></li>
      <li><a href="#_17" rel="nofollow" data-token="3b7fc3db430b7a40a278c071b42ede7b">知识点</a></li>
      <ul>
       <li><a href="#_18" rel="nofollow" data-token="e9a87cccea420bdb3e4354ea907fa416">像素范围的判断</a></li>
       <li><a href="#_33" rel="nofollow" data-token="059b53fbdc4b04fb17d9c7776da875bc">远近距离判断</a></li>
       <li><a href="#_53" rel="nofollow" data-token="be773a41e3e021f14c7c1c1450ec701f">角度情况判断</a></li>
       <li><a href="#_70" rel="nofollow" data-token="d4ec1ae159f70164112208ea085b417a">根据深度预测尺度</a></li>
       <li><a href="#pMP_72" rel="nofollow" data-token="c5c8b38297f9e7bb927f314772936a55">对实参pMP添加属性</a></li>
      </ul>
     </ul>
     <li><a href="#void_FrameComputeStereoFromRGBDconst_cvMat_imDepth_85" rel="nofollow" data-token="6cea4d2f1b3d2b4164ce5e399dcdf87d">void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth)</a></li>
     <ul>
      <li><a href="#_86" rel="nofollow" data-token="18bd9e81c656d8f29849c7925289b34e">函数简介</a></li>
      <li><a href="#_88" rel="nofollow" data-token="24e8736fba98d1fb809c3cde774e1603">知识点</a></li>
      <ul>
       <li><a href="#_89" rel="nofollow" data-token="a7a499dde26927319afe42d5287a2126">深度值的提取和内参的理解</a></li>
       <li><a href="#RGBDFrame_115" rel="nofollow" data-token="6dd4d90772a260fbb1c4aad98eded246">RGBD的Frame进行右图像横坐标填充</a></li>
      </ul>
     </ul>
    </ul>
   </ul>
  </div>
  <p></p> 
  <h2><a id="bool_FrameisInFrustumMapPoint_pMP_float_viewingCosLimit_1"></a>bool Frame::isInFrustum(MapPoint *pMP, float viewingCosLimit)</h2> 
  <h3><a id="_2"></a>函数简介</h3> 
  <p>该函数是运用于局部地图的跟踪里面，在进行局部地图点向当前帧进行投影前，都会对该地图点进行判断是否是处于当前帧的视野范围之内。通过像素范围、远近（深度）情况、角度情况进行判断，如果前面判断成立还会预测出对应的特征点可能出现在第几层金字塔中。</p> 
  <h3><a id="_4"></a>函数原型</h3> 
  <pre><code class="prism language-c"> <span class="token comment">/*@brief 判断一个点是否在视野内 * * 计算了重投影坐标，观测方向夹角，预测在当前帧的尺度 * @param pMP MapPoint * @param viewingCosLimit 视角和平均视角的方向阈值 * @return true if is in view * @see SearchLocalPoints() */</span>
bool Frame<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">isInFrustum</span><span class="token punctuation">(</span>MapPoint <span class="token operator">*</span>pMP<span class="token punctuation">,</span> <span class="token keyword">float</span> viewingCosLimit<span class="token punctuation">)</span>
</code></pre> 
  <h3><a id="_17"></a>知识点</h3> 
  <h4><a id="_18"></a>像素范围的判断</h4> 
  <pre><code class="prism language-c">
<span class="token operator">/</span> V<span class="token operator">-</span>D <span class="token number">1</span><span class="token punctuation">)</span> 将MapPoint投影到当前帧<span class="token punctuation">,</span> 并判断是否在图像内
    <span class="token keyword">const</span> <span class="token keyword">float</span> invz <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token operator">/</span>PcZ<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> u<span class="token operator">=</span>fx<span class="token operator">*</span>PcX<span class="token operator">*</span>invz<span class="token operator">+</span>cx<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> v<span class="token operator">=</span>fy<span class="token operator">*</span>PcY<span class="token operator">*</span>invz<span class="token operator">+</span>cy<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>u<span class="token operator">&lt;</span>mnMinX <span class="token operator">||</span> u<span class="token operator">&gt;</span>mnMaxX<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token operator">&lt;</span>mnMinY <span class="token operator">||</span> v<span class="token operator">&gt;</span>mnMaxY<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
</code></pre> 
  <h4><a id="_33"></a>远近距离判断</h4> 
  <p>根据前面金字塔的计算，可以推测特征点允许被成功提取的距离范围<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            d
           </mi>
           <mrow>
            <mi>
             m
            </mi>
            <mi>
             a
            </mi>
            <mi>
             x
            </mi>
           </mrow>
          </msub>
          <mo>
           =
          </mo>
          <msub>
           <mi>
            d
           </mi>
           <mi>
            m
           </mi>
          </msub>
          <mo>
           ∗
          </mo>
          <mn>
           1.
          </mn>
          <msup>
           <mn>
            2
           </mn>
           <mi>
            m
           </mi>
          </msup>
         </mrow>
         <annotation encoding="application/x-tex">
          d_{max}=d_m*1.2^m
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">m</span><span class="mord mathit mtight">a</span><span class="mord mathit mtight">x</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.714392em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714392em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">m</span></span></span></span></span></span></span></span></span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            d
           </mi>
           <mrow>
            <mi>
             m
            </mi>
            <mi>
             i
            </mi>
            <mi>
             n
            </mi>
           </mrow>
          </msub>
          <mo>
           =
          </mo>
          <msub>
           <mi>
            d
           </mi>
           <mi>
            m
           </mi>
          </msub>
          <mo>
           ∗
          </mo>
          <mn>
           1.
          </mn>
          <msup>
           <mn>
            2
           </mn>
           <mrow>
            <mi>
             m
            </mi>
            <mo>
             −
            </mo>
            <mn>
             1
            </mn>
           </mrow>
          </msup>
         </mrow>
         <annotation encoding="application/x-tex">
          d_{min}=d_m*1.2^{m-1}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">m</span><span class="mord mathit mtight">i</span><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.864108em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">m</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></span><br> 其中m是该地图点在它的观测关键帧中对应特征点所在的金字塔层，这样每一个MapPoint都有一个观测到该点的帧的距离上下限，超过这范围的帧是认为是观测不到这个点的。<a href="https://blog.csdn.net/RobotLife/article/details/87194017" rel="nofollow" data-token="267d8487f6741e766dd98832199e3331">相关介绍请看</a></p> 
  <p><strong>代码片段</strong></p> 
  <pre><code class="prism language-c"> <span class="token comment">// V-D 3) 计算MapPoint到相机中心的距离, 并判断是否在尺度变化的距离内</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> maxDistance <span class="token operator">=</span> pMP<span class="token operator">-&gt;</span><span class="token function">GetMaxDistanceInvariance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> minDistance <span class="token operator">=</span> pMP<span class="token operator">-&gt;</span><span class="token function">GetMinDistanceInvariance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 世界坐标系下，相机到3D点P的向量, 向量方向由相机指向3D点P</span>
    <span class="token keyword">const</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Mat PO <span class="token operator">=</span> P<span class="token operator">-</span>mOw<span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> dist <span class="token operator">=</span> cv<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">norm</span><span class="token punctuation">(</span>PO<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>dist<span class="token operator">&lt;</span>minDistance <span class="token operator">||</span> dist<span class="token operator">&gt;</span>maxDistance<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
</code></pre> 
  <h4><a id="_53"></a>角度情况判断</h4> 
  <p>相机会存在一个视角，每一个MapPoint都会计算出它的平均观测视角，用来当做当前地图点的观测角度向量，那可以比较当前帧观测该点的方向向量和平均观测向量的余弦值来判断是否在允许的观测视角范围内</p> 
  <pre><code class="prism language-c"> <span class="token comment">// V-D 2) 计算当前视角和平均视角夹角的余弦值, 若小于cos(60), 即夹角大于60度则返回</span>
    <span class="token comment">//这个计算理论是怎么样的？</span>
    <span class="token comment">// GetNormal()获得平均观测方向</span>
    cv<span class="token punctuation">:</span><span class="token punctuation">:</span>Mat Pn <span class="token operator">=</span> pMP<span class="token operator">-&gt;</span><span class="token function">GetNormal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn)</span>
    <span class="token keyword">const</span> <span class="token keyword">float</span> viewCos <span class="token operator">=</span> PO<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>Pn<span class="token punctuation">)</span><span class="token operator">/</span>dist<span class="token punctuation">;</span>
<span class="token comment">//其中viewingCosLimit是实参，值为0.5，刚好余弦的60度</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>viewCos<span class="token operator">&lt;</span>viewingCosLimit<span class="token punctuation">)</span>
        <span class="token keyword">return</span> false<span class="token punctuation">;</span>
</code></pre> 
  <p>有一个疑惑，P0点乘Pn,得到的应该是|Pn|*cos(PO,Pn)但是为什么说是得到的是cos(PO,Pn)，并且直接和viewingCosLimit=0.5进行判断呢？？</p> 
  <h4><a id="_70"></a>根据深度预测尺度</h4> 
  <p>这里是直接通过函数<a href="https://blog.csdn.net/weixin_43205582/article/details/95052388" rel="nofollow" data-token="2020b60ff5200357078e0961b340a436">int MapPoint::PredictScale(const float &amp;currentDist, KeyFrame* pKF)</a>进行计算</p> 
  <h4><a id="pMP_72"></a>对实参pMP添加属性</h4> 
  <pre><code class="prism language-c"> <span class="token comment">// 标记该点将来要被投影</span>
    pMP<span class="token operator">-&gt;</span>mbTrackInView <span class="token operator">=</span> true<span class="token punctuation">;</span>
    pMP<span class="token operator">-&gt;</span>mTrackProjX <span class="token operator">=</span> u<span class="token punctuation">;</span>
    pMP<span class="token operator">-&gt;</span>mTrackProjXR <span class="token operator">=</span> u <span class="token operator">-</span> mbf<span class="token operator">*</span>invz<span class="token punctuation">;</span> <span class="token comment">//该3D点投影到双目右侧相机上的横坐标</span>
    pMP<span class="token operator">-&gt;</span>mTrackProjY <span class="token operator">=</span> v<span class="token punctuation">;</span>
    pMP<span class="token operator">-&gt;</span>mnTrackScaleLevel <span class="token operator">=</span> nPredictedLevel<span class="token punctuation">;</span>
    pMP<span class="token operator">-&gt;</span>mTrackViewCos <span class="token operator">=</span> viewCos<span class="token punctuation">;</span>
</code></pre> 
  <p>以上参数都是仅用与跟踪要的，时刻可能会被改变</p> 
  <h2><a id="void_FrameComputeStereoFromRGBDconst_cvMat_imDepth_85"></a>void Frame::ComputeStereoFromRGBD(const cv::Mat &amp;imDepth)</h2> 
  <h3><a id="_86"></a>函数简介</h3> 
  <p>当前函数是基于RGBD相机的帧被创建的时候才会在构造函数中被调用，一直都是只有双目摄像机才会有右图像，这里是有深度信息和IR设备的基线（估计是摄像头到IR设备的距离），那么这样可以通过<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          d
         </mi>
         <mo>
          =
         </mo>
         <mfrac>
          <mrow>
           <msub>
            <mi>
             f
            </mi>
            <mi>
             x
            </mi>
           </msub>
           <mi>
            b
           </mi>
          </mrow>
          <mi>
           Z
          </mi>
         </mfrac>
        </mrow>
        <annotation encoding="application/x-tex">
         d=\frac{f_xb}{Z}
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathit">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.27722em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.932216em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07153em;" class="mord mathit mtight">Z</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.44611em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span style="margin-right: 0.10764em;" class="mord mathit mtight">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.164543em;"><span class="" style="top: -2.357em; margin-left: -0.10764em; margin-right: 0.0714286em;"><span class="pstrut" style="height: 2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.143em;"><span class=""></span></span></span></span></span></span><span class="mord mathit mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>得到视差，并通过视差和特征点像素横坐标可得到理论上的右图像对应的像素横坐标<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           u
          </mi>
          <mi>
           r
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         u_r
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02778em;" class="mord mathit mtight">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> ，填充这个的目的是为了在进行G2O优化的时候，基于深度相机下，多一个约束（空间点的深度值也会根据视差公式进行转换得到上的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           u
          </mi>
          <mi>
           r
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         u_r
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.02778em;" class="mord mathit mtight">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，然后和上一个作差），边的误差值也就变成vector3d类型。</p> 
  <h3><a id="_88"></a>知识点</h3> 
  <h4><a id="_89"></a>深度值的提取和内参的理解</h4> 
  <p>要明白像素平面是u做横坐标，v做纵坐标，所以在像素矩阵中应该是（v，u）的提取方式，第v行第u列<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019080921434992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIwNTU4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>实际上像素平面就是相机坐标系的平移和缩放得到的，那么就有相应的像素坐标转换公式<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                u
               </mi>
               <mo>
                =
               </mo>
               <mi>
                α
               </mi>
               <msup>
                <mi>
                 X
                </mi>
                <mo mathvariant="normal">
                 ′
                </mo>
               </msup>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 x
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                v
               </mi>
               <mo>
                =
               </mo>
               <mi>
                β
               </mi>
               <msup>
                <mi>
                 Y
                </mi>
                <mo mathvariant="normal">
                 ′
                </mo>
               </msup>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 y
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} u=\alpha X&amp;#x27;+c_x \\ v=\beta Y&amp;#x27;+c_y \\ \end{cases}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord mathit">u</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.0037em;" class="mord mathit">α</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.19em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          α
         </mi>
         <msup>
          <mi>
           X
          </mi>
          <mo mathvariant="normal">
           ′
          </mo>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         \alpha X&amp;#x27;
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span style="margin-right: 0.0037em;" class="mord mathit">α</span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          β
         </mi>
         <msup>
          <mi>
           Y
          </mi>
          <mo mathvariant="normal">
           ′
          </mo>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         \beta Y&amp;#x27;
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.946332em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span>分别表示在x和y轴上的缩放，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msup>
          <mi>
           X
          </mi>
          <mo mathvariant="normal">
           ′
          </mo>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         X&amp;#x27;
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.07847em;" class="mord mathit">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msup>
          <mi>
           Y
          </mi>
          <mo mathvariant="normal">
           ′
          </mo>
         </msup>
        </mrow>
        <annotation encoding="application/x-tex">
         Y&amp;#x27;
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.751892em; vertical-align: 0em;"></span><span class="mord"><span style="margin-right: 0.22222em;" class="mord mathit">Y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span> 是物理成像平面的坐标，<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           c
          </mi>
          <mi>
           x
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         c_x
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           c
          </mi>
          <mi>
           y
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         c_y
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.716668em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>分别表示平移，根据成像模型和三角形相似原理进行代入得到<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                u
               </mi>
               <mo>
                =
               </mo>
               <mi>
                α
               </mi>
               <mi>
                f
               </mi>
               <mfrac>
                <mi>
                 X
                </mi>
                <mi>
                 Z
                </mi>
               </mfrac>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 x
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                v
               </mi>
               <mo>
                =
               </mo>
               <mi>
                β
               </mi>
               <mi>
                f
               </mi>
               <mfrac>
                <mi>
                 Y
                </mi>
                <mi>
                 Z
                </mi>
               </mfrac>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 y
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} u=\alpha f\frac{X}{Z}+c_x \\ v=\beta f\frac{Y}{Z}+c_y \\ \end{cases}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord mathit">u</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.0037em;" class="mord mathit">α</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07153em;" class="mord mathit mtight">Z</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">X</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07153em;" class="mord mathit mtight">Z</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.22222em;" class="mord mathit mtight">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.19em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
  <p>X和Z都是像极坐标系的坐标值，那么<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          α
         </mi>
         <mi>
          f
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         \alpha f
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.0037em;" class="mord mathit">α</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span></span></span></span></span>就成了基线乘上了横坐标方向的缩放，变成了<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           x
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         f_x
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>并且单位是像素，相同的<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi>
          β
         </mi>
         <mi>
          f
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         \beta f
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span style="margin-right: 0.05278em;" class="mord mathit">β</span><span style="margin-right: 0.10764em;" class="mord mathit">f</span></span></span></span></span>也是一样的，成为<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           y
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         f_y
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.980548em; vertical-align: -0.286108em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span> ，它们也都称为焦距，单位是像素，最终<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mo fence="true">
           {
          </mo>
          <mtable>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                u
               </mi>
               <mo>
                =
               </mo>
               <msub>
                <mi>
                 f
                </mi>
                <mi>
                 x
                </mi>
               </msub>
               <mfrac>
                <mi>
                 X
                </mi>
                <mi>
                 Z
                </mi>
               </mfrac>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 x
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
           <mtr>
            <mtd>
             <mstyle displaystyle="false" scriptlevel="0">
              <mrow>
               <mi>
                v
               </mi>
               <mo>
                =
               </mo>
               <msub>
                <mi>
                 f
                </mi>
                <mi>
                 y
                </mi>
               </msub>
               <mfrac>
                <mi>
                 Y
                </mi>
                <mi>
                 Z
                </mi>
               </mfrac>
               <mo>
                +
               </mo>
               <msub>
                <mi>
                 c
                </mi>
                <mi>
                 y
                </mi>
               </msub>
              </mrow>
             </mstyle>
            </mtd>
           </mtr>
          </mtable>
         </mrow>
         <annotation encoding="application/x-tex">
          \begin{cases} u=f_x\frac{X}{Z}+c_x \\ v=f_y\frac{Y}{Z}+c_y \\ \end{cases}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 3.00003em; vertical-align: -1.25003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.69em;"><span class="" style="top: -3.69em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span class="mord mathit">u</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07153em;" class="mord mathit mtight">Z</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07847em;" class="mord mathit mtight">X</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 3.008em;"></span><span class="mord"><span style="margin-right: 0.03588em;" class="mord mathit">v</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.872331em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.07153em;" class="mord mathit mtight">Z</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.22222em;" class="mord mathit mtight">Y</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.03588em;" class="mord mathit mtight">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.19em;"><span class=""></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 可参考<a href="https://www.cnblogs.com/zipeilu/p/6658177.html?utm_source=itdadao&amp;utm_medium=referral" rel="nofollow">链接</a></p> 
  <p><strong>存在一个疑问</strong>在程序中是直接用未被校正过的特征点的像素坐标在深度图中采集深度，为什么不是用校正过的像素坐标进行深度采集呢？？？</p> 
  <h4><a id="RGBDFrame_115"></a>RGBD的Frame进行右图像横坐标填充</h4> 
  <p>从深度图得到特征点的深度信息并且摄像头到IR设备的基线是已知的，那么理论上是可以得到IR位置图像的像素横坐标，所以这里的填充数据就是这个，<strong>这主要是为了在后面进行优化的时候多一个约束，误差类型就成了一个vector3d类型</strong>。<br> 首先这里和双目相机计算深度信息的原理是一样的<br> <img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/2019080922345989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIwNTU4Mg==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <p>根据三角形 <span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi mathvariant="normal">
          Δ
         </mi>
         <mi>
          P
         </mi>
         <msub>
          <mi>
           P
          </mi>
          <mi>
           L
          </mi>
         </msub>
         <msub>
          <mi>
           P
          </mi>
          <mi>
           R
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         \Delta PP_LP_R
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord">Δ</span><span style="margin-right: 0.13889em;" class="mord mathit">P</span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.13889em;" class="mord mathit">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.00773em;" class="mord mathit mtight">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 和<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <mi mathvariant="normal">
          Δ
         </mi>
         <mi>
          P
         </mi>
         <msub>
          <mi>
           O
          </mi>
          <mi>
           L
          </mi>
         </msub>
         <msub>
          <mi>
           O
          </mi>
          <mi>
           R
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         \Delta PO_LO_R
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord">Δ</span><span style="margin-right: 0.13889em;" class="mord mathit">P</span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.02778em;" class="mord mathit">O</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.00773em;" class="mord mathit mtight">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的相似关系,有:<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mfrac>
           <mrow>
            <mi>
             z
            </mi>
            <mo>
             −
            </mo>
            <mi>
             f
            </mi>
           </mrow>
           <mi>
            z
           </mi>
          </mfrac>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             b
            </mi>
            <mo>
             −
            </mo>
            <msub>
             <mi>
              u
             </mi>
             <mi>
              L
             </mi>
            </msub>
            <mo>
             +
            </mo>
            <msub>
             <mi>
              u
             </mi>
             <mi>
              R
             </mi>
            </msub>
           </mrow>
           <mi>
            b
           </mi>
          </mfrac>
         </mrow>
         <annotation encoding="application/x-tex">
          \frac{z-f}{z} =\frac{b-u_L+u_R}{b}
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 2.05744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.04398em;" class="mord mathit">z</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.04398em;" class="mord mathit">z</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span style="margin-right: 0.10764em;" class="mord mathit">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.05744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">b</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">b</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.00773em;" class="mord mathit mtight">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 整理得到<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <mi>
           z
          </mi>
          <mo>
           =
          </mo>
          <mfrac>
           <mrow>
            <mi>
             f
            </mi>
            <mi>
             b
            </mi>
           </mrow>
           <mi>
            d
           </mi>
          </mfrac>
          <mspace width="2em"></mspace>
          <mi>
           d
          </mi>
          <mo>
           =
          </mo>
          <msub>
           <mi>
            u
           </mi>
           <mi>
            L
           </mi>
          </msub>
          <mo>
           −
          </mo>
          <msub>
           <mi>
            u
           </mi>
           <mi>
            R
           </mi>
          </msub>
         </mrow>
         <annotation encoding="application/x-tex">
          z=\frac{fb}{d}\qquad d=u_L-u_R
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span style="margin-right: 0.04398em;" class="mord mathit">z</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.05744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">d</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="mord mathit">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 2em;"></span><span class="mord mathit">d</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.00773em;" class="mord mathit mtight">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 其中d就是所说的视差，左右图横坐标之差</p> 
  <p>如程序片段中：</p> 
  <pre><code class="prism language-c">mvuRight<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> kpU<span class="token punctuation">.</span>pt<span class="token punctuation">.</span>x<span class="token operator">-</span>mbf<span class="token operator">/</span>d<span class="token punctuation">;</span>
</code></pre> 
  <p>相当于公式<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml">
       <math>
        <semantics>
         <mrow>
          <msub>
           <mi>
            u
           </mi>
           <mi>
            L
           </mi>
          </msub>
          <mo>
           −
          </mo>
          <mfrac>
           <mrow>
            <msub>
             <mi>
              f
             </mi>
             <mi>
              x
             </mi>
            </msub>
            <mi>
             b
            </mi>
           </mrow>
           <mi>
            d
           </mi>
          </mfrac>
          <mo>
           =
          </mo>
          <msub>
           <mi>
            u
           </mi>
           <mi>
            R
           </mi>
          </msub>
         </mrow>
         <annotation encoding="application/x-tex">
          u_L- \frac{f_xb}{d}=u_R
         </annotation>
        </semantics>
       </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.73333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 2.05744em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathit">d</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathit">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathit">u</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.328331em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.00773em;" class="mord mathit mtight">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span><br> 其中b是双目相机的基线（这里是摄像头到IR设备的距离），d是该特征点的深度值（相当于Z坐标值），在配置文件中直接得到的是<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           x
          </mi>
         </msub>
         <mi>
          b
         </mi>
        </mrow>
        <annotation encoding="application/x-tex">
         f_xb
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathit">b</span></span></span></span></span>的乘积，<strong>不会直接给出基线b</strong>，因为b和d单位都是物理长度单位，相除就会约去，只剩下<span class="katex--inline"><span class="katex"><span class="katex-mathml">
      <math>
       <semantics>
        <mrow>
         <msub>
          <mi>
           f
          </mi>
          <mi>
           x
          </mi>
         </msub>
        </mrow>
        <annotation encoding="application/x-tex">
         f_x
        </annotation>
       </semantics>
      </math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.88888em; vertical-align: -0.19444em;"></span><span class="mord"><span style="margin-right: 0.10764em;" class="mord mathit">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.10764em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的像素单位，符合等式。<a href="https://blog.csdn.net/xiaohaijiejie/article/details/49721415" rel="nofollow">可参考证明</a></p> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
