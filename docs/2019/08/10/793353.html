<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

<!-- Begin Jekyll SEO tag v2.5.0 -->
<title>《R语言实战》学习笔记：第五章 高级数据管理 | 有组织在！</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="《R语言实战》学习笔记：第五章 高级数据管理" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="高级数据管理 数值和字符处理函数 数学函数 abs(x)：求绝对值，例如 abs(-4) #返回值为4 sqrt(x)：求平方根，例如 sqrt(25) #返回值为5 ceiling(x)：不小于x 的最小整数，例如 ceiling(3.475) #返回值为4 floor(x)：不大于x 的最大整数，例如 floor(3.475) #返回值为3 trunc(x)：向0的方向截取的x 中的整数部分，例如 trunc(5.99) #返回值为5 round(x, digits=n)：将x舍入为指定位的小数，例如 round(3.475, digits=2) #返回值为3.48 signif(x, digits=n)：将x舍入为指定的有效数字位数，例如 signif(3.475, digits=2) #返回值为3.5 cos(x)、sin(x)、tan(x)：余弦、正弦和正切，例如 cos(2) #返回值为–0.416 acos(x)、asin(x)、atan(x)：反余弦、反正弦和反正切，例如 acos(-0.416) #返回值为2 cosh(x)、sinh(x)、tanh(x)：双曲余弦、双曲正弦和双曲正切， 例如 sinh(2) #返回值为3.627 acosh(x)、asinh(x)、atanh(x)：反双曲余弦、反双曲正弦和反双曲正切，例如 asinh(3.627) #返回值为2 log(x, base=n)：对x取以n 为底的对数 log(x)：自然对数 log10(x)：以10为底的对数 exp(x)：指数函数，例如exp(2.3026) #返回值为10 统计函数 mean(x)：平均数，例如 mean(c(1,2,3,4)) #返回值为2.5 median(x)：中位数，例如 median(c(1,2,3,4)) #返回值为2.5 sd(x)：标准差，例如 sd(c(1,2,3,4)) var(x)：方差，例如 var(c(1,2,3,4)) mad(x)：绝对中位差，例如 mad(c(1,2,3,4)) #返回值为1.48 quantile(x, probs)：求分位数，例如 y &lt;- quantile(x,c(.3,.84)) #返回值为x的30%和84%分位点 range(x)：求值域，例如 range(c(1,2,3,4)) #返回值为c(1,4) sum(x)：求和，例如 sum(c(1,2,3,4)) #返回值为10 diff(x, lag=n)：差分函数,lag为差分项,默认值为1,例如 diff(c(1, 5, 23, 29)) #返回值为c(4,18,6) min(x)：求最小值，例如 min(c(1,2,3,4)) #返回值为1 max(x)：求最大值，例如 max(c(1,2,3,4)) #返回值为4 scale(x, center=TRUE, scale=TRUE)：为数据对象x按列进行中心化(center=TRUE)或标准化(center=TRUE, scale=TRUE) 概率函数 在R中，概率函数形如 ：[dpqr]分布名称缩写( ) 其中第一个字母表示其所指分布的某一方面： d = 密度函数（density function） p = 分布函数（distribution function） q = 分位数函数（quantile function） r = 生成随机数（随机偏差） # 在[-3, 3]区间上绘制标准正态曲线 x &lt;- pretty(c(-3,3), 30) # 在[-3, 3]选取31个等分点 y &lt;- dnorm(x) plot(x, y, type = &quot;l&quot;, xlab = &quot;Normal Deviate&quot;, ylab = &quot;Density&quot;, yaxs = &quot;i&quot; ) pnorm(1.96) #位于z=1.96 左侧的标准正态曲线下方面积，返回值为0.975 qnorm(.9, mean=500, sd=100) #均值为500，标准差为100的正态分布的0.9分位点，返回值为628.16 rnorm(50, mean=50, sd=10) #生成50 个均值为50，标准差为10的正态随机数 设定随机数种子 在每次生成伪随机数的时候，函数都会使用一个不同的种子，因此也会产生不同的结果；可以通过函数 set.seed() 显式指定这个种子，让结果可以重现 runif(5) # 输出 0.5684550 0.2155904 0.6656250 0.6798496 0.7349901 runif(5) # 输出 0.70508234 0.45849879 0.21018669 0.08474743 0.79296225 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 生成多元正态数据 MASS包中的mvrnorm()函数可以生成给定均值向量和协方差阵的多元正态分布的随机数： mvrnorm(n, mean, sigma) 其中n是样本大小，mean为均值向量，而sigma是协方差矩阵 library(MASS) options(digits=3) set.seed(1234) # 设定随机数种子 mean &lt;- c(230.7, 146.7, 3.6) sigma &lt;- matrix( c(15360.8, 6721.2, -47.1, 6721.2, 4700.9, -16.5, -47.1, -16.5, 0.3), nrow=3, ncol=3) mydata &lt;- mvrnorm(500, mean, sigma) # 取500个观测值 mydata &lt;- as.data.frame(mydata) # 把矩阵转换为数据框 names(mydata) &lt;- c(&quot;y&quot;, &quot;x1&quot;, &quot;x2&quot;) # 指定数据框的名称 dim(mydata) # 查看数据 # 输出 500 3 head(mydata, n=10) # 查看前10行数据 # 输出 y x1 x2 1 98.8 41.3 3.43 2 244.5 205.2 3.80 3 375.7 186.7 2.51 4 -59.2 11.2 4.71 5 313.0 111.0 3.45 6 288.8 185.1 2.72 7 134.8 165.0 4.39 8 171.7 97.4 3.64 9 167.2 101.0 3.50 10 121.1 94.5 4.10 字符处理函数 nchar(x)：计算x 中的字符数量，例如x &lt;- c(&quot;ab&quot;, &quot;cde&quot;,&quot;fghij&quot;)，则nchar(x[3])返回值为5 substr(x, start, stop)：提取子串，例如 x &lt;- &quot;abcdef&quot;，则 substr(x, 2, 4)返回值为&quot;bcd&quot; grep(pattern, x, ignore.case=FALSE, fixed=FALSE)：在x中匹配搜索pattern，返回值为匹配的下标；若fixed=FALSE，则pattern 为一个正则表达式，若fixed=TRUE，则pattern 为一 个文本字符串。例如grep(&quot;A&quot;, c(&quot;b&quot;, &quot;A&quot;, &quot;c&quot;), fixed=TRUE) # 返回值为2 sub(pattern, replacement, x, ignore.case=FALSE,fixed=FALSE)：在x中搜索pattern，并以文本replacement将其替换。例如sub(&quot;\\s&quot;, &quot;.&quot;, &quot;Hello There&quot;) # 返回值为Hello.There 注意，&quot;\s&quot;是一个用来查找空白的正则表达式 strsplit(x, split, fixed=FALSE)：在split处分割字符向量x中的元素，例如y &lt;- strsplit(&quot;abc&quot;, &quot;&quot;) # 返回含有3个元素的列表，包含的内容为&quot;a&quot; &quot;b&quot; &quot;c&quot; paste(…, sep=&quot;&quot;)：连接字符串，分隔符为sep，例如paste(&quot;x&quot;, 1:3, sep=&quot;M&quot;) # 返回值为c(&quot;xM1&quot;,&quot;xM2&quot; &quot;xM3&quot;) toupper(x)：大写转换，例如 &gt; toupper(&quot;abc&quot;) # 返回值为 &quot;ABC&quot; tolower (x)：小写转换，例如 &gt; tolower (&quot;ABC&quot;) # 返回值为 &quot;abc&quot; 其他实用函数 length(x)：对象x的长度，例如x &lt;- c(2, 5, 6, 9) # 返回值为4 seq(from, to, by)：生成一个序列，例如indices &lt;-seq(1,10,2) # indices的值为c(1, 3, 5, 7, 9) rep(x, n)：将x重复n次，例如y &lt;- rep(1:3, 2) # y 的值为c(1, 2, 3, 1, 2, 3) cut(x, n)：将连续型变量x分割为有着n个水平的因子 pretty(x, n)：创建美观的分割点，绘图中常用。通过选取n+1个等间距的取整值，将一个连续型变量x分割为n个区间 cat(... , file =“myfile”, append =FALSE)：连接...中的对象 转义字符：\n表示新行，\t为制表符，\’为单引号，\b为退 格 … … name &lt;- &quot;Bob&quot; cat( &quot;Hello&quot;, name, &quot;\b.\n&quot;, &quot;Isn\&#39;t R&quot;, &quot;\t&quot;, &quot;GREAT?\n&quot;) # 输出 Hello Bob. Isn&#39;t R GREAT? 例题： 将学生的各科考试成绩组合为单一的成绩衡量指标，基于相对名次（前20%、后20%等）给出 从A到F的评分，根据学生姓氏和名字的首字母对花名册进行排序 # 第1步：创建学生花名册数据框roster options(digits=2) Student &lt;- c(&quot;John Davis&quot;, &quot;Angela Williams&quot;, &quot;Bullwinkle Moose&quot;, &quot;David Jones&quot;, &quot;Janice Markhammer&quot;, &quot;Cheryl Cushing&quot;,&quot;Reuven Ytzrhak&quot;, &quot;Greg Knox&quot;, &quot;Joel England&quot;,&quot;Mary Rayburn&quot;) Math &lt;- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522) Science &lt;- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86) English &lt;- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18) roster &lt;- data.frame(Student, Math, Science, English, stringsAsFactors=FALSE) # 限制字符向量变成因子 # 第2步：对各科成绩进行标准化操作（因为数学、科学和英语考试 的分值不同，所以需要在组合之前让它们变得可以比较） z &lt;- scale(roster[ , 2:4]) # 第3步：创建向量score，来计算每个学生3科成绩的平均值，并将score合并到花名册数据框roster 中 score &lt;- apply(z, 1, mean) roster &lt;- cbind(roster, score) # 第4步：为了给出五级制学分评级，对score变量计算中位数 y &lt;- quantile(score, c(.8,.6,.4,.2)) # 第5步：新建变量grade，计算学生的五级制评分 roster$grade[score &gt;= y[1]] &lt;- &quot;A&quot; roster$grade[score &lt; y[1] &amp; score &gt;= y[2]] &lt;- &quot;B&quot; roster$grade[score &lt; y[2] &amp; score &gt;= y[3]] &lt;- &quot;C&quot; roster$grade[score &lt; y[3] &amp; score &gt;= y[4]] &lt;- &quot;D&quot; roster$grade[score &lt; y[4]] &lt;- &quot;F&quot; # 第6步：将学生姓名拆分为姓氏和名字 name &lt;- strsplit((roster$Student), &quot; &quot;) # 以空格为界对学生的姓名进行拆分，返回拆分后的姓名列表 # 第7步：新建变量Firstname和Lastname存放名字和姓氏，并合并 到roster中 lastname &lt;- sapply (name, &quot;[&quot;, 2) # [”可以提取对象的一 部分，sapply专门对列表或者数据框进行分组统计 firstname &lt;- sapply (name, &quot;[&quot;, 1) roster &lt;- cbind (firstname, lastname, roster[,-1]) # 删除roster的第一列姓名列 # 第8步：依姓氏和名字对花名册roster进行排序 roster &lt;- roster[order(lastname,firstname), ] roster # 输出 firstname lastname Math Science English score grade 3 Bullwinkle 412 80 18 -0.86 D 6 Cheryl 512 85 28 0.35 C 10 Mary 522 86 18 -0.18 C 1 John Davis 502 95 25 0.56 B 9 Joel England 573 89 27 0.70 B 4 David Jones 358 82 15 -1.16 F 8 Greg Knox 625 95 30 1.34 A 5 Janice Markhammer 495 75 20 -0.63 D 2 Angela Williams 600 99 22 0.92 A 7 Reuven Ytzrhak 410 80 15 -1.05 F 控制流 重复和循环 for结构 for (var in seq) statement for (i in 1:10) print(&quot;Hello&quot;) # Hello被输出了10次 while循环 while (cond) statement i &lt;- 10 while (i&gt;0) { print(&quot;hello&quot;) i &lt;- i -1 } 条件语句 if-else结构 if (cond) statement if (cond) statement1 else statement2 若cond为TRUE，则执行statement语句 if (is.character(grade)) grade &lt;- as.factor(grade) # 如果grade是一个字符向量，它就会被转换为一个因子 if ( !is.factor(grade)) grade &lt;- as.factor(grade) else print(&quot;Grade already”) # 如果grade不是一个因子，它就会被转换为一个因子；如果它是一个因子，就会输出一段信息 ifelse结构 ifelse (cond, statement1, statement2) 若cond为TRUE，则执行statement1语句；若cond为FALSE，则 执行statement2语句 ifelse (score &gt; 0.5, print(&quot;Passed&quot;), print(&quot;Failed&quot;)) outcome &lt;- ifelse (score &gt; 0.5, &quot;Passed&quot;, &quot;Failed&quot;) switch结构 switch (expr, …) 其中“…” 表示与expr的各种可能输出值绑定的语句 feelings &lt;- c(&quot;sad&quot;, &quot;afraid&quot;) for (i in feelings) print(switch(i, happy = &quot;I am glad you are happy&quot;, afraid = &quot;There is nothing to fear&quot;, sad = &quot;Cheer up&quot;, angry = &quot;Calm down now&quot; ) ) # 输出 [1] &quot;Cheer up&quot; [1] &quot;There is nothing to fear&quot; 用户自编函数 myfunction &lt;- function(arg1, arg2, ... ){ statements return(object) } 注意： 函数中的对象只在函数内部使用 返回对象的数据类型是任意的，从标量到列表都可以 例题： 编写一个函数，用来计算数据对象的集中趋势和散布情况： 可以选择性地计算参数统计量（均值和标准差）和非参数统计量（中位数和绝对中位差）； 结果以列表的形式给出； 可以选择是否自动输出结果； 除非另外指定，否则此函数的默认行为是计算参数统计量并且不输出结果。 mystats &lt;- function(x, parametric=TRUE, print=FALSE) { if (parametric) { # 根据参数parametric确定应该怎样计算 center &lt;- mean(x); spread &lt;- sd(x) } else { center &lt;- median(x); spread &lt;- mad(x) } if (print &amp; parametric) { # 根据参数print确定是否打印 cat(&quot;Mean=&quot;, center, &quot;\n&quot;, &quot;SD=&quot;, spread, &quot;\n&quot;) } else if (print &amp; !parametric) { cat(&quot;Median=&quot;, center, &quot;\n&quot;, &quot;MAD=&quot;, spread, &quot;\n&quot;) } result &lt;- list(center=center, spread=spread) return(result) } set.seed(1234) x &lt;- rnorm(500) y &lt;- mystats(x) # y$center包含均值，y$spread包含标准差，并且没有输出结果 y &lt;- mystats(x, parametric=FALSE, print=TRUE) # 输出 Median= -0.021 MAD= 1 例题： 编写一个函数，可让用户选择输出当天日期的格式： mydate &lt;- function(type=&quot;long&quot;) { switch(type, long = format( Sys.time( ), &quot;%A %B %d %Y&quot; ), short = format( Sys.time( ), &quot;%m-%d-%y&quot; ), cat(type, &quot;is not a recognized type\n&quot;)) # 函数cat()仅会在输入的日期 格式类型不匹配&quot;long&quot;或&quot;short&quot;时执行 } mydate(&quot;long&quot;) # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;short&quot;) # 输出 [1] &quot;08-10-19&quot; mydate() # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;medium&quot;) # 输出 medium is not a recognized type 数据的整合与重塑 转置 函数t( ) 可对一个矩阵或数据框进行转置 mtcars&lt;-mtcars cars &lt;- mtcars[1:5, 1:4] # 输出 cars mpg cyl disp hp Mazda RX4 21 6 160 110 Mazda RX4 Wag 21 6 160 110 Datsun 710 23 4 108 93 Hornet 4 Drive 21 6 258 110 Hornet Sportabout 19 8 360 175 t(cars) # 输出 Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive Hornet Sportabout mpg 21 21 23 21 19 cyl 6 6 4 6 8 disp 160 160 108 258 360 hp 110 110 93 110 175 整合数据 aggregate(x, by, FUN) 其中，x是待折叠的数据对象，by是由整合变量所组成的列表，FUN是计算新观测的标量函数 options(digits=3) attach(mtcars) aggdata &lt;-aggregate(mtcars, by=list(cyl,gear), FUN=mean, na.rm=TRUE) # 根据气缸数cyl和档位数gear整合mtcars数据，并返回各数值型变量的均值 aggdata # 输出 Group.1 Group.2 mpg cyl disp hp drat wt qsec vs am gear carb 1 4 3 21.5 4 120 97 3.70 2.46 20.0 1.0 0.00 3 1.00 2 6 3 19.8 6 242 108 2.92 3.34 19.8 1.0 0.00 3 1.00 3 8 3 15.1 8 358 194 3.12 4.10 17.1 0.0 0.00 3 3.08 4 4 4 26.9 4 103 76 4.11 2.38 19.6 1.0 0.75 4 1.50 5 6 4 19.8 6 164 116 3.91 3.09 17.7 0.5 0.50 4 4.00 6 4 5 28.2 4 108 102 4.10 1.83 16.8 0.5 1.00 5 2.00 7 6 5 19.7 6 145 175 3.62 2.77 15.5 0.0 1.00 5 6.00 8 8 5 15.4 8 326 300 3.88 3.37 14.6 0.0 1.00 5 6.00 detach(mtcars)" />
<meta property="og:description" content="高级数据管理 数值和字符处理函数 数学函数 abs(x)：求绝对值，例如 abs(-4) #返回值为4 sqrt(x)：求平方根，例如 sqrt(25) #返回值为5 ceiling(x)：不小于x 的最小整数，例如 ceiling(3.475) #返回值为4 floor(x)：不大于x 的最大整数，例如 floor(3.475) #返回值为3 trunc(x)：向0的方向截取的x 中的整数部分，例如 trunc(5.99) #返回值为5 round(x, digits=n)：将x舍入为指定位的小数，例如 round(3.475, digits=2) #返回值为3.48 signif(x, digits=n)：将x舍入为指定的有效数字位数，例如 signif(3.475, digits=2) #返回值为3.5 cos(x)、sin(x)、tan(x)：余弦、正弦和正切，例如 cos(2) #返回值为–0.416 acos(x)、asin(x)、atan(x)：反余弦、反正弦和反正切，例如 acos(-0.416) #返回值为2 cosh(x)、sinh(x)、tanh(x)：双曲余弦、双曲正弦和双曲正切， 例如 sinh(2) #返回值为3.627 acosh(x)、asinh(x)、atanh(x)：反双曲余弦、反双曲正弦和反双曲正切，例如 asinh(3.627) #返回值为2 log(x, base=n)：对x取以n 为底的对数 log(x)：自然对数 log10(x)：以10为底的对数 exp(x)：指数函数，例如exp(2.3026) #返回值为10 统计函数 mean(x)：平均数，例如 mean(c(1,2,3,4)) #返回值为2.5 median(x)：中位数，例如 median(c(1,2,3,4)) #返回值为2.5 sd(x)：标准差，例如 sd(c(1,2,3,4)) var(x)：方差，例如 var(c(1,2,3,4)) mad(x)：绝对中位差，例如 mad(c(1,2,3,4)) #返回值为1.48 quantile(x, probs)：求分位数，例如 y &lt;- quantile(x,c(.3,.84)) #返回值为x的30%和84%分位点 range(x)：求值域，例如 range(c(1,2,3,4)) #返回值为c(1,4) sum(x)：求和，例如 sum(c(1,2,3,4)) #返回值为10 diff(x, lag=n)：差分函数,lag为差分项,默认值为1,例如 diff(c(1, 5, 23, 29)) #返回值为c(4,18,6) min(x)：求最小值，例如 min(c(1,2,3,4)) #返回值为1 max(x)：求最大值，例如 max(c(1,2,3,4)) #返回值为4 scale(x, center=TRUE, scale=TRUE)：为数据对象x按列进行中心化(center=TRUE)或标准化(center=TRUE, scale=TRUE) 概率函数 在R中，概率函数形如 ：[dpqr]分布名称缩写( ) 其中第一个字母表示其所指分布的某一方面： d = 密度函数（density function） p = 分布函数（distribution function） q = 分位数函数（quantile function） r = 生成随机数（随机偏差） # 在[-3, 3]区间上绘制标准正态曲线 x &lt;- pretty(c(-3,3), 30) # 在[-3, 3]选取31个等分点 y &lt;- dnorm(x) plot(x, y, type = &quot;l&quot;, xlab = &quot;Normal Deviate&quot;, ylab = &quot;Density&quot;, yaxs = &quot;i&quot; ) pnorm(1.96) #位于z=1.96 左侧的标准正态曲线下方面积，返回值为0.975 qnorm(.9, mean=500, sd=100) #均值为500，标准差为100的正态分布的0.9分位点，返回值为628.16 rnorm(50, mean=50, sd=10) #生成50 个均值为50，标准差为10的正态随机数 设定随机数种子 在每次生成伪随机数的时候，函数都会使用一个不同的种子，因此也会产生不同的结果；可以通过函数 set.seed() 显式指定这个种子，让结果可以重现 runif(5) # 输出 0.5684550 0.2155904 0.6656250 0.6798496 0.7349901 runif(5) # 输出 0.70508234 0.45849879 0.21018669 0.08474743 0.79296225 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 生成多元正态数据 MASS包中的mvrnorm()函数可以生成给定均值向量和协方差阵的多元正态分布的随机数： mvrnorm(n, mean, sigma) 其中n是样本大小，mean为均值向量，而sigma是协方差矩阵 library(MASS) options(digits=3) set.seed(1234) # 设定随机数种子 mean &lt;- c(230.7, 146.7, 3.6) sigma &lt;- matrix( c(15360.8, 6721.2, -47.1, 6721.2, 4700.9, -16.5, -47.1, -16.5, 0.3), nrow=3, ncol=3) mydata &lt;- mvrnorm(500, mean, sigma) # 取500个观测值 mydata &lt;- as.data.frame(mydata) # 把矩阵转换为数据框 names(mydata) &lt;- c(&quot;y&quot;, &quot;x1&quot;, &quot;x2&quot;) # 指定数据框的名称 dim(mydata) # 查看数据 # 输出 500 3 head(mydata, n=10) # 查看前10行数据 # 输出 y x1 x2 1 98.8 41.3 3.43 2 244.5 205.2 3.80 3 375.7 186.7 2.51 4 -59.2 11.2 4.71 5 313.0 111.0 3.45 6 288.8 185.1 2.72 7 134.8 165.0 4.39 8 171.7 97.4 3.64 9 167.2 101.0 3.50 10 121.1 94.5 4.10 字符处理函数 nchar(x)：计算x 中的字符数量，例如x &lt;- c(&quot;ab&quot;, &quot;cde&quot;,&quot;fghij&quot;)，则nchar(x[3])返回值为5 substr(x, start, stop)：提取子串，例如 x &lt;- &quot;abcdef&quot;，则 substr(x, 2, 4)返回值为&quot;bcd&quot; grep(pattern, x, ignore.case=FALSE, fixed=FALSE)：在x中匹配搜索pattern，返回值为匹配的下标；若fixed=FALSE，则pattern 为一个正则表达式，若fixed=TRUE，则pattern 为一 个文本字符串。例如grep(&quot;A&quot;, c(&quot;b&quot;, &quot;A&quot;, &quot;c&quot;), fixed=TRUE) # 返回值为2 sub(pattern, replacement, x, ignore.case=FALSE,fixed=FALSE)：在x中搜索pattern，并以文本replacement将其替换。例如sub(&quot;\\s&quot;, &quot;.&quot;, &quot;Hello There&quot;) # 返回值为Hello.There 注意，&quot;\s&quot;是一个用来查找空白的正则表达式 strsplit(x, split, fixed=FALSE)：在split处分割字符向量x中的元素，例如y &lt;- strsplit(&quot;abc&quot;, &quot;&quot;) # 返回含有3个元素的列表，包含的内容为&quot;a&quot; &quot;b&quot; &quot;c&quot; paste(…, sep=&quot;&quot;)：连接字符串，分隔符为sep，例如paste(&quot;x&quot;, 1:3, sep=&quot;M&quot;) # 返回值为c(&quot;xM1&quot;,&quot;xM2&quot; &quot;xM3&quot;) toupper(x)：大写转换，例如 &gt; toupper(&quot;abc&quot;) # 返回值为 &quot;ABC&quot; tolower (x)：小写转换，例如 &gt; tolower (&quot;ABC&quot;) # 返回值为 &quot;abc&quot; 其他实用函数 length(x)：对象x的长度，例如x &lt;- c(2, 5, 6, 9) # 返回值为4 seq(from, to, by)：生成一个序列，例如indices &lt;-seq(1,10,2) # indices的值为c(1, 3, 5, 7, 9) rep(x, n)：将x重复n次，例如y &lt;- rep(1:3, 2) # y 的值为c(1, 2, 3, 1, 2, 3) cut(x, n)：将连续型变量x分割为有着n个水平的因子 pretty(x, n)：创建美观的分割点，绘图中常用。通过选取n+1个等间距的取整值，将一个连续型变量x分割为n个区间 cat(... , file =“myfile”, append =FALSE)：连接...中的对象 转义字符：\n表示新行，\t为制表符，\’为单引号，\b为退 格 … … name &lt;- &quot;Bob&quot; cat( &quot;Hello&quot;, name, &quot;\b.\n&quot;, &quot;Isn\&#39;t R&quot;, &quot;\t&quot;, &quot;GREAT?\n&quot;) # 输出 Hello Bob. Isn&#39;t R GREAT? 例题： 将学生的各科考试成绩组合为单一的成绩衡量指标，基于相对名次（前20%、后20%等）给出 从A到F的评分，根据学生姓氏和名字的首字母对花名册进行排序 # 第1步：创建学生花名册数据框roster options(digits=2) Student &lt;- c(&quot;John Davis&quot;, &quot;Angela Williams&quot;, &quot;Bullwinkle Moose&quot;, &quot;David Jones&quot;, &quot;Janice Markhammer&quot;, &quot;Cheryl Cushing&quot;,&quot;Reuven Ytzrhak&quot;, &quot;Greg Knox&quot;, &quot;Joel England&quot;,&quot;Mary Rayburn&quot;) Math &lt;- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522) Science &lt;- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86) English &lt;- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18) roster &lt;- data.frame(Student, Math, Science, English, stringsAsFactors=FALSE) # 限制字符向量变成因子 # 第2步：对各科成绩进行标准化操作（因为数学、科学和英语考试 的分值不同，所以需要在组合之前让它们变得可以比较） z &lt;- scale(roster[ , 2:4]) # 第3步：创建向量score，来计算每个学生3科成绩的平均值，并将score合并到花名册数据框roster 中 score &lt;- apply(z, 1, mean) roster &lt;- cbind(roster, score) # 第4步：为了给出五级制学分评级，对score变量计算中位数 y &lt;- quantile(score, c(.8,.6,.4,.2)) # 第5步：新建变量grade，计算学生的五级制评分 roster$grade[score &gt;= y[1]] &lt;- &quot;A&quot; roster$grade[score &lt; y[1] &amp; score &gt;= y[2]] &lt;- &quot;B&quot; roster$grade[score &lt; y[2] &amp; score &gt;= y[3]] &lt;- &quot;C&quot; roster$grade[score &lt; y[3] &amp; score &gt;= y[4]] &lt;- &quot;D&quot; roster$grade[score &lt; y[4]] &lt;- &quot;F&quot; # 第6步：将学生姓名拆分为姓氏和名字 name &lt;- strsplit((roster$Student), &quot; &quot;) # 以空格为界对学生的姓名进行拆分，返回拆分后的姓名列表 # 第7步：新建变量Firstname和Lastname存放名字和姓氏，并合并 到roster中 lastname &lt;- sapply (name, &quot;[&quot;, 2) # [”可以提取对象的一 部分，sapply专门对列表或者数据框进行分组统计 firstname &lt;- sapply (name, &quot;[&quot;, 1) roster &lt;- cbind (firstname, lastname, roster[,-1]) # 删除roster的第一列姓名列 # 第8步：依姓氏和名字对花名册roster进行排序 roster &lt;- roster[order(lastname,firstname), ] roster # 输出 firstname lastname Math Science English score grade 3 Bullwinkle 412 80 18 -0.86 D 6 Cheryl 512 85 28 0.35 C 10 Mary 522 86 18 -0.18 C 1 John Davis 502 95 25 0.56 B 9 Joel England 573 89 27 0.70 B 4 David Jones 358 82 15 -1.16 F 8 Greg Knox 625 95 30 1.34 A 5 Janice Markhammer 495 75 20 -0.63 D 2 Angela Williams 600 99 22 0.92 A 7 Reuven Ytzrhak 410 80 15 -1.05 F 控制流 重复和循环 for结构 for (var in seq) statement for (i in 1:10) print(&quot;Hello&quot;) # Hello被输出了10次 while循环 while (cond) statement i &lt;- 10 while (i&gt;0) { print(&quot;hello&quot;) i &lt;- i -1 } 条件语句 if-else结构 if (cond) statement if (cond) statement1 else statement2 若cond为TRUE，则执行statement语句 if (is.character(grade)) grade &lt;- as.factor(grade) # 如果grade是一个字符向量，它就会被转换为一个因子 if ( !is.factor(grade)) grade &lt;- as.factor(grade) else print(&quot;Grade already”) # 如果grade不是一个因子，它就会被转换为一个因子；如果它是一个因子，就会输出一段信息 ifelse结构 ifelse (cond, statement1, statement2) 若cond为TRUE，则执行statement1语句；若cond为FALSE，则 执行statement2语句 ifelse (score &gt; 0.5, print(&quot;Passed&quot;), print(&quot;Failed&quot;)) outcome &lt;- ifelse (score &gt; 0.5, &quot;Passed&quot;, &quot;Failed&quot;) switch结构 switch (expr, …) 其中“…” 表示与expr的各种可能输出值绑定的语句 feelings &lt;- c(&quot;sad&quot;, &quot;afraid&quot;) for (i in feelings) print(switch(i, happy = &quot;I am glad you are happy&quot;, afraid = &quot;There is nothing to fear&quot;, sad = &quot;Cheer up&quot;, angry = &quot;Calm down now&quot; ) ) # 输出 [1] &quot;Cheer up&quot; [1] &quot;There is nothing to fear&quot; 用户自编函数 myfunction &lt;- function(arg1, arg2, ... ){ statements return(object) } 注意： 函数中的对象只在函数内部使用 返回对象的数据类型是任意的，从标量到列表都可以 例题： 编写一个函数，用来计算数据对象的集中趋势和散布情况： 可以选择性地计算参数统计量（均值和标准差）和非参数统计量（中位数和绝对中位差）； 结果以列表的形式给出； 可以选择是否自动输出结果； 除非另外指定，否则此函数的默认行为是计算参数统计量并且不输出结果。 mystats &lt;- function(x, parametric=TRUE, print=FALSE) { if (parametric) { # 根据参数parametric确定应该怎样计算 center &lt;- mean(x); spread &lt;- sd(x) } else { center &lt;- median(x); spread &lt;- mad(x) } if (print &amp; parametric) { # 根据参数print确定是否打印 cat(&quot;Mean=&quot;, center, &quot;\n&quot;, &quot;SD=&quot;, spread, &quot;\n&quot;) } else if (print &amp; !parametric) { cat(&quot;Median=&quot;, center, &quot;\n&quot;, &quot;MAD=&quot;, spread, &quot;\n&quot;) } result &lt;- list(center=center, spread=spread) return(result) } set.seed(1234) x &lt;- rnorm(500) y &lt;- mystats(x) # y$center包含均值，y$spread包含标准差，并且没有输出结果 y &lt;- mystats(x, parametric=FALSE, print=TRUE) # 输出 Median= -0.021 MAD= 1 例题： 编写一个函数，可让用户选择输出当天日期的格式： mydate &lt;- function(type=&quot;long&quot;) { switch(type, long = format( Sys.time( ), &quot;%A %B %d %Y&quot; ), short = format( Sys.time( ), &quot;%m-%d-%y&quot; ), cat(type, &quot;is not a recognized type\n&quot;)) # 函数cat()仅会在输入的日期 格式类型不匹配&quot;long&quot;或&quot;short&quot;时执行 } mydate(&quot;long&quot;) # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;short&quot;) # 输出 [1] &quot;08-10-19&quot; mydate() # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;medium&quot;) # 输出 medium is not a recognized type 数据的整合与重塑 转置 函数t( ) 可对一个矩阵或数据框进行转置 mtcars&lt;-mtcars cars &lt;- mtcars[1:5, 1:4] # 输出 cars mpg cyl disp hp Mazda RX4 21 6 160 110 Mazda RX4 Wag 21 6 160 110 Datsun 710 23 4 108 93 Hornet 4 Drive 21 6 258 110 Hornet Sportabout 19 8 360 175 t(cars) # 输出 Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive Hornet Sportabout mpg 21 21 23 21 19 cyl 6 6 4 6 8 disp 160 160 108 258 360 hp 110 110 93 110 175 整合数据 aggregate(x, by, FUN) 其中，x是待折叠的数据对象，by是由整合变量所组成的列表，FUN是计算新观测的标量函数 options(digits=3) attach(mtcars) aggdata &lt;-aggregate(mtcars, by=list(cyl,gear), FUN=mean, na.rm=TRUE) # 根据气缸数cyl和档位数gear整合mtcars数据，并返回各数值型变量的均值 aggdata # 输出 Group.1 Group.2 mpg cyl disp hp drat wt qsec vs am gear carb 1 4 3 21.5 4 120 97 3.70 2.46 20.0 1.0 0.00 3 1.00 2 6 3 19.8 6 242 108 2.92 3.34 19.8 1.0 0.00 3 1.00 3 8 3 15.1 8 358 194 3.12 4.10 17.1 0.0 0.00 3 3.08 4 4 4 26.9 4 103 76 4.11 2.38 19.6 1.0 0.75 4 1.50 5 6 4 19.8 6 164 116 3.91 3.09 17.7 0.5 0.50 4 4.00 6 4 5 28.2 4 108 102 4.10 1.83 16.8 0.5 1.00 5 2.00 7 6 5 19.7 6 145 175 3.62 2.77 15.5 0.0 1.00 5 6.00 8 8 5 15.4 8 326 300 3.88 3.37 14.6 0.0 1.00 5 6.00 detach(mtcars)" />
<link rel="canonical" href="https://uzzz.org/2019/08/10/793353.html" />
<meta property="og:url" content="https://uzzz.org/2019/08/10/793353.html" />
<meta property="og:site_name" content="有组织在！" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-10T00:00:00+08:00" />
<script type="application/ld+json">
{"description":"高级数据管理 数值和字符处理函数 数学函数 abs(x)：求绝对值，例如 abs(-4) #返回值为4 sqrt(x)：求平方根，例如 sqrt(25) #返回值为5 ceiling(x)：不小于x 的最小整数，例如 ceiling(3.475) #返回值为4 floor(x)：不大于x 的最大整数，例如 floor(3.475) #返回值为3 trunc(x)：向0的方向截取的x 中的整数部分，例如 trunc(5.99) #返回值为5 round(x, digits=n)：将x舍入为指定位的小数，例如 round(3.475, digits=2) #返回值为3.48 signif(x, digits=n)：将x舍入为指定的有效数字位数，例如 signif(3.475, digits=2) #返回值为3.5 cos(x)、sin(x)、tan(x)：余弦、正弦和正切，例如 cos(2) #返回值为–0.416 acos(x)、asin(x)、atan(x)：反余弦、反正弦和反正切，例如 acos(-0.416) #返回值为2 cosh(x)、sinh(x)、tanh(x)：双曲余弦、双曲正弦和双曲正切， 例如 sinh(2) #返回值为3.627 acosh(x)、asinh(x)、atanh(x)：反双曲余弦、反双曲正弦和反双曲正切，例如 asinh(3.627) #返回值为2 log(x, base=n)：对x取以n 为底的对数 log(x)：自然对数 log10(x)：以10为底的对数 exp(x)：指数函数，例如exp(2.3026) #返回值为10 统计函数 mean(x)：平均数，例如 mean(c(1,2,3,4)) #返回值为2.5 median(x)：中位数，例如 median(c(1,2,3,4)) #返回值为2.5 sd(x)：标准差，例如 sd(c(1,2,3,4)) var(x)：方差，例如 var(c(1,2,3,4)) mad(x)：绝对中位差，例如 mad(c(1,2,3,4)) #返回值为1.48 quantile(x, probs)：求分位数，例如 y &lt;- quantile(x,c(.3,.84)) #返回值为x的30%和84%分位点 range(x)：求值域，例如 range(c(1,2,3,4)) #返回值为c(1,4) sum(x)：求和，例如 sum(c(1,2,3,4)) #返回值为10 diff(x, lag=n)：差分函数,lag为差分项,默认值为1,例如 diff(c(1, 5, 23, 29)) #返回值为c(4,18,6) min(x)：求最小值，例如 min(c(1,2,3,4)) #返回值为1 max(x)：求最大值，例如 max(c(1,2,3,4)) #返回值为4 scale(x, center=TRUE, scale=TRUE)：为数据对象x按列进行中心化(center=TRUE)或标准化(center=TRUE, scale=TRUE) 概率函数 在R中，概率函数形如 ：[dpqr]分布名称缩写( ) 其中第一个字母表示其所指分布的某一方面： d = 密度函数（density function） p = 分布函数（distribution function） q = 分位数函数（quantile function） r = 生成随机数（随机偏差） # 在[-3, 3]区间上绘制标准正态曲线 x &lt;- pretty(c(-3,3), 30) # 在[-3, 3]选取31个等分点 y &lt;- dnorm(x) plot(x, y, type = &quot;l&quot;, xlab = &quot;Normal Deviate&quot;, ylab = &quot;Density&quot;, yaxs = &quot;i&quot; ) pnorm(1.96) #位于z=1.96 左侧的标准正态曲线下方面积，返回值为0.975 qnorm(.9, mean=500, sd=100) #均值为500，标准差为100的正态分布的0.9分位点，返回值为628.16 rnorm(50, mean=50, sd=10) #生成50 个均值为50，标准差为10的正态随机数 设定随机数种子 在每次生成伪随机数的时候，函数都会使用一个不同的种子，因此也会产生不同的结果；可以通过函数 set.seed() 显式指定这个种子，让结果可以重现 runif(5) # 输出 0.5684550 0.2155904 0.6656250 0.6798496 0.7349901 runif(5) # 输出 0.70508234 0.45849879 0.21018669 0.08474743 0.79296225 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 set.seed(1234) runif(5) # 输出 0.1137034 0.6222994 0.6092747 0.6233794 0.8609154 生成多元正态数据 MASS包中的mvrnorm()函数可以生成给定均值向量和协方差阵的多元正态分布的随机数： mvrnorm(n, mean, sigma) 其中n是样本大小，mean为均值向量，而sigma是协方差矩阵 library(MASS) options(digits=3) set.seed(1234) # 设定随机数种子 mean &lt;- c(230.7, 146.7, 3.6) sigma &lt;- matrix( c(15360.8, 6721.2, -47.1, 6721.2, 4700.9, -16.5, -47.1, -16.5, 0.3), nrow=3, ncol=3) mydata &lt;- mvrnorm(500, mean, sigma) # 取500个观测值 mydata &lt;- as.data.frame(mydata) # 把矩阵转换为数据框 names(mydata) &lt;- c(&quot;y&quot;, &quot;x1&quot;, &quot;x2&quot;) # 指定数据框的名称 dim(mydata) # 查看数据 # 输出 500 3 head(mydata, n=10) # 查看前10行数据 # 输出 y x1 x2 1 98.8 41.3 3.43 2 244.5 205.2 3.80 3 375.7 186.7 2.51 4 -59.2 11.2 4.71 5 313.0 111.0 3.45 6 288.8 185.1 2.72 7 134.8 165.0 4.39 8 171.7 97.4 3.64 9 167.2 101.0 3.50 10 121.1 94.5 4.10 字符处理函数 nchar(x)：计算x 中的字符数量，例如x &lt;- c(&quot;ab&quot;, &quot;cde&quot;,&quot;fghij&quot;)，则nchar(x[3])返回值为5 substr(x, start, stop)：提取子串，例如 x &lt;- &quot;abcdef&quot;，则 substr(x, 2, 4)返回值为&quot;bcd&quot; grep(pattern, x, ignore.case=FALSE, fixed=FALSE)：在x中匹配搜索pattern，返回值为匹配的下标；若fixed=FALSE，则pattern 为一个正则表达式，若fixed=TRUE，则pattern 为一 个文本字符串。例如grep(&quot;A&quot;, c(&quot;b&quot;, &quot;A&quot;, &quot;c&quot;), fixed=TRUE) # 返回值为2 sub(pattern, replacement, x, ignore.case=FALSE,fixed=FALSE)：在x中搜索pattern，并以文本replacement将其替换。例如sub(&quot;\\\\s&quot;, &quot;.&quot;, &quot;Hello There&quot;) # 返回值为Hello.There 注意，&quot;\\s&quot;是一个用来查找空白的正则表达式 strsplit(x, split, fixed=FALSE)：在split处分割字符向量x中的元素，例如y &lt;- strsplit(&quot;abc&quot;, &quot;&quot;) # 返回含有3个元素的列表，包含的内容为&quot;a&quot; &quot;b&quot; &quot;c&quot; paste(…, sep=&quot;&quot;)：连接字符串，分隔符为sep，例如paste(&quot;x&quot;, 1:3, sep=&quot;M&quot;) # 返回值为c(&quot;xM1&quot;,&quot;xM2&quot; &quot;xM3&quot;) toupper(x)：大写转换，例如 &gt; toupper(&quot;abc&quot;) # 返回值为 &quot;ABC&quot; tolower (x)：小写转换，例如 &gt; tolower (&quot;ABC&quot;) # 返回值为 &quot;abc&quot; 其他实用函数 length(x)：对象x的长度，例如x &lt;- c(2, 5, 6, 9) # 返回值为4 seq(from, to, by)：生成一个序列，例如indices &lt;-seq(1,10,2) # indices的值为c(1, 3, 5, 7, 9) rep(x, n)：将x重复n次，例如y &lt;- rep(1:3, 2) # y 的值为c(1, 2, 3, 1, 2, 3) cut(x, n)：将连续型变量x分割为有着n个水平的因子 pretty(x, n)：创建美观的分割点，绘图中常用。通过选取n+1个等间距的取整值，将一个连续型变量x分割为n个区间 cat(... , file =“myfile”, append =FALSE)：连接...中的对象 转义字符：\\n表示新行，\\t为制表符，\\’为单引号，\\b为退 格 … … name &lt;- &quot;Bob&quot; cat( &quot;Hello&quot;, name, &quot;\\b.\\n&quot;, &quot;Isn\\&#39;t R&quot;, &quot;\\t&quot;, &quot;GREAT?\\n&quot;) # 输出 Hello Bob. Isn&#39;t R GREAT? 例题： 将学生的各科考试成绩组合为单一的成绩衡量指标，基于相对名次（前20%、后20%等）给出 从A到F的评分，根据学生姓氏和名字的首字母对花名册进行排序 # 第1步：创建学生花名册数据框roster options(digits=2) Student &lt;- c(&quot;John Davis&quot;, &quot;Angela Williams&quot;, &quot;Bullwinkle Moose&quot;, &quot;David Jones&quot;, &quot;Janice Markhammer&quot;, &quot;Cheryl Cushing&quot;,&quot;Reuven Ytzrhak&quot;, &quot;Greg Knox&quot;, &quot;Joel England&quot;,&quot;Mary Rayburn&quot;) Math &lt;- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522) Science &lt;- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86) English &lt;- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18) roster &lt;- data.frame(Student, Math, Science, English, stringsAsFactors=FALSE) # 限制字符向量变成因子 # 第2步：对各科成绩进行标准化操作（因为数学、科学和英语考试 的分值不同，所以需要在组合之前让它们变得可以比较） z &lt;- scale(roster[ , 2:4]) # 第3步：创建向量score，来计算每个学生3科成绩的平均值，并将score合并到花名册数据框roster 中 score &lt;- apply(z, 1, mean) roster &lt;- cbind(roster, score) # 第4步：为了给出五级制学分评级，对score变量计算中位数 y &lt;- quantile(score, c(.8,.6,.4,.2)) # 第5步：新建变量grade，计算学生的五级制评分 roster$grade[score &gt;= y[1]] &lt;- &quot;A&quot; roster$grade[score &lt; y[1] &amp; score &gt;= y[2]] &lt;- &quot;B&quot; roster$grade[score &lt; y[2] &amp; score &gt;= y[3]] &lt;- &quot;C&quot; roster$grade[score &lt; y[3] &amp; score &gt;= y[4]] &lt;- &quot;D&quot; roster$grade[score &lt; y[4]] &lt;- &quot;F&quot; # 第6步：将学生姓名拆分为姓氏和名字 name &lt;- strsplit((roster$Student), &quot; &quot;) # 以空格为界对学生的姓名进行拆分，返回拆分后的姓名列表 # 第7步：新建变量Firstname和Lastname存放名字和姓氏，并合并 到roster中 lastname &lt;- sapply (name, &quot;[&quot;, 2) # [”可以提取对象的一 部分，sapply专门对列表或者数据框进行分组统计 firstname &lt;- sapply (name, &quot;[&quot;, 1) roster &lt;- cbind (firstname, lastname, roster[,-1]) # 删除roster的第一列姓名列 # 第8步：依姓氏和名字对花名册roster进行排序 roster &lt;- roster[order(lastname,firstname), ] roster # 输出 firstname lastname Math Science English score grade 3 Bullwinkle 412 80 18 -0.86 D 6 Cheryl 512 85 28 0.35 C 10 Mary 522 86 18 -0.18 C 1 John Davis 502 95 25 0.56 B 9 Joel England 573 89 27 0.70 B 4 David Jones 358 82 15 -1.16 F 8 Greg Knox 625 95 30 1.34 A 5 Janice Markhammer 495 75 20 -0.63 D 2 Angela Williams 600 99 22 0.92 A 7 Reuven Ytzrhak 410 80 15 -1.05 F 控制流 重复和循环 for结构 for (var in seq) statement for (i in 1:10) print(&quot;Hello&quot;) # Hello被输出了10次 while循环 while (cond) statement i &lt;- 10 while (i&gt;0) { print(&quot;hello&quot;) i &lt;- i -1 } 条件语句 if-else结构 if (cond) statement if (cond) statement1 else statement2 若cond为TRUE，则执行statement语句 if (is.character(grade)) grade &lt;- as.factor(grade) # 如果grade是一个字符向量，它就会被转换为一个因子 if ( !is.factor(grade)) grade &lt;- as.factor(grade) else print(&quot;Grade already”) # 如果grade不是一个因子，它就会被转换为一个因子；如果它是一个因子，就会输出一段信息 ifelse结构 ifelse (cond, statement1, statement2) 若cond为TRUE，则执行statement1语句；若cond为FALSE，则 执行statement2语句 ifelse (score &gt; 0.5, print(&quot;Passed&quot;), print(&quot;Failed&quot;)) outcome &lt;- ifelse (score &gt; 0.5, &quot;Passed&quot;, &quot;Failed&quot;) switch结构 switch (expr, …) 其中“…” 表示与expr的各种可能输出值绑定的语句 feelings &lt;- c(&quot;sad&quot;, &quot;afraid&quot;) for (i in feelings) print(switch(i, happy = &quot;I am glad you are happy&quot;, afraid = &quot;There is nothing to fear&quot;, sad = &quot;Cheer up&quot;, angry = &quot;Calm down now&quot; ) ) # 输出 [1] &quot;Cheer up&quot; [1] &quot;There is nothing to fear&quot; 用户自编函数 myfunction &lt;- function(arg1, arg2, ... ){ statements return(object) } 注意： 函数中的对象只在函数内部使用 返回对象的数据类型是任意的，从标量到列表都可以 例题： 编写一个函数，用来计算数据对象的集中趋势和散布情况： 可以选择性地计算参数统计量（均值和标准差）和非参数统计量（中位数和绝对中位差）； 结果以列表的形式给出； 可以选择是否自动输出结果； 除非另外指定，否则此函数的默认行为是计算参数统计量并且不输出结果。 mystats &lt;- function(x, parametric=TRUE, print=FALSE) { if (parametric) { # 根据参数parametric确定应该怎样计算 center &lt;- mean(x); spread &lt;- sd(x) } else { center &lt;- median(x); spread &lt;- mad(x) } if (print &amp; parametric) { # 根据参数print确定是否打印 cat(&quot;Mean=&quot;, center, &quot;\\n&quot;, &quot;SD=&quot;, spread, &quot;\\n&quot;) } else if (print &amp; !parametric) { cat(&quot;Median=&quot;, center, &quot;\\n&quot;, &quot;MAD=&quot;, spread, &quot;\\n&quot;) } result &lt;- list(center=center, spread=spread) return(result) } set.seed(1234) x &lt;- rnorm(500) y &lt;- mystats(x) # y$center包含均值，y$spread包含标准差，并且没有输出结果 y &lt;- mystats(x, parametric=FALSE, print=TRUE) # 输出 Median= -0.021 MAD= 1 例题： 编写一个函数，可让用户选择输出当天日期的格式： mydate &lt;- function(type=&quot;long&quot;) { switch(type, long = format( Sys.time( ), &quot;%A %B %d %Y&quot; ), short = format( Sys.time( ), &quot;%m-%d-%y&quot; ), cat(type, &quot;is not a recognized type\\n&quot;)) # 函数cat()仅会在输入的日期 格式类型不匹配&quot;long&quot;或&quot;short&quot;时执行 } mydate(&quot;long&quot;) # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;short&quot;) # 输出 [1] &quot;08-10-19&quot; mydate() # 输出 [1] &quot;星期六 八月 10 2019&quot; mydate(&quot;medium&quot;) # 输出 medium is not a recognized type 数据的整合与重塑 转置 函数t( ) 可对一个矩阵或数据框进行转置 mtcars&lt;-mtcars cars &lt;- mtcars[1:5, 1:4] # 输出 cars mpg cyl disp hp Mazda RX4 21 6 160 110 Mazda RX4 Wag 21 6 160 110 Datsun 710 23 4 108 93 Hornet 4 Drive 21 6 258 110 Hornet Sportabout 19 8 360 175 t(cars) # 输出 Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive Hornet Sportabout mpg 21 21 23 21 19 cyl 6 6 4 6 8 disp 160 160 108 258 360 hp 110 110 93 110 175 整合数据 aggregate(x, by, FUN) 其中，x是待折叠的数据对象，by是由整合变量所组成的列表，FUN是计算新观测的标量函数 options(digits=3) attach(mtcars) aggdata &lt;-aggregate(mtcars, by=list(cyl,gear), FUN=mean, na.rm=TRUE) # 根据气缸数cyl和档位数gear整合mtcars数据，并返回各数值型变量的均值 aggdata # 输出 Group.1 Group.2 mpg cyl disp hp drat wt qsec vs am gear carb 1 4 3 21.5 4 120 97 3.70 2.46 20.0 1.0 0.00 3 1.00 2 6 3 19.8 6 242 108 2.92 3.34 19.8 1.0 0.00 3 1.00 3 8 3 15.1 8 358 194 3.12 4.10 17.1 0.0 0.00 3 3.08 4 4 4 26.9 4 103 76 4.11 2.38 19.6 1.0 0.75 4 1.50 5 6 4 19.8 6 164 116 3.91 3.09 17.7 0.5 0.50 4 4.00 6 4 5 28.2 4 108 102 4.10 1.83 16.8 0.5 1.00 5 2.00 7 6 5 19.7 6 145 175 3.62 2.77 15.5 0.0 1.00 5 6.00 8 8 5 15.4 8 326 300 3.88 3.37 14.6 0.0 1.00 5 6.00 detach(mtcars)","@type":"BlogPosting","url":"https://uzzz.org/2019/08/10/793353.html","headline":"《R语言实战》学习笔记：第五章 高级数据管理","dateModified":"2019-08-10T00:00:00+08:00","datePublished":"2019-08-10T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://uzzz.org/2019/08/10/793353.html"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="/assets/js/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-123344652-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-123344652-1');
    </script>
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-8889449066804352",
        enable_page_level_ads: true
      });
    </script>
    
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
    
    <style>
      @media screen and (max-width:760px){
        .sm-hidden{display:none; }
      }
    </style>

  </head>
  <body>
    
        <amp-auto-ads type="adsense"
              data-ad-client="ca-pub-8889449066804352">
        </amp-auto-ads>
    
    <div class="wrapper">
      <header  class="without-description" >
        <h1>《R语言实战》学习笔记：第五章 高级数据管理</h1>
        
        
        <ul style="display: block;">
            <li><a href="https://uzshare.com/" style="line-height: unset;" target="_blank"><strong>柚子社区</strong></a></li>
 	    <li><a href="/donate/" style="line-height: unset;" target="_blank"><strong>Donate</strong></a></li>
        </ul>
        
      </header>
      <section>

<div style="margin:0 0 8px 0;">
<style>
table.gsc-input {
    margin: 0;
}
.cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
    width: auto;
}
.gsc-search-box td {
    border-bottom: none;
}
</style>
<script>
  (function() {
    var cx = '004431708863642777669:qan2_6ugotw';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
</div>
<!-- match content ads -->
	        <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<ins class="adsbygoogle"
			     style="display:block"
			     data-ad-format="autorelaxed"
			     data-ad-client="ca-pub-8889449066804352"
			     data-ad-slot="1928667997"></ins>
			<script>
			     (adsbygoogle = window.adsbygoogle || []).push({});
			</script>	



        <div id="article_content" class="article_content clearfix"> 
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css"> 
 <div id="content_views" class="markdown_views prism-tomorrow-night-eighties"> 
  <!-- flowchart 箭头图标 勿删 --> 
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> 
   <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path> 
  </svg> 
  <h1><a id="_0"></a>高级数据管理</h1> 
  <h2><a id="_2"></a>数值和字符处理函数</h2> 
  <h3><a id="_4"></a>数学函数</h3> 
  <pre><code>abs(x)：求绝对值，例如 abs(-4) #返回值为4
sqrt(x)：求平方根，例如 sqrt(25) #返回值为5
ceiling(x)：不小于x 的最小整数，例如 ceiling(3.475) #返回值为4
floor(x)：不大于x 的最大整数，例如 floor(3.475)  #返回值为3
trunc(x)：向0的方向截取的x 中的整数部分，例如 trunc(5.99) #返回值为5
round(x, digits=n)：将x舍入为指定位的小数，例如 round(3.475, digits=2) #返回值为3.48
signif(x, digits=n)：将x舍入为指定的有效数字位数，例如 signif(3.475, digits=2) #返回值为3.5
cos(x)、sin(x)、tan(x)：余弦、正弦和正切，例如 cos(2)	#返回值为–0.416
acos(x)、asin(x)、atan(x)：反余弦、反正弦和反正切，例如 acos(-0.416)	#返回值为2
cosh(x)、sinh(x)、tanh(x)：双曲余弦、双曲正弦和双曲正切， 例如 sinh(2)	#返回值为3.627
acosh(x)、asinh(x)、atanh(x)：反双曲余弦、反双曲正弦和反双曲正切，例如 asinh(3.627)	#返回值为2
log(x, base=n)：对x取以n 为底的对数
log(x)：自然对数
log10(x)：以10为底的对数
exp(x)：指数函数，例如exp(2.3026)	#返回值为10
</code></pre> 
  <h3><a id="_24"></a>统计函数</h3> 
  <pre><code>mean(x)：平均数，例如 mean(c(1,2,3,4))	#返回值为2.5
median(x)：中位数，例如 median(c(1,2,3,4)) #返回值为2.5
sd(x)：标准差，例如 sd(c(1,2,3,4))
var(x)：方差，例如 var(c(1,2,3,4))
mad(x)：绝对中位差，例如 mad(c(1,2,3,4))	#返回值为1.48
quantile(x, probs)：求分位数，例如 y &lt;- quantile(x,c(.3,.84)) #返回值为x的30%和84%分位点
range(x)：求值域，例如 range(c(1,2,3,4))	#返回值为c(1,4)
sum(x)：求和，例如 sum(c(1,2,3,4))	#返回值为10
diff(x, lag=n)：差分函数,lag为差分项,默认值为1,例如 diff(c(1, 5, 23, 29)) #返回值为c(4,18,6)
min(x)：求最小值，例如 min(c(1,2,3,4)) #返回值为1
max(x)：求最大值，例如 max(c(1,2,3,4)) #返回值为4
scale(x, center=TRUE, scale=TRUE)：为数据对象x按列进行中心化(center=TRUE)或标准化(center=TRUE, scale=TRUE)
</code></pre> 
  <h3><a id="_41"></a>概率函数</h3> 
  <p>在R中，概率函数形如 ：[dpqr]分布名称缩写( )</p> 
  <p>其中第一个字母表示其所指分布的某一方面：</p> 
  <p>d = 密度函数（density function）</p> 
  <p>p = 分布函数（distribution function）</p> 
  <p>q = 分位数函数（quantile function）</p> 
  <p>r = 生成随机数（随机偏差）</p> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190809105757463.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDA3NzYz,size_16,color_FFFFFF,t_70" alt="概率分布"></p> 
  <pre><code># 在[-3, 3]区间上绘制标准正态曲线
x &lt;- pretty(c(-3,3), 30)	# 在[-3, 3]选取31个等分点
y &lt;- dnorm(x)
plot(x, y, type = "l", xlab = "Normal Deviate", ylab = "Density",  yaxs = "i" )
</code></pre> 
  <p><img src="https://uzshare.com/_p?https://img-blog.csdnimg.cn/20190809194827563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDA3NzYz,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p> 
  <pre><code>pnorm(1.96)						#位于z=1.96 左侧的标准正态曲线下方面积，返回值为0.975
qnorm(.9, mean=500, sd=100)		#均值为500，标准差为100的正态分布的0.9分位点，返回值为628.16
rnorm(50, mean=50, sd=10)		#生成50 个均值为50，标准差为10的正态随机数
</code></pre> 
  <h5><a id="_72"></a>设定随机数种子</h5> 
  <p>在每次生成伪随机数的时候，函数都会使用一个不同的种子，因此也会产生不同的结果；可以通过函数 <strong>set.seed()</strong> 显式指定这个种子，让结果可以重现</p> 
  <pre><code>runif(5)
# 输出
0.5684550 0.2155904 0.6656250 0.6798496 0.7349901

runif(5)
# 输出
0.70508234 0.45849879 0.21018669 0.08474743 0.79296225

set.seed(1234)
runif(5)
# 输出
0.1137034 0.6222994 0.6092747 0.6233794 0.8609154

set.seed(1234)
runif(5)
# 输出
0.1137034 0.6222994 0.6092747 0.6233794 0.8609154
</code></pre> 
  <h5><a id="_95"></a>生成多元正态数据</h5> 
  <p>MASS包中的mvrnorm()函数可以生成给定均值向量和协方差阵的多元正态分布的随机数：</p> 
  <p><strong>mvrnorm(n, mean, sigma)</strong></p> 
  <p>其中n是样本大小，mean为均值向量，而sigma是协方差矩阵</p> 
  <pre><code>library(MASS)
options(digits=3)
set.seed(1234)	# 设定随机数种子
mean &lt;- c(230.7, 146.7, 3.6)
sigma &lt;- matrix( c(15360.8, 6721.2, -47.1,
                   6721.2, 4700.9, -16.5,
                   -47.1,	-16.5,	0.3), nrow=3, ncol=3)
mydata &lt;- mvrnorm(500, mean, sigma)	# 取500个观测值
mydata &lt;- as.data.frame(mydata)	# 把矩阵转换为数据框
names(mydata) &lt;- c("y", "x1", "x2")	# 指定数据框的名称
dim(mydata)	# 查看数据
# 输出
500   3
head(mydata, n=10)	# 查看前10行数据
# 输出
       y    x1   x2
1   98.8  41.3 3.43
2  244.5 205.2 3.80
3  375.7 186.7 2.51
4  -59.2  11.2 4.71
5  313.0 111.0 3.45
6  288.8 185.1 2.72
7  134.8 165.0 4.39
8  171.7  97.4 3.64
9  167.2 101.0 3.50
10 121.1  94.5 4.10
</code></pre> 
  <h3><a id="_132"></a>字符处理函数</h3> 
  <pre><code>nchar(x)：计算x 中的字符数量，例如x &lt;- c("ab", "cde","fghij")，则nchar(x[3])返回值为5
substr(x, start, stop)：提取子串，例如 x &lt;- "abcdef"，则 substr(x, 2, 4)返回值为"bcd"
grep(pattern, x, ignore.case=FALSE, fixed=FALSE)：在x中匹配搜索pattern，返回值为匹配的下标；若fixed=FALSE，则pattern 为一个正则表达式，若fixed=TRUE，则pattern 为一 个文本字符串。例如grep("A", c("b", "A", "c"), fixed=TRUE)	# 返回值为2
sub(pattern, replacement, x, ignore.case=FALSE,fixed=FALSE)：在x中搜索pattern，并以文本replacement将其替换。例如sub("\\s", ".", "Hello There")	# 返回值为Hello.There
注意，"\s"是一个用来查找空白的正则表达式
strsplit(x, split, fixed=FALSE)：在split处分割字符向量x中的元素，例如y &lt;- strsplit("abc", "")	# 返回含有3个元素的列表，包含的内容为"a" "b" "c"
paste(…, sep="")：连接字符串，分隔符为sep，例如paste("x", 1:3, sep="M")   # 返回值为c("xM1","xM2" "xM3")
toupper(x)：大写转换，例如 &gt; toupper("abc")	# 返回值为 "ABC"
tolower (x)：小写转换，例如 &gt; tolower ("ABC")	# 返回值为 "abc"
</code></pre> 
  <h3><a id="_146"></a>其他实用函数</h3> 
  <pre><code>length(x)：对象x的长度，例如x &lt;- c(2, 5, 6, 9)	# 返回值为4
seq(from, to, by)：生成一个序列，例如indices &lt;-seq(1,10,2)  # indices的值为c(1, 3, 5, 7, 9)
rep(x, n)：将x重复n次，例如y &lt;- rep(1:3, 2)	# y 的值为c(1, 2, 3, 1, 2, 3)
cut(x, n)：将连续型变量x分割为有着n个水平的因子
pretty(x, n)：创建美观的分割点，绘图中常用。通过选取n+1个等间距的取整值，将一个连续型变量x分割为n个区间
cat(... , file =“myfile”, append =FALSE)：连接...中的对象
</code></pre> 
  <p>转义字符：\n表示新行，\t为制表符，\’为单引号，\b为退 格 … …</p> 
  <pre><code>name &lt;- "Bob"
cat( "Hello", name, "\b.\n", "Isn\'t R", "\t", "GREAT?\n")
# 输出
Hello Bob.
 Isn't R 	 GREAT?
</code></pre> 
  <p><strong>例题：</strong> 将学生的各科考试成绩组合为单一的成绩衡量指标，基于相对名次（前20%、后20%等）给出</p> 
  <p>从A到F的评分，根据学生姓氏和名字的首字母对花名册进行排序</p> 
  <pre><code># 第1步：创建学生花名册数据框roster
options(digits=2)
Student &lt;- c("John Davis", "Angela Williams", "Bullwinkle  Moose", "David Jones", "Janice Markhammer", "Cheryl  Cushing","Reuven Ytzrhak", "Greg Knox", "Joel England","Mary  Rayburn")
Math &lt;- c(502, 600, 412, 358, 495, 512, 410, 625, 573, 522)
Science &lt;- c(95, 99, 80, 82, 75, 85, 80, 95, 89, 86)
English &lt;- c(25, 22, 18, 15, 20, 28, 15, 30, 27, 18)
roster &lt;- data.frame(Student, Math, Science, English,  stringsAsFactors=FALSE)	# 限制字符向量变成因子
# 第2步：对各科成绩进行标准化操作（因为数学、科学和英语考试 的分值不同，所以需要在组合之前让它们变得可以比较）
z &lt;- scale(roster[ , 2:4])
# 第3步：创建向量score，来计算每个学生3科成绩的平均值，并将score合并到花名册数据框roster 中
score &lt;- apply(z, 1, mean)
roster &lt;- cbind(roster, score)
# 第4步：为了给出五级制学分评级，对score变量计算中位数
y &lt;- quantile(score, c(.8,.6,.4,.2))
# 第5步：新建变量grade，计算学生的五级制评分
roster$grade[score &gt;= y[1]] &lt;- "A"
roster$grade[score &lt; y[1] &amp; score &gt;= y[2]] &lt;- "B"
roster$grade[score &lt; y[2] &amp; score &gt;= y[3]] &lt;- "C"
roster$grade[score &lt; y[3] &amp; score &gt;= y[4]] &lt;- "D"
roster$grade[score &lt; y[4]] &lt;- "F"
# 第6步：将学生姓名拆分为姓氏和名字
name &lt;- strsplit((roster$Student), " ")	# 以空格为界对学生的姓名进行拆分，返回拆分后的姓名列表
# 第7步：新建变量Firstname和Lastname存放名字和姓氏，并合并 到roster中
lastname &lt;- sapply (name, "[", 2)	# [”可以提取对象的一 部分，sapply专门对列表或者数据框进行分组统计
firstname &lt;- sapply (name, "[", 1)
roster &lt;- cbind (firstname, lastname, roster[,-1])	# 删除roster的第一列姓名列
# 第8步：依姓氏和名字对花名册roster进行排序
roster &lt;- roster[order(lastname,firstname), ]
roster
# 输出
    firstname   lastname Math Science English score grade
3  Bullwinkle             412      80      18 -0.86     D
6      Cheryl             512      85      28  0.35     C
10       Mary             522      86      18 -0.18     C
1        John      Davis  502      95      25  0.56     B
9        Joel    England  573      89      27  0.70     B
4       David      Jones  358      82      15 -1.16     F
8        Greg       Knox  625      95      30  1.34     A
5      Janice Markhammer  495      75      20 -0.63     D
2      Angela   Williams  600      99      22  0.92     A
7      Reuven    Ytzrhak  410      80      15 -1.05     F
</code></pre> 
  <h2><a id="_215"></a>控制流</h2> 
  <h3><a id="_217"></a>重复和循环</h3> 
  <h5><a id="for_219"></a>for结构</h5> 
  <p>for (var in seq) statement</p> 
  <pre><code>for (i in 1:10)	print("Hello")	# Hello被输出了10次
</code></pre> 
  <h5><a id="while_225"></a>while循环</h5> 
  <p>while (cond) statement</p> 
  <pre><code>i &lt;- 10
while (i&gt;0) {
     print("hello")
     i &lt;- i -1
			 }
</code></pre> 
  <h3><a id="_237"></a>条件语句</h3> 
  <h5><a id="ifelse_239"></a>if-else结构</h5> 
  <p>if (cond) statement<br> if (cond) statement1 else statement2<br> 若cond为TRUE，则执行statement语句</p> 
  <pre><code>if (is.character(grade))	grade &lt;- as.factor(grade)
# 如果grade是一个字符向量，它就会被转换为一个因子
if ( !is.factor(grade))	grade &lt;- as.factor(grade)
else	print("Grade already”)
# 如果grade不是一个因子，它就会被转换为一个因子；如果它是一个因子，就会输出一段信息
</code></pre> 
  <h5><a id="ifelse_253"></a>ifelse结构</h5> 
  <p>ifelse (cond, statement1, statement2)<br> 若cond为TRUE，则执行statement1语句；若cond为FALSE，则 执行statement2语句</p> 
  <pre><code>ifelse (score &gt; 0.5, print("Passed"), print("Failed"))
outcome &lt;- ifelse (score &gt; 0.5, "Passed", "Failed")
</code></pre> 
  <h5><a id="switch_263"></a>switch结构</h5> 
  <p>switch (expr, …)<br> 其中“…” 表示与expr的各种可能输出值绑定的语句</p> 
  <pre><code>feelings &lt;- c("sad", "afraid")
for (i in feelings)  
  print(switch(i,
         happy = "I am glad you are happy",  
         afraid = "There is nothing to fear",  
         sad = "Cheer up",
         angry = "Calm down now" )
         )
# 输出
[1] "Cheer up"
[1] "There is nothing to fear"
</code></pre> 
  <h2><a id="_282"></a>用户自编函数</h2> 
  <pre><code>myfunction &lt;- function(arg1, arg2, ... ){
  statements  return(object)
  }
</code></pre> 
  <p><strong>注意：</strong></p> 
  <p>函数中的对象只在函数内部使用</p> 
  <p>返回对象的数据类型是任意的，从标量到列表都可以</p> 
  <p><strong>例题：</strong> 编写一个函数，用来计算数据对象的集中趋势和散布情况：<br> 可以选择性地计算参数统计量（均值和标准差）和非参数统计量（中位数和绝对中位差）；<br> 结果以列表的形式给出；<br> 可以选择是否自动输出结果；<br> 除非另外指定，否则此函数的默认行为是计算参数统计量并且不输出结果。</p> 
  <pre><code>mystats &lt;- function(x, parametric=TRUE, print=FALSE) {
  if (parametric) {	# 根据参数parametric确定应该怎样计算
    center &lt;- mean(x); spread &lt;- sd(x)
  } 
  else {
    center &lt;- median(x); spread &lt;- mad(x)
  }
  if (print &amp; parametric) {	# 根据参数print确定是否打印
    cat("Mean=", center, "\n", "SD=", spread, "\n")
  } 
  else if (print &amp; !parametric) {
    cat("Median=", center, "\n", "MAD=", spread, "\n")
  }
  result &lt;- list(center=center, spread=spread)
  return(result)
}
set.seed(1234)
x &lt;- rnorm(500)
y &lt;- mystats(x)   # y$center包含均值，y$spread包含标准差，并且没有输出结果
y &lt;- mystats(x, parametric=FALSE, print=TRUE)
# 输出
Median= -0.021 
 MAD= 1 
</code></pre> 
  <p><strong>例题：</strong> 编写一个函数，可让用户选择输出当天日期的格式：</p> 
  <pre><code>mydate &lt;- function(type="long") {
  switch(type,
         long =	format( Sys.time( ), "%A %B %d %Y" ),
         short = format( Sys.time( ), "%m-%d-%y" ),  
         cat(type, "is not a recognized type\n"))	# 函数cat()仅会在输入的日期 格式类型不匹配"long"或"short"时执行

}
 mydate("long")
 # 输出
[1] "星期六 八月 10 2019"

mydate("short")  
# 输出
[1] "08-10-19"

mydate()
# 输出
[1] "星期六 八月 10 2019"

mydate("medium")
# 输出
medium is not a recognized type
</code></pre> 
  <h2><a id="_355"></a>数据的整合与重塑</h2> 
  <h3><a id="_357"></a>转置</h3> 
  <p>函数<strong>t( )</strong> 可对一个矩阵或数据框进行转置</p> 
  <pre><code>mtcars&lt;-mtcars
cars &lt;- mtcars[1:5, 1:4]
# 输出
cars
                  mpg cyl disp  hp
Mazda RX4          21   6  160 110
Mazda RX4 Wag      21   6  160 110
Datsun 710         23   4  108  93
Hornet 4 Drive     21   6  258 110
Hornet Sportabout  19   8  360 175

t(cars)
# 输出
     Mazda RX4 Mazda RX4 Wag Datsun 710 Hornet 4 Drive Hornet Sportabout
mpg         21            21         23             21                19
cyl          6             6          4              6                 8
disp       160           160        108            258               360
hp         110           110         93            110               175
</code></pre> 
  <h3><a id="_382"></a>整合数据</h3> 
  <p><strong>aggregate(x, by, FUN)</strong></p> 
  <p>其中，x是待折叠的数据对象，by是由整合变量所组成的列表，FUN是计算新观测的标量函数</p> 
  <pre><code>options(digits=3)
attach(mtcars)
aggdata &lt;-aggregate(mtcars, by=list(cyl,gear), 
                    FUN=mean,
                    na.rm=TRUE) # 根据气缸数cyl和档位数gear整合mtcars数据，并返回各数值型变量的均值
aggdata
# 输出
  Group.1 Group.2  mpg cyl disp  hp drat   wt qsec  vs   am gear carb
1       4       3 21.5   4  120  97 3.70 2.46 20.0 1.0 0.00    3 1.00
2       6       3 19.8   6  242 108 2.92 3.34 19.8 1.0 0.00    3 1.00
3       8       3 15.1   8  358 194 3.12 4.10 17.1 0.0 0.00    3 3.08
4       4       4 26.9   4  103  76 4.11 2.38 19.6 1.0 0.75    4 1.50
5       6       4 19.8   6  164 116 3.91 3.09 17.7 0.5 0.50    4 4.00
6       4       5 28.2   4  108 102 4.10 1.83 16.8 0.5 1.00    5 2.00
7       6       5 19.7   6  145 175 3.62 2.77 15.5 0.0 1.00    5 6.00
8       8       5 15.4   8  326 300 3.88 3.37 14.6 0.0 1.00    5 6.00

detach(mtcars)
</code></pre> 
 </div> 
 <link href="https://csdnimg.cn/release/phoenix/mdeditor/markdown_views-e44c3c0e64.css" rel="stylesheet"> 
</div>

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
	<!-- 自定义广告 -->
	<ins class="adsbygoogle"
	     style="display:block"
	     data-ad-client="ca-pub-8889449066804352"
	     data-ad-slot="1494696990"
	     data-ad-format="auto"
	     data-full-width-responsive="true"></ins>
	<script>
		(adsbygoogle = window.adsbygoogle || []).push({});
	</script>


        <br />
        <a href="https://uzshare.com/">更多精彩内容</a>
      </section>
      
      <header style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
        <ul style="display: block;">
          <li><a href="/" style="line-height: 40px;padding-top:0px;">回首页</a></li>
        </ul>
      </header>
      <header class="sm-hidden" style="right: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/imgqcode.png" style="width:160px;" />
      </header>
      
      <header class="sm-hidden" style="left: 0;position: fixed;bottom: 60px;z-index: 100;background: none;border-bottom:none;">
          <img src="https://uzzz.org.cn/hou_imgqcode.png" style="width:160px;">
      </header>
    </div>
    
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d293c49e1e4bfe8f276695a5aa953300";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

  </body>
</html>
