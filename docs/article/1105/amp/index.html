<!DOCTYPE html>
<html amp lang="en-US" i-amphtml-layout="" i-amphtml-no-boilerplate="" transformed="self;v=1">
<head><meta charset="utf-8"><style amp-runtime="" i-amphtml-version="012111242025001">html{overflow-x:hidden!important}html.i-amphtml-fie{height:100%!important;width:100%!important}html:not([amp4ads]),html:not([amp4ads]) body{height:auto!important}html:not([amp4ads]) body{margin:0!important}body{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.i-amphtml-singledoc.i-amphtml-embedded{-ms-touch-action:pan-y pinch-zoom;touch-action:pan-y pinch-zoom}html.i-amphtml-fie>body,html.i-amphtml-singledoc>body{overflow:visible!important}html.i-amphtml-fie:not(.i-amphtml-inabox)>body,html.i-amphtml-singledoc:not(.i-amphtml-inabox)>body{position:relative!important}html.i-amphtml-ios-embed-legacy>body{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important}html.i-amphtml-ios-embed{overflow-y:auto!important;position:static}#i-amphtml-wrapper{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}html.i-amphtml-ios-embed.i-amphtml-ios-overscroll,html.i-amphtml-ios-embed.i-amphtml-ios-overscroll>#i-amphtml-wrapper{-webkit-overflow-scrolling:touch!important}#i-amphtml-wrapper>body{position:relative!important;border-top:1px solid transparent!important}#i-amphtml-wrapper+body{visibility:visible}#i-amphtml-wrapper+body .i-amphtml-lightbox-element,#i-amphtml-wrapper+body[i-amphtml-lightbox]{visibility:hidden}#i-amphtml-wrapper+body[i-amphtml-lightbox] .i-amphtml-lightbox-element{visibility:visible}#i-amphtml-wrapper.i-amphtml-scroll-disabled,.i-amphtml-scroll-disabled{overflow-x:hidden!important;overflow-y:hidden!important}amp-instagram{padding:54px 0px 0px!important;background-color:#fff}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide]{display:none}[subscriptions-dialog],body:not(.i-amphtml-subs-ready) [subscriptions-action],body:not(.i-amphtml-subs-ready) [subscriptions-section]{display:none!important}amp-experiment,amp-live-list>[update]{display:none}amp-list[resizable-children]>.i-amphtml-loading-container.amp-hidden{display:none!important}amp-list [fetch-error],amp-list[load-more] [load-more-button],amp-list[load-more] [load-more-end],amp-list[load-more] [load-more-failed],amp-list[load-more] [load-more-loading]{display:none}amp-list[diffable] div[role=list]{display:block}amp-story-page,amp-story[standalone]{min-height:1px!important;display:block!important;height:100%!important;margin:0!important;padding:0!important;overflow:hidden!important;width:100%!important}amp-story[standalone]{background-color:#000!important;position:relative!important}amp-story-page{background-color:#757575}amp-story .amp-active>div,amp-story .i-amphtml-loader-background{display:none!important}amp-story-page:not(:first-of-type):not([distance]):not([active]){transform:translateY(1000vh)!important}amp-autocomplete{position:relative!important;display:inline-block!important}amp-autocomplete>input,amp-autocomplete>textarea{padding:0.5rem;border:1px solid rgba(0,0,0,0.33)}.i-amphtml-autocomplete-results,amp-autocomplete>input,amp-autocomplete>textarea{font-size:1rem;line-height:1.5rem}[amp-fx^=fly-in]{visibility:hidden}amp-script[nodom],amp-script[sandboxed]{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}
/*# sourceURL=/css/ampdoc.css*/[hidden]{display:none!important}.i-amphtml-element{display:inline-block}.i-amphtml-blurry-placeholder{transition:opacity 0.3s cubic-bezier(0.0,0.0,0.2,1)!important;pointer-events:none}[layout=nodisplay]:not(.i-amphtml-element){display:none!important}.i-amphtml-layout-fixed,[layout=fixed][width][height]:not(.i-amphtml-layout-fixed){display:inline-block;position:relative}.i-amphtml-layout-responsive,[layout=responsive][width][height]:not(.i-amphtml-layout-responsive),[width][height][heights]:not([layout]):not(.i-amphtml-layout-responsive),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-layout-responsive){display:block;position:relative}.i-amphtml-layout-intrinsic,[layout=intrinsic][width][height]:not(.i-amphtml-layout-intrinsic){display:inline-block;position:relative;max-width:100%}.i-amphtml-layout-intrinsic .i-amphtml-sizer{max-width:100%}.i-amphtml-intrinsic-sizer{max-width:100%;display:block!important}.i-amphtml-layout-container,.i-amphtml-layout-fixed-height,[layout=container],[layout=fixed-height][height]:not(.i-amphtml-layout-fixed-height){display:block;position:relative}.i-amphtml-layout-fill,.i-amphtml-layout-fill.i-amphtml-notbuilt,[layout=fill]:not(.i-amphtml-layout-fill),body noscript>*{display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}body noscript>*{position:absolute!important;width:100%;height:100%;z-index:2}body noscript{display:inline!important}.i-amphtml-layout-flex-item,[layout=flex-item]:not(.i-amphtml-layout-flex-item){display:block;position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.i-amphtml-layout-fluid{position:relative}.i-amphtml-layout-size-defined{overflow:hidden!important}.i-amphtml-layout-awaiting-size{position:absolute!important;top:auto!important;bottom:auto!important}i-amphtml-sizer{display:block!important}@supports (aspect-ratio:1/1){i-amphtml-sizer.i-amphtml-disable-ar{display:none!important}}.i-amphtml-blurry-placeholder,.i-amphtml-fill-content{display:block;height:0;max-height:100%;max-width:100%;min-height:100%;min-width:100%;width:0;margin:auto}.i-amphtml-layout-size-defined .i-amphtml-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-replaced-content,.i-amphtml-screen-reader{padding:0!important;border:none!important}.i-amphtml-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:4px!important;height:4px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:8px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:12px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:16px!important}.i-amphtml-unresolved{position:relative;overflow:hidden!important}.i-amphtml-select-disabled{-webkit-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.i-amphtml-notbuilt,[layout]:not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){position:relative;overflow:hidden!important;color:transparent!important}.i-amphtml-notbuilt:not(.i-amphtml-layout-container)>*,[layout]:not([layout=container]):not(.i-amphtml-element)>*,[width][height][heights]:not([layout]):not(.i-amphtml-element)>*,[width][height][sizes]:not([layout]):not(.i-amphtml-element)>*{display:none}amp-img:not(.i-amphtml-element)[i-amphtml-ssr]>img.i-amphtml-fill-content{display:block}.i-amphtml-notbuilt:not(.i-amphtml-layout-container),[layout]:not([layout=container]):not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){color:transparent!important;line-height:0!important}.i-amphtml-ghost{visibility:hidden!important}.i-amphtml-element>[placeholder],[layout]:not(.i-amphtml-element)>[placeholder],[width][height][heights]:not([layout]):not(.i-amphtml-element)>[placeholder],[width][height][sizes]:not([layout]):not(.i-amphtml-element)>[placeholder]{display:block;line-height:normal}.i-amphtml-element>[placeholder].amp-hidden,.i-amphtml-element>[placeholder].hidden{visibility:hidden}.i-amphtml-element:not(.amp-notsupported)>[fallback],.i-amphtml-layout-container>[placeholder].amp-hidden,.i-amphtml-layout-container>[placeholder].hidden{display:none}.i-amphtml-layout-size-defined>[fallback],.i-amphtml-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1}amp-img[i-amphtml-ssr]:not(.i-amphtml-element)>[placeholder]{z-index:auto}.i-amphtml-notbuilt>[placeholder]{display:block!important}.i-amphtml-hidden-by-media-query{display:none!important}.i-amphtml-element-error{background:red!important;color:#fff!important;position:relative!important}.i-amphtml-element-error:before{content:attr(error-message)}i-amp-scroll-container,i-amphtml-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active,i-amphtml-scroll-container.amp-active{overflow:auto;-webkit-overflow-scrolling:touch}.i-amphtml-loading-container{display:block!important;pointer-events:none;z-index:1}.i-amphtml-notbuilt>.i-amphtml-loading-container{display:block!important}.i-amphtml-loading-container.amp-hidden{visibility:hidden}.i-amphtml-element>[overflow]{cursor:pointer;position:relative;z-index:2;visibility:hidden;display:initial;line-height:normal}.i-amphtml-layout-size-defined>[overflow]{position:absolute}.i-amphtml-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{display:none!important}amp-analytics,amp-auto-ads,amp-story-auto-ads{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}html.i-amphtml-fie>amp-analytics{position:initial!important}[visible-when-invalid]:not(.visible),form [submit-error],form [submit-success],form [submitting]{display:none}amp-accordion{display:block!important}@media (min-width:1px){:where(amp-accordion>section)>:first-child{margin:0;background-color:#efefef;padding-right:20px;border:1px solid #dfdfdf}:where(amp-accordion>section)>:last-child{margin:0}}amp-accordion>section{float:none!important}amp-accordion>section>*{float:none!important;display:block!important;overflow:hidden!important;position:relative!important}amp-accordion,amp-accordion>section{margin:0}amp-accordion:not(.i-amphtml-built)>section>:last-child{display:none!important}amp-accordion:not(.i-amphtml-built)>section[expanded]>:last-child{display:block!important}
/*# sourceURL=/css/ampshared.css*/</style><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><title>Install Docker and Tor Network and Proxy Service on CentOS7 - 有组织在!</title><link rel="preconnect" href="https://cdn.ampproject.org"><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js"><script async="" src="https://cdn.ampproject.org/v0.js"></script><style amp-custom="">html{background:#0a89c0}body{background:#fff;color:#353535;font-family:Georgia,"Times New Roman",Times,Serif;font-weight:300;line-height:1.75em}p{margin:0 0 1em;padding:0}a,a:visited{color:#0a89c0}a:hover,a:active,a:focus{color:#353535}.amp-wp-meta,.amp-wp-header div,.amp-wp-title,.amp-wp-tax-category,.amp-wp-footer p,.back-to-top{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue",sans-serif}.amp-wp-header{background-color:#0a89c0}.amp-wp-header div{color:#fff;font-size:1em;font-weight:400;margin:0 auto;max-width:calc(840px - 32px);padding:.875em 16px;position:relative}.amp-wp-header a{color:#fff;text-decoration:none}.amp-wp-header .amp-wp-site-icon{background-color:#fff;border:1px solid #fff;border-radius:50%;position:absolute;right:18px;top:10px}.amp-wp-article{color:#353535;font-weight:400;margin:1.5em auto;max-width:840px;overflow-wrap:break-word;word-wrap:break-word}.amp-wp-article-header{align-items:center;align-content:stretch;display:flex;flex-wrap:wrap;justify-content:space-between;margin:1.5em 16px 0}.amp-wp-title{color:#353535;display:block;flex:1 0 100%;font-weight:900;margin:0 0 .625em;width:100%}.amp-wp-meta{color:#696969;display:inline-block;flex:2 1 50%;font-size:.875em;line-height:1.5em;margin:0 0 1.5em;padding:0}.amp-wp-article-header .amp-wp-meta:last-of-type{text-align:right}.amp-wp-article-header .amp-wp-meta:first-of-type{text-align:left}.amp-wp-byline amp-img,.amp-wp-byline .amp-wp-author{display:inline-block;vertical-align:middle}.amp-wp-byline amp-img{border:1px solid #0a89c0;border-radius:50%;position:relative;margin-right:6px}.amp-wp-posted-on{text-align:right}.amp-wp-article-content{margin:0 16px}.amp-wp-article-content amp-img{margin:0 auto}.amp-wp-article-footer .amp-wp-meta{display:block}.amp-wp-tax-category{color:#696969;font-size:.875em;line-height:1.5em;margin:1.5em 16px}.amp-wp-footer{border-top:1px solid #c2c2c2;margin:calc(1.5em - 1px) 0 0}.amp-wp-footer div{margin:0 auto;max-width:calc(840px - 32px);padding:1.25em 16px 1.25em;position:relative}.amp-wp-footer h2{font-size:1em;line-height:1.375em;margin:0 0 .5em}.amp-wp-footer p{color:#696969;font-size:.8em;line-height:1.5em;margin:0 85px 0 0}.amp-wp-footer a{text-decoration:none}.back-to-top{bottom:1.275em;font-size:.8em;font-weight:600;line-height:2em;position:absolute;right:16px}.htmledit_views span[lang]{font-style:italic}.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}.htmledit_views amp-img{max-width:100%}.htmledit_views *{box-sizing:border-box}.htmledit_views h1,.htmledit_views h2{color:#4f4f4f;margin:8px 0 16px;font-weight:700}.htmledit_views h1{font-size:28px;line-height:36px}.htmledit_views h2{font-size:24px;line-height:32px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}

/*# sourceURL=amp-custom.css */</style><script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https://uzzz.org/article/1105/#webpage","url":"https://uzzz.org/article/1105/","inLanguage":"en-US","name":"Install Docker and Tor Network and Proxy Service on CentOS7 - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"datePublished":"2018-10-04T18:42:41+00:00","dateModified":"2018-10-04T18:42:41+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script><link rel="canonical" href="https://uzzz.org/article/1105/"></head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:32px;height:32px;" i-amphtml-layout="fixed"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">Install Docker and Tor Network and Proxy Service on CentOS7</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:24px;height:24px;" i-amphtml-layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2018-10-05T02:42:41+00:00">
		3 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
 
 
<div class="htmledit_views" id="content_views">
   Install Docker and Tor Network and Proxy Service on CentOS7
<p>How to run Tor network and Proxy Service<br>
  <br>It is docker, so only thing we need on our target machine is docker. No tor, no proxy, no python, no java, just docker environment. This will do work for all the other docker applications as well.<br>
  <br>So in the future, the target machine will be clean and clear. Not java version conflict, no python version conflict, no other installation issues.</p>
<p>My target server is CentOS 7</p>
<p>First, check the software database index<br>
  <br>> sudo yum check-update<br>
  <br>Install Docker Service<br>
  <br>> curl -fsSL https://get.docker.com/ | sh<br>
  <br>Start the Docker Service<br>
  <br>> sudo systemctl start docker</p>
<p>After the installation, we can check<br>
  <br>> docker –version<br>
  <br>Docker version 18.06.1-ce, build e68fc7a</p>
<p>Directly install privoxy on CentOS from Source Code<br>
  <br>https://wiki.polaire.nl/doku.php?id=centos7_privoxy<br>
  <br>http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/</p>
<p>Here is the command to fetch the privoxy source code<br>
  <br>> wget http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/privoxy-3.0.26-stable-src.tar.gz</p>
<p>Install the build tool we need<br>
  <br>> sudo yum groupinstall development tools<br>
  <br>> sudo yum install zlib-devel pcre-devel w3m</p>
<p>Unzip the file<br>
  <br>> tar zxvf privoxy-3.0.26-stable-src.tar.gz </p>
<p>Build the source<br>
  <br>> cd privoxy-3.0.26-stable<br>
  <br>> autoheader<br>
  <br>> autoconf<br>
  <br>> ./configure –with-user=privoxy –with-group=privoxy –prefix=/home/carl/tool/privoxy-3.0.26<br>
  <br>> make<br>
  <br>> make -n install<br>
  <br>> make -s install USER=privoxy GROUP=privoxy</p>
<p>User privoxy and group privoxy not working, so I switch to use my current sudo user carl, this command can start that service</p>
<p>sudo /opt/privoxy/sbin/privoxy –pidfile /opt/privoxy/var/run/privoxy.pid –user carl /opt/privoxy/etc/config 2>/dev/null</p>
<p>Copy the script to working directory<br>
  <br>> sudo cp privoxy-generic.init /etc/init.d/privoxy<br>
  <br>> sudo chkconfig –add privoxy<br>
  <br>> sudo chkconfig privoxy on</p>
<p>Edit the /etc/init.d/privoxy as follow:<br>
  <br>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/xpg4/bin:/usr/bin:/sbin:/bin:/opt/privoxy/sbin<br>
  <br>P_NAME=Privoxy<br>
  <br># Path to executable.<br>
  <br>P_DAEMON=privoxy<br>
  <br># Full path to location of Privoxy config file.<br>
  <br>P_CONF_FILE=/opt/privoxy/etc/config<br>
  <br># Full path to PID file location. Location must be writable by<br>
  <br># whoever runs this script and by Privoxy itself.<br>
  <br>P_PIDFILE=/opt/privoxy/var/run/privoxy.pid<br>
  <br># If uncommented, this script will try to run as USER=privoxy, which<br>
  <br># may require special handling of config, *.action, trust, logfile,<br>
  <br># jarfile, and pidfile.<br>
  <br>P_USER=carl</p>
<p>Command can work<br>
  <br>> sudo service privoxy start</p>
<p>The privoxy configuration will be as follow:<br>
  <br>forward-socks5t / 127.0.0.1:9050 .<br>
  <br>listen-address 0.0.0.0:8119</p>
<p>Set Up the Tor from Command Line<br>
  <br>sudo yum install tor</p>
<p>Generate the password for tor<br>
  <br>> echo HashedControlPassword $(tor –hash-password “xxxxxxxx”)</p>
<p>Add these to the file end<br>
  <br>> sudo less /etc/tor/torrc</p>
<p>ControlPort 9051<br>
  <br>ControlListenAddress 0.0.0.0<br>
  <br>HashedControlPassword 16:xxxxxxxxxxxxxx</p>
<p>Check the permission of one directory<br>
  <br>> chmod 400 /run/tor</p>
<p>Some Tips<br>
  <br>Optional commands if you needed<br>
  <br>> sudo yum-config-manager –disable chromium-el6<br>
  <br>> sudo usermod -aG docker carl</p>
<p>Here is the Docker information<br>
  <br>start.sh<br>
  <br>#!/bin/sh -ex</p>
<p>#start the service<br>
  <br>/etc/init.d/privoxy start<br>
  <br>tor</p>
<p>Here is the Makefile<br>
  <br>IMAGE=sillycat/public<br>
  <br>TAG=centos-tornetwork-1.0<br>
  <br>NAME=centos-tornetwork-1.0</p>
<p>prepare:<br>
  <br> wget http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/privoxy-3.0.26-stable-src.tar.gz -P install/</p>
<p>docker-context:</p>
<p>build: docker-context<br>
  <br> docker build -t $(IMAGE):$(TAG) .</p>
<p>run:<br>
  <br> docker run -d -p 9051:9051 -p 8119:8119 –name $(NAME) $(IMAGE):$(TAG)</p>
<p>debug:<br>
  <br> docker run -p 9051:9051 -p 8119:8119 –name $(NAME) -ti $(IMAGE):$(TAG) /bin/bash</p>
<p>clean:<br>
  <br> docker stop ${NAME}<br>
  <br> docker rm ${NAME}</p>
<p>logs:<br>
  <br> docker logs ${NAME}</p>
<p>publish:<br>
  <br> docker push ${IMAGE}</p>
<p>Here is the Dockerfile with all the steps and Details<br>
  <br>#Run a Tor Network Server</p>
<p>#Prepare the OS<br>
  <br>FROM centos:7<br>
  <br>MAINTAINER Carl Luo <luohuazju@gmail.com></p>
<p>#upgrade the system<br>
  <br>RUN yum -y update</p>
<p>#Prepare the denpendencies<br>
  <br>RUN yum install -y epel-release<br>
  <br>RUN yum install -y tor<br>
  <br>RUN yum groupinstall -y development tools<br>
  <br>RUN yum install -y wget gcc make<br>
  <br>RUN yum install -y zlib-devel pcre-devel w3m</p>
<p>#set up tor configuration<br>
  <br>RUN echo “ControlPort 9051” >> /etc/tor/torrc<br>
  <br>RUN echo “ControlListenAddress 0.0.0.0” >> /etc/tor/torrc<br>
  <br>RUN echo HashedControlPassword $(tor –hash-password “xxxxxxxxx” | tail -n 1) >> /etc/tor/torrc<br>
  <br>RUN rm -fr /run/tor/<br>
  <br>RUN mkdir /run/tor<br>
  <br>RUN chmod 400 /run/tor</p>
<p>#manually install privoxy<br>
  <br>RUN adduser privoxy<br>
  <br>RUN usermod -aG wheel privoxy<br>
  <br>RUN mkdir /install/<br>
  <br>RUN mkdir /tool/<br>
  <br>ADD install/privoxy-3.0.26-stable-src.tar.gz /install/<br>
  <br>WORKDIR /install/privoxy-3.0.26-stable<br>
  <br>RUN autoheader<br>
  <br>RUN autoconf<br>
  <br>RUN ./configure –with-user=privoxy –with-group=wheel –prefix=/tool/privoxy-3.0.26<br>
  <br>RUN make<br>
  <br>RUN make -n install<br>
  <br>RUN make -s install USER=privoxy GROUP=wheel</p>
<p>#set up forward configuration<br>
  <br>RUN echo “forward-socks5t / 127.0.0.1:9050 .”>> /tool/privoxy-3.0.26/etc/config<br>
  <br>RUN echo “listen-address 0.0.0.0:8119”>> /tool/privoxy-3.0.26/etc/config</p>
<p>ADD conf/privoxy /etc/init.d/privoxy<br>
  <br>RUN chmod a+x /etc/init.d/privoxy</p>
<p>#set up the app<br>
  <br>EXPOSE 9051 8119<br>
  <br>RUN mkdir -p /app/<br>
  <br>ADD start.sh /app/<br>
  <br>WORKDIR /app/<br>
  <br>CMD [ “./start.sh” ]</p>
<p>The /etc/init.d/privoxy Script to start the service<br>
  <br>#!/bin/sh</p>
<p>###########################################################################<br>
  <br>#<br>
  <br># File : $Source: /cvsroot/ijbswa/current/privoxy-generic.init,v $<br>
  <br>#<br>
  <br># Purpose : This script takes care of starting and stopping privoxy.<br>
  <br># It is supposed to work cross-platform and thus doesn’t<br>
  <br># do too much. When packaging Privoxy it’s recommended to<br>
  <br># write a platform-specific start script instead of using<br>
  <br># this one.<br>
  <br>#<br>
  <br># Copyright : Written by and Copyright (C) 2001,2002 the<br>
  <br># Privoxy team. http://www.privoxy.org/<br>
  <br>#<br>
  <br># This program is free software; you can redistribute it<br>
  <br># and/or modify it under the terms of the GNU General<br>
  <br># Public License as published by the Free Software<br>
  <br># Foundation; either version 2 of the License, or (at<br>
  <br># your option) any later version.<br>
  <br>#<br>
  <br># This program is distributed in the hope that it will<br>
  <br># be useful, but WITHOUT ANY WARRANTY; without even the<br>
  <br># implied warranty of MERCHANTABILITY or FITNESS FOR A<br>
  <br># PARTICULAR PURPOSE. See the GNU General Public<br>
  <br># License for more details.<br>
  <br>#<br>
  <br># The GNU General Public License should be included with<br>
  <br># this file. If not, you can view it at<br>
  <br># http://www.gnu.org/copyleft/gpl.html<br>
  <br># or write to the Free Software Foundation, Inc., 59<br>
  <br># Temple Place – Suite 330, Boston, MA 02111-1307, USA.<br>
  <br>#<br>
  <br>###########################################################################</p>
<p>### BEGIN INIT INFO<br>
  <br># Provides: privoxy<br>
  <br># Required-Start:<br>
  <br># Required-Stop:<br>
  <br># Default-Start: 2 3 4 5<br>
  <br># Default-Stop: 0 1 6<br>
  <br># Short-Description: Start privoxy at boot time<br>
  <br># Description: Start and stop the privacy-enhancing HTTP proxy privoxy.<br>
  <br>### END INIT INFO</p>
<p># NOTE: This script may require editing to ensure proper location of<br>
  <br># config file, and the privoxy executable. Care should be taken to ensure<br>
  <br># logfile is writable by $P_USER (logfile is defined in config), and that<br>
  <br># there is suitable write access for $P_PIDFILE.</p>
<p>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/xpg4/bin:/usr/bin:/sbin:/bin:/tool/privoxy-3.0.26/sbin<br>
  <br>P_NAME=Privoxy<br>
  <br># Path to executable.<br>
  <br>P_DAEMON=privoxy<br>
  <br># Full path to location of Privoxy config file.<br>
  <br>P_CONF_FILE=/tool/privoxy-3.0.26/etc/config<br>
  <br># Full path to PID file location. Location must be writable by<br>
  <br># whoever runs this script and by Privoxy itself.<br>
  <br>P_PIDFILE=/tool/privoxy-3.0.26/var/run/privoxy.pid<br>
  <br># If uncommented, this script will try to run as USER=privoxy, which<br>
  <br># may require special handling of config, *.action, trust, logfile,<br>
  <br># jarfile, and pidfile.<br>
  <br>P_USER=privoxy</p>
<p># If a privoxy user is specified, lets try that. /bin/sh does not seem to<br>
  <br># know about $UID.<br>
  <br>if [ 0 = `id -u` ]; then<br>
  <br> if [ -n “$P_USER” ]; then<br>
  <br> id $P_USER 2>/dev/null >/dev/null<br>
  <br> if [ $? -eq 0 ]; then<br>
  <br> P_USER_SETTINGS=”–user $P_USER”<br>
  <br> else<br>
  <br> echo “User $P_USER doesn’t exist, exiting.”<br>
  <br> exit 1<br>
  <br> fi<br>
  <br> else<br>
  <br> # The user has sufficient rights, but $P_USER isn’t set<br>
  <br> echo “Running Privoxy as root is not recommended!”<br>
  <br> P_USER_SETTINGS=””<br>
  <br> fi<br>
  <br>else<br>
  <br> # The user has insufficient rights to run Privoxy as $P_USER<br>
  <br> # and may not be able to write or delete the PID file.<br>
  <br> echo “You aren’t root, expect trouble!”<br>
  <br> P_USER_SETTINGS=””<br>
  <br>fi</p>
<p>if [ ! -f $P_CONF_FILE ]; then<br>
  <br> echo “Can’t find $P_CONF_FILE, exiting.”<br>
  <br> exit 1<br>
  <br>fi</p>
<p>case “$1” in</p>
<p> start)<br>
  <br> if [ -f $P_PIDFILE ]; then<br>
  <br> if kill -0 `cat $P_PIDFILE`; then<br>
  <br> echo “Error: $P_NAME is already running, exiting.”<br>
  <br> exit 1<br>
  <br> else<br>
  <br> rm -f $P_PIDFILE<br>
  <br> fi<br>
  <br> fi</p>
<p> $P_DAEMON –pidfile $P_PIDFILE $P_USER_SETTINGS $P_CONF_FILE 2>/dev/null</p>
<p> if [ $? -eq 0 ]; then<br>
  <br> echo “Starting $P_NAME, OK.”<br>
  <br> else<br>
  <br> echo “Starting $P_NAME, Failed.”<br>
  <br> rm -f $P_PIDFILE<br>
  <br> fi<br>
  <br> ;;</p>
<p> restart)<br>
  <br> $0 stop<br>
  <br> $0 start<br>
  <br> ;;</p>
<p> stop)<br>
  <br> test ! -f $P_PIDFILE && echo “No $P_PIDFILE file found, exiting.” && exit 1<br>
  <br> kill `cat $P_PIDFILE` && rm -f $P_PIDFILE && \<br>
  <br> echo “Stopping $P_NAME, OK.” || echo “Stopping $P_NAME, failed.”<br>
  <br> ;;</p>
<p> *)<br>
  <br> echo “Usage: $0 {start|stop|restart}”<br>
  <br> exit 1<br>
  <br> ;;</p>
<p>esac</p>
<p>exit 0</p>
<p>How to Verify that?<br>
  <br>How to change the IP<br>
  <br>> echo -e ‘AUTHENTICATE “xxxxxxxxx”\r\nsignal NEWNYM\r\nQUIT’ | nc localhost 9051</p>
<p>Check the IP<br>
  <br>> curl -x localhost:8118 http://icanhazip.com/</p>
<p>How to change the IP from remote<br>
  <br>> echo -e ‘AUTHENTICATE “xxxxxxxxx”\r\nsignal NEWNYM\r\nQUIT’ | nc ubuntu-master 9051</p>
<p>Check the IP from Remote<br>
  <br>> curl -x centos-dev1:8118 http://icanhazip.com/</p>
<p>References:<br>
  <br>http://sillycat.iteye.com/blog/2223733<br>
  <br>http://sillycat.iteye.com/blog/2226093<br>
  <br>http://sillycat.iteye.com/blog/2227400</p>
<p>https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-centos-7<br>
  <br>https://hub.docker.com/_/centos/<br>
  <br>https://linuxacademy.com/community/posts/show/topic/21629-docker-failed-to-get-dbus-connection-operation-not-permitted<br>
  <br>https://serverfault.com/questions/824975/failed-to-get-d-bus-connection-operation-not-permitted<br>
  <br>https://github.com/CentOS/sig-cloud-instance-images/issues/45</p>
<p>https://www.rosehosting.com/blog/how-to-create-a-sudo-user-on-centos-7/
 </p></div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="https://uzzz.org/category/uncategorized/" rel="category tag">未分类</a>	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>




</body></html>
