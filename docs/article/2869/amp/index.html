<!DOCTYPE html>
<html amp lang="en-US" i-amphtml-layout="" i-amphtml-no-boilerplate="" transformed="self;v=1">
<head><meta charset="utf-8"><style amp-runtime="" i-amphtml-version="012111242025001">html{overflow-x:hidden!important}html.i-amphtml-fie{height:100%!important;width:100%!important}html:not([amp4ads]),html:not([amp4ads]) body{height:auto!important}html:not([amp4ads]) body{margin:0!important}body{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.i-amphtml-singledoc.i-amphtml-embedded{-ms-touch-action:pan-y pinch-zoom;touch-action:pan-y pinch-zoom}html.i-amphtml-fie>body,html.i-amphtml-singledoc>body{overflow:visible!important}html.i-amphtml-fie:not(.i-amphtml-inabox)>body,html.i-amphtml-singledoc:not(.i-amphtml-inabox)>body{position:relative!important}html.i-amphtml-ios-embed-legacy>body{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important}html.i-amphtml-ios-embed{overflow-y:auto!important;position:static}#i-amphtml-wrapper{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}html.i-amphtml-ios-embed.i-amphtml-ios-overscroll,html.i-amphtml-ios-embed.i-amphtml-ios-overscroll>#i-amphtml-wrapper{-webkit-overflow-scrolling:touch!important}#i-amphtml-wrapper>body{position:relative!important;border-top:1px solid transparent!important}#i-amphtml-wrapper+body{visibility:visible}#i-amphtml-wrapper+body .i-amphtml-lightbox-element,#i-amphtml-wrapper+body[i-amphtml-lightbox]{visibility:hidden}#i-amphtml-wrapper+body[i-amphtml-lightbox] .i-amphtml-lightbox-element{visibility:visible}#i-amphtml-wrapper.i-amphtml-scroll-disabled,.i-amphtml-scroll-disabled{overflow-x:hidden!important;overflow-y:hidden!important}amp-instagram{padding:54px 0px 0px!important;background-color:#fff}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide]{display:none}[subscriptions-dialog],body:not(.i-amphtml-subs-ready) [subscriptions-action],body:not(.i-amphtml-subs-ready) [subscriptions-section]{display:none!important}amp-experiment,amp-live-list>[update]{display:none}amp-list[resizable-children]>.i-amphtml-loading-container.amp-hidden{display:none!important}amp-list [fetch-error],amp-list[load-more] [load-more-button],amp-list[load-more] [load-more-end],amp-list[load-more] [load-more-failed],amp-list[load-more] [load-more-loading]{display:none}amp-list[diffable] div[role=list]{display:block}amp-story-page,amp-story[standalone]{min-height:1px!important;display:block!important;height:100%!important;margin:0!important;padding:0!important;overflow:hidden!important;width:100%!important}amp-story[standalone]{background-color:#000!important;position:relative!important}amp-story-page{background-color:#757575}amp-story .amp-active>div,amp-story .i-amphtml-loader-background{display:none!important}amp-story-page:not(:first-of-type):not([distance]):not([active]){transform:translateY(1000vh)!important}amp-autocomplete{position:relative!important;display:inline-block!important}amp-autocomplete>input,amp-autocomplete>textarea{padding:0.5rem;border:1px solid rgba(0,0,0,0.33)}.i-amphtml-autocomplete-results,amp-autocomplete>input,amp-autocomplete>textarea{font-size:1rem;line-height:1.5rem}[amp-fx^=fly-in]{visibility:hidden}amp-script[nodom],amp-script[sandboxed]{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}
/*# sourceURL=/css/ampdoc.css*/[hidden]{display:none!important}.i-amphtml-element{display:inline-block}.i-amphtml-blurry-placeholder{transition:opacity 0.3s cubic-bezier(0.0,0.0,0.2,1)!important;pointer-events:none}[layout=nodisplay]:not(.i-amphtml-element){display:none!important}.i-amphtml-layout-fixed,[layout=fixed][width][height]:not(.i-amphtml-layout-fixed){display:inline-block;position:relative}.i-amphtml-layout-responsive,[layout=responsive][width][height]:not(.i-amphtml-layout-responsive),[width][height][heights]:not([layout]):not(.i-amphtml-layout-responsive),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-layout-responsive){display:block;position:relative}.i-amphtml-layout-intrinsic,[layout=intrinsic][width][height]:not(.i-amphtml-layout-intrinsic){display:inline-block;position:relative;max-width:100%}.i-amphtml-layout-intrinsic .i-amphtml-sizer{max-width:100%}.i-amphtml-intrinsic-sizer{max-width:100%;display:block!important}.i-amphtml-layout-container,.i-amphtml-layout-fixed-height,[layout=container],[layout=fixed-height][height]:not(.i-amphtml-layout-fixed-height){display:block;position:relative}.i-amphtml-layout-fill,.i-amphtml-layout-fill.i-amphtml-notbuilt,[layout=fill]:not(.i-amphtml-layout-fill),body noscript>*{display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}body noscript>*{position:absolute!important;width:100%;height:100%;z-index:2}body noscript{display:inline!important}.i-amphtml-layout-flex-item,[layout=flex-item]:not(.i-amphtml-layout-flex-item){display:block;position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.i-amphtml-layout-fluid{position:relative}.i-amphtml-layout-size-defined{overflow:hidden!important}.i-amphtml-layout-awaiting-size{position:absolute!important;top:auto!important;bottom:auto!important}i-amphtml-sizer{display:block!important}@supports (aspect-ratio:1/1){i-amphtml-sizer.i-amphtml-disable-ar{display:none!important}}.i-amphtml-blurry-placeholder,.i-amphtml-fill-content{display:block;height:0;max-height:100%;max-width:100%;min-height:100%;min-width:100%;width:0;margin:auto}.i-amphtml-layout-size-defined .i-amphtml-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-replaced-content,.i-amphtml-screen-reader{padding:0!important;border:none!important}.i-amphtml-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:4px!important;height:4px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:8px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:12px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:16px!important}.i-amphtml-unresolved{position:relative;overflow:hidden!important}.i-amphtml-select-disabled{-webkit-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.i-amphtml-notbuilt,[layout]:not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){position:relative;overflow:hidden!important;color:transparent!important}.i-amphtml-notbuilt:not(.i-amphtml-layout-container)>*,[layout]:not([layout=container]):not(.i-amphtml-element)>*,[width][height][heights]:not([layout]):not(.i-amphtml-element)>*,[width][height][sizes]:not([layout]):not(.i-amphtml-element)>*{display:none}amp-img:not(.i-amphtml-element)[i-amphtml-ssr]>img.i-amphtml-fill-content{display:block}.i-amphtml-notbuilt:not(.i-amphtml-layout-container),[layout]:not([layout=container]):not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){color:transparent!important;line-height:0!important}.i-amphtml-ghost{visibility:hidden!important}.i-amphtml-element>[placeholder],[layout]:not(.i-amphtml-element)>[placeholder],[width][height][heights]:not([layout]):not(.i-amphtml-element)>[placeholder],[width][height][sizes]:not([layout]):not(.i-amphtml-element)>[placeholder]{display:block;line-height:normal}.i-amphtml-element>[placeholder].amp-hidden,.i-amphtml-element>[placeholder].hidden{visibility:hidden}.i-amphtml-element:not(.amp-notsupported)>[fallback],.i-amphtml-layout-container>[placeholder].amp-hidden,.i-amphtml-layout-container>[placeholder].hidden{display:none}.i-amphtml-layout-size-defined>[fallback],.i-amphtml-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1}amp-img[i-amphtml-ssr]:not(.i-amphtml-element)>[placeholder]{z-index:auto}.i-amphtml-notbuilt>[placeholder]{display:block!important}.i-amphtml-hidden-by-media-query{display:none!important}.i-amphtml-element-error{background:red!important;color:#fff!important;position:relative!important}.i-amphtml-element-error:before{content:attr(error-message)}i-amp-scroll-container,i-amphtml-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active,i-amphtml-scroll-container.amp-active{overflow:auto;-webkit-overflow-scrolling:touch}.i-amphtml-loading-container{display:block!important;pointer-events:none;z-index:1}.i-amphtml-notbuilt>.i-amphtml-loading-container{display:block!important}.i-amphtml-loading-container.amp-hidden{visibility:hidden}.i-amphtml-element>[overflow]{cursor:pointer;position:relative;z-index:2;visibility:hidden;display:initial;line-height:normal}.i-amphtml-layout-size-defined>[overflow]{position:absolute}.i-amphtml-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{display:none!important}amp-analytics,amp-auto-ads,amp-story-auto-ads{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}html.i-amphtml-fie>amp-analytics{position:initial!important}[visible-when-invalid]:not(.visible),form [submit-error],form [submit-success],form [submitting]{display:none}amp-accordion{display:block!important}@media (min-width:1px){:where(amp-accordion>section)>:first-child{margin:0;background-color:#efefef;padding-right:20px;border:1px solid #dfdfdf}:where(amp-accordion>section)>:last-child{margin:0}}amp-accordion>section{float:none!important}amp-accordion>section>*{float:none!important;display:block!important;overflow:hidden!important;position:relative!important}amp-accordion,amp-accordion>section{margin:0}amp-accordion:not(.i-amphtml-built)>section>:last-child{display:none!important}amp-accordion:not(.i-amphtml-built)>section[expanded]>:last-child{display:block!important}
/*# sourceURL=/css/ampshared.css*/</style><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><title>【Android休眠】之Android休眠机制 - 有组织在!</title><link rel="preconnect" href="https://cdn.ampproject.org"><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js"><script async="" src="https://cdn.ampproject.org/v0.js"></script><style amp-custom="">.amp-wp-enforced-sizes{max-width:100%;margin:0 auto}amp-img.amp-wp-enforced-sizes[layout="intrinsic"] > img{object-fit:contain}html{background:#0a89c0}body{background:#fff;color:#353535;font-family:Georgia,"Times New Roman",Times,Serif;font-weight:300;line-height:1.75em}p,ul{margin:0 0 1em;padding:0}a,a:visited{color:#0a89c0}a:hover,a:active,a:focus{color:#353535}.amp-wp-meta,.amp-wp-header div,.amp-wp-title,.amp-wp-tax-category,.amp-wp-footer p,.back-to-top{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue",sans-serif}.amp-wp-header{background-color:#0a89c0}.amp-wp-header div{color:#fff;font-size:1em;font-weight:400;margin:0 auto;max-width:calc(840px - 32px);padding:.875em 16px;position:relative}.amp-wp-header a{color:#fff;text-decoration:none}.amp-wp-header .amp-wp-site-icon{background-color:#fff;border:1px solid #fff;border-radius:50%;position:absolute;right:18px;top:10px}.amp-wp-article{color:#353535;font-weight:400;margin:1.5em auto;max-width:840px;overflow-wrap:break-word;word-wrap:break-word}.amp-wp-article-header{align-items:center;align-content:stretch;display:flex;flex-wrap:wrap;justify-content:space-between;margin:1.5em 16px 0}.amp-wp-title{color:#353535;display:block;flex:1 0 100%;font-weight:900;margin:0 0 .625em;width:100%}.amp-wp-meta{color:#696969;display:inline-block;flex:2 1 50%;font-size:.875em;line-height:1.5em;margin:0 0 1.5em;padding:0}.amp-wp-article-header .amp-wp-meta:last-of-type{text-align:right}.amp-wp-article-header .amp-wp-meta:first-of-type{text-align:left}.amp-wp-byline amp-img,.amp-wp-byline .amp-wp-author{display:inline-block;vertical-align:middle}.amp-wp-byline amp-img{border:1px solid #0a89c0;border-radius:50%;position:relative;margin-right:6px}.amp-wp-posted-on{text-align:right}.amp-wp-article-content{margin:0 16px}.amp-wp-article-content ul{margin-left:1em}.amp-wp-article-content amp-img{margin:0 auto}.amp-wp-article-footer .amp-wp-meta{display:block}.amp-wp-tax-category{color:#696969;font-size:.875em;line-height:1.5em;margin:1.5em 16px}.amp-wp-footer{border-top:1px solid #c2c2c2;margin:calc(1.5em - 1px) 0 0}.amp-wp-footer div{margin:0 auto;max-width:calc(840px - 32px);padding:1.25em 16px 1.25em;position:relative}.amp-wp-footer h2{font-size:1em;line-height:1.375em;margin:0 0 .5em}.amp-wp-footer p{color:#696969;font-size:.8em;line-height:1.5em;margin:0 85px 0 0}.amp-wp-footer a{text-decoration:none}.back-to-top{bottom:1.275em;font-size:.8em;font-weight:600;line-height:2em;position:absolute;right:16px}.htmledit_views span[lang]{font-style:italic}.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}p[align=center]{text-align:center}.htmledit_views amp-img{max-width:100%}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views h1,.htmledit_views h2,.htmledit_views h3,.htmledit_views h4{color:#4f4f4f;margin:8px 0 16px;font-weight:700}.htmledit_views ul{margin:0 0 24px;padding:0;font-size:16px}.htmledit_views ul li{list-style-type:disc;margin:8px 0 0 32px}.htmledit_views h1{font-size:28px;line-height:36px}.htmledit_views h2{font-size:24px;line-height:32px}.htmledit_views h3{font-size:22px;line-height:30px}.htmledit_views h4{font-size:20px;line-height:28px}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-family:"Source Code Pro","DejaVu Sans Mono","Ubuntu Mono","Anonymous Pro","Droid Sans Mono",Menlo,Monaco,Consolas,Inconsolata,Courier,monospace,"PingFang SC","Microsoft YaHei",sans-serif}.htmledit_views code{border-radius:4px}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}.htmledit_views pre code{display:block;line-height:22px;overflow-x:auto;white-space:pre;word-wrap:normal;border-radius:4px;padding:8px}.htmledit_views pre code:not(.hljs){background-color:#f3f4f5}.htmledit_views pre code,.htmledit_views pre code div,.htmledit_views pre code span{font-size:14px}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-5b2cb8c{font-family:"Comic Sans MS"}

/*# sourceURL=amp-custom.css */</style><script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://uzzz.org/article/2869/#primaryimage","url":"https://uzshare.com/_p?https://img-blog.csdn.net/20161214213708009"},{"@type":"WebPage","@id":"https://uzzz.org/article/2869/#webpage","url":"https://uzzz.org/article/2869/","inLanguage":"en-US","name":"\u3010Android\u4f11\u7720\u3011\u4e4bAndroid\u4f11\u7720\u673a\u5236 - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"primaryImageOfPage":{"@id":"https://uzzz.org/article/2869/#primaryimage"},"datePublished":"2016-12-14T13:42:13+00:00","dateModified":"2016-12-14T13:42:13+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script><link rel="canonical" href="https://uzzz.org/article/2869/"></head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:32px;height:32px;" i-amphtml-layout="fixed"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">【Android休眠】之Android休眠机制</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:24px;height:24px;" i-amphtml-layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2016-12-14T21:42:13+00:00">
		5 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
 <br>
 
 
 
<div class="htmledit_views" id="content_views">
<h3><a href="http://blog.csdn.net/u013686019/article/details/53645646" rel="nofollow" data-token="83884438658342f81e00e569d84b4f75">http://blog.csdn.net/u013686019/article/details/53645646</a><br></h3>
<h3><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">一、休眠概述</span></h3>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">休眠，简而言之就是设备在不需要工作的时候把一些部件、外设关掉(掉电或让它进入低功耗模式)。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">为什么要休眠呢？一言以蔽之：省电。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">休眠分主动休眠和被动休眠。<strong>主动休眠</strong>：比如我电脑不用了，就通过设置让系统进入休眠模式；<strong>被动休眠</strong>：系统检测到自己闲的慌，为了节约故，自己就休眠去了。</span><br></span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">废话不叙。<br></span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><br></span></p>
<h3><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">二、Android休眠</span></h3>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">休眠是内核的核心工作，而Android是基于Linux内核的，所以Android休眠和内核有着千丝万缕的联系；由于Android的特殊应用场景：移动设备，所以Android休眠和内核又有着特别的需求。</span></p>
<h4><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">1、联系：</span></h4>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">Android设备停止使用，系统没有什么事情可做，进入休眠状态的功能最终是由内核去实现的；每一类硬件都有自己的驱动，具体的驱动决定怎么进入休眠以及处于何种层次的休眠。比如：对于platform_device，就按照platform_driver定义的规则，在suspend调用的时候，去做上面提到的事情：</span></p>

<pre><code class="language-cpp">struct platform_driver {
	int (*probe)(struct platform_device *);
	int (*remove)(struct platform_device *);
	void (*shutdown)(struct platform_device *);
	int (*suspend)(struct platform_device *, pm_message_t state);
	int (*resume)(struct platform_device *);
	struct device_driver driver;
	const struct platform_device_id *id_table;
};</code></pre>
<p></p>
<h4><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">2、Android的特别需求：</span></h4>
<p>比如对于自己的电脑，不用让它休眠好了；但是对于我们形影不离的手机，在休眠的时候还要睁一只眼：来电了要通知你，QQ啊微信啊什么的由信息了也要通知你，所以Android在Linux内核休眠机制之上，提出了“Opportunistic Suspend”<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><br></span></p>
<h3><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">三、休眠实践</span></h3>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"></span>絮絮叨叨这么多，下面让我们切切实实体验下休眠。</p>
<h4>1、休眠模式</h4>
<p>休眠是分好几种模式的，不同模式实现方式、耗电量不同，以下来自<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">Documentation/power/states.txt</span>：</p>

<pre><code class="language-html">The kernel supports four power management states generically, though
one is generic and the other three are dependent on platform support
code to implement the low-level details for each state.
This file describes each state, what they are
commonly called, what ACPI state they map to, and what string to write
to /sys/power/state to enter that state

state:		Freeze / Low-Power Idle
ACPI state:	S0
String:		"freeze"

This state is a generic, pure software, light-weight, low-power state.
It allows more energy to be saved relative to idle by freezing user
space and putting all I/O devices into low-power states (possibly
lower-power than available at run time), such that the processors can
spend more time in their idle states.
This state can be used for platforms without Standby/Suspend-to-RAM
support, or it can be used in addition to Suspend-to-RAM (memory sleep)
to provide reduced resume latency.


State:		Standby / Power-On Suspend
ACPI State:	S1
String:		"standby"

This state offers minimal, though real, power savings, while providing
a very low-latency transition back to a working system. No operating
state is lost (the CPU retains power), so the system easily starts up
again where it left off. 

We try to put devices in a low-power state equivalent to D1, which
also offers low power savings, but low resume latency. Not all devices
support D1, and those that don't are left on. 


State:		Suspend-to-RAM
ACPI State:	S3
String:		"mem"

This state offers significant power savings as everything in the
system is put into a low-power state, except for memory, which is
placed in self-refresh mode to retain its contents. 

System and device state is saved and kept in memory. All devices are
suspended and put into D3. In many cases, all peripheral buses lose
power when entering STR, so devices must be able to handle the
transition back to the On state. 

For at least ACPI, STR requires some minimal boot-strapping code to
resume the system from STR. This may be true on other platforms. 


State:		Suspend-to-disk
ACPI State:	S4
String:		"disk"

This state offers the greatest power savings, and can be used even in
the absence of low-level platform support for power management. This
state operates similarly to Suspend-to-RAM, but includes a final step
of writing memory contents to disk. On resume, this is read and memory
is restored to its pre-suspend state. </code></pre>
<p>
  <span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">虽说kernel支持上述四种休眠模式，但具体哪几种可用取决于你的硬件。那么怎么知道自己的Android设备支持的休眠模式呢？</span> </p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">答案：通过/sys/文件系统。查询支持的休眠模式可以cat文件/sys/power/state：</span></p>

<pre><code class="language-cpp">cat /sys/power/state 
freeze mem</code></pre>

<p>如果我们往<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/state</span>文件<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">echo</span>上面的某一种模式的字符串，系统就会进入相应的休眠模式：</p>

<pre><code class="language-cpp">echo "mem" > /sys/power/state</code></pre>
<p></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">如果你搜索过Android休眠相关的内容，在老版本的Android(4.4版本之前)会见有提到PowerManager</span><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">的setPowerState()方法，该方法即是通过<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">以上方式使系统进入休眠。但自从引入<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">Autosleep后，就不在这么做了，<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">setPowerState()方法</span>也销声匿迹。</span></span></span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><br></span></span></span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">2、<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/</span>目录下文件</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><amp-img src="https://uzshare.com/_p?https://img-blog.csdn.net/20161214213708009" alt="" height="166" width="346" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg%20height=%22166%22%20width=%22346%22%20xmlns=%22http://www.w3.org/2000/svg%22%20version=%221.1%22/>"></i-amphtml-sizer><noscript><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20161214213708009" alt="" height="166" width="346"></noscript></amp-img><br></span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">文件简介：</span></p>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/state：用来控制系统的Power状态。读取该文件可以获取系统支持的休眠模式，写入该文件休眠模式的一种，系统进入到指定的休眠模式。如上所示例。<br></span></li>
</ul>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/</span>autosleep：从Android wakelocks补丁集中演化而来，用于取代Android wakelocks中的自动休眠功能。向该文件写入<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/state</span>返回值的某一种，系统会在适当的时候进入指定的休眠的模式；读取该文件返回之前写入的数值。</span></li>
</ul>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/</span></span>wake_lock、<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/</span></span>wake_unlock：即我们常说的休眠锁，如果应用持有休眠锁，系统将无法进入休眠模式。在Android wakelocks时代，写wake_lock获取锁，写wake_unlock释放锁；在AutoSleep时代，具体参见<a href="http://blog.csdn.net/u013686019/article/details/53691897" rel="nofollow" data-token="91c87017c56b532561bf866dfeb86e2a">【Android休眠】之AutoSleep</a><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><br></span></span></li>
</ul>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">wake</span>up_count：用于解决“system suspend和system wakeup events之间的同步问题”。</span></li>
</ul>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/pm_async：状态切换开关，允许/禁止User空间对设备进行异步的suspend和resume操作。</span></li>
</ul>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">/sys/power/pm_freeze_timeout：系统在执行休眠动作的时候要冻结(freeze)用户控件的进程和内核空间的允许冻结的内核线程，执行这些操作要耗时间吧？该文件指定所需时间的最大值。</span></li>
</ul>
<h3><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">四、其他需要明了的问题</span></h3>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">1、Android设备屏幕暗下来的时候，并不是立即就进入了休眠模式；当所有唤醒源都处于de-avtive状态后，系统才会进入休眠。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">2、<span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">Android设备</span>连着adb线到其他设备的情况下，设备是不会进入休眠模式的。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">3、有休眠操作就有唤醒，就需要唤醒源。唤醒源有很多种，在内核注册，比如常用的Power按键。</span></p>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">4、曾经困惑的一个问题：系统怎么知道自己应该进入休眠模式了？它的判断依据是什么？</span></p>
<ul>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">在wakelock时代，系统休眠过程中去检测休眠锁；如果系统中没有其他部件持有休眠锁，就尝试进入休眠模式，没有异常事件发生的话就进入休眠模式。</span></li>
<li><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">Android从4.4开始使用autosleep机制，只要不存在任何active的唤醒源(wakeup_source)了，就进入休眠模式。<br></span></li>
</ul>
<p><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c">5、系统Power Manager整体流程：</span></p>
<p align="center"><span data-amp-original-style="font-family:'Comic Sans MS';" class="amp-wp-5b2cb8c"><amp-img src="https://uzshare.com/_p?https://img-blog.csdn.net/20161215095029484" alt="" width="678" height="358" class="amp-wp-enforced-sizes i-amphtml-layout-intrinsic i-amphtml-layout-size-defined" layout="intrinsic" i-amphtml-layout="intrinsic"><i-amphtml-sizer class="i-amphtml-sizer"><img alt="" aria-hidden="true" class="i-amphtml-intrinsic-sizer" role="presentation" src="data:image/svg+xml;charset=utf-8,<svg%20height=%22358%22%20width=%22678%22%20xmlns=%22http://www.w3.org/2000/svg%22%20version=%221.1%22/>"></i-amphtml-sizer><noscript><img src="https://uzshare.com/_p?https://img-blog.csdn.net/20161215095029484" alt="" width="678" height="358" class=""></noscript></amp-img><br></span></p>
</div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="https://uzzz.org/category/yidongkaifa/" rel="category tag">移动开发</a>	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>




</body></html>
