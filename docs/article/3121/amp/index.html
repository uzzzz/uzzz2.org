<!DOCTYPE html>
<html amp lang="en-US" i-amphtml-layout="" i-amphtml-no-boilerplate="" transformed="self;v=1">
<head><meta charset="utf-8"><style amp-runtime="" i-amphtml-version="012111242025001">html{overflow-x:hidden!important}html.i-amphtml-fie{height:100%!important;width:100%!important}html:not([amp4ads]),html:not([amp4ads]) body{height:auto!important}html:not([amp4ads]) body{margin:0!important}body{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%}html.i-amphtml-singledoc.i-amphtml-embedded{-ms-touch-action:pan-y pinch-zoom;touch-action:pan-y pinch-zoom}html.i-amphtml-fie>body,html.i-amphtml-singledoc>body{overflow:visible!important}html.i-amphtml-fie:not(.i-amphtml-inabox)>body,html.i-amphtml-singledoc:not(.i-amphtml-inabox)>body{position:relative!important}html.i-amphtml-ios-embed-legacy>body{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important}html.i-amphtml-ios-embed{overflow-y:auto!important;position:static}#i-amphtml-wrapper{overflow-x:hidden!important;overflow-y:auto!important;position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;margin:0!important;display:block!important}html.i-amphtml-ios-embed.i-amphtml-ios-overscroll,html.i-amphtml-ios-embed.i-amphtml-ios-overscroll>#i-amphtml-wrapper{-webkit-overflow-scrolling:touch!important}#i-amphtml-wrapper>body{position:relative!important;border-top:1px solid transparent!important}#i-amphtml-wrapper+body{visibility:visible}#i-amphtml-wrapper+body .i-amphtml-lightbox-element,#i-amphtml-wrapper+body[i-amphtml-lightbox]{visibility:hidden}#i-amphtml-wrapper+body[i-amphtml-lightbox] .i-amphtml-lightbox-element{visibility:visible}#i-amphtml-wrapper.i-amphtml-scroll-disabled,.i-amphtml-scroll-disabled{overflow-x:hidden!important;overflow-y:hidden!important}amp-instagram{padding:54px 0px 0px!important;background-color:#fff}amp-iframe iframe{box-sizing:border-box!important}[amp-access][amp-access-hide]{display:none}[subscriptions-dialog],body:not(.i-amphtml-subs-ready) [subscriptions-action],body:not(.i-amphtml-subs-ready) [subscriptions-section]{display:none!important}amp-experiment,amp-live-list>[update]{display:none}amp-list[resizable-children]>.i-amphtml-loading-container.amp-hidden{display:none!important}amp-list [fetch-error],amp-list[load-more] [load-more-button],amp-list[load-more] [load-more-end],amp-list[load-more] [load-more-failed],amp-list[load-more] [load-more-loading]{display:none}amp-list[diffable] div[role=list]{display:block}amp-story-page,amp-story[standalone]{min-height:1px!important;display:block!important;height:100%!important;margin:0!important;padding:0!important;overflow:hidden!important;width:100%!important}amp-story[standalone]{background-color:#000!important;position:relative!important}amp-story-page{background-color:#757575}amp-story .amp-active>div,amp-story .i-amphtml-loader-background{display:none!important}amp-story-page:not(:first-of-type):not([distance]):not([active]){transform:translateY(1000vh)!important}amp-autocomplete{position:relative!important;display:inline-block!important}amp-autocomplete>input,amp-autocomplete>textarea{padding:0.5rem;border:1px solid rgba(0,0,0,0.33)}.i-amphtml-autocomplete-results,amp-autocomplete>input,amp-autocomplete>textarea{font-size:1rem;line-height:1.5rem}[amp-fx^=fly-in]{visibility:hidden}amp-script[nodom],amp-script[sandboxed]{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}
/*# sourceURL=/css/ampdoc.css*/[hidden]{display:none!important}.i-amphtml-element{display:inline-block}.i-amphtml-blurry-placeholder{transition:opacity 0.3s cubic-bezier(0.0,0.0,0.2,1)!important;pointer-events:none}[layout=nodisplay]:not(.i-amphtml-element){display:none!important}.i-amphtml-layout-fixed,[layout=fixed][width][height]:not(.i-amphtml-layout-fixed){display:inline-block;position:relative}.i-amphtml-layout-responsive,[layout=responsive][width][height]:not(.i-amphtml-layout-responsive),[width][height][heights]:not([layout]):not(.i-amphtml-layout-responsive),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-layout-responsive){display:block;position:relative}.i-amphtml-layout-intrinsic,[layout=intrinsic][width][height]:not(.i-amphtml-layout-intrinsic){display:inline-block;position:relative;max-width:100%}.i-amphtml-layout-intrinsic .i-amphtml-sizer{max-width:100%}.i-amphtml-intrinsic-sizer{max-width:100%;display:block!important}.i-amphtml-layout-container,.i-amphtml-layout-fixed-height,[layout=container],[layout=fixed-height][height]:not(.i-amphtml-layout-fixed-height){display:block;position:relative}.i-amphtml-layout-fill,.i-amphtml-layout-fill.i-amphtml-notbuilt,[layout=fill]:not(.i-amphtml-layout-fill),body noscript>*{display:block;overflow:hidden!important;position:absolute;top:0;left:0;bottom:0;right:0}body noscript>*{position:absolute!important;width:100%;height:100%;z-index:2}body noscript{display:inline!important}.i-amphtml-layout-flex-item,[layout=flex-item]:not(.i-amphtml-layout-flex-item){display:block;position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.i-amphtml-layout-fluid{position:relative}.i-amphtml-layout-size-defined{overflow:hidden!important}.i-amphtml-layout-awaiting-size{position:absolute!important;top:auto!important;bottom:auto!important}i-amphtml-sizer{display:block!important}@supports (aspect-ratio:1/1){i-amphtml-sizer.i-amphtml-disable-ar{display:none!important}}.i-amphtml-blurry-placeholder,.i-amphtml-fill-content{display:block;height:0;max-height:100%;max-width:100%;min-height:100%;min-width:100%;width:0;margin:auto}.i-amphtml-layout-size-defined .i-amphtml-fill-content{position:absolute;top:0;left:0;bottom:0;right:0}.i-amphtml-replaced-content,.i-amphtml-screen-reader{padding:0!important;border:none!important}.i-amphtml-screen-reader{position:fixed!important;top:0px!important;left:0px!important;width:4px!important;height:4px!important;opacity:0!important;overflow:hidden!important;margin:0!important;display:block!important;visibility:visible!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:8px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:12px!important}.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader~.i-amphtml-screen-reader{left:16px!important}.i-amphtml-unresolved{position:relative;overflow:hidden!important}.i-amphtml-select-disabled{-webkit-user-select:none!important;-ms-user-select:none!important;user-select:none!important}.i-amphtml-notbuilt,[layout]:not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){position:relative;overflow:hidden!important;color:transparent!important}.i-amphtml-notbuilt:not(.i-amphtml-layout-container)>*,[layout]:not([layout=container]):not(.i-amphtml-element)>*,[width][height][heights]:not([layout]):not(.i-amphtml-element)>*,[width][height][sizes]:not([layout]):not(.i-amphtml-element)>*{display:none}amp-img:not(.i-amphtml-element)[i-amphtml-ssr]>img.i-amphtml-fill-content{display:block}.i-amphtml-notbuilt:not(.i-amphtml-layout-container),[layout]:not([layout=container]):not(.i-amphtml-element),[width][height][heights]:not([layout]):not(.i-amphtml-element),[width][height][sizes]:not(img):not([layout]):not(.i-amphtml-element){color:transparent!important;line-height:0!important}.i-amphtml-ghost{visibility:hidden!important}.i-amphtml-element>[placeholder],[layout]:not(.i-amphtml-element)>[placeholder],[width][height][heights]:not([layout]):not(.i-amphtml-element)>[placeholder],[width][height][sizes]:not([layout]):not(.i-amphtml-element)>[placeholder]{display:block;line-height:normal}.i-amphtml-element>[placeholder].amp-hidden,.i-amphtml-element>[placeholder].hidden{visibility:hidden}.i-amphtml-element:not(.amp-notsupported)>[fallback],.i-amphtml-layout-container>[placeholder].amp-hidden,.i-amphtml-layout-container>[placeholder].hidden{display:none}.i-amphtml-layout-size-defined>[fallback],.i-amphtml-layout-size-defined>[placeholder]{position:absolute!important;top:0!important;left:0!important;right:0!important;bottom:0!important;z-index:1}amp-img[i-amphtml-ssr]:not(.i-amphtml-element)>[placeholder]{z-index:auto}.i-amphtml-notbuilt>[placeholder]{display:block!important}.i-amphtml-hidden-by-media-query{display:none!important}.i-amphtml-element-error{background:red!important;color:#fff!important;position:relative!important}.i-amphtml-element-error:before{content:attr(error-message)}i-amp-scroll-container,i-amphtml-scroll-container{position:absolute;top:0;left:0;right:0;bottom:0;display:block}i-amp-scroll-container.amp-active,i-amphtml-scroll-container.amp-active{overflow:auto;-webkit-overflow-scrolling:touch}.i-amphtml-loading-container{display:block!important;pointer-events:none;z-index:1}.i-amphtml-notbuilt>.i-amphtml-loading-container{display:block!important}.i-amphtml-loading-container.amp-hidden{visibility:hidden}.i-amphtml-element>[overflow]{cursor:pointer;position:relative;z-index:2;visibility:hidden;display:initial;line-height:normal}.i-amphtml-layout-size-defined>[overflow]{position:absolute}.i-amphtml-element>[overflow].amp-visible{visibility:visible}template{display:none!important}.amp-border-box,.amp-border-box *,.amp-border-box :after,.amp-border-box :before{box-sizing:border-box}amp-pixel{display:none!important}amp-analytics,amp-auto-ads,amp-story-auto-ads{position:fixed!important;top:0!important;width:1px!important;height:1px!important;overflow:hidden!important;visibility:hidden}html.i-amphtml-fie>amp-analytics{position:initial!important}[visible-when-invalid]:not(.visible),form [submit-error],form [submit-success],form [submitting]{display:none}amp-accordion{display:block!important}@media (min-width:1px){:where(amp-accordion>section)>:first-child{margin:0;background-color:#efefef;padding-right:20px;border:1px solid #dfdfdf}:where(amp-accordion>section)>:last-child{margin:0}}amp-accordion>section{float:none!important}amp-accordion>section>*{float:none!important;display:block!important;overflow:hidden!important;position:relative!important}amp-accordion,amp-accordion>section{margin:0}amp-accordion:not(.i-amphtml-built)>section>:last-child{display:none!important}amp-accordion:not(.i-amphtml-built)>section[expanded]>:last-child{display:block!important}
/*# sourceURL=/css/ampshared.css*/</style><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1"><title>高级纹理映射知识汇总 - 有组织在!</title><link rel="preconnect" href="https://cdn.ampproject.org"><link rel="preload" as="script" href="https://cdn.ampproject.org/v0.js"><script async="" src="https://cdn.ampproject.org/v0.js"></script><style amp-custom="">html{background:#0a89c0}body{background:#fff;color:#353535;font-family:Georgia,"Times New Roman",Times,Serif;font-weight:300;line-height:1.75em}p{margin:0 0 1em;padding:0}a,a:visited{color:#0a89c0}a:hover,a:active,a:focus{color:#353535}.amp-wp-meta,.amp-wp-header div,.amp-wp-title,.amp-wp-tax-category,.amp-wp-footer p,.back-to-top{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen-Sans","Ubuntu","Cantarell","Helvetica Neue",sans-serif}.amp-wp-header{background-color:#0a89c0}.amp-wp-header div{color:#fff;font-size:1em;font-weight:400;margin:0 auto;max-width:calc(840px - 32px);padding:.875em 16px;position:relative}.amp-wp-header a{color:#fff;text-decoration:none}.amp-wp-header .amp-wp-site-icon{background-color:#fff;border:1px solid #fff;border-radius:50%;position:absolute;right:18px;top:10px}.amp-wp-article{color:#353535;font-weight:400;margin:1.5em auto;max-width:840px;overflow-wrap:break-word;word-wrap:break-word}.amp-wp-article-header{align-items:center;align-content:stretch;display:flex;flex-wrap:wrap;justify-content:space-between;margin:1.5em 16px 0}.amp-wp-title{color:#353535;display:block;flex:1 0 100%;font-weight:900;margin:0 0 .625em;width:100%}.amp-wp-meta{color:#696969;display:inline-block;flex:2 1 50%;font-size:.875em;line-height:1.5em;margin:0 0 1.5em;padding:0}.amp-wp-article-header .amp-wp-meta:last-of-type{text-align:right}.amp-wp-article-header .amp-wp-meta:first-of-type{text-align:left}.amp-wp-byline amp-img,.amp-wp-byline .amp-wp-author{display:inline-block;vertical-align:middle}.amp-wp-byline amp-img{border:1px solid #0a89c0;border-radius:50%;position:relative;margin-right:6px}.amp-wp-posted-on{text-align:right}.amp-wp-article-content{margin:0 16px}.amp-wp-article-content amp-img{margin:0 auto}.amp-wp-article-footer .amp-wp-meta{display:block}.amp-wp-tax-category{color:#696969;font-size:.875em;line-height:1.5em;margin:1.5em 16px}.amp-wp-footer{border-top:1px solid #c2c2c2;margin:calc(1.5em - 1px) 0 0}.amp-wp-footer div{margin:0 auto;max-width:calc(840px - 32px);padding:1.25em 16px 1.25em;position:relative}.amp-wp-footer h2{font-size:1em;line-height:1.375em;margin:0 0 .5em}.amp-wp-footer p{color:#696969;font-size:.8em;line-height:1.5em;margin:0 85px 0 0}.amp-wp-footer a{text-decoration:none}.back-to-top{bottom:1.275em;font-size:.8em;font-weight:600;line-height:2em;position:absolute;right:16px}.htmledit_views em,.htmledit_views span[lang]{font-style:italic}.htmledit_views{font-family:-apple-system,SF UI Text,Arial,PingFang SC,Hiragino Sans GB,Microsoft YaHei,WenQuanYi Micro Hei,sans-serif,SimHei,SimSun}.htmledit_views a>amp-img{padding:1px;margin:1px;border:none;outline:#0782c1 solid 1px}.htmledit_views p{font-size:16px;color:#4d4d4d;font-weight:400;line-height:26px;margin:0 0 16px;overflow-x:auto}.htmledit_views amp-img{max-width:100%}.htmledit_views strong,.htmledit_views strong span{font-weight:700}.htmledit_views *{box-sizing:border-box}.htmledit_views h1,.htmledit_views h2,.htmledit_views h3{color:#4f4f4f;margin:8px 0 16px;font-weight:700}.htmledit_views h1{font-size:28px;line-height:36px}.htmledit_views h2{font-size:24px;line-height:32px}.htmledit_views h3{font-size:22px;line-height:30px}.htmledit_views table tr{border:0;border-top:1px solid #ddd;background-color:#fff}.htmledit_views table{border-collapse:collapse;display:table;width:100%;text-align:left;margin-bottom:24px;margin-left:auto;margin-right:auto}.htmledit_views tbody{border:0}.htmledit_views table tr:nth-child(2n){background-color:#f7f7f7}.htmledit_views table tr td{border:1px solid #ddd;font-size:14px;color:#4f4f4f;line-height:22px;padding:8px;text-align:left}.htmledit_views table tr td p{font-size:14px;color:#4f4f4f;margin:0;padding:0;text-align:left;line-height:22px}.htmledit_views pre{white-space:pre-wrap;word-wrap:break-word;margin:0 0 24px;overflow-x:auto;padding:8px}.htmledit_views pre{font-family:Consolas,Inconsolata,Courier,monospace;font-size:14px;line-height:22px;color:#000}.htmledit_views a{color:#4ea1db;text-decoration:none}.htmledit_views a:focus,.htmledit_views a:hover{color:#ca0c16}.htmledit_views a:visited{color:#6795b5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-3977ce7{background-color:#fff;font-size:14px;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-38e5e2c{font-size:14px;background-color:#fff;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-0a0cfb8{background-color:#fff;font-weight:normal;font-size:14px;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-20ac7c3{background-color:inherit;font-style:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-dd493e9{background-color:#fff;font-size:14px;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e9fafc6{background-color:inherit;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-b93bf72{font-size:14px;color:#000;background-color:#fff;font-weight:normal;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d722d50{background-color:#fff;font-weight:normal;font-style:normal;font-size:14px;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-712a63e{font-size:14px;color:rgba(255,255,0,0);background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-6f084b0{color:#f00;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-388561c{font-size:14px;color:#040800;background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-14c8475{margin:5px 0px;background-color:#fff;font-weight:normal;color:#000;font-size:14px;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-2841171{margin:5px 0px;background-color:#fff;font-weight:normal;font-size:14px;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-350acd6{font-size:undefined;border-collapse:collapse;margin-top:10px;margin-bottom:10px;display:table;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7d56003{word-break:break-all;border:1px solid #999;padding:5px 16px 5px 12px;min-height:25px;min-width:25px;height:25px;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-49d96a9{color:#3c3c3c;background-color:inherit;font-size:11pt}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-0e1bca6{color:#040800;background-color:inherit;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-81d8503{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-style:normal;background-color:inherit;color:#c00000}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-43c2f3f{color:#800000;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d93046f{margin:5px 0px;background-color:inherit;color:#00b050}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-3b94075{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-style:normal;background-color:inherit;color:#00b050}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-145c37b{color:#00b050;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ad2a445{font-size:14px;color:#c00000;background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-4923382{background-color:#fff;color:#333;font-size:14px;font-style:normal;font-weight:normal;text-align:start}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7a2d47e{background-color:#fff;color:#136ec2;font-size:14px;font-style:normal;font-weight:normal;text-align:start}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-100b07c{font-size:14px;background-color:#fff;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-2089cc4{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-style:normal;background-color:inherit;font-weight:normal;color:#00b050}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-35e04fe{color:#004080;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-2de1fe0{color:#333;background-color:#fff;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e4fdad8{background-color:inherit;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-fbbed93{font-size:14px;background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7a3597a{background-color:#fff;color:#000;font-size:14px;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-cbfe37b{font-size:14px;color:#333;background-color:#fff;font-style:normal;font-weight:normal;text-align:start}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-899326d{background-color:#fff;font-size:14px;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-1b7e516{font-size:14px;color:#000;background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ae387fe{background-color:#fff;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-6360929{background-color:#fff}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-2bbde4f{color:#333;background-color:#fff;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-2e67a3c{background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-0d7ae4d{font-size:14px;background-color:#fff;font-style:normal;text-align:start}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7e0dc1a{font-size:14px;color:#333;background-color:#fff;font-weight:normal;font-style:normal;text-align:start}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-3e5d72f{color:#004040;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-99ba05c{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-size:14px;color:rgba(204,0,0,0);background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-b01be11{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-size:14px;color:#000;background-color:#fff;font-style:normal;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-a072350{background-color:inherit;color:#004040}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-61ac278{background-color:inherit;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-cf2e470{color:#c00000;background-color:inherit;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-a639778{background-color:#fefef2;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e46607f{background-color:#fefef2}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-261fd7f{color:#c00000;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-a7534de{color:red;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-8ffa67d{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-style:normal;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-54245a9{color:#454545;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-6f2a06a{margin:5px 0px;background-color:inherit;font-weight:bold}:root:not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-6f2a06a{display:inline}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-e14748f{margin:5px 0px;background-color:inherit;font-weight:bold}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-5c7a274{color:red;background-color:inherit;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-d95e8b0{color:red;background-color:#fff;font-weight:normal;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-8cb80e2{background-color:#fff;font-weight:normal;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-5280889{margin:5px 0px;background-color:inherit;font-weight:normal}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-3b66975{color:#0b0500;background-color:#fff;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-0858e66{background-color:#fff;line-height:1.5}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-8de5079{color:rgba(204,0,0,0);background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-b8cdffc{color:#0b0500;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-7b12461{font-family:Arial;font-size:14px;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-ec56991{font-size:14px;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c1e298d{margin:5px 0px;background-color:inherit}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-1e79455{background-color:#fff;color:#000;font-size:14px;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c303bf6{font-size:14px;color:#000;background-color:#fff;font-style:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-25fcc7d{font-family:Monaco,Consolas,Courier,"Lucida Console",monospace;font-style:normal;background-color:#fff;color:#000;font-size:14px;font-weight:normal;text-align:left}:root:not(#_):not(#_):not(#_):not(#_):not(#_) .amp-wp-c49b7e2{background-color:inherit}

/*# sourceURL=amp-custom.css */</style><script type="application/ld+json" class="yoast-schema-graph yoast-schema-graph--main">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://uzzz.org/#website","url":"https://uzzz.org/","name":"\u6709\u7ec4\u7ec7\u5728!","potentialAction":{"@type":"SearchAction","target":"https://uzzz.org/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"WebPage","@id":"https://uzzz.org/article/3121/#webpage","url":"https://uzzz.org/article/3121/","inLanguage":"en-US","name":"\u9ad8\u7ea7\u7eb9\u7406\u6620\u5c04\u77e5\u8bc6\u6c47\u603b - \u6709\u7ec4\u7ec7\u5728!","isPartOf":{"@id":"https://uzzz.org/#website"},"datePublished":"2015-08-03T00:56:49+00:00","dateModified":"2015-08-03T00:56:49+00:00","author":{"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f"}},{"@type":["Person"],"@id":"https://uzzz.org/#/schema/person/29673f1347b0abda5882803c72ee5a3f","name":"fandyvon","sameAs":[]}]}</script><link rel="canonical" href="https://uzzz.org/article/3121/"></head>

<body class="">

<header id="top" class="amp-wp-header">
	<div>
		<a href="https://uzzz.org/">
										<amp-img src="https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png" width="32" height="32" class="amp-wp-site-icon i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:32px;height:32px;" i-amphtml-layout="fixed"></amp-img>
						<span class="amp-site-title">
				有组织在!			</span>
		</a>

					</div>
</header>

<article class="amp-wp-article">
	<header class="amp-wp-article-header">
		<h1 class="amp-wp-title">高级纹理映射知识汇总</h1>
			<div class="amp-wp-meta amp-wp-byline">
					<amp-img src="https://secure.gravatar.com/avatar/e786821a74ef0467825a7d60183307bc?s=24&d=mm&r=g" alt="fandyvon" width="24" height="24" layout="fixed" class="i-amphtml-layout-fixed i-amphtml-layout-size-defined" style="width:24px;height:24px;" i-amphtml-layout="fixed"></amp-img>
				<span class="amp-wp-author author vcard">fandyvon</span>
	</div>
<div class="amp-wp-meta amp-wp-posted-on">
	<time datetime="2015-08-03T08:56:49+00:00">
		6 years ago	</time>
</div>
	</header>

	
	<div class="amp-wp-article-content">
		<div id="article_content" class="article_content clearfix">
 <br>
 
 
 
<div class="htmledit_views" id="content_views">
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">参考整理自：</strong> 
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
    <a target="_blank" href="http://17de.com/library/d3d_6im/d3dim6_20.htm" rel="nofollow noopener noreferrer" data-token="4e1be1ffd6a3277f2c8f7822fb587f58" data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">http://17de.com/library/d3d_6im/d3dim6_20.htm</a>
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
    <a target="_blank" href="http://www.cppblog.com/lovedday/archive/2008/05/22/50782.html" rel="nofollow noopener noreferrer" data-token="1dbae5a2a5762d2fafea54d1fdcffb09" data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d">http://www.cppblog.com/lovedday/archive/2008/05/22/50782.html</a>
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
    <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
   </div>
</div>
<div style="">
<h2><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">多阶层纹理的基本概念</strong></h2>
</div>
<div style="">
   纹理拥有一个surface表面和格式大小等数据，后台缓存也有一个surface,是可以从后台缓存获取surface拷贝到texture的surface的但是有点影响效率。
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
    <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">这里多阶层纹理融合是指对单个物体多边形顶点像素上设置多个阶层纹理时候的融合操作，最终得到物体多边形顶点像素上的颜色。而</span><br>
    <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
     一般的融合指着色阶段的网格物体颜色和后台缓存的融合，该blend融合也可以设置融合操作和基于颜色还是alpha融合。
   </div>
</div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   多通道纹理<br>
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">(多次渲染, 每次设置一个纹理)</span>已经不用了，现在DX6后都是用单通道多阶层Stage纹理（一次渲染可以将多个纹理融合到一个多边形顶点上），老的多通道纹理是可以转换到多阶层纹理的。
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">多阶段纹理设置的才启用，不设置的不启用，如果要禁用一个阶段纹理设置它的颜色操作为COLOROP_DISABLE即可。</span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">Device->SetTextureStageState(i, D3DTSS_<span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">COLOROP</span>, D3DTOP_DISABLE);</span></span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-weight:normal; text-align:left" class="amp-wp-3977ce7"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">Device->SetTextureStageState(</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">i,</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"><span> </span>D3DTSS_ALPHAOP</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">, D3DTOP_DISABLE);</span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">每个阶段纹理都有自己的对应纹理指针对象，和纹理采用的顶点坐标，还有</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">纹理过滤的采样状态</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">。</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">Device->SetTexture(i, pTexObj);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span></span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"> Device->SetTextureStageState(i, D3DTSS_TEXCOORDINDEX, 0);<span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span></span></span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span></span></span></span></span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-dd493e9"><span data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-dd493e9"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); text-align:left" class="amp-wp-38e5e2c"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); text-align:left" class="amp-wp-38e5e2c"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"></span></span></span></span></span> 
<div data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-0a0cfb8">
    <span data-amp-original-style="background-color:inherit; font-style:normal" class="amp-wp-20ac7c3"> Device->SetSamplerState(</span><br>
    <em data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">i,<span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span></em>D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-0a0cfb8">
    <span data-amp-original-style="background-color:inherit; font-style:normal" class="amp-wp-20ac7c3"> Device->SetSamplerState(</span><br>
    <span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">i,<span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span><br>
    <span> </span>D3DSAMP_MINFILTER, D3DTEXF_LINEAR);
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-dd493e9">
    <span data-amp-original-style="background-color:inherit; font-weight:normal" class="amp-wp-e9fafc6">//<span> </span></span><br>
    <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">MipMapTexture </strong><br>
    <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-weight:normal; font-style:normal; text-align:left" class="amp-wp-b93bf72">多幅渐进纹理,在CreateTextureFromFile和<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">CreateTextureFromFileEx时候就会创建，这里选择纹理采用线性插值</span></span>
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; font-style:normal; font-family:微软雅黑; font-size:14px; text-align:left" class="amp-wp-d722d50">
      Device->SetSamplerState(<br>
    <span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">i,<span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span>D3DSAMP_MIPFILTER, D3DTEXF_LINEAR);
   </div>
</div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span></span></span>
  </div>
<div style="">
   每个阶段纹理都有自己的两个参数纹理和操作，两个参数arg1和arg2, arg1是当前stage的纹理，arg2是第0层纹理或者是上一层融合的结果纹理，操作有两种分别是alpha操作和颜色操作，两个参数arg1和arg2 会根据操作进行设置值，操作就是指在两个颜色之间进行的从操作：color =  arg1 opr arg2, opr是D3DTOP_ADD就是加，不会像物体和后台缓存融合一样先进行分量乘再相加。
  </div>
<div style="">
   <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTextureStageState(i, D3DTSS_XXXARG1, D3DTA_XXX);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(i, D3DTSS_<span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">XXX</span>ARG2, D3DTA_XXX);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(i, D3DTSS_<span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">XXX</span>OP, D3DTOP_XXX);</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">阶段状态前缀：D3DTSS_ 前缀是Texture stage state, 有<span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">D3DTSS_COLOROP和<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">D3DTSS_ALPHAOP以及他们相同的操作值，有<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>D3DTSS_COLORARG1相同以及他们相同的操作值</span>。</span></span></span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">状态的值类型为：D3DTOP_ 前缀是Operation。</span></span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">或者状态的值类型为：D3DTA_  前缀是Texture Argument。</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">参数一般是两元组合，如果需要三元组合操作那么需要：</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"> D3DTSS_COLORARG0      = 26, /* D3DTA_* third arg for triadic ops */</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"> D3DTSS_ALPHAARG0      = 27, /* D3DTA_* third arg for triadic ops */</span>
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   检测多阶层纹理融合阶层数：
  </div>
<div style="">
   D3DCAPS9 pCaps;
  </div>
<div style="">
    Device->GetDeviceCaps(&pCaps);
  </div>
<div style="">
    if(pCaps.MaxTextureBlendStages <= 1)
  </div>
<div style="">
     return false;
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h2><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">纹理阶层的用法</strong></h2>
</div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">1.<span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">可以用纹理阶层指定获取alpha值，默认是D3DTA_TEXTURE的</span></strong></h3>
</div>
<div style="">
   // 可以用当前纹理阶段选择alpha值，可以选择来自纹理或者来自漫反射光
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_ALPHAARG1, D3DTA_TEXTURE/*D3DTA_DIFFUSE*/);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_ALPHAOP, D3DTOP_SELECTARG1);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   Device->SetRenderState(D3DRS_SRCBLEND, D3DBLEND_SRCALPHA);
  </div>
<div style="">
    Device->SetRenderState(D3DRS_DESTBLEND, D3DBLEND_INVSRCALPHA);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   Device->SetRenderState(D3DRS_ALPHABLENDENABLE, true);
  </div>
<div style="">
   // 绘制物体
  </div>
<div style="">
   Device->SetRenderState(D3DRS_ALPHABLENDENABLE, false);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2.用于指定<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">纹理和光照混合(一般是第0阶层纹理)，默认是采用顶点纹理值和光照相乘的</span></span></strong></h3>
</div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   Device->SetTexture(0, BackTex);
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"> Device->SetTextureStageState(0, D3DTSS_TEXCOORDINDEX, 0);<span> </span></span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">// 纹理阶段设置</span>
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_MODULATE);<br>
   <span> </span><br>
   <span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">// 用D3DTOP_ADD可以实现强光照效果，白光</span>
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
    //<br>
   <span> </span><br>
   <span data-amp-original-style="color:#ff0000; background-color:inherit" class="amp-wp-6f084b0">颜色参数来自顶点光照漫反射颜色，如果没有开启光照那么arg1 x arg2颜色也不会有问题 ，<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#ff00; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-712a63e">会得到arg1的颜色，</span></span>
  </div>
<div style="">
    //<br>
   <span> </span><br>
   <span data-amp-original-style="color:#ff0000; background-color:inherit" class="amp-wp-6f084b0">或者很多多阶层融合纹理都是第0阶层3DTSS_COLOROP值取D3DTOP_SELECTARG1就可以了。</span>
  </div>
<div style="">
    //<br>
   <span data-amp-original-style="color:#ff0000; background-color:inherit" class="amp-wp-6f084b0"> 可用3DTSS_COLOROP值取D3DTOP_SELECTARG1来避免光照影响，也就是顶点颜色融合不采用光照。</span>
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG2, D3DTA_DIFFUSE);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_ALPHAOP, D3DTOP_DISABLE);
  </div>
<div style="">
   // 纹理采样设置
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MIPFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   // 光照开启，使得多边形顶点的颜色可以由纹理颜色和光照颜色决定
  </div>
<div style="">
   const D3DXCOLOR      WHITE( D3DCOLOR_XRGB(255, 255, 255) );
  </div>
<div style="">
    const D3DXCOLOR     YELLOW( D3DCOLOR_XRGB(255, 255,   0) );
  </div>
<div style="">
    D3DXVECTOR3 lightDir(0.0f, 0.0f, 1.0f);
  </div>
<div style="">
    D3DXCOLOR lightColor = D3DCOLOR_XRGB(255, 255, 255);
  </div>
<div style="">
    D3DLIGHT9 light = d3d::InitDirectionalLight(&lightDir, &lightColor);
  </div>
<div style="">
    D3DMATERIAL9 matrial = d3d::InitMtrl(YELLOW, YELLOW, YELLOW, BLACK, 2.0f);
  </div>
<div style="">
    // 使用这样的环境光颜色，会导致绘制异常
  </div>
<div style="">
    //Device->SetRenderState(D3DRS_AMBIENT, 0x00808080);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   /*可指定漫反射光的来源，可以来自材质D3DMCS_MATERIAL，顶点漫反射颜色 D3DMCS_COLOR1，顶点镜面反射颜色 D3DMCS_COLOR2<br>
   <span> </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"> 默认是来自于D3DMCS_COLOR1，一般默认就好了 </span>
  </div>
<div style="">
   */
  </div>
<div style="">
    Device->SetRenderState(D3DRS_DIFFUSEMATERIALSOURCE,<br>
   <span> </span><br>
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">D3DMCS_MATERIAL</span>);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    // 开启光照下面4个都要设置
  </div>
<div style="">
    Device->SetRenderState(D3DRS_LIGHTING, true);// 默认为true,不需要记得关闭
  </div>
<div style="">
    Device->SetMaterial(&matrial);
  </div>
<div style="">
    Device->SetLight(0, &light);
  </div>
<div style="">
    Device->LightEnable(0, TRUE);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   // 额外的光照设置，这里不用也是可以的
  </div>
<div style="">
    /*Device->SetRenderState(D3DRS_NORMALIZENORMALS, true);
  </div>
<div style="">
    Device->SetRenderState(D3DRS_SPECULARENABLE, false);*/
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">3.黑暗纹理用光照贴图模拟像素光照</strong></h3>
</div>
<div style="">
   因为光源很接近物体时候会导致顶点没有光照而使得三角形内没有光照，所以需要基于像素的光照因为逐像素计算光照计算量太大，所以需要用光照贴图来代替光照。
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">// 背景纹理</strong>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTexture(0, g_base_texture);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(0, D3DTSS_TEXCOORDINDEX, 0);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_SELECTARG1);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> // 光照纹理和背景纹理，进行<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#04080; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-388561c">D3DTOP_MODULATE分量乘法计算，得到黑暗纹理</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTexture(1, g_dark_texture);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_TEXCOORDINDEX, 0);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_COLORARG1, D3DTA_TEXTURE);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_COLORARG2, D3DTA_CURRENT);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE);</span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
<h3><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">4. 黑暗纹理动画，通过不同的分量相乘作为结果输出,也可以用不同的纹理算法和状态间切换实现特效</strong></span></h3>
</div>
<div style="">
   <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">// 1.切换纹理阶段融合的算法</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">static double interval = 0.0f;</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  interval += 0.0015f;</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  char szBuffer[256];</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  sprintf(szBuffer, “interval: %1.4f\n”, interval);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  OutputDebugString(szBuffer);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  if(interval < 0.5f)</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  else if(interval > 0.5f && interval < 1.0f)</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   // D3DTOP_MODULATE2X是分量相乘后得到的颜色左移1位作为最终颜色</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE2X);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  else if(interval > 1.0f && interval < 1.5f)</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   // D3DTOP_MODULATE2X是分量相乘后得到的颜色左移2位作为最终颜色</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE4X);</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">  if(interval < 0.0f || interval > 1.5f)</span>
  </div>
<div style="">
   <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">   interval = timeDelta;</span>
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">5.实现黑暗环境中灯光开灯闪烁效果</strong></h3>
</div>
<div style="">
   这个过程可以描述为”（基础贴图 x 顶点的漫反射颜色） x 黑暗贴图”。可以从没有光照中切换到有光照中出现灯光，再通过设置1阶段和0阶段纹理的融合方式从分量乘法变为加法实现全部照明，来模拟开灯效果。<br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   // 1.设置阶段纹理
  </div>
<div style="">
   Device->SetTexture(0, BackTex);
  </div>
<div style="">
    // D3DTOP_MODULATE分量乘法
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_MODULATE);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG2, D3DTA_DIFFUSE);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_ALPHAOP, D3DTOP_DISABLE);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_TEXCOORDINDEX, 0);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(0, D3DSAMP_MIPFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    // set color blend operation and texture coordinate index for texture stage 1
  </div>
<div style="">
    Device->SetTexture(1, LightTex);
  </div>
<div style="">
    // D3DTOP_MODULATE分量乘法
  </div>
<div style="">
    Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE);
  </div>
<div style="">
    Device->SetTextureStageState(1, D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
    Device->SetTextureStageState(1, D3DTSS_COLORARG2, D3DTA_CURRENT);
  </div>
<div style="">
    Device->SetTextureStageState(1, D3DTSS_ALPHAOP, D3DTOP_DISABLE);
  </div>
<div style="">
    Device->SetTextureStageState(1, D3DTSS_TEXCOORDINDEX, 0);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    Device->SetSamplerState(1, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(1, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
    Device->SetSamplerState(1, D3DSAMP_MIPFILTER, D3DTEXF_LINEAR);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   // 2. 材质设置和光照启用
  </div>
<div style="">
   D3DXVECTOR3 lightDir(0.0f, 0.0f, 1.0f);
  </div>
<div style="">
    D3DXCOLOR lightColor = D3DCOLOR_XRGB(128, 128, 128);
  </div>
<div style="">
    D3DLIGHT9 light = d3d::InitDirectionalLight(&lightDir, &lightColor);
  </div>
<div style="">
    D3DMATERIAL9 matrial = d3d::InitMtrl(WHITE, WHITE * 0.7f, BLACK, BLACK, 0.0f);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   Device->SetRenderState(D3DRS_LIGHTING, true);
  </div>
<div style="">
    Device->SetMaterial(&matrial);
  </div>
<div style="">
    Device->SetLight(0, &light);
  </div>
<div style="">
    Device->LightEnable(0, TRUE);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   // 3.Display每帧渲染函数中切换有光照和没光照
  </div>
<div style="">
   static int nFrameTime = 0;
  </div>
<div style="">
     if( nFrameTime < 1000 )
  </div>
<div style="">
     {
  </div>
<div style="">
      Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE);
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">// 光照黑暗效果</span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
      Device->SetRenderState(D3DRS_LIGHTING, TRUE);
  </div>
<div style="">
     }
  </div>
<div style="">
     else if (nFrameTime < 2000)
  </div>
<div style="">
     {
  </div>
<div style="">
       // 光照黑暗效果
  </div>
<div style="">
      Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_MODULATE);
  </div>
<div style="">
      Device->SetRenderState(D3DRS_LIGHTING, FALSE);
  </div>
<div style="">
     }
  </div>
<div style="">
     else if (nFrameTime < 3000)
  </div>
<div style="">
     {
  </div>
<div style="">
       // 光照发光效果
  </div>
<div style="">
    <br>
   <span> </span><br>
   <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"> Device->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_ADD);</span>
  </div>
<div style="">
     }
  </div>
<div style="">
     nFrameTime++;
  </div>
<div style="">
     if( nFrameTime >= 3000)
  </div>
<div style="">
     {
  </div>
<div style="">
      nFrameTime = 0;
  </div>
<div style="">
     }
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">6.细节纹理</strong></h3>
</div>
<div style="">
   细节纹理，在第后面阶层纹理，用<br>
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">D3DTOP_ADDSIGNED纹理操作算法。</span>
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"></span> 
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
      /*D3DTOP_ADDSIGNED
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
      color rgba = arg1 + arg2 – 0.5
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
       Add the components of the arguments with a – 0.5 bias,
   </div>
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
       making the effective range of values from – 0.5 through 0.5. */
   </div>
</div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">它将参数的每个成分相加后再减去偏移量0.5，在细节贴图中较亮的灰色纹理元素会使基础贴图变得更亮，而较暗的灰色纹理元素会使基础贴图变得更暗。由此可使物体呈现出粗糙的表面，从而使之看上去更为真实。<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   Device->SetTexture(0, BackTex);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_TEXCOORDINDEX, 0);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_SELECTARG1);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    Device->SetTexture(1, DetailTex);
  </div>
<div style="">
    Device->SetTextureStageState(1,D3DTSS_TEXCOORDINDEX, 0);
  </div>
<div style="">
    Device->SetTextureStageState(1,D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
    Device->SetTextureStageState(1,D3DTSS_COLORARG2, D3DTA_CURRENT);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    if( FAILED( Device->SetTextureStageState( 1, D3DTSS_COLOROP, D3DTOP_ADDSIGNED )) )
  </div>
<div style="">
    {
  </div>
<div style="">
     Device->SetTextureStageState( 1, D3DTSS_COLOROP, D3DTOP_MODULATE2X );
  </div>
<div style="">
    }
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">7.纹理阶层的Alpha混合操作</strong></h3>
</div>
<div style="">
   // alpha来源设置
  </div>
<div style="">
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#800000; background-color:inherit" class="amp-wp-43c2f3f">如果要从一张纹理中获取Alpha值，应将D3DTA_TEXTURE作为Alpha参数。<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> 如果要使用来自顶点中的Alpha值，应将D3DTA_DIFFUSE作为Alpha参数，并确保渲染状态D3DRS_DIFFUSEMATERIALSOURCE被设置为D3DMCS_COLOR1（这也是默认状态）。</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#800000; background-color:inherit" class="amp-wp-43c2f3f">如果要使用来自材质中的Alpha值，应将D3DTA_DIFFUSE作为Alpha参数，并确保渲染状态D3DRS_DIFFUSEMATERIALSOURCE被设置为D3DMCS_MATERIAL。</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">如果未用SetRenderState()设置D3DRS_DIFFUSEMATERIALSOURCE参数，则从默认来源（即顶点）获取漫反射颜色。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">//设置纹理颜色和光照顶点颜色进行融合</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTexture( 0, g_pTexture );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, 0 );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_COLORARG2, D3DTA_DIFFUSE );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_MODULATE );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">// 选择纹理alpha作为第0阶层纹理的颜色，这里也就是多边形顶点颜色的alpha值</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_ALPHAARG1, D3DTA_TEXTURE );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> Device->SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_SELECTARG1 );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> //Alpha混合设置, 设置混合系数</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> pd3dDevice->SetRenderState( D3DRS_ALPHABLENDENABLE,   true );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> pd3dDevice->SetRenderState( D3DRS_SRCBLEND,  D3DBLEND_SRCALPHA );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> pd3dDevice->SetRenderState( D3DRS_DESTBLEND, D3DBLEND_INVSRCALPHA );</p>
</div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h2><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">Texture Wrapping纹理包装</strong></h2>
</div>
<div style="">
   影响纹理光栅化时候的插值，说明究竟是默认直线插值，还是沿着UV进行曲线插值计算像素纹理坐标：
  </div>
<div style="">
   // D3DRS_WRAP0是指第0阶层纹理，D3DWRAPCOORD_0就是D3DWRAP_U，D3DWRAPCOORD_1是D3DWRAP_V方向
  </div>
<div style="">
    // 这里是指对第0层纹理采用UV方向都进行曲线空间包装类型的插值，而不是两点间直线插值。
  </div>
<div style="">
    // 要禁用纹理包装类型的插值，那么SetRenderState( D3DRS_WRAP0, 0)即可，默认也是0值的。
  </div>
<div style="">
    // 只有空间物体环境纹理中，才会用到纹理包装，否则平面内使用纹理包装会导致着色异常。
  </div>
<div style="">
    //Device->SetRenderState( D3DRS_WRAP0, D3DWRAPCOORD_0 /*| D3DWRAPCOORD_1 */);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h2><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">CubeMapTexture立方体纹理映射和球形纹理映射实现<strong data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455">环境纹理</strong></strong></h2>
</div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">自动生成纹理坐标和自动纹理坐标变换，用于<strong data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455">立方体纹理映射和球形纹理映射。</strong></strong>
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">和普通纹理的区别就是使用自动纹理坐标，和指定uv纹理坐标用顶点<span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">法线作为uv坐标</span>，还是球形的。</strong>
  </div>
<div style="">
<p data-amp-original-style="margin:5px 0px; background-color:rgb(255,255,255); font-weight:normal; color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-14c8475"> 一般应用：</p>
<p data-amp-original-style="margin:5px 0px; background-color:rgb(255,255,255); font-weight:normal; font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-2841171"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">用于天空盒贴图。</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:rgb(255,255,255); font-weight:normal; font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-2841171"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">用于物体反射周围环境颜色。</span></p>
<h3 data-amp-original-style="margin:5px 0px; background-color:rgb(255,255,255); font-weight:normal; font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-2841171"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><strong>球形环境纹理</strong><br> </span></h3>
<p> 基础设置：
  </p></div>
<div style="">
   Device->SetTexture(0, BackTex);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_TEXCOORDINDEX, 0);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_SELECTARG1);
  </div>
<div style="">
    Device->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);
  </div>
<div style="">
    Device->SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_DISABLE );
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">1)利用摄影机空间顶点位置生成纹理坐标，自动生成纹理坐标不需要顶点中包含纹理坐标信息</strong>
  </div>
<div style="">
    // 自动生成纹理坐标只适合在一些特殊效果上，所以大多数情况下顶点还是要包含纹理坐标信息的
  </div>
<div style="">
    // 自动生成，一般情况下只用在环境纹理上
  </div>
<div style="">
    Device->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_CAMERASPACEPOSITION/*D3DTSS_TCI_SPHEREMAP*/);
  </div>
<div style="">
    // 控制纹理坐标自动生成的格式标识，一般是二维的
  </div>
<div style="">
    Device->SetTextureStageState( 0, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2 );
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2)纹理坐标变换只能应用于自动生成的纹理坐标中，变换矩阵和顶点的矩阵一样</strong>
  </div>
<div style="">
    D3DXMATRIXA16 matTex, matScale, matTrans;
  </div>
<div style="">
    D3DXMatrixIdentity(&matTex);
  </div>
<div style="">
    D3DXMatrixScaling(&matScale, 0.5f, -0.5f, 1.0f);
  </div>
<div style="">
    D3DXMatrixTranslation(&matTrans, 0.5f, 0.5f, 1.0f);
  </div>
<div style="">
    matTex = matTex * matScale * matTrans;
  </div>
<div style="">
   // 坐标系和D3DTS_WORLD,D3DTS_VIEW,D3DTS_PROJECTION一样，纹理坐标有D3DTS_TEXTURE0~D3DTS_TEXTURE7
  </div>
<div style="">
    Device->SetTransform( D3DTS_TEXTURE0, &matTex );
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   //设置球形环境映射纹理
  </div>
<div style="">
    pd3dDevice->SetTexture( 0, g_pEnvTexture);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //设置纹理坐标自动生成
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_SPHEREMAP );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2 );
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //设计纹理阶段混合状态
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG2, D3DTA_DIFFUSE );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_MODULATE );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_DISABLE);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">3)自动纹理坐标生成应用最为广泛的环境纹理映</strong>
  </div>
<div style="">
   环境纹理映射，就是将周围环境在光滑三维物体上的映像，用一幅贴图描绘出来，然后映射到物体表面，其实就是简单的映射，唯一不同就是用了自动生成纹理坐标，且这里没有使用自动生成纹理坐标转换。
  </div>
<div style="">
   //设置球形环境映射纹理
  </div>
<div style="">
    pd3dDevice->SetTexture( 0, g_pEnvTexture);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //设置纹理坐标自动生成
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_SPHEREMAP );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2 );
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //设计纹理阶段混合状态
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG2, D3DTA_DIFFUSE );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLORARG1, D3DTA_TEXTURE );
  </div>
<div style="">
   // 用分量乘法，将物体表面顶点漫反射和当前的环境纹理融合
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_COLOROP,   D3DTOP_MODULATE );
  </div>
<div style="">
    pd3dDevice->SetTextureStageState( 0, D3DTSS_ALPHAOP,   D3DTOP_DISABLE);
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h3>CubeMapTexture立方体纹理</h3>
</div>
<div style="">
   立方体纹理是一种特殊的纹理技术，它用6幅二维纹理图像构成一个以原点为中心的纹理立方体。对于每个片段，纹理坐标(s, t, r)被当作方向向量看待，每个纹理单元都表示从原点所看到的纹理立方体上的图像。<br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">它有6个面，每个面都是一个二维图像，每个二维图像用一个x,-x, y, -y, z, -z来表示。</span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   OGL中指定六个面的方式：
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image1);  </span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_X, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image4);  </span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Y, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"> imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image2);  </span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Y, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"> imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image5);  </span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_Z, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image3);  </span><br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexImage2D(GL_TEXTURE_CUBE_MAP_NEGATIVE_Z, 0, GL_RGBA,  </span><br>
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">imageSize, imageSize, 0, GL_RGBA, GL_UNSIGNED_BYTE, image6);  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">指定立方体纹理对象的参数：<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S,  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">                GL_REPEAT);  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T,  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">                GL_REPEAT);  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R,  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">                GL_REPEAT);  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER,  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">                GL_NEAREST);  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER,  </span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">                GL_NEAREST);</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">纹理纹素的获取算法</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">          正如前面所述，对于每个片段，纹理坐标(s, t, r)被当作方向向量看待，每个纹理单元都表示从原点所看到的纹理立方体上的图像。参见实现代码来自mesa3d里面，源文件路径为Mesa-8.0.4\src\mesa\swrast\s_texfilter.c</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">应用立体纹理时候，还需要指定：</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">使用vertex的法线作为uv坐标；   (GL_NORMAL_MAP)</span>
  </div>
<div style="">
   <span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"></span> 
<div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">用于天空盒贴图。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">使用法线和相机到vertex的向量，推导出入射光向量作为uv坐标 (GL_REFLECTION_MAP)</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">用于物体反射周围环境颜色。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">然后自动或者手动shader计算立体纹理uv坐标，然后渲染物体就可以了。</p>
</div>
</div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
<h2><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">bumpTexture凹凸纹理映射</strong></h2>
</div>
<div style="">
   普通的纹理映射只能模拟比较平滑的三维物体表面，难以显示表面高低起伏、凹凸不平的效果。凹凸纹理映射能够通过一张表示物体表面凹凸程度的高度图（称为凹 凸纹理），对另一张表示物体表面环境映射的纹理图的纹理坐标进行相应的干扰，经过干扰的纹理坐标将应用于环境映射，从而产生凹凸不平的显示效果。凹凸纹理 映射通常由三张纹理映射图组成，第一张纹理图表示物体表面原始纹理颜色，第二张凹凸纹理图表示物体表面凹凸的高度起伏值，用来对下一张环境纹理图坐标进行 干扰，第三张纹理图表示周围镜面反射或漫反射光照的环境光照映射图。<br>
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">1) 检测设备是否支持凹凸纹理</strong>
  </div>
<div style="">
   bool CALLBACK IsDeviceAcceptable( D3DCAPS9* pCaps, D3DFORMAT AdapterFormat,
  </div>
<div style="">
    D3DFORMAT BackBufferFormat, bool bWindowed,
  </div>
<div style="">
    void* pUserContext )
  </div>
<div style="">
   {
  </div>
<div style="">
    //检查后台缓冲区格式是否支持Alpha混合等操作(post pixel blending operations)
  </div>
<div style="">
    IDirect3D9* pD3D = d3d::d3d9;
  </div>
<div style="">
    if( FAILED( pD3D->CheckDeviceFormat( pCaps->AdapterOrdinal, pCaps->DeviceType,
  </div>
<div style="">
     AdapterFormat, D3DUSAGE_QUERY_POSTPIXELSHADER_BLENDING,
  </div>
<div style="">
     D3DRTYPE_TEXTURE, BackBufferFormat ) ) )
  </div>
<div style="">
     return false;
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //检查当前设备是否支持凹凸纹理
  </div>
<div style="">
    if(0 == (pCaps->TextureOpCaps&(D3DTEXOPCAPS_BUMPENVMAP|D3DTEXOPCAPS_BUMPENVMAPLUMINANCE)))
  </div>
<div style="">
     return false;
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //检查当前设备是否支持3层纹理混合
  </div>
<div style="">
    if(pCaps->MaxTextureBlendStages < 3)
  </div>
<div style="">
     return false;
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    //检查当前设备是否支持设置的凹凸纹理像素格式
  </div>
<div style="">
    if( FAILED( pD3D->CheckDeviceFormat( pCaps->AdapterOrdinal, pCaps->DeviceType,
  </div>
<div style="">
     AdapterFormat, D3DUSAGE_QUERY_LEGACYBUMPMAP,  
  </div>
<div style="">
     D3DRTYPE_TEXTURE, D3DFMT_X8L8V8U8 ) ) )
  </div>
<div style="">
     return false;
  </div>
<div style="">
   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
  </div>
<div style="">
    return true;
  </div>
<div style="">
   }
  </div>
<div style="">
   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2) <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6">凹凸纹理的生成</span></strong>
  </div>
<div style="">
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">Direct3D的凹凸纹理被用来表示物体表面相邻像素的高度差，它的每个纹理元素由表示水平相邻像素高度差的D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>、表示垂直相邻像素高度差的D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>以及表示该点亮度的L组成（某些凹凸纹理像素格式可以不包含L）。下表列出了Direct3D支持的凹凸纹理像素格式：</p>
<table border="1" cellpadding="2" cellspacing="0" width="100%" data-amp-original-style="font-size:undefined; border-collapse:collapse; margin-top:10px; margin-bottom:10px; display:table; background-color:inherit" class="amp-wp-350acd6">
<tbody data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">凹凸纹理像素格式</strong></span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">说明</strong></span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_V8U8</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">每个像素由16位整数表示，分别由8位整数表示D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>和D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub></span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_L6V5U5</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">每个像素由16位整数表示，6位整数表示L，分别由5位整数表示D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>和D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub></span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_X8L8V8U8</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">每个像素由32位整数表示，包括8位保留位、8位L、8位D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>、8位D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub></span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_V16U16</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">每个像素由32位整数表示，分别由16位整数表示D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>和D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub></span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_Q8W8V8U8</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">每个像素由32位整数表示，分别由8位整数表示Q、W、V、U</span></td>
</tr>
<tr data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">D3DFMT_CxV8U8</span></td>
<td data-amp-original-style="word-break:break-all; border:1px solid rgb(153,153,153); padding:5px 16px 5px 12px; min-height:25px; min-width:25px; height:25px; background-color:inherit" class="amp-wp-7d56003"> <span data-amp-original-style="font-family:微软雅黑; color:#3c3c3c; background-color:inherit; font-size:11pt" class="amp-wp-49d96a9">压缩像素格式，每个像素由16位整数表示，即8位D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>和8位D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>，另外C = sqrt(1 – D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub><sup data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2</sup><span> </span>– D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub><sup data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2</sup>  )</span></td>
</tr>
</tbody>
</table>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">通常情况下，可以载入一张表示物体表面图像高度的纹理图，通过计算高度图水平相邻和垂直相邻元素的高度差来生成凹凸纹理，也可以通过程序生成凹凸纹理，这里根据高度纹理图，用程序来生成凹凸纹理，代码如下：</p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">HRESULT CreateBumpTexture(IDirect3DDevice9* device, IDirect3DTexture9* pHeightMapTexture, IDirect3DTexture9* pBump_map_texture)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	HRESULT hr;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	D3DSURFACE_DESC surface_desc;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// pHeightMapTexture是高度纹理图，每个像素存放的是高度，虽然大小是4个字节，但是只用一个字节也就是大小为[0,255]
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// 从纹理的表面数据中获取纹理的具体数值
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	pHeightMapTexture->GetLevelDesc(0, &surface_desc);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// 创建一个凹凸纹理图，凹凸纹理的每个像素存放的是D3DFMT_X8L8V8U8,
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// 值为：预留值X8、亮度值L8、相邻上高度减去下高度的值V8、左高度减去右高度的值U8
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	device->CreateTexture(surface_desc.Width, surface_desc.Height, 1, 0, D3DFMT_X8L8V8U8, D3DPOOL_MANAGED,
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		&pBump_map_texture, NULL);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	D3DLOCKED_RECT locked_rect;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	pHeightMapTexture->LockRect(0, &locked_rect, NULL, 0);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// 一行的宽度
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	DWORD src_pitch   = (DWORD) locked_rect.Pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	BYTE* src_row_top = (BYTE*) locked_rect.pBits;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	BYTE* src_row_cur = src_row_top;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	BYTE* src_row_bot = src_row_top + src_pitch * (surface_desc.Height - 1);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	pBump_map_texture->LockRect(0, &locked_rect, NULL, 0);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	DWORD dest_pitch   = (DWORD) locked_rect.Pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	BYTE* dest_row_top = (BYTE*) locked_rect.pBits;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	BYTE* dest_row_cur = dest_row_top;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	// iterate through all lines
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	for(DWORD y = 0; y < surface_desc.Height; y++)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 源像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		BYTE* src_pixel_cur;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 源上一行的像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		BYTE* src_pixel_up;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 源下一行的像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		BYTE* src_pixel_below;		
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 目标像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		BYTE* dest_pixel;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 取当前行做为源像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		src_pixel_cur = src_row_cur;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 当y为0第一行时候，源像素的上一行为最后一行像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		if(y == 0)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_up = src_row_bot;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 否则上一行的像素等于当前行的像素减去一行的宽度
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		else
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		    src_pixel_up = src_row_cur - src_pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 最末一行的下一行像素，是第一行像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		if(y == surface_desc.Height - 1)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_below = src_row_top;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 否则下一行像素，等于当前行加上行宽
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		else
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_below = src_row_cur + src_pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 目标行等于当前目标行
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		dest_pixel = dest_row_cur;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// iterate through all columns in current line
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		for(DWORD x = 0; x < surface_desc.Width; x++)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		{
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			BYTE src_pixel_left, src_pixel_right;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			if(x == 0)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				// 第0列，左边一个像素等于最后一个像素，4个字节等于D3DFMT_X8L8V8U8大小
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				src_pixel_left = *(src_row_cur + (surface_desc.Width - 4));
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			else
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				// 其它列，左边一个像素就是当前像素减去4个字节等于D3DFMT_X8L8V8U8大小
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				src_pixel_left = *(src_pixel_cur - 4);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			if(x == surface_desc.Width - 1)
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				// 最后一列，右边一个像素等于第一列的像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				src_pixel_right = *src_row_cur;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			else
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				// 其它像素等于，右边一个像素
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">				src_pixel_right = *(src_pixel_cur + 4);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// du是当前像素的左边第一个像素高度值(小端存储)，减去右边一个像素的高度值
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			BYTE du = BYTE(src_pixel_left - src_pixel_right);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// dv是当前像素列的上一列减去下一列的高度值
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			BYTE dv = BYTE(src_pixel_up   - src_pixel_below);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// the luminance bump value
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 目标当前行中的迭代像素值(高度)，如果大于1那么亮度取63，否则取127
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			BYTE u_lumi = (*src_pixel_cur > 1) ? 63 : 127;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 一个4字节的数值里面，格式为D3DFMT_X8L8V8U8,低数值存放在低地址，所以是先赋值du
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			*dest_pixel++ = du;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			*dest_pixel++ = dv;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			*dest_pixel++ = u_lumi;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			*dest_pixel++ = 0;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// move one pixel to the right
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 当前源像素跳过4字节
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_cur   += 4;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 源的下一行加上了4字节
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_below += 4;	
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 源的上一行也应该加4字节[by jiayuan 2015.8.2]
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_up +=4;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			// 当前目标像素跳过4字节
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">			src_pixel_up     += 4;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// move to the next line
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 一行结束，源像素行加宽度
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		src_row_cur  += src_pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		// 一行结束，目标像素加宽度
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">		dest_row_cur += dest_pitch;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	}
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	pBump_map_texture->UnlockRect(0);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	pHeightMapTexture->UnlockRect(0);
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	return S_OK;
</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">}</span></pre>
<p> 3) <br>
   <strong data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">凹凸纹理设置</strong> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">凹凸纹理映射通常使用3层纹理：物体原始纹理、由原始纹理高度图生成的凹凸纹理、环境纹理，对应于多层纹理混合的0、1、2层。指定当前纹理层状态 为D3DTOP_BUMPENVMAP或D3DTOP_BUMPENVMAPLUMINANCE可设置当前纹理层为凹凸纹理，例如：</p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTexture(1, g_bump_map_texture);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// </span><span data-amp-original-style="color:#04080; background-color:inherit; line-height:1.5" class="amp-wp-0e1bca6">D3DTOP_BUMPENVMAP 没有亮度值，默认设置为1，和下一阶层纹理分量乘法输出是下一阶层的颜色</span><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetTextureStageState(1, D3DTSS_COLOROP,		   D3DTOP_BUMPENVMAP);</span></pre>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">或</p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTexture(1, g_bump_map_texture);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// </span><span data-amp-original-style="color:#04080; background-color:inherit; line-height:1.5" class="amp-wp-0e1bca6">D3DTOP_BUMPENVMAPLUMINANCE 有亮度值需要和下阶层分量乘法输出颜色</span><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetTextureStageState(1, D3DTSS_COLOROP,		   D3DTOP_BUMPENVMAPLUMINANCE);</span></pre>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">纹理状态D3DTOP_BUMPENVMAP和D3DTOP_BUMPENVMAPLUMINANCE表示两种不同的凹凸纹理映射方法。纹理状态D3DTOP_BUMPENVMAPLUMINANCE表示在凹凸纹理中包含凹凸纹理亮度值L，L将与下一纹理层的纹理颜色相乘作为最后输出的纹理颜色。纹理状态D3DTOP_BUMPENVMAP默认亮度值L为1，即不改变下一纹理层的纹理颜色。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">4) 凹凸纹理的扰动矩阵和亮度系数亮度偏移的设置</strong></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">Direct3D可设置凹凸纹理矩阵，对凹凸纹理中的每个纹理元素值（D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>、D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>，即对于下一纹理层中的每个纹理坐标的扰动值）进行坐标变换：</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>‘ = D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub><span> </span>* M<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">00</sub><span> </span>+ D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub><span> </span>* M<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">10</sub></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>‘ = D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub><span> </span>* M<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">01</sub><span> </span>+ D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub><span> </span>* M<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">11</sub></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">凹凸纹理的每个纹理元素D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>、D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>与一个2 x 2的凹凸矩阵相乘，其结果D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>、D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>对下一纹理层中的每个纹理元素的纹理坐标产生该数值代表的坐标扰 动。2 x 2的凹凸矩阵值可由函数IDirect3DDevice9::SetTextureStageState()设置，将它的第一个参数设置为纹理层序号，第 二个参数设置为D3DTSS_BUMPENVMAT00或D3DTSS_BUMPENVMAT01或D3DTSS_BUMPENVMAT10或 D3DTSS_BUMPENVMAT11，分别表示凹凸矩阵的4个矩阵元素，第三个参数设置为该矩阵元素的值。纹理坐标扰动D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>、D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>或D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">v</sub>‘、D<sub data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">u</sub>‘的范围介于-1 ~ +1之间。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">如果使用D3DTOP_BUMPENVMAPLUMINANCE计算凹凸纹理，Direct3D将使用下列方程计算凹凸纹理的亮度值L’（L’为0~255的整数，它将被用来与下一纹理层的颜色相乘，作为最后输出的纹理颜色值）。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">L’ = L * S + O</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">其中，L为凹凸纹理元素中的亮度L值，比例系数S和偏移系数O可改变最终的亮度值。S和O可由函数 IDirect3DDevice9::SetTexureStageState()设置，将它的第一个参数设置为纹理层序号，第二个参数设置为 D3DTSS_BUMPENVLSCALE或D3DTSS_BUMPENVLOFFSET，分别表示凹凸纹理映射的比例系数S和偏移系数O，将第三个参数 设置为相应的系数值。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">设置凹凸纹理状态的代码如下所示：</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// set texture color blend method for stage 0 (base texture)</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE);<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_SELECTARG1);<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(0, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(0, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// set texture color blend method for stage 1 (bump map texture)</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTexture(1, g_bump_map_texture);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(</span><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">1, D3DTSS_TEXCOORDINDEX, 0</span><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(1, D3DTSS_COLOROP, D3DTOP_BUMPENVMAPLUMINANCE);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(1, D3DTSS_COLORARG1, D3DTA_TEXTURE);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(1, D3DTSS_COLORARG2, D3DTA_CURRENT);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVMAT00, F2DW(0.8f));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVMAT01, F2DW(0.0f));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVMAT10, F2DW(0.0f));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVMAT11, F2DW(0.8f));</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVLSCALE, F2DW(4.0f));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(1, D3DTSS_BUMPENVLOFFSET, F2DW(0.0f));</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(1, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(1, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// set texture color blend method for stage 2 (environment map texture)</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">5）凹凸纹理使用环境纹理的话，那么需要设置环境纹理的自动纹理坐标，和自动纹理坐标转换矩阵</strong><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">D3DXMATRIX mat;</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">mat._11 = 0.5f; mat._12 = 0.0f; mat._13 = 0.0f; mat._14 = 0.0f;<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">mat._21 = 0.0f; mat._22 = -0.5f; mat._23 = 0.0f; mat._24 = 0.0f;<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">mat._31 = 0.0f; mat._32 = 0.0f; mat._33 = 1.0f; mat._34 = 0.0f;<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">mat._41 = 0.5f; mat._42 = 0.5f; mat._43 = 0.0f; mat._44 = 1.0f;<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTransform(D3DTS_TEXTURE2, &mat);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTexture(2, g_env_map_texture);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTextureStageState(2, D3DTSS_TEXTURETRANSFORMFLAGS, D3DTTFF_COUNT2);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">// 第0层第1层都是采用顶点uv或者用网格DrawSubset绘制，而第2阶层纹理采用了环境映射纹理用了自动生成坐标系<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> pd3dDevice->SetTextureStageState(2, D3DTSS_TEXCOORDINDEX, D3DTSS_TCI_SPHEREMAP);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(2, D3DTSS_COLORARG1, D3DTA_TEXTURE);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(2, D3DTSS_COLORARG2, D3DTA_CURRENT);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetTextureStageState(2, D3DTSS_COLOROP, D3DTOP_ADD);<span> </span></span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(2, D3DSAMP_MAGFILTER, D3DTEXF_LINEAR);</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> <span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->SetSamplerState(2, D3DSAMP_MINFILTER, D3DTEXF_LINEAR);</span></p>
<p>   <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> </p>
<h2 data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">volume texture立体纹理：每个维度都是有像素值的</strong></h2>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// check whether device support volume texture<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">if((pCaps->TextureCaps & D3DPTEXTURECAPS_VOLUMEMAP) == 0)<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	return false;</span></pre>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">立体纹理（volume texture）是一组应用到二维图元（如一个三角形或一条直线）的三维纹理元素的集合，<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">可以使用立体纹理实现一些特殊效果，如迷雾、爆炸等</span>。当对一个图 元使用立体纹理时，它的每个顶点都需要一组三元纹理坐标。当绘制该图元时，它中间的每个像素都将用立体纹理中的一些纹理元素的颜色值进行填充，这与二维纹 理映射的情况相似。</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">立体纹理以薄片为单元组织起来，可以把它想象成将（宽 x 高）的二维表面转换成（宽 x 高 x 深）的三维立体，每个薄片是单独的一行，立体纹理可以有一系列级别，每一级都较上一级缩小一倍，<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">类似二维的多幅渐进纹理，只不过这里是三维的</span>。</p>
<p>   <strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">1) 声明顶点格式，使用立体纹理坐标</strong> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">接着，我们需要在灵活顶点格式中指定每个顶点都需要三个纹理坐标，如下所示：</p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">struct sCustomVertex<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">{<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	float x, y, z;</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">        // 一个立体纹理，是有x,y,z三个维度的，每个维度都是一个像素一层<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	float u, v, w;<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">};</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">#define D3DFVF_CUSTOM_VERTEX	(D3DFVF_XYZ | D3DFVF_TEX1 | D3DFVF_TEXCOORDSIZE3(0))</span></pre>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2) 填充顶点缓存，为了显示立体纹理在<strong data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455">不同深度上的表现</strong>，顶点纹理坐标的w值还是需要变化的</strong></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">接着，为每个顶点指定数据，创建顶点缓冲区并填充它：</p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(192,0,0)" class="amp-wp-81d8503"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// create vertex buffer and fill data</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(192,0,0)" class="amp-wp-81d8503"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">sCustomVertex vertices[] = 	<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">{<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    { -3.0f, -3.0f,  0.0f, 0.0f, 1.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    { -3.0f,  3.0f,  0.0f, 0.0f, 0.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    {  3.0f, -3.0f,  0.0f, 1.0f, 1.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    {  3.0f,  3.0f,  0.0f, 1.0f, 0.0f, 0.0f}<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">};</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(192,0,0)" class="amp-wp-81d8503"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">pd3dDevice->CreateVertexBuffer(sizeof(vertices), 0, D3DFVF_CUSTOM_VERTEX, D3DPOOL_MANAGED, &g_vertex_buffer, NULL);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(192,0,0)" class="amp-wp-81d8503"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">void* ptr;<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">g_vertex_buffer->Lock(0, sizeof(vertices), (void**)&ptr, 0);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">memcpy(ptr, vertices, sizeof(vertices));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">g_vertex_buffer->Unlock();</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(192,0,0)" class="amp-wp-81d8503"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"></span><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">为了生成立体纹理，还必须改变纹理的w坐标：</p><pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">//--------------------------------------------------------------------------------------<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">// Handle updates to the scene<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">//--------------------------------------------------------------------------------------<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">void CALLBACK OnFrameMove( IDirect3DDevice9* pd3dDevice, double fTime, float fElapsedTime, void* pUserContext )<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">{<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	// change w coordinate of volume texture<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	float angle = (float) fTime / 2.0f;</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	sCustomVertex* ptr;</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	g_vertex_buffer->Lock(0, 0, (void**)&ptr, 0);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">        // 改变w值，也就是w在[0,1]的纹理坐标内切换，显示立体纹理中不同维度的平面纹理</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	for(int i = 0; i < 4; i++)<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">		ptr[i].w = sin(angle) * sin(angle);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	g_vertex_buffer->Unlock();<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">}</span></pre>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">3) 创建和填充立体纹理</strong></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">在示例程序中，立体纹理是由程序生成的，比较复杂。Direct3D提供了辅助函数D3DXCreateVolumeTextureFromFile()来从图片文件中生成立体纹理，该函数的声明如下：</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f">Creates a volume texture from a file.</span></p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f">HRESULT </span><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DXCreateVolumeTextureFromFile</span><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f">(</span></strong><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">LPDIRECT3DDEVICE9</strong><em data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">pDevice</em><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">,</strong><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">LPCTSTR</strong><em data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">pSrcFile</em><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">,</strong><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">LPDIRECT3DVOLUMETEXTURE9 *</strong><em data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">ppVolumeTexture</em><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">);</strong></pre>
<p>   <span data-amp-original-style="color:#800000; background-color:inherit" class="amp-wp-43c2f3f">通过文件创建立体纹理时文件格式必须是立体纹理格式，对于普通格式的图片文件，可以通过DirectX提供的纹理工具”DirectX Texture Tool”转换成立体纹理格式的文件。</span> </p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">程序创建立体纹理</strong></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">//创建立体纹理</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> hr = pd3dDevice->CreateVolumeTexture( 16, 16, 16, 1, 0,</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">  D3DFMT_A8R8G8B8, D3DPOOL_MANAGED,</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">  &g_pVolumeTexture, NULL );</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> if( FAILED(hr) )</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">  return hr;</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> //填充立体纹理</p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"> <span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">D3DLOCKED_BOX LockedBox;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> hr = g_pVolumeTexture->LockBox( 0, &LockedBox, 0, 0 );</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> if( FAILED(hr) )</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  return hr;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> for( UINT w=0; w<16; w++ )</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> {</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  BYTE* pSliceStart = (BYTE*)LockedBox.pBits;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  for( UINT v=0; v<16; v++ )</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  {</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">   for( UINT u=0; u<16; u++ )</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">   {</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    // du,dv,dw从[-1,1]的浮点数</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    FLOAT du = (u-7.5f)/7.5f;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    FLOAT dv = (v-7.5f)/7.5f;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    FLOAT dw = (w-7.5f)/7.5f;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    FLOAT fScale = sqrtf( du*du + dv*dv + dw*dw ) / sqrtf(1.0f);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    if( fScale > 1.0f )</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    {</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">       fScale = 0.0f;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    }</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    // 取反是因为越近，颜色越明亮，越远越暗淡</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    else</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    {</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">       fScale = 1.0f – fScale;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    }</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    // rgb颜色</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    DWORD r = (DWORD)((w<<4)*fScale);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    DWORD g = (DWORD)((v<<4)*fScale);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    DWORD b = (DWORD)((u<<4)*fScale);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    // 填充好二维的</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">    ((DWORD*)LockedBox.pBits)[u] = 0xff000000 + (r<<16) + (g<<8) + (b);</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">   }</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">   // 下一行</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">   LockedBox.pBits = (BYTE*)LockedBox.pBits + LockedBox.RowPitch;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  }<span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  // 深度上面也是要逐像素计算颜色的，也是和2维一样分作了16像素</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  // 那么最终得到的立体纹理是一个 16X16X16的纹理内存，故可以模拟迷糊、爆炸效果.</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">  LockedBox.pBits = pSliceStart + LockedBox.SlicePitch;</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> }</span><span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"> g_pVolumeTexture->UnlockBox( 0 );</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">接着，为每个顶点指定数据，创建顶点缓冲区并填充它：</span></p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// create vertex buffer and fill data</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">sCustomVertex vertices[] = 	<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">{<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    { -3.0f, -3.0f,  0.0f, 0.0f, 1.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    { -3.0f,  3.0f,  0.0f, 0.0f, 0.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    {  3.0f, -3.0f,  0.0f, 1.0f, 1.0f, 0.0f},<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    {  3.0f,  3.0f,  0.0f, 1.0f, 0.0f, 0.0f}<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">};</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">4）渲染立体纹理</strong></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><p data-amp-original-style="margin:5px 0px; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-d93046f">最后设置要渲染的纹理层和立体纹理，纹理阶段混合方法，顶点数据，并渲染它：</p><pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">// set textue and stream source and vertex format<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTexture(0, g_volume_texture);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetStreamSource(0, g_vertex_buffer, 0, sizeof(sCustomVertex));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetFVF(D3DFVF_CUSTOM_VERTEX);</span></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b">// set texture color blend method<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">pd3dDevice->SetTextureStageState(0, D3DTSS_COLORARG1, D3DTA_TEXTURE); <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetTextureStageState(0, D3DTSS_COLOROP, D3DTOP_SELECTARG1);</span></span><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetSamplerState(0,		D3DSAMP_MINFILTER,		D3DTEXF_LINEAR);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">pd3dDevice->SetSamplerState(0,		D3DSAMP_MAGFILTER,		D3DTEXF_LINEAR);</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// Clear the render target and the zbuffer <br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">V( pd3dDevice->Clear(0, NULL, D3DCLEAR_TARGET | D3DCLEAR_ZBUFFER, D3DCOLOR_ARGB(0, 0, 0, 0), 1.0f, 0) );</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// Render the scene<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">if( SUCCEEDED( pd3dDevice->BeginScene() ) )<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">{<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	pd3dDevice->DrawPrimitive(D3DPT_TRIANGLESTRIP, 0, 2);<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	RenderText();</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; color:rgb(0,176,80)" class="amp-wp-3b94075"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">	V(g_button_dlg.OnRender(fElapsedTime));<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">    V( pd3dDevice->EndScene() );<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">}</span></pre>
<p><span data-amp-original-style="color:#00b050; background-color:inherit" class="amp-wp-145c37b"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">立体纹理和普通二维纹理的主要区别是：</span><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#c00000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-ad2a445">顶点纹理坐标是三维的，纹理对象指针的类型不同，立体纹理的创建也不同，而立体纹理在使用上和普通二维纹理基本相同。</span><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span> </p>
<h2 data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"> <span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-100b07c"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">纹理压缩技术应用</strong></span></span></h2>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"></span></span><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">要渲染看起来真实的场景，最好是使用高分辨率而且颜色丰富的纹理，但这样的纹理可能会耗费大量的内存，例如，一张每像素16位颜色的256x 256纹理将使用128KB的内存。如果在该纹理中使用多级渐进纹理，还需要额外的43KB内存。一个使用50张这种纹理的场景将需要8MB的内存，如果需要更强的真实性，可以使用每像素32位颜色的512x 512纹理，但那就需要8倍的内存。<span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">为了减少纹理消耗的系统带宽和内存空间，Direct3D支持纹理压缩和实时解压，即DXT纹理压缩。压缩后的纹理被存储在Direct3D纹理指</span><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">针中，当Direct3D渲染物体时，Direct3D引擎自动对纹理进行解压。应用DXT压缩纹理不仅可以节省内存空间，而且能有效地降低纹理传输带</span><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">宽，提高图形系统的整体性能。</span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">随着DirectX对纹理压缩格式的推广，目前大部分显卡都支持DXT压缩纹理，而且DXT压缩纹理在图形质量和运行速度之间取得了很好的平衡。</p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">DXT纹理压缩格式</strong></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">DXT是一种DirectDraw表面，它以压缩形式存储图形数据，该表面可以节省大量的系统带宽和内存。即使不直接使用DXT表面渲染，也可以通
过DXT格式创建纹理的方法节省磁盘空间。Direct3D提供了D3DFMT_DXT1~D3DFMT_DXT5共5种压缩纹理格式。其中，D3DFMT_DXT1支持15位RGB和1位alpha图形格式，D3DFMT_DXT2、D3DFMT_DXT3支持12位RGB和4位alpha，D3DFMT_DXT4、D3DFMT_DXT5则采取了线性插值方式生成alpha。</p>
    <div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(51,51,51); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-4923382">
     有3种DXTC的格式可供使用，分别是DXT1，DXT3和DXT5。
    </div>
    <div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(51,51,51); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-4923382">
     DXT1 压缩比例：1:8 压缩比最高，它只有1Bit Alpha，Alpha通道信息几乎完全丧失。一般将不带Alpha通道的图片压缩成这种格式。如Worldwind 用的卫星图片。
    </div>
    <div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(51,51,51); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-4923382">
     DXT3 压缩比例：1:4 使用了4Bit Alpha，可以有16个Alpha值，可很好地用于alpha通道锐利、对比强烈的半透和镂空材质。
    </div>
    <div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(51,51,51); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-4923382">
     DXT5 压缩比例：1:4 使用了线形插值的4Bit Alpha，特别适合Alpha通道柔和的材质，比如高光掩码材质。
    </div><span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:start" class="amp-wp-cbfe37b">大部分</span><a target="_blank" href="http://baike.baidu.com/view/721420.htm" rel="nofollow noopener noreferrer" data-token="01acc0f9bb6219144992562928ddb642" data-amp-original-style="background-color:rgb(255,255,255); color:rgb(19,110,194); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-7a2d47e">3D游戏引擎</a><span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:start" class="amp-wp-cbfe37b">都可以使用DDS格式的图片用作</span><a target="_blank" href="http://baike.baidu.com/view/366383.htm" rel="nofollow noopener noreferrer" data-token="b90329f581b493a08dedeccdd4e56a9e" data-amp-original-style="background-color:rgb(255,255,255); color:rgb(19,110,194); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-7a2d47e">贴图</a><span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:start" class="amp-wp-cbfe37b">，也可以制作</span><a target="_blank" href="http://baike.baidu.com/view/1359428.htm" rel="nofollow noopener noreferrer" data-token="4d90ed1fc2af2b618a7dae74f9d30249" data-amp-original-style="background-color:rgb(255,255,255); color:rgb(19,110,194); font-family:arial,宋体,sans-serif; font-size:14px; font-style:normal; font-weight:normal; text-align:start" class="amp-wp-7a2d47e">法线贴图</a><span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:start" class="amp-wp-cbfe37b">。</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93">DXT纹理压缩的应用：</span></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-100b07c"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">1）检查是否支持纹理压缩</strong></span></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-100b07c"></span></span><pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; font-weight:normal; color:rgb(0,176,80)" class="amp-wp-2089cc4"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">// check whether device support DXT compressed texture<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">if(FAILED(pD3D->CheckDeviceFormat(pCaps->AdapterOrdinal, pCaps->DeviceType, AdapterFormat, 0, D3DRTYPE_TEXTURE, D3DFMT_DXT1)))<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">	return false;</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit; font-weight:normal; color:rgb(0,176,80)" class="amp-wp-2089cc4"><span data-amp-original-style="color:#004080; background-color:inherit" class="amp-wp-35e04fe">如果当前设备支持DXT压缩纹理，就可以直接创建DXT压缩纹理，并可以通过IDirect3DDevice9::SetTexture()函数设置
DXT压缩纹理，将其映射到物体表面。如果当前设备不支持DXT压缩纹理，仍然可以DXT压缩格式存储纹理，但在使用该纹理渲染图形前，必须将DXT压缩
格式的纹理转换为当前设备支持的格式。<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span></pre>
<p><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">2) 创建dds格式文件，非dds格式文件也是可以使用压缩纹理的，但是dds格式可以压缩贴图大小且加载更快</strong> </p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="font-family:arial,宋体,sans-serif; color:#333333; background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-2de1fe0">ps查看和导出dds插件：</span><a target="_blank" href="https://developer.nvidia.com/nvidia-texture-tools-adobe-photoshop" rel="nofollow noopener noreferrer" data-token="ec7ffb634114ec2e5634f6eb25c21d64" data-amp-original-style="background-color:inherit; font-family:微软雅黑; line-height:1.5" class="amp-wp-e4fdad8">https://developer.nvidia.com/nvidia-texture-tools-adobe-photoshop</a></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-fbbed93"></span></span>
    <div data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">
     <div data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-7a3597a">
      <span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:start" class="amp-wp-cbfe37b">3dsmax现在的版本都应该支持dds贴图作为才材质的了，</span>
      <span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">不过通过<a target="_blank" href="http://www.nvidia.cn/object/3dsmax_dds_plugins.html" rel="nofollow noopener noreferrer" data-token="81e551e186e3d4e2f97100701c7b36a2" data-amp-original-style="background-color:rgb(255,255,255); font-family:微软雅黑; font-size:14px; font-style:normal; font-weight:normal; text-align:left" class="amp-wp-899326d">http://www.nvidia.cn/object/3dsmax_dds_plugins.html</a>下载的原码可以窥探一下nvidia写的导入</span>
      <span data-amp-original-style="background-color:rgb(255,255,255)" class="amp-wp-6360929">dds的</span>
      <span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">插件代码。</span>
     </div>
     <span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-1b7e516">dds文件格式编辑</span>
     <strong data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">DirectX</strong>
     <span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"> Texture Tool 可以编辑dds文件使用的压缩格式<span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal" class="amp-wp-ae387fe">DXT1，</span><span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal" class="amp-wp-ae387fe">DXT3，<span data-amp-original-style="background-color:rgb(255,255,255)" class="amp-wp-6360929">DXT5等，可以编辑文件</span></span>的<span data-amp-original-style="font-family:arial,宋体,sans-serif; color:#333333; background-color:rgb(255,255,255); font-weight:normal" class="amp-wp-2bbde4f">mipMap/CubeMap/VolumeMap纹理特性。可以查看alpha通道信息等，具体使用见</span></strong></span>
     <a target="_blank" href="https://msdn.microsoft.com/en-us/library/bb219744.aspx" rel="nofollow noopener noreferrer" data-token="b30e6afa9133377fd13a830bdc31f117" data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">https://msdn.microsoft.com/en-us/library/bb219744.aspx</a>
     <strong data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278"><span data-amp-original-style="font-family:arial,宋体,sans-serif; color:#333333; background-color:rgb(255,255,255); font-weight:normal" class="amp-wp-2bbde4f">。</span></strong>
    </div><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="font-family:微软雅黑; background-color:inherit" class="amp-wp-2e67a3c"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">3）创建压缩纹理</strong></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="font-family:微软雅黑; background-color:inherit" class="amp-wp-2e67a3c"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">一般使用<span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; background-color:rgb(255,255,255); font-style:normal; text-align:start" class="amp-wp-0d7ae4d">DXT1，DXT3和DXT5类型的压缩纹理</span></span><span data-amp-original-style="font-family:arial,宋体,sans-serif; font-size:14px; color:#333333; background-color:rgb(255,255,255); font-weight:normal; font-style:normal; text-align:start" class="amp-wp-7e0dc1a">。</span></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d">在使用函数IDirect3DDevice9::<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">CreateTexture()</span>创建纹理时，将参数Format设置为压缩纹理格式<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DFMT_DXT1 ~ D3DFMT_DXT5</span>中的任意值，可以创建指定压缩格式的纹理，也可以通过函数D3DXCreateTextureFromFileEx()从磁盘文件中生成DXT压缩纹理：</p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DXCreateTextureFromFileExW</span>(pd3dDevice, L"texture.jpg", 0, 0, 5, 0, </span>D3DFMT_DXT1<span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">, D3DPOOL_MANAGED,D3DX_DEFAULT, D3DX_DEFAULT, 0xFF000000, NULL, NULL, &g_texture);</span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">4）使用压缩纹理</strong></span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">在创建好压缩纹理之后，就可以和前面一样设置纹理及各项纹理渲染状态，最后进行渲染。如果当前设备支持DXT压缩纹理，那么在使用DXT纹理渲染图形时，Direct3D引擎会自动进行纹理压缩，如果当前设备不支持DXT压缩纹理，这时使用DXT压缩纹理和使用普通的非压缩纹理完全相同。</span><span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">当使用大量纹理贴图渲染复杂场景时，通过使用DXT压缩纹理可以有效提高程序运行性能。</span></p><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">13.纹理管理</strong></span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">如果显卡中只有64MB的视频内存，就应该考虑将哪些纹理加载和保留在内存中。可以编写一个算法让计算机来自动考虑这些问题，那么这个算法的任务是什么呢？它需要跟踪可用的纹理内存总数，并了解哪些纹理是经常用到的，而哪些纹理是很少用到的。至少，这个纹理管理算法必须能决定哪些现有的纹理资源可以通过一张纹理图来重新加载，以及应该销毁哪些表面，然后由新的纹理资源取而代之。</span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">Direct3D有一个自动的纹理管理系统，当通过CreateTexture()创建一个纹理对象时，将Pool参数指定为<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DPOOL_MANAGED</span>，就是向Direct3D请求该系统的支持。纹理管理器通过一个时间戳来跟踪纹理的使用情况，这个时间戳用于记录每个纹理 对象最后被使用的时间。纹理管理器通过"最近最少使用"算法来决定哪些纹理应从视频内存中移除，若有两个纹理对象同时满足移除条件，则根据纹理属性来做进一步的判断。如果它们具有相同的优先级，则移除最近最少使用的纹理，如果它们具有相同的时间戳，则移除低优先级的纹理。</span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">通过为纹理表面调用<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">IDirect3DResource9::SetPriority()</span>函数，可以给托管的纹理赋予一个优先级，该函数声明如下：</span></p><p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f">Assigns the resource-management priority for this resource. </span></span></p><pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">DWORD SetPriority(</strong><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">DWORD</strong><em data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">PriorityNew</em><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">);</strong></span></span></pre>
<h2 data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">纹理优化方式</strong></span></span></h2>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#004040; background-color:inherit" class="amp-wp-3e5d72f"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">0）使用dds格式文件，使用<span data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-size:14px; color:#c000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-99ba05c"><span data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left" class="amp-wp-b01be11">D3DFMT_DXTn来创建内存压缩纹理。</span></span></strong></span></span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d">1）将多个小图片，用TexturePacker合并为一张大图和xml配置文件，读取小图时候根据xml截取矩形区域即可。对称的纹理只需要一张即可，然后通过旋转变换。符合九宫格的图片也是只需要一张即可进行放大。太大的图片也可以切割然后进行拼接得到需要的大图片。</pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">2）使用</strong><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">D3DPOOL_DEFAULT</strong></span><strong data-amp-original-style="background-color:inherit; color:rgb(0,64,64)" class="amp-wp-a072350">常驻显存中，避免每次都调度提交，</strong></span><span data-amp-original-style="background-color:inherit; line-height:1.5" class="amp-wp-61ac278">将静态不经常变更的纹理放置在显存中(例如</span><span data-amp-original-style="color:#c00000; background-color:inherit; line-height:1.5" class="amp-wp-cf2e470"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="font-family:微软雅黑; background-color:rgb(254,254,242); font-weight:normal" class="amp-wp-a639778">光照贴图，</span></strong></span><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"><span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">地图,建筑</span>等资源)，渲染效率会更高，丢失的时候IDirect3DDevice9::Reset后要重新创建<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">恢复起来要不断的传输到显存中有点慢有时候如果是比较大量的贴图建议使用D3DPOOL_MANAGED</span>，并且显存中的纹理不能锁定更新需要<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">IDirect3DDevice9::UpdateSurface, IDirect3DDevice9::UpdateTexture</span>；和纹理不同显存中的swapchain back buffers, render targets, vertex buffers和indexbuffers都是可以锁定更新的。</span></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d">常驻内存，有频繁更新的数据，例如<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">粒子数据，骨骼蒙皮动画</span>等也是可以声明为<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">D3DPOOL_DEFAULT</strong></span>的，<span data-amp-original-style="background-color:rgb(254,254,242)" class="amp-wp-e46607f">同时用<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DUSAGE_DYNAMIC|D3DUSAGE_WRITEONLY </span>使用方式</span>标记，这意味着此资源会被创建在AGP Memory中。锁定的时候用<span data-amp-original-style="color:#c00000; background-color:inherit" class="amp-wp-261fd7f">D3DLOCK_NOOVERWRITE或D3DLOCK_DISCARD可</span>以瞒天过海避免同步，且可以修改一部分渲染一部分提高CPU和GPU的并行效率。</pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">使用D3DPOOL_MANAGED</strong></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="color:#454545; background-color:inherit" class="amp-wp-54245a9">交给D3D托管，<span data-amp-original-style="color:red; background-color:inherit" class="amp-wp-a7534de">渲染效率一般(</span>系统RAM/AGP内存/显存中都有)<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span></strong></pre>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:inherit" class="amp-wp-8ffa67d"><span data-amp-original-style="color:#454545; background-color:inherit" class="amp-wp-54245a9"></span><p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:bold" class="amp-wp-e14748f">D3DPOOL_MANAGED的资源可以自由的锁定。</p><p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:bold" class="amp-wp-e14748f">但是只有系统内存中的副本资源数据可以直接的修改，当需要渲染的时候D3D会自动的拷贝到AGP内存和显存中。</p><p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:bold; display:inline!important" class="amp-wp-6f2a06a">适用情况：由于<span data-amp-original-style="color:#c000; background-color:inherit" class="amp-wp-8de5079">D3D</span><span data-amp-original-style="color:#c000; background-color:inherit" class="amp-wp-8de5079">自己的资源管理方案很高效、使用简单，游戏中大部分资源都可以使用此标识创建</span>。</p><p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:bold" class="amp-wp-e14748f">例子：<span data-amp-original-style="color:#0b050; background-color:inherit" class="amp-wp-b8cdffc">游戏中使用的大部分纹理贴图，静态模型</span>。</p><p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:bold" class="amp-wp-e14748f"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></p>D3DPOOL_SYSTEMMEM:<strong data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></strong></pre>
<p><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"></span></span></span></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"></span></span></span></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">直接放置在系统中，<span data-amp-original-style="color:red; background-color:inherit; font-weight:normal" class="amp-wp-5c7a274">渲染效率较差需要用UpdateSurface</span>或UpdateTexture拷贝到D3DPOOL_DEFAULT创建的资源，<span data-amp-original-style="color:red; background-color:rgb(255,255,255); font-weight:normal; line-height:1.5" class="amp-wp-d95e8b0">设备丢失时候不需要重新创建资源，锁定很方便CPU</span><span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; line-height:1.5" class="amp-wp-8cb80e2">处理较快。</span><span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; line-height:1.5" class="amp-wp-8cb80e2">这些资源可以被锁定(读写)，可以通过IDirect3DDevice9::UpdateSurfaceor IDirect3DDevice9::</span><span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; line-height:1.5" class="amp-wp-8cb80e2">UpdateTexture函数，将该类型的资源数据，设置为用D3DPOOL_DEFAULT创建的资源的数据来源。</span><span data-amp-original-style="background-color:rgb(255,255,255); font-weight:normal; line-height:1.5" class="amp-wp-8cb80e2"><br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66"></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit; font-weight:normal" class="amp-wp-5280889"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">使用：<span data-amp-original-style="color:#0b050; background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-3b66975">对于需要高频CPU</span><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">读写处理的数据，推荐使用这种方式。</span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="background-color:rgb(255,255,255); line-height:1.5" class="amp-wp-0858e66">D3DPOOL_SCRATCH:<br data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">直接放置在系统中，<span data-amp-original-style="color:#c000; background-color:inherit" class="amp-wp-8de5079">不能直接的交给D3D</span>渲染，设备丢失时候不需要创建资源，不被设备像素格式限制可以创建锁定拷贝。</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">这些资源放置在系统RAM中，当设备丢失时不需要重新创建数据。这些数据不被设备大小和像素格式的限制。正因为如此，</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">这些资源不能被Direct3D访问，不能够设置为纹理或者设置为渲染目标。然而，这些资源之间总是可以被创建，锁定和拷贝。</span></p>
<p><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">Directx 9引入这种内存池的原因是由于它从API中删除了CreateImageSurface（）的函数。通常，D3DPOOL_SCRATCH是连同CreateOffscreenPlainSurface（）一起使用的，后者将返回一个与之前通过CreateImageSurface（）来创建的、具有相同特征的表面。<span data-amp-original-style="color:#0b050; background-color:inherit" class="amp-wp-b8cdffc">因此，它主要用于创建图像表面</span>。</span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455">4）使用内存池管理纹理，避免每次都从磁盘IO加载纹理，当不需要的时候及时释放，过关卡时候释放掉管理的一些场景静态纹理内存，建筑纹理，特效等等。对于纹理<span data-amp-original-style="font-family:宋体; font-size:14px; background-color:inherit" class="amp-wp-ec56991"><span data-amp-original-style="font-family:Arial; font-size:14px; background-color:inherit" class="amp-wp-7b12461"><span data-amp-original-style="font-family:宋体; font-size:14px; background-color:inherit" class="amp-wp-ec56991">这时可以调用</span><span data-amp-original-style="font-family:Arial; font-size:14px; background-color:inherit" class="amp-wp-7b12461">IDirect3D3::EvictManagedTextures</span><span data-amp-original-style="font-family:宋体; font-size:14px; background-color:inherit" class="amp-wp-ec56991">方法逐出所有的被管理纹理。在调用这个方法时，</span><span data-amp-original-style="font-family:Arial; font-size:14px; background-color:inherit" class="amp-wp-7b12461">Direct3D</span><span data-amp-original-style="font-family:宋体; font-size:14px; background-color:inherit" class="amp-wp-ec56991">会将所有的本地与非本地显存纹理销毁掉，只留下原始系统内存拷贝。</span></span></span></span></span></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6">5）异步读取纹理，提高IO性能，但是一定要采用异步线程机制，唤醒回调的机制，避免不断的循环浪费CPU时间。</span></span></span></span></span></p>
<p data-amp-original-style="margin:5px 0px; background-color:inherit" class="amp-wp-c1e298d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2"><span data-amp-original-style="background-color:rgb(255,255,255); color:rgb(0,0,0); font-family:微软雅黑; font-size:14px; font-style:normal; text-align:left" class="amp-wp-1e79455"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"><span data-amp-original-style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; text-align:left" class="amp-wp-c303bf6"></span></span></span></span></span></p>
<pre data-amp-original-style="font-family:Monaco,Consolas,Courier,'Lucida Console',monospace; font-style:normal; background-color:rgb(255,255,255); color:rgb(0,0,0); font-size:14px; font-weight:normal; text-align:left" class="amp-wp-25fcc7d"><span data-amp-original-style="background-color:inherit" class="amp-wp-c49b7e2">6）暂时没有想到其它减少cpu draw call的技巧，减少内存和飙升大小的技巧，减少IO读取和提高IO读取性能，减少GPU调度和渲染纹理的技巧。</span></pre>
</pre></pre></pre></pre></div>
<p> 
 </p></div>
</div>
	</div>

	<footer class="amp-wp-article-footer">
			<div class="amp-wp-meta amp-wp-tax-category">
		Categories: <a href="https://uzzz.org/category/tuxiangchuli/" rel="category tag">图像处理</a>	</div>

	</footer>
</article>

<footer class="amp-wp-footer">
	<div>
		<h2>有组织在!</h2>
		<a href="#top" class="back-to-top">Back to top</a>
	</div>
</footer>




</body></html>
