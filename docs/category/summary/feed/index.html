<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Summary &#8211; 有组织在!</title>
	<atom:link href="https://uzzz.org/category/summary/feed" rel="self" type="application/rss+xml" />
	<link>http://uzzz.org/</link>
	<description></description>
	<lastBuildDate>Thu, 04 Oct 2018 18:42:41 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.2.4</generator>

<image>
	<url>https://uzzz.org/wp-content/uploads/2019/10/cropped-icon-32x32.png</url>
	<title>Summary &#8211; 有组织在!</title>
	<link>http://uzzz.org/</link>
	<width>32</width>
	<height>32</height>
</image> 
	<item>
		<title>Install Docker and Tor Network and Proxy Service on CentOS7</title>
		<link>https://uzzz.org/article/1105.html</link>
				<pubDate>Thu, 04 Oct 2018 18:42:41 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[Summary]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/1105.html</guid>
				<description><![CDATA[Install Docker and Tor Network and Proxy Service on CentOS7 How to run Tor network and Proxy Service It is docker, so only thing we need on our target machine is docker. No tor, no proxy, no python, no java, just docker environment. This will do work for all the other docker applications as well. So in the future, the target machine will be clean and clear. Not java version conflict, no python version conflict, no other installation issues. My target server is CentOS 7 First, check the software database index &#62; sudo yum check-update Install Docker Service &#62; curl -fsSL https://get.docker.com/ &#124; sh Start the Docker Service &#62; sudo systemctl start docker After the installation, we can check &#62; docker &#8211;version Docker version 18.06.1-ce, build e68fc7a Directly install privoxy on CentOS from Source Code https://wiki.polaire.nl/doku.php?id=centos7_privoxy http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/ Here is the command to fetch the privoxy source code &#62; wget http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/privoxy-3.0.26-stable-src.tar.gz Install the build tool we need &#62; sudo yum groupinstall development tools &#62; sudo yum install zlib-devel pcre-devel w3m Unzip the file &#62; tar zxvf privoxy-3.0.26-stable-src.tar.gz Build the source &#62;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
   Install Docker and Tor Network and Proxy Service on CentOS7</p>
<p>How to run Tor network and Proxy Service<br />
  <br />It is docker, so only thing we need on our target machine is docker. No tor, no proxy, no python, no java, just docker environment. This will do work for all the other docker applications as well.<br />
  <br />So in the future, the target machine will be clean and clear. Not java version conflict, no python version conflict, no other installation issues.</p>
<p>My target server is CentOS 7</p>
<p>First, check the software database index<br />
  <br />&gt; sudo yum check-update<br />
  <br />Install Docker Service<br />
  <br />&gt; curl -fsSL https://get.docker.com/ | sh<br />
  <br />Start the Docker Service<br />
  <br />&gt; sudo systemctl start docker</p>
<p>After the installation, we can check<br />
  <br />&gt; docker &#8211;version<br />
  <br />Docker version 18.06.1-ce, build e68fc7a</p>
<p>Directly install privoxy on CentOS from Source Code<br />
  <br />https://wiki.polaire.nl/doku.php?id=centos7_privoxy<br />
  <br />http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/</p>
<p>Here is the command to fetch the privoxy source code<br />
  <br />&gt; wget http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/privoxy-3.0.26-stable-src.tar.gz</p>
<p>Install the build tool we need<br />
  <br />&gt; sudo yum groupinstall development tools<br />
  <br />&gt; sudo yum install zlib-devel pcre-devel w3m</p>
<p>Unzip the file<br />
  <br />&gt; tar zxvf privoxy-3.0.26-stable-src.tar.gz </p>
<p>Build the source<br />
  <br />&gt; cd privoxy-3.0.26-stable<br />
  <br />&gt; autoheader<br />
  <br />&gt; autoconf<br />
  <br />&gt; ./configure &#8211;with-user=privoxy &#8211;with-group=privoxy &#8211;prefix=/home/carl/tool/privoxy-3.0.26<br />
  <br />&gt; make<br />
  <br />&gt; make -n install<br />
  <br />&gt; make -s install USER=privoxy GROUP=privoxy</p>
<p>User privoxy and group privoxy not working, so I switch to use my current sudo user carl, this command can start that service</p>
<p>sudo /opt/privoxy/sbin/privoxy &#8211;pidfile /opt/privoxy/var/run/privoxy.pid &#8211;user carl /opt/privoxy/etc/config 2&gt;/dev/null</p>
<p>Copy the script to working directory<br />
  <br />&gt; sudo cp privoxy-generic.init /etc/init.d/privoxy<br />
  <br />&gt; sudo chkconfig &#8211;add privoxy<br />
  <br />&gt; sudo chkconfig privoxy on</p>
<p>Edit the /etc/init.d/privoxy as follow:<br />
  <br />PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/xpg4/bin:/usr/bin:/sbin:/bin:/opt/privoxy/sbin<br />
  <br />P_NAME=Privoxy<br />
  <br /># Path to executable.<br />
  <br />P_DAEMON=privoxy<br />
  <br /># Full path to location of Privoxy config file.<br />
  <br />P_CONF_FILE=/opt/privoxy/etc/config<br />
  <br /># Full path to PID file location. Location must be writable by<br />
  <br /># whoever runs this script and by Privoxy itself.<br />
  <br />P_PIDFILE=/opt/privoxy/var/run/privoxy.pid<br />
  <br /># If uncommented, this script will try to run as USER=privoxy, which<br />
  <br /># may require special handling of config, *.action, trust, logfile,<br />
  <br /># jarfile, and pidfile.<br />
  <br />P_USER=carl</p>
<p>Command can work<br />
  <br />&gt; sudo service privoxy start</p>
<p>The privoxy configuration will be as follow:<br />
  <br />forward-socks5t / 127.0.0.1:9050 .<br />
  <br />listen-address 0.0.0.0:8119</p>
<p>Set Up the Tor from Command Line<br />
  <br />sudo yum install tor</p>
<p>Generate the password for tor<br />
  <br />&gt; echo HashedControlPassword $(tor &#8211;hash-password “xxxxxxxx&#8221;)</p>
<p>Add these to the file end<br />
  <br />&gt; sudo less /etc/tor/torrc</p>
<p>ControlPort 9051<br />
  <br />ControlListenAddress 0.0.0.0<br />
  <br />HashedControlPassword 16:xxxxxxxxxxxxxx</p>
<p>Check the permission of one directory<br />
  <br />&gt; chmod 400 /run/tor</p>
<p>Some Tips<br />
  <br />Optional commands if you needed<br />
  <br />&gt; sudo yum-config-manager &#8211;disable chromium-el6<br />
  <br />&gt; sudo usermod -aG docker carl</p>
<p>Here is the Docker information<br />
  <br />start.sh<br />
  <br />#!/bin/sh -ex</p>
<p>#start the service<br />
  <br />/etc/init.d/privoxy start<br />
  <br />tor</p>
<p>Here is the Makefile<br />
  <br />IMAGE=sillycat/public<br />
  <br />TAG=centos-tornetwork-1.0<br />
  <br />NAME=centos-tornetwork-1.0</p>
<p>prepare:<br />
  <br /> wget http://www.privoxy.org/sf-download-mirror/Sources/3.0.26%20%28stable%29/privoxy-3.0.26-stable-src.tar.gz -P install/</p>
<p>docker-context:</p>
<p>build: docker-context<br />
  <br /> docker build -t $(IMAGE):$(TAG) .</p>
<p>run:<br />
  <br /> docker run -d -p 9051:9051 -p 8119:8119 &#8211;name $(NAME) $(IMAGE):$(TAG)</p>
<p>debug:<br />
  <br /> docker run -p 9051:9051 -p 8119:8119 &#8211;name $(NAME) -ti $(IMAGE):$(TAG) /bin/bash</p>
<p>clean:<br />
  <br /> docker stop ${NAME}<br />
  <br /> docker rm ${NAME}</p>
<p>logs:<br />
  <br /> docker logs ${NAME}</p>
<p>publish:<br />
  <br /> docker push ${IMAGE}</p>
<p>Here is the Dockerfile with all the steps and Details<br />
  <br />#Run a Tor Network Server</p>
<p>#Prepare the OS<br />
  <br />FROM centos:7<br />
  <br />MAINTAINER Carl Luo &lt;luohuazju@gmail.com&gt;</p>
<p>#upgrade the system<br />
  <br />RUN yum -y update</p>
<p>#Prepare the denpendencies<br />
  <br />RUN yum install -y epel-release<br />
  <br />RUN yum install -y tor<br />
  <br />RUN yum groupinstall -y development tools<br />
  <br />RUN yum install -y wget gcc make<br />
  <br />RUN yum install -y zlib-devel pcre-devel w3m</p>
<p>#set up tor configuration<br />
  <br />RUN echo &#8220;ControlPort 9051&#8221; &gt;&gt; /etc/tor/torrc<br />
  <br />RUN echo &#8220;ControlListenAddress 0.0.0.0&#8221; &gt;&gt; /etc/tor/torrc<br />
  <br />RUN echo HashedControlPassword $(tor &#8211;hash-password &#8220;xxxxxxxxx&#8221; | tail -n 1) &gt;&gt; /etc/tor/torrc<br />
  <br />RUN rm -fr /run/tor/<br />
  <br />RUN mkdir /run/tor<br />
  <br />RUN chmod 400 /run/tor</p>
<p>#manually install privoxy<br />
  <br />RUN adduser privoxy<br />
  <br />RUN usermod -aG wheel privoxy<br />
  <br />RUN mkdir /install/<br />
  <br />RUN mkdir /tool/<br />
  <br />ADD install/privoxy-3.0.26-stable-src.tar.gz /install/<br />
  <br />WORKDIR /install/privoxy-3.0.26-stable<br />
  <br />RUN autoheader<br />
  <br />RUN autoconf<br />
  <br />RUN ./configure &#8211;with-user=privoxy &#8211;with-group=wheel &#8211;prefix=/tool/privoxy-3.0.26<br />
  <br />RUN make<br />
  <br />RUN make -n install<br />
  <br />RUN make -s install USER=privoxy GROUP=wheel</p>
<p>#set up forward configuration<br />
  <br />RUN echo &#8220;forward-socks5t / 127.0.0.1:9050 .&#8221;&gt;&gt; /tool/privoxy-3.0.26/etc/config<br />
  <br />RUN echo &#8220;listen-address 0.0.0.0:8119&#8221;&gt;&gt; /tool/privoxy-3.0.26/etc/config</p>
<p>ADD conf/privoxy /etc/init.d/privoxy<br />
  <br />RUN chmod a+x /etc/init.d/privoxy</p>
<p>#set up the app<br />
  <br />EXPOSE 9051 8119<br />
  <br />RUN mkdir -p /app/<br />
  <br />ADD start.sh /app/<br />
  <br />WORKDIR /app/<br />
  <br />CMD [ &#8220;./start.sh&#8221; ]</p>
<p>The /etc/init.d/privoxy Script to start the service<br />
  <br />#!/bin/sh</p>
<p>###########################################################################<br />
  <br />#<br />
  <br /># File : $Source: /cvsroot/ijbswa/current/privoxy-generic.init,v $<br />
  <br />#<br />
  <br /># Purpose : This script takes care of starting and stopping privoxy.<br />
  <br /># It is supposed to work cross-platform and thus doesn&#8217;t<br />
  <br /># do too much. When packaging Privoxy it&#8217;s recommended to<br />
  <br /># write a platform-specific start script instead of using<br />
  <br /># this one.<br />
  <br />#<br />
  <br /># Copyright : Written by and Copyright (C) 2001,2002 the<br />
  <br /># Privoxy team. http://www.privoxy.org/<br />
  <br />#<br />
  <br /># This program is free software; you can redistribute it<br />
  <br /># and/or modify it under the terms of the GNU General<br />
  <br /># Public License as published by the Free Software<br />
  <br /># Foundation; either version 2 of the License, or (at<br />
  <br /># your option) any later version.<br />
  <br />#<br />
  <br /># This program is distributed in the hope that it will<br />
  <br /># be useful, but WITHOUT ANY WARRANTY; without even the<br />
  <br /># implied warranty of MERCHANTABILITY or FITNESS FOR A<br />
  <br /># PARTICULAR PURPOSE. See the GNU General Public<br />
  <br /># License for more details.<br />
  <br />#<br />
  <br /># The GNU General Public License should be included with<br />
  <br /># this file. If not, you can view it at<br />
  <br /># http://www.gnu.org/copyleft/gpl.html<br />
  <br /># or write to the Free Software Foundation, Inc., 59<br />
  <br /># Temple Place &#8211; Suite 330, Boston, MA 02111-1307, USA.<br />
  <br />#<br />
  <br />###########################################################################</p>
<p>### BEGIN INIT INFO<br />
  <br /># Provides: privoxy<br />
  <br /># Required-Start:<br />
  <br /># Required-Stop:<br />
  <br /># Default-Start: 2 3 4 5<br />
  <br /># Default-Stop: 0 1 6<br />
  <br /># Short-Description: Start privoxy at boot time<br />
  <br /># Description: Start and stop the privacy-enhancing HTTP proxy privoxy.<br />
  <br />### END INIT INFO</p>
<p># NOTE: This script may require editing to ensure proper location of<br />
  <br /># config file, and the privoxy executable. Care should be taken to ensure<br />
  <br /># logfile is writable by $P_USER (logfile is defined in config), and that<br />
  <br /># there is suitable write access for $P_PIDFILE.</p>
<p>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/xpg4/bin:/usr/bin:/sbin:/bin:/tool/privoxy-3.0.26/sbin<br />
  <br />P_NAME=Privoxy<br />
  <br /># Path to executable.<br />
  <br />P_DAEMON=privoxy<br />
  <br /># Full path to location of Privoxy config file.<br />
  <br />P_CONF_FILE=/tool/privoxy-3.0.26/etc/config<br />
  <br /># Full path to PID file location. Location must be writable by<br />
  <br /># whoever runs this script and by Privoxy itself.<br />
  <br />P_PIDFILE=/tool/privoxy-3.0.26/var/run/privoxy.pid<br />
  <br /># If uncommented, this script will try to run as USER=privoxy, which<br />
  <br /># may require special handling of config, *.action, trust, logfile,<br />
  <br /># jarfile, and pidfile.<br />
  <br />P_USER=privoxy</p>
<p># If a privoxy user is specified, lets try that. /bin/sh does not seem to<br />
  <br /># know about $UID.<br />
  <br />if [ 0 = `id -u` ]; then<br />
  <br /> if [ -n &#8220;$P_USER&#8221; ]; then<br />
  <br /> id $P_USER 2&gt;/dev/null &gt;/dev/null<br />
  <br /> if [ $? -eq 0 ]; then<br />
  <br /> P_USER_SETTINGS=&#8221;&#8211;user $P_USER&#8221;<br />
  <br /> else<br />
  <br /> echo &#8220;User $P_USER doesn&#8217;t exist, exiting.&#8221;<br />
  <br /> exit 1<br />
  <br /> fi<br />
  <br /> else<br />
  <br /> # The user has sufficient rights, but $P_USER isn&#8217;t set<br />
  <br /> echo &#8220;Running Privoxy as root is not recommended!&#8221;<br />
  <br /> P_USER_SETTINGS=&#8221;&#8221;<br />
  <br /> fi<br />
  <br />else<br />
  <br /> # The user has insufficient rights to run Privoxy as $P_USER<br />
  <br /> # and may not be able to write or delete the PID file.<br />
  <br /> echo &#8220;You aren&#8217;t root, expect trouble!&#8221;<br />
  <br /> P_USER_SETTINGS=&#8221;&#8221;<br />
  <br />fi</p>
<p>if [ ! -f $P_CONF_FILE ]; then<br />
  <br /> echo &#8220;Can&#8217;t find $P_CONF_FILE, exiting.&#8221;<br />
  <br /> exit 1<br />
  <br />fi</p>
<p>case &#8220;$1&#8221; in</p>
<p> start)<br />
  <br /> if [ -f $P_PIDFILE ]; then<br />
  <br /> if kill -0 `cat $P_PIDFILE`; then<br />
  <br /> echo &#8220;Error: $P_NAME is already running, exiting.&#8221;<br />
  <br /> exit 1<br />
  <br /> else<br />
  <br /> rm -f $P_PIDFILE<br />
  <br /> fi<br />
  <br /> fi</p>
<p> $P_DAEMON &#8211;pidfile $P_PIDFILE $P_USER_SETTINGS $P_CONF_FILE 2&gt;/dev/null</p>
<p> if [ $? -eq 0 ]; then<br />
  <br /> echo &#8220;Starting $P_NAME, OK.&#8221;<br />
  <br /> else<br />
  <br /> echo &#8220;Starting $P_NAME, Failed.&#8221;<br />
  <br /> rm -f $P_PIDFILE<br />
  <br /> fi<br />
  <br /> ;;</p>
<p> restart)<br />
  <br /> $0 stop<br />
  <br /> $0 start<br />
  <br /> ;;</p>
<p> stop)<br />
  <br /> test ! -f $P_PIDFILE &amp;&amp; echo &#8220;No $P_PIDFILE file found, exiting.&#8221; &amp;&amp; exit 1<br />
  <br /> kill `cat $P_PIDFILE` &amp;&amp; rm -f $P_PIDFILE &amp;&amp; \<br />
  <br /> echo &#8220;Stopping $P_NAME, OK.&#8221; || echo &#8220;Stopping $P_NAME, failed.&#8221;<br />
  <br /> ;;</p>
<p> *)<br />
  <br /> echo &#8220;Usage: $0 {start|stop|restart}&#8221;<br />
  <br /> exit 1<br />
  <br /> ;;</p>
<p>esac</p>
<p>exit 0</p>
<p>How to Verify that?<br />
  <br />How to change the IP<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE “xxxxxxxxx&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; | nc localhost 9051</p>
<p>Check the IP<br />
  <br />&gt; curl -x localhost:8118 http://icanhazip.com/</p>
<p>How to change the IP from remote<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE “xxxxxxxxx&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; | nc ubuntu-master 9051</p>
<p>Check the IP from Remote<br />
  <br />&gt; curl -x centos-dev1:8118 http://icanhazip.com/</p>
<p>References:<br />
  <br />http://sillycat.iteye.com/blog/2223733<br />
  <br />http://sillycat.iteye.com/blog/2226093<br />
  <br />http://sillycat.iteye.com/blog/2227400</p>
<p>https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-centos-7<br />
  <br />https://hub.docker.com/_/centos/<br />
  <br />https://linuxacademy.com/community/posts/show/topic/21629-docker-failed-to-get-dbus-connection-operation-not-permitted<br />
  <br />https://serverfault.com/questions/824975/failed-to-get-d-bus-connection-operation-not-permitted<br />
  <br />https://github.com/CentOS/sig-cloud-instance-images/issues/45</p>
<p>https://www.rosehosting.com/blog/how-to-create-a-sudo-user-on-centos-7/
 </p></div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>2018 Scrapy Environment Enhance(4)Docker Service for Scrapyd and Tor Network</title>
		<link>https://uzzz.org/article/1181.html</link>
				<pubDate>Tue, 15 May 2018 19:12:18 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[Summary]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/1181.html</guid>
				<description><![CDATA[2018 Scrapy Environment Enhance(4)Docker Service for Scrapyd and Tor Network Docker Service for Scrapyd http://sillycat.iteye.com/blog/2422861 Docker Service for Tor Network There are 3 ports and 3 different function services. Tor 9051 Port reset IP Tor 9050 Port to proxy Privoxy 8118 to proxy to 9050 I put them into one Docker App, but we should be able to split them into 2 apps. Dockerfile #Run a Tor Network Server #Prepare the OS FROM ubuntu:16.04 MAINTAINER Carl Luo &#60;luohuazju@gmail.com&#62; ENV DEBIAN_FRONTEND noninteractive RUN apt-get -qq update RUN apt-get -qqy dist-upgrade #Prepare the denpendencies RUN apt-get install -qy tor RUN apt-get install -qy netcat RUN apt-get install -qy curl RUN apt-get install -qy privoxy #set up tor configuration RUN echo &#8220;ControlPort 9051&#8221; &#62;&#62; /etc/tor/torrc RUN echo &#8220;ControlListenAddress 0.0.0.0&#8221; &#62;&#62; /etc/tor/torrc RUN echo HashedControlPassword $(tor &#8211;hash-password “xxxxxxxx&#8221; &#124; tail -n 1) &#62;&#62; /etc/tor/torrc #set up forward configuration RUN echo &#8220;forward-socks5t / 127.0.0.1:9050 .&#8221;&#62;&#62; /etc/privoxy/config RUN echo &#8220;listen-address 0.0.0.0:8118&#8221;&#62;&#62; /etc/privoxy/config #set up the app EXPOSE 9051 8118 RUN mkdir -p /app/ ADD start.sh /app/ WORKDIR /app/ CMD [ &#8220;./start.sh&#8221; ] The command line to]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
   2018 Scrapy Environment Enhance(4)Docker Service for Scrapyd and Tor Network</p>
<p>Docker Service for Scrapyd<br />
  <br />http://sillycat.iteye.com/blog/2422861</p>
<p>Docker Service for Tor Network<br />
  <br />There are 3 ports and 3 different function services.<br />
  <br />Tor 9051 Port reset IP<br />
  <br />Tor 9050 Port to proxy<br />
  <br />Privoxy 8118 to proxy to 9050</p>
<p>I put them into one Docker App, but we should be able to split them into 2 apps.<br />
  <br />Dockerfile<br />
  <br />#Run a Tor Network Server<br />
  <br />#Prepare the OS<br />
  <br />FROM ubuntu:16.04<br />
  <br />MAINTAINER Carl Luo &lt;luohuazju@gmail.com&gt;<br />
  <br />ENV DEBIAN_FRONTEND noninteractive<br />
  <br />RUN apt-get -qq update<br />
  <br />RUN apt-get -qqy dist-upgrade<br />
  <br />#Prepare the denpendencies<br />
  <br />RUN apt-get install -qy tor<br />
  <br />RUN apt-get install -qy netcat<br />
  <br />RUN apt-get install -qy curl<br />
  <br />RUN apt-get install -qy privoxy<br />
  <br />#set up tor configuration<br />
  <br />RUN echo &#8220;ControlPort 9051&#8221; &gt;&gt; /etc/tor/torrc<br />
  <br />RUN echo &#8220;ControlListenAddress 0.0.0.0&#8221; &gt;&gt; /etc/tor/torrc<br />
  <br />RUN echo HashedControlPassword $(tor &#8211;hash-password “xxxxxxxx&#8221; | tail -n 1) &gt;&gt; /etc/tor/torrc<br />
  <br />#set up forward configuration<br />
  <br />RUN echo &#8220;forward-socks5t / 127.0.0.1:9050 .&#8221;&gt;&gt; /etc/privoxy/config<br />
  <br />RUN echo &#8220;listen-address 0.0.0.0:8118&#8221;&gt;&gt; /etc/privoxy/config<br />
  <br />#set up the app<br />
  <br />EXPOSE 9051 8118<br />
  <br />RUN mkdir -p /app/<br />
  <br />ADD start.sh /app/<br />
  <br />WORKDIR /app/<br />
  <br />CMD [ &#8220;./start.sh&#8221; ]</p>
<p>The command line to start, start.sh<br />
  <br />#!/bin/sh -ex<br />
  <br />#start the service<br />
  <br />service tor start<br />
  <br />service privoxy start<br />
  <br />tail -f /dev/null</p>
<p>Makefile to open the PORT number<br />
  <br />IMAGE=sillycat/public<br />
  <br />TAG=ubuntu-tornetwork-1.0<br />
  <br />NAME=ubuntu-tornetwork-1.0<br />
  <br />docker-context:<br />
  <br />build: docker-context<br />
  <br /> docker build -t $(IMAGE):$(TAG) .<br />
  <br />run:<br />
  <br /> docker run -d -p 9051:9051 -p 8118:8118 &#8211;name $(NAME) $(IMAGE):$(TAG)<br />
  <br />debug:<br />
  <br /> docker run -p 9051:9051 -p 8118:8118 &#8211;name $(NAME) -ti $(IMAGE):$(TAG) /bin/bash<br />
  <br />clean:<br />
  <br /> docker stop ${NAME}<br />
  <br /> docker rm ${NAME}<br />
  <br />logs:<br />
  <br /> docker logs ${NAME}<br />
  <br />publish:<br />
  <br /> docker push ${IMAGE}</p>
<p>How to change the IP<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE “xxxxxxxxx&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; | nc localhost 9051</p>
<p>Check the IP<br />
  <br />&gt; curl -x localhost:8118 http://icanhazip.com/</p>
<p>How to change the IP from remote<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE “xxxxxxxxx&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; | nc ubuntu-master 9051</p>
<p>Check the IP from Remote<br />
  <br />&gt; curl -x ubuntu-master:8118 http://icanhazip.com/</p>
<p>References:<br />
  <br />http://sillycat.iteye.com/blog/2418229<br />
  <br />http://sillycat.iteye.com/blog/2418353<br />
  <br />http://sillycat.iteye.com/blog/2422861</p>
<p>https://github.com/torproject/tor/blob/master/src/config/torrc.sample.in<br />
  <br />https://github.com/osminogin/docker-tor-simple<br />
  <br />https://github.com/dperson/torproxy<br />
  <br />https://program-think.blogspot.com/2014/12/gfw-privoxy.html<br />
  <br />http://www.cnblogs.com/another-wheel/archive/2011/11/16/setup-http-proxy-via-socks-and-privoxy.html<br />
  <br />https://blog.phpgao.com/privoxy-shadowsocks.html<br />
  <br />https://blog.csdn.net/north_eagle/article/details/8683403<br />
  <br />https://stackoverflow.com/questions/15459170/trouble-authenticating-tor-with-python<br />
  <br />https://gist.github.com/DusanMadar/c1155329cf6a71e4346cae271a2eafd3<br />
  <br />https://www.torproject.org/docs/faq.html.en<br />
  <br />https://stackoverflow.com/questions/45901892/how-to-connect-to-tor-control-port-9051-from-a-remote-host<br />
  <br />https://stackoverflow.com/questions/25775266/how-to-keep-docker-container-running-after-starting-services/36872226
 </div>
</div>
]]></content:encoded>
										</item>
		<item>
		<title>2018 Scrapy Environment Enhance(2)Proxy to Tor Network</title>
		<link>https://uzzz.org/article/1210.html</link>
				<pubDate>Wed, 11 Apr 2018 17:32:54 +0000</pubDate>
		<dc:creator><![CDATA[fandyvon]]></dc:creator>
				<category><![CDATA[Distributed]]></category>
		<category><![CDATA[Summary]]></category>

		<guid isPermaLink="false">https://uzzz.org/article/1210.html</guid>
				<description><![CDATA[2018 Scrapy Environment Enhance(2)Proxy to Tor Network Follow this Blog and Set the Proxy https://gist.github.com/DusanMadar/8d11026b7ce0bce6a67f7dd87b999f6b https://stackoverflow.com/questions/45009940/scrapy-with-privoxy-and-tor-how-to-renew-ip Install Tor thing and Verify &#62; apt update &#62; apt install tor Install Client Tool &#62; apt install netcat Set Up Tor &#62; echo &#8220;ControlPort 9051&#8221; &#62;&#62; /etc/tor/torrc &#62; echo HashedControlPassword $(tor &#8211;hash-password &#8220;mypassword&#8221; &#124; tail -n 1) &#62;&#62; /etc/tor/torrcpassword Start Tor &#62; service tor start Exception: /etc/init.d/tor: line 140: ulimit: open files: cannot modify limit: Operation not permitted Solution: ? Verify the thing &#62; echo -e &#8216;AUTHENTICATE &#8220;password&#8221;&#8216; &#124; nc 127.0.0.1 9051 Check the Public IP &#62; apt install curl My Local IP &#62; curl http://icanhazip.com/ xxx.xxx.244.5 My Proxy IP &#62; torify curl http://icanhazip.com/ 185.56.80.242 Change the IP &#62; echo -e &#8216;AUTHENTICATE &#8220;password&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; &#124; nc 127.0.0.1 9051 &#62; torify curl http://icanhazip.com/ 51.15.86.162 Change and Check IP in Python &#62; pip install stem &#62; python Python 3.5.2 (default, Nov 23 2017, 16:37:01) [GCC 5.4.0 20160609] on linux Type &#8220;help&#8221;, &#8220;copyright&#8221;, &#8220;credits&#8221; or &#8220;license&#8221; for more information. &#62;&#62;&#62; &#62;&#62;&#62; from stem import Signal &#62;&#62;&#62; from stem.control import Controller &#62;&#62;&#62; with Controller.from_port(port=9051) as controller: &#8230;]]></description>
								<content:encoded><![CDATA[<div id="article_content" class="article_content clearfix">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
 <link rel="stylesheet" href="https://csdnimg.cn/release/phoenix/template/css/ck_htmledit_views-3019150162.css">
<div class="htmledit_views" id="content_views">
   2018 Scrapy Environment Enhance(2)Proxy to Tor Network</p>
<p>Follow this Blog and Set the Proxy<br />
  <br />https://gist.github.com/DusanMadar/8d11026b7ce0bce6a67f7dd87b999f6b<br />
  <br />https://stackoverflow.com/questions/45009940/scrapy-with-privoxy-and-tor-how-to-renew-ip</p>
<p>Install Tor thing and Verify<br />
  <br />&gt; apt update<br />
  <br />&gt; apt install tor</p>
<p>Install Client Tool<br />
  <br />&gt; apt install netcat</p>
<p>Set Up Tor<br />
  <br />&gt; echo &#8220;ControlPort 9051&#8221; &gt;&gt; /etc/tor/torrc<br />
  <br />&gt; echo HashedControlPassword $(tor &#8211;hash-password &#8220;mypassword&#8221; | tail -n 1) &gt;&gt; /etc/tor/torrcpassword</p>
<p>Start Tor<br />
  <br />&gt; service tor start</p>
<p>Exception:<br />
  <br />/etc/init.d/tor: line 140: ulimit: open files: cannot modify limit: Operation not permitted</p>
<p>Solution:<br />
  <br />?</p>
<p>Verify the thing<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE &#8220;password&#8221;&#8216; | nc 127.0.0.1 9051</p>
<p>Check the Public IP<br />
  <br />&gt; apt install curl</p>
<p>My Local IP<br />
  <br />&gt; curl http://icanhazip.com/<br />
  <br />xxx.xxx.244.5</p>
<p>My Proxy IP<br />
  <br />&gt; torify curl http://icanhazip.com/<br />
  <br />185.56.80.242</p>
<p>Change the IP<br />
  <br />&gt; echo -e &#8216;AUTHENTICATE &#8220;password&#8221;\r\nsignal NEWNYM\r\nQUIT&#8217; | nc 127.0.0.1 9051</p>
<p>&gt; torify curl http://icanhazip.com/<br />
  <br />51.15.86.162</p>
<p>Change and Check IP in Python<br />
  <br />&gt; pip install stem<br />
  <br />&gt; python<br />
  <br />Python 3.5.2 (default, Nov 23 2017, 16:37:01)<br />
  <br />[GCC 5.4.0 20160609] on linux<br />
  <br />Type &#8220;help&#8221;, &#8220;copyright&#8221;, &#8220;credits&#8221; or &#8220;license&#8221; for more information.<br />
  <br />&gt;&gt;&gt;<br />
  <br />&gt;&gt;&gt; from stem import Signal<br />
  <br />&gt;&gt;&gt; from stem.control import Controller<br />
  <br />&gt;&gt;&gt; with Controller.from_port(port=9051) as controller:<br />
  <br />&#8230; controller.authenticate()<br />
  <br />&#8230; controller.signal(Signal.NEWNYM)<br />
  <br />&#8230;<br />
  <br />&gt;&gt;&gt; exit()</p>
<p>&gt; torify curl http://icanhazip.com/<br />
  <br />142.4.211.161</p>
<p>Install Privoxy and Check<br />
  <br />&gt; apt install privoxy<br />
  <br />Configure to connect to Tor<br />
  <br />&gt; echo &#8220;forward-socks5t / 127.0.0.1:9050 .&#8221; &gt;&gt; /etc/privoxy/config</p>
<p>Start the Service<br />
  <br />&gt; service privoxy start</p>
<p>&gt; curl -x 127.0.0.1:8118 http://icanhazip.com/<br />
  <br />142.4.211.161</p>
<p>Check all the things in Python3<br />
  <br />&gt; pip install requests<br />
  <br />&gt; python<br />
  <br />Python 3.5.2 (default, Nov 23 2017, 16:37:01)<br />
  <br />[GCC 5.4.0 20160609] on linux<br />
  <br />Type &#8220;help&#8221;, &#8220;copyright&#8221;, &#8220;credits&#8221; or &#8220;license&#8221; for more information.<br />
  <br />&gt;&gt;&gt;<br />
  <br />&gt;&gt;&gt; import requests<br />
  <br />&gt;&gt;&gt; from stem import Signal<br />
  <br />&gt;&gt;&gt; from stem.control import Controller<br />
  <br />&gt;&gt;&gt; response = requests.get(&#8216;http://icanhazip.com/&#8217;, proxies={&#8216;http&#8217;: &#8216;127.0.0.1:8118&#8217;})<br />
  <br />&gt;&gt;&gt; response.text.strip()<br />
  <br />&#8216;142.4.211.161&#8217;<br />
  <br />&gt;&gt;&gt; with Controller.from_port(port=9051) as controller:<br />
  <br />&#8230; controller.authenticate(password=&#8217;password&#8217;)<br />
  <br />&#8230; controller.signal(Signal.NEWNYM)<br />
  <br />&#8230;<br />
  <br />&gt;&gt;&gt; response = requests.get(&#8216;http://icanhazip.com/&#8217;, proxies={&#8216;http&#8217;: &#8216;127.0.0.1:8118&#8217;})<br />
  <br />&gt;&gt;&gt; response.text.strip()<br />
  <br />&#8216;95.128.43.164&#8217;</p>
<p>At least it works there in Scrapy framework<br />
  <br />class ChromeHeadlessMiddleware(object):<br />
  <br /> def process_request(self, request, spider):<br />
  <br /> #by pass the access deny<br />
  <br /> #https://intoli.com/blog/making-chrome-headless-undetectable/<br />
  <br /> options = webdriver.ChromeOptions()</p>
<p> options.add_argument(&#8216;headless&#8217;)<br />
  <br /> options.add_argument(&#8216;no-sandbox&#8217;)<br />
  <br /> options.add_argument(&#8216;window-size=800&#215;600&#8217;)<br />
  <br /> options.add_argument(&#8216;user-agent=Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.50 Safari/537.36&#8217;)<br />
  <br /> options.add_argument(&#8216;&#8211;proxy-server=127.0.0.1:8118&#8217;)</p>
<p> browser = webdriver.Chrome(chrome_options=options)<br />
  <br /> browser.switch_to.window(browser.window_handles[0])</p>
<p> browser.get(request.url)<br />
  <br /> body = browser.page_source<br />
  <br /> return HtmlResponse(browser.current_url, body=body, encoding=&#8217;utf-8&#8242;, request=request)</p>
<p>References:<br />
  <br />http://sillycat.iteye.com/blog/2418229</p>
<p>http://neuralfoundry.com/scrapy-in-a-container-docker-development-environment/<br />
  <br />https://github.com/dataisbeautiful/scrapy-development-docker<br />
  <br />https://github.com/scrapy-plugins/scrapy-splash<br />
  <br />https://www.jianshu.com/p/4052926bc12c<br />
  <br />https://www.cnblogs.com/jclian91/p/8590617.html</p>
<p>IP Proxy Setting<br />
  <br />https://free-proxy-list.net/<br />
  <br />https://github.com/cnu/scrapy-random-useragent<br />
  <br />https://github.com/aivarsk/scrapy-proxies<br />
  <br />https://gist.github.com/seagatesoft/e7de4e3878035726731d<br />
  <br />https://stackoverflow.com/questions/28852057/change-ip-address-dynamically<br />
  <br />http://danielphil.github.io/raspberrypi/http/proxy/2015/04/01/raspberry-pi-http-proxy.html<br />
  <br />https://docs.proxymesh.com/article/4-python-proxy-configuration<br />
  <br />https://gist.github.com/DusanMadar/8d11026b7ce0bce6a67f7dd87b999f6b
 </div>
</div>
]]></content:encoded>
										</item>
	</channel>
</rss>
